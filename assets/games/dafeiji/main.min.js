window.Laya=function(o,t){var h={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?h.__presubstr.call(this,t):h.__presubstr.call(this,t,0<e?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__parseInt:function(t){return t?parseInt(t):0},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var s=0;s<t;s++)i[s]=e;return i},__extend:function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var s=e.__lookupGetter__(i),n=e.__lookupSetter__(i);s||n?(s&&t.__defineGetter__(i,s),n&&t.__defineSetter__(i,n)):t[i]=e[i]}function r(){h.un(this,"constructor",t)}r.prototype=e.prototype,t.prototype=new r,h.un(t.prototype,"__imps",h.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;for(var i in t=t||{},e)t[i]=e[i];return t},__package:function(t,e){if(!h.__packages[t]){h.__packages[t]=!0;var i=o,s=t.split(".");if(1<s.length)for(var n=0,r=s.length-1;n<r;n++){var a=i[s[n]];i=a||(i[s[n]]={})}i[s[s.length-1]]||(i[s[s.length-1]]=e||{})}},__hasOwnProperty:function(t,e){return e=e||this,Object.hasOwnProperty.call(e,t)||function t(e,i){if(Object.hasOwnProperty.call(i.prototype,e))return!0;var s=i.prototype.__super;return null==s?null:t(e,s)}(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e==String)return"string"==typeof t;if(e==Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},interface:function(t,e){h.__package(t,{});var i=h.__internals,s=i[t]=i[t]||{};s.self=t,e&&(s.extend=i[e]=i[e]||{});for(var n=o,r=t.split("."),a=0;a<r.length-1;a++)n=n[r[a]];n[r[r.length-1]]={__interface__:t}},class:function(t,e,i,s){if(i&&h.__extend(t,i),e)if(h.__package(e,t),h.__classmap[e]=t,0<e.indexOf(".")){if(0==e.indexOf("laya.")){var n=e.split(".");s=s||n[n.length-1],h[s]&&console.log("warning:class name redefinition,"+e+"/"+h[s]),h[s]=t}}else"Main"==e?o.Main=t:(h[e]&&console.log("warning:class name redefinition,"+e+"/"+h[e]),h[e]=t);var r=h.un,a=t.prototype;r(a,"hasOwnProperty",h.__hasOwnProperty),r(a,"__class",t),r(a,"__super",i),r(a,"__className",e),r(t,"__super",i),r(t,"__className",e),r(t,"__isclass",!0),r(t,"super",function(t){this.__super.call(t)})},imps:function(t,e){if(!e)return null;var i=t.__imps||h.un(t,"__imps",{});for(var s in e){i[s]=e[s];for(var n=s;(n=this.__internals[n])&&(n=n.extend);)i[n=n.self]=!0}},getset:function(t,e,i,s,n){t?(s&&(e["_$GET_"+i]=s),n&&(e["_$SET_"+i]=n)):(s&&h.un(e,"_$get_"+i,s),n&&h.un(e,"_$set_"+i,n)),s&&n?Object.defineProperty(e,i,{get:s,set:n,enumerable:!1}):(s&&Object.defineProperty(e,i,{get:s,enumerable:!1}),n&&Object.defineProperty(e,i,{set:n,enumerable:!1}))},static:function(i,s){for(var n=0,t=s.length;n<t;n+=2)if("length"==s[n])i.length=s[n+1].call(i);else{function e(){var e=s[n],t=s[n+1];Object.defineProperty(i,e,{get:function(){return delete this[e],this[e]=t.call(this)},set:function(t){delete this[e],this[e]=t},enumerable:!0,configurable:!0})}e()}},un:function(t,e,i){return arguments.length<3&&(i=t[e]),h.__propun.value=i,Object.defineProperty(t,e,h.__propun),i},uns:function(e,t){t.forEach(function(t){h.un(e,t)})}};return o.console=o.console||{log:function(){}},o.trace=o.console.log,Error.prototype.throwError=function(){throw arguments},String.prototype.substr=h.__substr,Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),h}(window,document),function(t,e,i){i.un,i.uns,i.static,i.class,i.getset,i.__newvec}(window,document,Laya),function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya.static,__class=Laya.class,__getset=Laya.getset,__newvec=Laya.__newvec;Laya.interface("laya.resource.IDispose"),Laya.interface("laya.display.ILayout"),Laya.interface("laya.filters.IFilter"),Laya.interface("laya.filters.IFilterAction");var wait=Laya.wait=function(t){return Asyn.wait(t)},sleep=Laya.sleep=function(t){Asyn.sleep(t)},_await=Laya.await=function(t,e,i){Asyn._caller_=t,Asyn._callback_=e,Asyn._nextLine_=i},load=Laya.load=function(t,e){return Asyn.load(t,e)},RunDriver=function(){function i(){}return __class(i,"laya.utils.RunDriver"),i.FILTER_ACTIONS=[],i._charSizeTestDiv=null,i.now=function(){return Date.now()},i.getWindow=function(){return window},i.newWebGLContext=function(t,e){return t.getContext(e,{stencil:!0,alpha:!1,antialias:!0,premultipliedAlpha:!1})},i.getPixelRatio=function(t){if(t<0){var e=Browser.ctx,i=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;t=(Browser.window.devicePixelRatio||1)/i}return t},i.getIncludeStr=function(t){return null},i.createShaderCondition=function(t){var e="(function() {return "+t+";})";return Browser.window.eval(e)},i.measureText=function(t,e){return null==i._charSizeTestDiv&&((i._charSizeTestDiv=Browser.createElement("div")).style.cssText="z-index:10000000;padding:0px;position: absolute;left:0px;visibility:hidden;top:0px;background:white",Browser.document.body.appendChild(i._charSizeTestDiv)),i._charSizeTestDiv.style.font=e,i._charSizeTestDiv.innerText=" "==t?"i":t,{width:i._charSizeTestDiv.offsetWidth,height:i._charSizeTestDiv.offsetHeight}},i.benginFlush=function(){},i.endFinish=function(){},i.addToAtlas=null,i.flashFlushImage=function(t){},i.drawToCanvas=function(t,e,i,s,n,r){var a=HTMLCanvas.create("2D"),o=new RenderContext(i,s,a);return RenderSprite.renders[e]._fun(t,o,n,r),a},i.createParticleTemplate2D=null,i.createGLTextur=null,i.createWebGLContext2D=null,i.changeWebGLSize=function(t,e){},i.createRenderSprite=function(t,e){return new RenderSprite(t,e)},i.createFilterAction=function(t){return new ColorFilterAction},i.createGraphics=function(){return new Graphics},i.clear=function(t){Render._context.ctx.clear()},i.clearAtlas=function(t){},i}(),___Laya=(__getset(1,Laya,"alertGlobalError",null,function(t){var r=0;Browser.window.onerror=t?function(t,e,i,s,n){r++<5&&n&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+n.stack)}:null}),Laya.init=function(t,e,i){for(var s=[],n=2,r=arguments.length;n<r;n++)s.push(arguments[n]);Browser.__init__(),Laya.timer=new Timer,Laya.loader=new LoaderManager,n=0;for(var a=s.length;n<a;n++)s[n].enable&&s[n].enable();Font.__init__(),Style.__init__(),ResourceManager.__init__(),Laya.stage=new Stage;var o=Browser.window.location,h=o.pathname;h=":"==h.charAt(2)?h.substring(1):h,URL.rootPath=URL.basePath=URL.getPath("file:"==o.protocol?h:o.origin+h),Laya.initAsyn(),Laya.render=new Render(t,e),Laya.stage.size(t,e),RenderSprite.__init__(),KeyBoardManager.__init__(),MouseManager.instance.__init__()},Laya.initAsyn=function(){Asyn.loadDo=function(t,e,i){var s=new Loader;return i&&(s.once("complete",null,function(t){i.callback(t)}),s.once("error",null,function(t){})),s.load(t,e),i},Asyn.onceTimer=function(t,e){Laya.timer.once(t,e,e.callback)},Asyn.onceEvent=function(t,e){Laya.stage.once(t,null,e)},Laya.timer.frameLoop(1,null,Asyn._loop_)},Laya.stage=null,Laya.timer=null,Laya.loader=null,Laya.render=null,Laya.version="0.9.9",Laya),Config=function(){function t(){}return __class(t,"Config"),t.showLog=!1,t.atlasEnable=!1,t.showCanvasMark=!1,t.CPUMemoryLimit=125829120,t.GPUMemoryLimit=167772160,t.animationInterval=30,t}(),Asyn=function(){function n(){}return __class(n,"laya.asyn.Asyn"),n.wait=function(t){var e=new Deferred;return 0==t.indexOf("event:")?(n.onceEvent(t.substr(8),function(){e.callback()}),null):(e.loopIndex=n._loopCount,n._Deferreds[t]=e)},n.callLater=function(t){n._callLater.push(t)},n.notify=function(t,e){var i=n._Deferreds[t];i&&(n._Deferreds[t]=null,i.callback(e))},n.load=function(t,e){return n.loadDo(t,e,new Deferred)},n.sleep=function(t){t<1?n._loopsCount>=n.loops[n._loopsIndex].length?(n._loopsCount++,n.loops[n._loopsIndex].push(new Deferred)):(n.loops[n._loopsIndex][n._loopsCount]._reset(),n._loopsCount++):n.onceTimer(t,new Deferred)},n._loop_=function(){Deferred._TIMECOUNT_++,n._loopCount++;var t=0;if(0<(t=n._loopsCount)){var e=n.loops[n._loopsIndex];n._loopsCount=0,n._loopsIndex=(n._loopsIndex+1)%2;for(var i=0;i<t;i++)e[i].callback()}if(0<(t=n._callLater.length)){var s=n._callLater;for(n._callLater=[],i=0,t=s.length;i<t;i++){s[i].callback()}}},n._Deferreds={},n.loops=[[],[]],n._loopsIndex=0,n._loopCount=0,n._loopsCount=0,n._callLater=[],n._waitFunctionId=0,n.loadDo=null,n.onceEvent=null,n.onceTimer=null,n._caller_=null,n._callback_=null,n._nextLine_=0,n}(),Deferred=function(){function e(){this._caller=null,this._callback=null,this._nextLine=0,this._value=null,this._createTime=0,this._reset()}__class(e,"laya.asyn.Deferred");var t=e.prototype;return t.setValue=function(t){this._value=t},t.getValue=function(){return this._value},t._reset=function(){this._caller=Asyn._caller_,this._callback=Asyn._callback_,this._nextLine=Asyn._nextLine_,this._createTime=e._TIMECOUNT_},t.callback=function(t){0<arguments.length&&(this._value=t),this._createTime==e._TIMECOUNT_?Asyn.callLater(this):this._callback&&this._callback.call(this._caller,this._nextLine)},t.errback=function(t){0<arguments.length&&(this._value=t),this._callback&&this._callback.call(this._caller,this._nextLine)},e._TIMECOUNT_=0,e}(),EventDispatcher=function(){var o;function e(){this._events=null}__class(e,"laya.events.EventDispatcher");var t=e.prototype;return t.hasListener=function(t){return!!(this._events&&this._events[t])},t.event=function(t,e){if(!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var s=0,n=i.length;s<n;s++){var r=i[s];r&&(null!=e?r.runWith(e):r.run()),r&&!r.once||(i.splice(s,1),s--,n--)}0===i.length&&delete this._events[t]}return!0},t.on=function(t,e,i,s){return this._createListener(t,e,i,s,!1)},t.once=function(t,e,i,s){return this._createListener(t,e,i,s,!0)},t._createListener=function(t,e,i,s,n){this.off(t,e,i,n);var r=o.create(e||this,i,s,n);this._events||(this._events={});var a=this._events;return a[t]?a[t].run?a[t]=[a[t],r]:a[t].push(r):a[t]=r,this},t.off=function(t,e,i,s){if(void 0===s&&(s=!1),!this._events||!this._events[t])return this;var n=this._events[t];if(null!=i)if(n.run)e&&n.caller!==e||n.method!==i||s&&!n.once||(delete this._events[t],n.recover());else{for(var r=0,a=0,o=n.length;a<o;a++){var h=n[a];!h||e&&h.caller!==e||h.method!==i||s&&!h.once||(r++,n[a]=null,h.recover())}r===o&&delete this._events[t]}return this},t.offAll=function(t){var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},t._recoverHandlers=function(t){if(t.run)t.recover();else for(var e=t.length-1;-1<e;e--)t[e]&&(t[e].recover(),t[e]=null)},t.isMouseEvent=function(t){return e.MOUSE_EVENTS[t]},e.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},e.__init$=function(){o=function(t){function n(t,e,i,s){n.__super.call(this,t,e,i,s)}return __class(n,"",Handler),n.prototype.recover=function(){0<this._id&&(this._id=0,n._pool.push(this.clear()))},n.create=function(t,e,i,s){return void 0===s&&(s=!0),n._pool.length?n._pool.pop().setTo(t,e,i,s):new n(t,e,i,s)},n._pool=[],n}()},e}(),Handler=function(){function n(t,e,i,s){this.once=!1,void(this._id=0)===s&&(s=!1),this.setTo(t,e,i,s)}__class(n,"laya.utils.Handler");var t=n.prototype;return t.setTo=function(t,e,i,s){return this._id=n._gid++,this.caller=t,this.method=e,this.args=i,this.once=s,this},t.run=function(){if(null!=this.method){var t=this._id;this.method.apply(this.caller,this.args),this._id===t&&this.once&&this.recover()}},t.runWith=function(t){if(null!=this.method){var e=this._id;null==t?this.method.apply(this.caller,this.args):this.args||t.unshift?this.args?this.method.apply(this.caller,this.args?this.args.concat(t):t):this.method.apply(this.caller,t):this.method.call(this.caller,t),this._id===e&&this.once&&this.recover()}},t.clear=function(){return this.caller=null,this.method=null,this.args=null,this},t.recover=function(){0<this._id&&(this._id=0,n._pool.push(this.clear()))},n.create=function(t,e,i,s){return void 0===s&&(s=!0),n._pool.length?n._pool.pop().setTo(t,e,i,s):new n(t,e,i,s)},n._pool=[],n._gid=1,n}(),BitmapFont=function(){function t(){this.fontSize=12,this.autoScaleSize=!1,this._texture=null,this._fontCharDic={},this._complete=null,this._path=null,this._maxHeight=0,this._maxWidth=0,this._spaceWidth=10,this._leftPadding=0,this._rightPadding=0}__class(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){this._path=t,this._complete=e,Laya.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],Handler.create(this,this.onLoaded))},e.onLoaded=function(){this.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.run()},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");this.fontSize=Laya.__parseInt(i[0].attributes.size.nodeValue);var s=i[0].attributes.padding.nodeValue.split(","),n=Laya.__parseInt(s[0]),r=Laya.__parseInt(s[2]);this._leftPadding=Laya.__parseInt(s[3]),this._rightPadding=Laya.__parseInt(s[1]);var a=t.getElementsByTagName("char"),o=0;for(o=0;o<a.length;o++){var h=a[o].attributes,l=Laya.__parseInt(h.id.nodeValue),u=Laya.__parseInt(h.xoffset.nodeValue)/1,c=Laya.__parseInt(h.yoffset.nodeValue)/1,_=(Laya.__parseInt(h.xadvance.nodeValue),new Rectangle);_.x=Laya.__parseInt(h.x.nodeValue),_.y=Laya.__parseInt(h.y.nodeValue),_.width=Laya.__parseInt(h.width.nodeValue),_.height=Laya.__parseInt(h.height.nodeValue);var d=Texture.create(e,_.x,_.y,_.width,_.height,u,c);this._maxHeight=Math.max(this._maxHeight,n+r+d.height),this._maxWidth=Math.max(this._maxWidth,d.width),this._fontCharDic[l]=d}this.getCharTexture(" ")&&this.setSpaceWidth(this.getCharWidth(" "))}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destory=function(){var t=null;for(var e in this._fontCharDic)(t=this._fontCharDic[e])&&t.destroy(),delete this._fontCharDic[e];this._texture.destroy()},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){if(" "==t)return this._spaceWidth;var e=this.getCharTexture(t);return e?e.width+2*e.offsetX:0},e.getTextWidth=function(t){for(var e=0,i=0,s=t.length;i<s;i++)e+=this.getCharWidth(t[i]);return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this._maxHeight},e.drawText=function(t,e,i,s,n,r){for(var a,o=0,h=0,l=t.length;h<l;h++)o+=this.getCharWidth(t[h]);var u=this._leftPadding;"center"===n&&(u=(r-o)/2),"right"===n&&(u=r-o-this._rightPadding);var c=0;for(h=0,l=t.length;h<l;h++)(a=this.getCharTexture(t[h]))&&e.graphics.drawTexture(a,i+c+u,s,a.width,a.height),c+=this.getCharWidth(t[h])},t}(),Style=function(){function e(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=e._TF_EMPTY}__class(e,"laya.display.css.Style");var t=e.prototype;return t.getTransform=function(){return this._tf},t.setTransform=function(t){this._tf="none"!==t&&t?t:e._TF_EMPTY},t.setTranslateX=function(t){this._tf===e._TF_EMPTY&&(this._tf=e._createTransform()),this._tf.translateX=t},t.setTranslateY=function(t){this._tf===e._TF_EMPTY&&(this._tf=e._createTransform()),this._tf.translateY=t},t.setScaleX=function(t){this._tf===e._TF_EMPTY&&(this._tf=e._createTransform()),this._tf.scaleX=t},t.setScaleY=function(t){this._tf===e._TF_EMPTY&&(this._tf=e._createTransform()),this._tf.scaleY=t},t.setRotate=function(t){this._tf===e._TF_EMPTY&&(this._tf=e._createTransform()),this._tf.rotate=t},t.setSkewX=function(t){this._tf===e._TF_EMPTY&&(this._tf=e._createTransform()),this._tf.skewX=t},t.setSkewY=function(t){this._tf===e._TF_EMPTY&&(this._tf=e._createTransform()),this._tf.skewY=t},t.destroy=function(){this.scrollRect=null},t.render=function(t,e,i,s){},t.getCSSStyle=function(){return CSSStyle.EMPTY},t._enableLayout=function(){return!1},__getset(0,t,"block",function(){return 0!=(1&this._type)}),__getset(0,t,"paddingTop",function(){return 0}),__getset(0,t,"scaleX",function(){return this._tf.scaleX},function(t){this.setScaleX(t)}),__getset(0,t,"scaleY",function(){return this._tf.scaleY},function(t){this.setScaleY(t)}),__getset(0,t,"transform",function(){return this.getTransform()},function(t){this.setTransform(t)}),__getset(0,t,"translateX",function(){return this._tf.translateX},function(t){this.setTranslateX(t)}),__getset(0,t,"translateY",function(){return this._tf.translateY},function(t){this.setTranslateY(t)}),__getset(0,t,"rotate",function(){return this._tf.rotate},function(t){this.setRotate(t)}),__getset(0,t,"skewX",function(){return this._tf.skewX},function(t){this.setSkewX(t)}),__getset(0,t,"skewY",function(){return this._tf.skewY},function(t){this.setSkewY(t)}),__getset(0,t,"absolute",function(){return!0}),__getset(0,t,"paddingLeft",function(){return 0}),e.__init__=function(){e._TF_EMPTY=e._createTransform(),e.EMPTY=new e},e._createTransform=function(){return{translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0,skewX:0,skewY:0}},e.EMPTY=null,e._TF_EMPTY=null,e}(),Font=function(){function e(t){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=Color.create(e.defaultColor),this.family=e.defaultFamily,this.stroke=e._STROKE,this.size=e.defaultSize,t&&t!==e.EMPTY&&t.copyTo(this)}__class(e,"laya.display.css.Font");var t=e.prototype;return t.set=function(t){this._text=null;for(var e=t.split(" "),i=0,s=e.length;i<s;i++){var n=e[i];switch(n){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<n.indexOf("px")&&(this.size=Laya.__parseInt(n),this.family=e[i+1],i++)}},t.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},t.copyTo=function(t){t._type=this._type,t._text=this._text,t._weight=this._weight,t._color=this._color,t.family=this.family,t.stroke=this.stroke!=e._STROKE?this.stroke.slice():e._STROKE,t.indent=this.indent,t.size=this.size},__getset(0,t,"color",function(){return this._color.strColor},function(t){this._color=Color.create(t)}),__getset(0,t,"decoration",function(){return this._decoration?this._decoration.value:"none"},function(t){var e=t.split(" ");switch(this._decoration||(this._decoration={}),e[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=e[0]}e[1]&&(this._decoration.color=Color.create(e)),this._decoration.value=t}),__getset(0,t,"italic",function(){return 0!=(512&this._type)},function(t){t?this._type|=512:this._type&=-513}),__getset(0,t,"bold",function(){return 0!=(2048&this._type)},function(t){t?this._type|=2048:this._type&=-2049}),__getset(0,t,"password",function(){return 0!=(1024&this._type)},function(t){t?this._type|=1024:this._type&=-1025}),__getset(0,t,"weight",function(){return""+this._weight},function(t){var e=0;switch(t){case"normal":break;case"bold":this.bold=!0,e=700;break;case"bolder":e=800;break;case"lighter":e=100;break;default:e=Laya.__parseInt(t)}this._weight=e,this._text=null}),e.__init__=function(){e.EMPTY=new e(null)},e.EMPTY=null,e.defaultColor="#000000",e.defaultSize=12,e.defaultFamily="Arial",e.defaultFont="12px Arial",e._STROKE=[0,"#000000"],e._ITALIC=512,e._PASSWORD=1024,e._BOLD=2048,e}(),Graphics=function(){function u(){this._one=null,this._cmds=null,this._render=this._renderEmpty,this._render=this._renderEmpty}__class(u,"laya.display.Graphics");var t=u.prototype;return t.destroy=function(){this.clear(),this._temp=null,this._bounds=null,this._rstBoundPoints=null,this._sp&&(this._sp._renderType=0),this._sp=null},t.clear=function(){this._one=null,this._render=this._renderEmpty,this._cmds=null,this._temp&&(this._temp.length=0),this._sp&&(this._sp._renderType&=-2),this._sp&&(this._sp._renderType&=-257),this._repaint()},t.empty=function(){return null===this._one&&(!this._cmds||0===this._cmds.length)},t._repaint=function(){this._temp&&(this._temp.length=0),this._sp&&this._sp.repaint()},t._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},t.getBounds=function(){return(!this._bounds||!this._temp||this._temp.length<1)&&(this._bounds=Rectangle._getWrapRec(this.getBoundPoints(),this._bounds)),this._bounds},t.getBoundPoints=function(){return(!this._temp||this._temp.length<1)&&(this._temp=this._getCmdPoints()),this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp)},t._getCmdPoints=function(){var t,e,i=Render._context,s=this._cmds;if((t=this._temp||(this._temp=[])).length=0,s||null==this._one||(s=[this._one]),!s)return[];e=[];for(var n,r=new Matrix,a=u._tempMatrix,o=0,h=s.length;o<h;o++)switch((n=s[o]).callee){case i.save:e.push(r),r=r.clone();break;case i.restore:r=e.pop();break;case i._scale:a.identity(),a.translate(-n[2],-n[3]),a.scale(n[0],n[1]),a.translate(n[2],n[3]),this._switchMatrix(r,a);break;case i._rotate:a.identity(),a.translate(-n[1],-n[2]),a.rotate(n[0]),a.translate(n[1],n[2]),this._switchMatrix(r,a);break;case i._translate:a.identity(),a.translate(n[0],n[1]),this._switchMatrix(r,a);break;case i._transform:a.identity(),a.translate(-n[1],-n[2]),a.concat(n[0]),a.translate(n[1],n[2]),this._switchMatrix(r,a);break;case i._drawTexture:if(n[3]&&n[4])u._addPointArrToRst(t,Rectangle._getBoundPointS(n[1],n[2],n[3],n[4]),r);else{var l=n[0];u._addPointArrToRst(t,Rectangle._getBoundPointS(n[1],n[2],l.width,l.height),r)}break;case i._drawRect:case i._fillRect:u._addPointArrToRst(t,Rectangle._getBoundPointS(n[0],n[1],n[2],n[3]),r);break;case i._drawCircle:case i._fillCircle:u._addPointArrToRst(t,Rectangle._getBoundPointS(n[0]-n[2],n[1]-n[2],n[2]+n[2],n[2]+n[2]),r);break;case i._drawLine:u._addPointArrToRst(t,[n[0],n[1],n[2],n[3]],r);break;case i._drawCurves:u._addPointArrToRst(t,Bezier.I.getBezierPoints(n[2]),r,n[0],n[1]);break;case i._drawPoly:u._addPointArrToRst(t,n[2],r,n[0],n[1]);break;case i._drawPath:u._addPointArrToRst(t,this._getPathPoints(n[2]),r,n[0],n[1]);break;case i._drawPie:case i._drawPieWebGL:u._addPointArrToRst(t,this._getPiePoints(n[0],n[1],n[2],n[3],n[4]),r)}return 200<t.length?t=Utils.copyArray(t,Rectangle._getWrapRec(t)._getBoundPoints()):8<t.length&&(t=GrahamScan.scanPList(t)),t},t._switchMatrix=function(t,e){e.concat(t),e.copy(t)},t.drawTexture=function(t,e,i,s,n,r){void 0===s&&(s=0),void 0===n&&(n=0),this._sp&&(this._sp._renderType|=256),s||(s=t.sourceWidth),n||(n=t.sourceHeight),e+=t.offsetX,i+=t.offsetY,(s=s-t.sourceWidth+t.width)<0&&(s=0),(n=n-t.sourceHeight+t.height)<0&&(n=0);var a=[t,e,i,s,n,r];null==this._one?(this._one=a,this._render=this._renderOneImg):(this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(a)),a.callee=r?Render._context._drawTextureWithTransform:Render._context._drawTexture,this._repaint()},t._textureLoaded=function(t,e){t.off("loaded",this,this._textureLoaded),e[3]=t.width,e[4]=t.height,this._repaint()},t.drawRenderTarget=function(t,e,i,s,n){var r=new Matrix(1,0,0,-1,0,n);this.drawTexture(t,e,i,s,n,r)},t._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=256),null==this._one?(this._one=e,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),e.callee=t,this._temp&&(this._temp.length=0),this._repaint(),e},t.clipRect=function(t,e,i,s){this._saveToCmd(Render._context._clipRect,arguments)},t.fillText=function(t,e,i,s,n,r){this._saveToCmd(Render._context._fillText,[t,e,i,s||Font.defaultFont,n,r])},t.fillBorderText=function(t,e,i,s,n,r,a,o){this._saveToCmd(Render._context._fillBorderText,[t,e,i,s||Font.defaultFont,n,r,a,o])},t.strokeText=function(t,e,i,s,n,r,a){this._saveToCmd(Render._context._strokeText,[t,e,i,s||Font.defaultFont,n,r,a])},t.alpha=function(t){this._saveToCmd(Render._context._alpha,arguments)},t.blendMode=function(t){this._saveToCmd(Render._context._blendMode,arguments)},t.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._transform,[t,e,i])},t.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._rotate,[t,e,i])},t.scale=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0),this._saveToCmd(Render._context._scale,[t,e,i,s])},t.translate=function(t,e){this._saveToCmd(Render._context._translate,[t,e])},t.save=function(){this._saveToCmd(Render._context._save,arguments)},t.restore=function(){this._saveToCmd(Render._context._restore,arguments)},t.replaceText=function(t){this._repaint();var e=this._cmds;if(!e)return this._one&&this._one.callee===Render._context._fillText&&(this._one[0]=t,!0);for(var i=e.length-1;-1<i;i--)if(e[i].callee===Render._context._fillText)return e[i][0]=t,!0;return!1},t.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(!e)return this._one&&(this._one.callee===Render._context._fillBorderText||this._one.callee===Render._context._fillText)&&(this._one[4]=t,!0);for(var i=e.length-1;-1<i;i--)if(e[i].callee===Render._context._fillText)return e[i][4]=t,!0;return!1},t.loadImage=function(t,e,i,s,n,r){var a=this;void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0);var o=Loader.getRes(t);function h(t){t&&(a.drawTexture(t,e,i,s,n),null!=r&&r.call(a._sp,t))}o?h(o):Laya.loader.load(t,Handler.create(null,h),null,"image")},t._renderEmpty=function(t,e,i,s){},t._renderAll=function(t,e,i,s){for(var n,r=this._cmds,a=0,o=r.length;a<o;a++)(n=r[a]).callee.call(e,i,s,n)},t._renderOne=function(t,e,i,s){this._one.callee.call(e,i,s,this._one)},t._renderOneImg=function(t,e,i,s){this._one.callee.call(e,i,s,this._one),2305!==t._renderType&&(t._renderType|=1)},t.drawLine=function(t,e,i,s,n,r){void 0===r&&(r=1);var a=[t+.5,e+.5,i+.5,s+.5,n,r];this._saveToCmd(Render._context._drawLine,a)},t.drawLines=function(t,e,i,s,n){void 0===n&&(n=1);var r=[t+.5,e+.5,i,s,n];Render.isWebGL&&(r[3]=Color.create(s).numColor),this._saveToCmd(Render.isWebGL?Render._context._drawLinesWebGL:Render._context._drawLines,r)},t.drawCurves=function(t,e,i,s,n){void 0===n&&(n=1);var r=[t+.5,e+.5,i,s,n];Render.isWebGL&&(r[3]=Color.create(s).numColor),this._saveToCmd(Render.isWebGL?Render._context._drawCurvesGL:Render._context._drawCurves,r)},t.drawRect=function(t,e,i,s,n,r,a){void 0===a&&(a=1);var o=r?.5:0,h=[t+o,e+o,i,s,n,r,a];this._saveToCmd(Render._context._drawRect,h)},t.drawCircle=function(t,e,i,s,n,r){void 0===r&&(r=1);var a=n?.5:0,o=[t+a,e+a,i,s,n,r];Render.isWebGL&&(o[3]=s?Color.create(s).numColor:s,o[4]=n?Color.create(n).numColor:n),this._saveToCmd(Render.isWebGL?Render._context._drawCircleWebGL:Render._context._drawCircle,o)},t.drawPie=function(t,e,i,s,n,r,a,o){void 0===o&&(o=1);var h=a?.5:0,l=[t+h,e+h,i,s,n,r,a,o];Render.isWebGL&&(s=90-s,n=90-n,l[5]=r?Color.create(r).numColor:r,l[6]=a?Color.create(a).numColor:a),l[3]=Utils.toRadian(s),l[4]=Utils.toRadian(n),this._saveToCmd(Render.isWebGL?Render._context._drawPieWebGL:Render._context._drawPie,l)},t._getPiePoints=function(t,e,i,s,n){var r;r=[t,e];var a=Math.PI/10,o=NaN;for(o=s;o<n;o+=a)r.push(t+i*Math.cos(o),e+i*Math.sin(o));return n!=o&&r.push(t+i*Math.cos(n),e+i*Math.sin(n)),r},t.drawPoly=function(t,e,i,s,n,r){void 0===r&&(r=1);var a=n?.5:0,o=[t+a,e+a,i,s,n,r];Render.isWebGL&&(null!=s&&(o[3]=Color.create(s).numColor),null!=n&&(o[4]=Color.create(n).numColor)),this._saveToCmd(Render.isWebGL?Render._context._drawPolyGL:Render._context._drawPoly,o)},t._getPathPoints=function(t){var e,i,s=0,n=[];for(e=t.length,s=0;s<e;s++)1<(i=t[s]).length&&(n.push(i[1],i[2]),3<i.length&&n.push(i[3],i[4]));return n},t.drawPath=function(t,e,i,s,n){var r=[t+.5,e+.5,i,s,n];this._saveToCmd(Render._context._drawPath,r)},__getset(0,t,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=256),this._cmds=t,this._render=this._renderAll,this._repaint()}),u._addPointArrToRst=function(t,e,i,s,n){void 0===s&&(s=0),void 0===n&&(n=0);var r,a=0;for(r=e.length,a=0;a<r;a+=2)u._addPointToRst(t,e[a]+s,e[a+1]+n,i)},u._addPointToRst=function(t,e,i,s){var n=Point.TEMP;e=e||0,i=i||0,n.setTo(e,i),s.transformPoint(e,i,n),t.push(n.x,n.y)},__static(u,["_tempMatrix",function(){return this._tempMatrix=new Matrix}]),u}(),Event=function(){function t(){}__class(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},__getset(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey}),__getset(0,e,"touches",function(){var t=this.nativeEvent.touches;if(t)for(var e=0,i=t.length;e<i;e++){var s=t[e],n=Point.TEMP;n.setTo(s.clientX,s.clientY),Laya.stage._canvasTransform.invertTransformPoint(n),s.stageX=n.x,s.stageY=n.y}return t}),__getset(0,e,"altKey",function(){return this.nativeEvent.altKey}),__getset(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.ENTER_FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.ENABLED_CHANGED="enabledchanged",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.ACTIVE_CHANGED="activechanged",t.LAYER_CHANGED="layerchanged",t.HIERARCHY_LOADED="hierarchyloaded",t.MEMORY_CHANGED="memorychanged",t.RECOVERING="recovering",t.RECOVERED="recovered",t.RELEASED="released",t.LINK="link",t.LABEL="label",t}(),Keyboard=function(){function t(){}return __class(t,"laya.events.Keyboard"),t.NUMBER_0=48,t.NUMBER_1=49,t.NUMBER_2=50,t.NUMBER_3=51,t.NUMBER_4=52,t.NUMBER_5=53,t.NUMBER_6=54,t.NUMBER_7=55,t.NUMBER_8=56,t.NUMBER_9=57,t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.F13=124,t.F14=125,t.F15=126,t.NUMPAD=21,t.NUMPAD_0=96,t.NUMPAD_1=97,t.NUMPAD_2=98,t.NUMPAD_3=99,t.NUMPAD_4=100,t.NUMPAD_5=101,t.NUMPAD_6=102,t.NUMPAD_7=103,t.NUMPAD_8=104,t.NUMPAD_9=105,t.NUMPAD_ADD=107,t.NUMPAD_DECIMAL=110,t.NUMPAD_DIVIDE=111,t.NUMPAD_ENTER=108,t.NUMPAD_MULTIPLY=106,t.NUMPAD_SUBTRACT=109,t.SEMICOLON=186,t.EQUAL=187,t.COMMA=188,t.MINUS=189,t.PERIOD=190,t.SLASH=191,t.BACKQUOTE=192,t.LEFTBRACKET=219,t.BACKSLASH=220,t.RIGHTBRACKET=221,t.QUOTE=222,t.ALTERNATE=18,t.BACKSPACE=8,t.CAPS_LOCK=20,t.COMMAND=15,t.CONTROL=17,t.DELETE=46,t.ENTER=13,t.ESCAPE=27,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.SHIFT=16,t.SPACE=32,t.TAB=9,t.INSERT=45,t}(),KeyBoardManager=function(){function s(){}return __class(s,"laya.events.KeyBoardManager"),s.__init__=function(){s._addEvent("keydown"),s._addEvent("keypress"),s._addEvent("keyup")},s._addEvent=function(e){Browser.document.addEventListener(e,function(t){laya.events.KeyBoardManager._dispatch(t,e)},!0)},s._dispatch=function(t,e){if(s.enabled){t.keyCode=t.keyCode||t.which||t.charCode,"keydown"===e?s._pressKeys[t.keyCode]=!0:"keyup"===e&&(s._pressKeys[t.keyCode]=null);for(var i=Laya.stage.focus&&null!=Laya.stage.focus.event?Laya.stage.focus:Laya.stage;i;)i.event(e,t),i=i.parent}},s.hasKeyDown=function(t){return s._pressKeys[t]},s._pressKeys={},s.enabled=!0,s}(),MouseManager=function(){function n(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this._stage=null,this._target=null,this._lastOvers=[],this._currOvers=[],this._lastClickTimer=0,this._lastMoveTimer=0,this._isDoubleClick=!1,this._isLeftMouse=!1,this._eventList=[],this._event=new Event,this._matrix=new Matrix,this._point=new Point,this._rect=new Rectangle}__class(n,"laya.events.MouseManager");var t=n.prototype;return t.__init__=function(){this._stage=Laya.stage;var i=this,t=Render.canvas.source,s=this._eventList;Browser.document.oncontextmenu=function(t){if(n.enabled)return!1},t.addEventListener("mousedown",function(t){n.enabled&&(t.preventDefault(),s.push(t),i.mouseDownTime=Browser.now())}),t.addEventListener("mouseup",function(t){n.enabled&&(t.preventDefault(),s.push(t),i.mouseDownTime=-Browser.now())},!0),Browser.document.addEventListener("mousemove",function(t){if(n.enabled){var e=Browser.now();if(e-i._lastMoveTimer<10)return;i._lastMoveTimer=e,s.push(t)}},!0),t.addEventListener("mouseout",function(t){n.enabled&&s.push(t)}),t.addEventListener("mouseover",function(t){n.enabled&&s.push(t)}),t.addEventListener("touchstart",function(t){n.enabled&&(t.preventDefault(),s.push(t),i.mouseDownTime=Browser.now())}),t.addEventListener("touchend",function(t){n.enabled&&(t.preventDefault(),s.push(t),i.mouseDownTime=-Browser.now())},!0),t.addEventListener("touchmove",function(t){n.enabled&&(t.preventDefault(),s.push(t))},!0),t.addEventListener("mousewheel",function(t){n.enabled&&s.push(t)}),t.addEventListener("DOMMouseScroll",function(t){n.enabled&&s.push(t)})},t.initEvent=function(t,e){var i=laya.events.MouseManager.instance;i._event._stoped=!1,i._event.nativeEvent=e||t,i._target=null,this._point.setTo(t.clientX,t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),t.stageX=i.mouseX=this._point.x,t.stageY=i.mouseY=this._point.y,i._event.touchId=t.identifier},t.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=0,i=this._lastOvers.length;e<i;e++){var s=this._lastOvers[e];s.event("mousewheel",this._event.setTo("mousewheel",s,this._target))}},t.checkMouseOut=function(){if(!this.disableMouseEvent){for(var t=0,e=this._lastOvers.length;t<e;t++){var i=this._lastOvers[t];!i.destroyed&&this._currOvers.indexOf(i)<0&&(i._set$P("$_MOUSEOVER",!1),i.event("mouseout",this._event.setTo("mouseout",i,this._target)))}var s=this._lastOvers;this._lastOvers=this._currOvers,this._currOvers=s,this._currOvers.length=0}},t.onMouseMove=function(t){this.sendMouseMove(t),this._event._stoped=!1,this.sendMouseOver(this._target)},t.sendMouseMove=function(t){t.event("mousemove",this._event.setTo("mousemove",t,this._target)),!this._event._stoped&&t.parent&&this.sendMouseMove(t.parent)},t.sendMouseOver=function(t){t.parent&&(t._get$P("$_MOUSEOVER")||(t._set$P("$_MOUSEOVER",!0),t.event("mouseover",this._event.setTo("mouseover",t,this._target))),this._currOvers.push(t)),!this._event._stoped&&t.parent&&this.sendMouseOver(t.parent)},t.onMouseDown=function(t){this._isLeftMouse?(t._set$P("$_MOUSEDOWN",!0),t.event("mousedown",this._event.setTo("mousedown",t,this._target))):(t._set$P("$_RIGHTMOUSEDOWN",!0),t.event("rightmousedown",this._event.setTo("rightmousedown",t,this._target))),!this._event._stoped&&t.parent&&this.onMouseDown(t.parent)},t.onMouseUp=function(t){var e=this._isLeftMouse?"mouseup":"rightmouseup";this.sendMouseUp(t,e),this._event._stoped=!1,this.sendClick(this._target,e)},t.sendMouseUp=function(t,e){t.event(e,this._event.setTo(e,t,this._target)),!this._event._stoped&&t.parent&&this.sendMouseUp(t.parent,e)},t.sendClick=function(t,e){"mouseup"===e&&t._get$P("$_MOUSEDOWN")?(t._set$P("$_MOUSEDOWN",!1),t.event("click",this._event.setTo("click",t,this._target)),this._isDoubleClick&&t.event("doubleclick",this._event.setTo("doubleclick",t,this._target))):"rightmouseup"===e&&t._get$P("$_RIGHTMOUSEDOWN")&&(t._set$P("$_RIGHTMOUSEDOWN",!1),t.event("rightclick",this._event.setTo("rightclick",t,this._target))),!this._event._stoped&&t.parent&&this.sendClick(t.parent,e)},t.check=function(t,e,i,s){var n=t.transform||this._matrix,r=t.pivotX,a=t.pivotY;if(0===r&&0===a)n.setTranslate(t.x,t.y);else if(n===this._matrix)n.setTranslate(t.x-r,t.y-a);else{var o=n.cos,h=n.sin;n.setTranslate(t.x-(r*o-a*h)*t.scaleX,t.y-(r*h+a*o)*t.scaleY)}n.invertTransformPoint(this._point.setTo(e,i)),n.setTranslate(0,0),e=this._point.x,i=this._point.y;var l=t.scrollRect;if(l){this._rect.setTo(0,0,l.width,l.height);var u=this._rect.contains(e,i);if(!u)return!1}if(!this.disableMouseEvent)for(var c=t._childs.length-1;-1<c;c--){var _=t._childs[c];if(_.mouseEnabled&&_.visible&&this.check(_,e+(l?l.x:0),i+(l?l.y:0),s))return!0}if(0<t.width&&0<t.height){var d=this._rect;(u=t.mouseThrough?t.getGraphicBounds().contains(e,i):(t.hitArea?d=t.hitArea:d.setTo(0,0,t.width,t.height),d.contains(e,i)))&&(this._target=t,s.call(this,t))}return u},t.runEvent=function(){var t=this._eventList.length;if(t){for(var e=this,i=0;i<t;){var s=this._eventList[i];switch(s.type){case"mousedown":e._isLeftMouse=0===s.button,e.initEvent(s),e.check(e._stage,e.mouseX,e.mouseY,e.onMouseDown);break;case"mouseup":e._isLeftMouse=0===s.button;var n=Browser.now();e._isDoubleClick=n-e._lastClickTimer<300,e._lastClickTimer=n,e.initEvent(s),e.check(e._stage,e.mouseX,e.mouseY,e.onMouseUp);break;case"mousemove":e.initEvent(s),e.check(e._stage,e.mouseX,e.mouseY,e.onMouseMove),e.checkMouseOut();break;case"touchstart":e._isLeftMouse=!0;for(var r=s.changedTouches,a=0,o=r.length;a<o;a++)e.initEvent(r[a],s),e.check(e._stage,e.mouseX,e.mouseY,e.onMouseDown);break;case"touchend":e._isLeftMouse=!0;var h=s.changedTouches;for(a=0,o=h.length;a<o;a++)e.initEvent(h[a],s),e.check(e._stage,e.mouseX,e.mouseY,e.onMouseUp);break;case"touchmove":var l=s.changedTouches;for(a=0,o=l.length;a<o;a++)e.initEvent(l[a],s),e.check(e._stage,e.mouseX,e.mouseY,e.onMouseMove);e.checkMouseOut();break;case"wheel":case"mousewheel":case"DOMMouseScroll":e.checkMouseWheel(s);break;case"mouseout":e._stage.event("mouseout",e._event.setTo("mouseout",e._stage,e._stage));break;case"mouseover":e._stage.event("mouseover",e._event.setTo("mouseover",e._stage,e._stage))}i++}this._eventList.length=0}},n.enabled=!0,__static(n,["instance",function(){return this.instance=new n}]),n}(),Filter=function(){function t(){this._action=null}__class(t,"laya.filters.Filter");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilter":!0}),__getset(0,e,"type",function(){return-1}),__getset(0,e,"action",function(){return this._action}),t.BLUR=16,t.COLOR=32,t.GLOW=8,t._filterStart=null,t._filterEnd=null,t._EndTarget=null,t._recycleScope=null,t._filter=null,t._useSrc=null,t._endSrc=null,t._useOut=null,t._endOut=null,t}(),ColorFilterAction=function(){function t(){this.data=null}__class(t,"laya.filters.ColorFilterAction");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){var e=t.ctx.ctx,i=t.ctx.ctx.canvas;if(0==i.width||0==i.height)return i;for(var s,n=e.getImageData(0,0,i.width,i.height),r=n.data,a=0,o=r.length;a<o;a+=4)s=this.getColor(r[a],r[a+1],r[a+2],r[a+3]),0!=r[a+3]&&(r[a]=s[0],r[a+1]=s[1],r[a+2]=s[2],r[a+3]=s[3]);return e.putImageData(n,0,0),t},e.getColor=function(t,e,i,s){var n=[];if(this.data._elements){var r=this.data._elements;n[0]=r[0]*t+r[1]*e+r[2]*i+r[3]*s+r[4],n[1]=r[5]*t+r[6]*e+r[7]*i+r[8]*s+r[9],n[2]=r[10]*t+r[11]*e+r[12]*i+r[13]*s+r[14],n[3]=r[15]*t+r[16]*e+r[17]*i+r[18]*s+r[19]}return n},t}(),Arith=function(){function t(){}return __class(t,"laya.maths.Arith"),t.formatR=function(t){return t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),t},t.isPOT=function(t,e){return 0<t&&0==(t&t-1)&&0<e&&0==(e&e-1)},t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx,t.ty,e[0]=t.a,e[1]=t.b,e[4]=t.c,e[5]=t.d,e[12]=t.tx,e[13]=t.ty},t}(),Bezier=function(){function t(){this.controlPoints=[new Point,new Point,new Point],this._calFun=this.getPoint2}__class(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this.controlPoints.shift();i.setTo(t,e),this.controlPoints.push(i)},e.getPoint2=function(t,e){var i=this.controlPoints[0],s=this.controlPoints[1],n=this.controlPoints[2],r=Math.pow(1-t,2)*i.x+2*t*(1-t)*s.x+Math.pow(t,2)*n.x,a=Math.pow(1-t,2)*i.y+2*t*(1-t)*s.y+Math.pow(t,2)*n.y;e.push(r,a)},e.getPoint3=function(t,e){var i=this.controlPoints[0],s=this.controlPoints[1],n=this.controlPoints[2],r=this.controlPoints[3],a=Math.pow(1-t,3)*i.x+3*s.x*t*(1-t)*(1-t)+3*n.x*t*t*(1-t)+r.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*s.y*t*(1-t)*(1-t)+3*n.y*t*t*(1-t)+r.y*Math.pow(t,3);e.push(a,o)},e.insertPoints=function(t,e){var i,s=0;for(i=1/(t=0<t?t:5),s=0;s<=1;s+=i)this._calFun(s,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var s,n,r=0;if((s=t.length)<2*(i+1))return[];switch(n=[],i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(r=0;r<2*i;r+=2)this._switchPoint(t[r],t[r+1]);for(r=2*i;r<s;r+=2)this._switchPoint(t[r],t[r+1]),r/2%i==0&&this.insertPoints(e,n);return n},__static(t,["I",function(){return this.I=new t}]),t}(),GrahamScan=function(){function l(){}return __class(l,"laya.maths.GrahamScan"),l.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},l.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},l._getPoints=function(t,e,i){for(void 0===e&&(e=!1),l._mPointList||(l._mPointList=[]);l._mPointList.length<t;)l._mPointList.push(new Point);return i||(i=[]),i.length=0,e?l.getFrom(i,l._mPointList,t):l.getFromR(i,l._mPointList,t),i},l.getFrom=function(t,e,i){var s=0;for(s=0;s<i;s++)t.push(e[s]);return t},l.getFromR=function(t,e,i){var s=0;for(s=0;s<i;s++)t.push(e.pop());return t},l.pListToPointList=function(t,e){void 0===e&&(e=!1);var i=0,s=t.length/2,n=l._getPoints(s,e,l._tempPointList);for(i=0;i<s;i++)n[i].setTo(t[i+i],t[i+i+1]);return n},l.pointListToPlist=function(t){var e,i=0,s=t.length,n=l._temPList;for(i=n.length=0;i<s;i++)e=t[i],n.push(e.x,e.y);return n},l.scanPList=function(t){return Utils.copyArray(t,l.pointListToPlist(l.scan(l.pListToPointList(t,!0))))},l.scan=function(t){var e,i,s,n=0,r=0,a=0,o=t.length,h={};for((i=l._temArr).length=0,n=(o=t.length)-1;0<=n;n--)s=(e=t[n]).x+"_"+e.y,h.hasOwnProperty(s)||(h[s]=!0,i.push(e));for(o=i.length,Utils.copyArray(t,i),n=1;n<o;n++)(t[n].y<t[a].y||t[n].y==t[a].y&&t[n].x<t[a].x)&&(a=n);for(e=t[0],t[0]=t[a],t[a]=e,n=1;n<o-1;n++){for(r=(a=n)+1;r<o;r++)(0<l.multiply(t[r],t[a],t[0])||0==l.multiply(t[r],t[a],t[0])&&l.dis(t[0],t[r])<l.dis(t[0],t[a]))&&(a=r);e=t[n],t[n]=t[a],t[a]=e}if((i=l._temArr).length=0,t.length<3)return Utils.copyArray(i,t);for(i.push(t[0],t[1],t[2]),n=3;n<o;n++){for(;2<=i.length&&0<=l.multiply(t[n],i[i.length-1],i[i.length-2]);)i.pop();t[n]&&i.push(t[n])}return i},l._mPointList=null,l._tempPointList=[],l._temPList=[],l._temArr=[],l}(),MathUtil=function(){function n(){}return __class(n,"laya.maths.MathUtil"),n.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},n.lerp=function(t,e,i){return t*(1-i)+e*i},n.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},n.lerpVector3=function(t,e,i,s){var n=t[0],r=t[1],a=t[2];s[0]=n+i*(e[0]-n),s[1]=r+i*(e[1]-r),s[2]=a+i*(e[2]-a)},n.lerpVector4=function(t,e,i,s){var n=t[0],r=t[1],a=t[2],o=t[3];s[0]=n+i*(e[0]-n),s[1]=r+i*(e[1]-r),s[2]=a+i*(e[2]-a),s[3]=o+i*(e[3]-o)},n.slerpQuaternionArray=function(t,e,i,s,n,r,a){var o,h,l,u,c,_=t[e+0],d=t[e+1],f=t[e+2],p=t[e+3],g=i[s+0],m=i[s+1],y=i[s+2],v=i[s+3];return(h=_*g+d*m+f*y+p*v)<0&&(h=-h,g=-g,m=-m,y=-y,v=-v),c=1e-6<1-h?(o=Math.acos(h),l=Math.sin(o),u=Math.sin((1-n)*o)/l,Math.sin(n*o)/l):(u=1-n,n),r[a+0]=u*_+c*g,r[a+1]=u*d+c*m,r[a+2]=u*f+c*y,r[a+3]=u*p+c*v,r},n.getRotation=function(t,e,i,s){return Math.atan2(i-t,s-e)/Math.PI*180},n.SortBigFirst=function(t,e){return t==e?0:t<e?1:-1},n.SortSmallFirst=function(t,e){return t==e?0:t<e?-1:1},n.SortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},n.SortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},n.SortByKey=function(i,t,e){var s;return void 0===t&&(t=!1),void 0===e&&(e=!0),s=t?e?n.SortNumBigFirst:n.SortBigFirst:e?n.SortNumSmallFirst:n.SortSmallFirst,function(t,e){return s(t[i],e[i])}},n}(),Matrix=function(){function i(t,e,i,s,n,r){this.cos=1,this.sin=0,this.inPool=!1,this.bTransform=!1,void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===n&&(n=0),void 0===r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=r,this._checkTransform()}__class(i,"laya.maths.Matrix");var t=i.prototype;return t.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},t._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},t.setTranslate=function(t,e){this.tx=t,this.ty=e},t.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.scale=function(t,e){this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this.bTransform=!0},t.rotate=function(t){var e=this.cos=Math.cos(t),i=this.sin=Math.sin(t),s=this.a,n=this.c,r=this.tx;this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e,this.bTransform=!0},t.skew=function(t,e){var i=Math.tan(t),s=Math.tan(e),n=this.a,r=this.b;return this.a+=s*this.c,this.b+=s*this.d,this.c+=i*n,this.d+=i*r,this},t.invertTransformPoint=function(t){var e=this.a,i=this.b,s=this.c,n=this.d,r=this.tx,a=e*n-i*s,o=n/a,h=-i/a,l=-s/a,u=e/a,c=(s*this.ty-n*r)/a,_=-(e*this.ty-i*r)/a;t.setTo(o*t.x+l*t.y+c,h*t.x+u*t.y+_)},t.transformPoint=function(t,e,i){i.setTo(this.a*t+this.c*e+this.tx,this.b*t+this.d*e+this.ty)},t.transformPointArray=function(t,e){for(var i=t.length,s=0;s<i;s+=2){var n=t[s],r=t[s+1];e[s]=this.a*n+this.c*r+this.tx,e[s+1]=this.b*n+this.d*r+this.ty}},t.transformPointArrayScale=function(t,e){for(var i=t.length,s=0;s<i;s+=2){var n=t[s],r=t[s+1];e[s]=this.a*n+this.c*r,e[s+1]=this.b*n+this.d*r}},t.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},t.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},t.invert=function(){var t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,r=t*s-e*i;return this.a=s/r,this.b=-e/r,this.c=-i/r,this.d=t/r,this.tx=(i*this.ty-s*n)/r,this.ty=-(t*this.ty-e*n)/r,this},t.setTo=function(t,e,i,s,n,r){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=r,this},t.concat=function(t){var e=this.a,i=this.c,s=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=s*t.a+this.ty*t.c+t.tx,this.ty=s*t.b+this.ty*t.d+t.ty,this},t.clone=function(){var t=i._cache,e=t._length?t[--t._length]:new i;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e.bTransform=this.bTransform,e},t.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},t.destroy=function(){if(!this.inPool){var t=i._cache;this.inPool=!0,t._length||(t._length=0),(t[t._length++]=this).a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},i.mul=function(t,e,i){var s=t.a,n=t.b,r=t.c,a=t.d,o=t.tx,h=t.ty,l=e.a,u=e.b,c=e.c,_=e.d,d=e.tx,f=e.ty;return i.ty=0!==u||0!==c?(i.a=s*l+n*c,i.b=s*u+n*_,i.c=r*l+a*c,i.d=r*u+a*_,i.tx=l*o+c*h+d,u*o+_*h+f):(i.a=s*l,i.b=n*_,i.c=r*l,i.d=a*_,i.tx=l*o+d,_*h+f),i},i.mulPre=function(t,e,i,s,n,r,a,o){var h=t.a,l=t.b,u=t.c,c=t.d,_=t.tx,d=t.ty;return o.ty=0!==i||0!==s?(o.a=h*e+l*s,o.b=h*i+l*n,o.c=u*e+c*s,o.d=u*i+c*n,o.tx=e*_+s*d+r,i*_+n*d+a):(o.a=h*e,o.b=l*n,o.c=u*e,o.d=c*n,o.tx=e*_+r,n*d+a),o},i.mulPos=function(t,e,i,s,n,r,a,o){var h=t.a,l=t.b,u=t.c,c=t.d,_=t.tx,d=t.ty;return o.ty=0!==l||0!==u?(o.a=e*h+i*u,o.b=e*l+i*c,o.c=s*h+n*u,o.d=s*l+n*c,o.tx=h*r+u*a+_,l*r+c*a+d):(o.a=e*h,o.b=i*c,o.c=s*h,o.d=n*c,o.tx=h*r+_,c*a+d),o},i.preMul=function(t,e,i){var s=t.a,n=t.b,r=t.c,a=t.d,o=e.a,h=e.b,l=e.c,u=e.d,c=e.tx,_=e.ty;return i.a=o*s,i.b=i.c=0,i.d=u*a,i.tx=c*s+t.tx,i.ty=_*a+t.ty,0===h&&0===l&&0===n&&0===r||(i.a+=h*r,i.d+=l*n,i.b+=o*n+h*a,i.c+=l*s+u*r,i.tx+=_*r,i.ty+=c*n),i},i.preMulXY=function(t,e,i,s){var n=t.a,r=t.b,a=t.c,o=t.d;return s.a=n,s.b=r,s.c=a,s.d=o,s.tx=e*n+t.tx+i*a,s.ty=i*o+t.ty+e*r,s},i.create=function(){var t=i._cache,e=t._length?t[--t._length]:new i;return e.inPool=!1,e},i.EMPTY=new i,i.TEMP=new i,i._cache=[],i}(),Point=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}__class(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},t.TEMP=new t,t.EMPTY=new t,t}(),Rectangle=function(){function l(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.x=t,this.y=e,this.width=i,this.height=s}__class(l,"laya.maths.Rectangle");var t=l.prototype;return t.setTo=function(t,e,i,s){return this.x=t,this.y=e,this.width=i,this.height=s,this},t.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom)},t.intersects=function(t){return!(t.x>this.right||t.right<this.x||t.y>this.bottom||t.bottom<this.y)},t.intersection=function(t,e){return this.intersects(t)?(e||(e=new l),e.x=Math.max(this.x,t.x),e.y=Math.max(this.y,t.y),e.width=Math.min(this.right,t.right)-e.x,e.height=Math.min(this.bottom,t.bottom)-e.y,e):null},t.union=function(t,e){return e||(e=new l),this.clone(e),t.width<=0||t.height<=0?e:(e.addPoint(t.x,t.y),e.addPoint(t.right,t.bottom),this)},t.clone=function(t){return t||(t=new l),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},t.equal=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)},t.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},t._getBoundPoints=function(){var t=l._temB;return(t.length=0)==this.width||0==this.height||t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),t},__getset(0,t,"right",function(){return this.x+this.width}),__getset(0,t,"bottom",function(){return this.y+this.height}),l._getBoundPointS=function(t,e,i,s){var n=l._temA;return(n.length=0)==i||0==s||n.push(t,e,t+i,e,t,e+s,t+i,e+s),n},l._getWrapRec=function(t,e){if(!t||t.length<1)return e?e.setTo(0,0,0,0):l.EMPTY;e=e||new l;var i,s,n,r,a,o=t.length,h=Point.TEMP;for(n=a=-(s=r=99999),i=0;i<o;i+=2)h.x=t[i],h.y=t[i+1],s=s<h.x?s:h.x,r=r<h.y?r:h.y,n=n>h.x?n:h.x,a=a>h.y?a:h.y;return e.setTo(s,r,n-s,a-r)},l.EMPTY=new l,l.TEMP=new l,l._temB=[],l._temA=[],l}(),SoundManager=function(){function a(){}return __class(a,"laya.media.SoundManager"),__getset(1,a,"autoStopMusic",function(){return a._autoStopMusic},function(t){Laya.stage.off("blur",null,a._stageOnBlur),Laya.stage.off("focus",null,a._stageOnFocus),(a._autoStopMusic=t)&&(Laya.stage.on("blur",null,a._stageOnBlur),Laya.stage.on("focus",null,a._stageOnFocus))}),__getset(1,a,"muted",function(){return a._muted},function(t){t&&a._tMusic&&a.stopSound(a._tMusic),a._muted=t}),__getset(1,a,"soundMuted",function(){return a._soundMuted},function(t){a._soundMuted=t}),__getset(1,a,"musicMuted",function(){return a._musicMuted},function(t){t?(a._tMusic&&a.stopSound(a._tMusic),a._musicMuted=t):(a._musicMuted=t,a._tMusic&&a.playMusic(a._tMusic))}),a.addChannel=function(t){0<=a._channels.indexOf(t)||a._channels.push(t)},a.removeChannel=function(t){var e=0;for(e=a._channels.length-1;0<=e;e--)a._channels[e]==t&&a._channels.splice(e,1)},a._stageOnBlur=function(){a._musicChannel&&(a._musicChannel.isStopped||(a._blurPaused=!0,a._musicChannel.stop()))},a._stageOnFocus=function(){a._blurPaused&&(a.playMusic(a._tMusic),a._blurPaused=!1)},a.playSound=function(t,e,i,s){if(void 0===e&&(e=1),a._muted)return null;if(t==a._tMusic){if(a._musicMuted)return null}else if(a._soundMuted)return null;var n,r=Laya.loader.getRes(t);return s||(s=Sound),r||((r=new s).load(t),Loader.cacheRes(t,r)),(n=r.play(0,e)).url=t,n.volume=t==a._tMusic?a.musicVolume:a.soundVolume,n.completeHandler=i,n},a.destroySound=function(t){var e=Laya.loader.getRes(t);e&&(Loader.clearRes(t),e.dispose())},a.playMusic=function(t,e,i){return void 0===e&&(e=0),a._tMusic=t,a._musicChannel&&a._musicChannel.stop(),a._musicChannel=a.playSound(t,e,i,null)},a.stopSound=function(t){var e,i=0;for(i=a._channels.length-1;0<=i;i--)(e=a._channels[i]).url==t&&e.stop()},a.stopMusic=function(){a._musicChannel&&a._musicChannel.stop()},a.setSoundVolume=function(t,e){e?a._setVolume(e,t):a.soundVolume=t},a.setMusicVolume=function(t){a.musicVolume=t,a._setVolume(a._tMusic,t)},a._setVolume=function(t,e){var i,s=0;for(s=a._channels.length-1;0<=s;s--)(i=a._channels[s]).url==t&&(i.volume=e)},a.musicVolume=1,a.soundVolume=1,a._muted=!1,a._soundMuted=!1,a._musicMuted=!1,a._tMusic=null,a._musicChannel=null,a._channels=[],a._autoStopMusic=!1,a._blurPaused=!1,a}(),LocalStorage=function(){function i(){}return __class(i,"laya.net.LocalStorage"),i.setItem=function(t,e){try{i.support&&i.items.setItem(t,e)}catch(t){console.log("set localStorage failed",t)}},i.getItem=function(t){return i.support?i.items.getItem(t):null},i.setJSON=function(t,e){try{i.support&&i.items.setItem(t,JSON.stringify(e))}catch(t){console.log("set localStorage failed",t)}},i.getJSON=function(t){return JSON.parse(i.support?i.items.getItem(t):null)},i.removeItem=function(t){i.support&&i.items.removeItem(t)},i.clear=function(){i.support&&i.items.clear()},i.items=null,i.support=!1,i.__init$=function(){if(window.localStorage){i.items=window.localStorage;try{localStorage.setItem("laya","1"),localStorage.removeItem("laya"),i.support=!0}catch(t){}}i.support||console.log("LocalStorage is not supprot or browser is private mode.")},i}(),URL=function(){function i(t){this._url=null,this._path=null,this._url=i.formatURL(t),this._path=i.getPath(t)}__class(i,"laya.net.URL");var t=i.prototype;return __getset(0,t,"url",function(){return this._url}),__getset(0,t,"path",function(){return this._path}),i.formatURL=function(t,e){return null!=i.customFormat&&(t=i.customFormat(t,e)),t?(0==Render.isConchApp&&i.version[t]&&(t+="?v="+i.version[t]),"~"==t.charAt(0)?i.rootPath+t.substring(1):i.isAbsolute(t)?t:(e||i.basePath)+t):"null path"},i.isAbsolute=function(t){return 0<t.indexOf(":")||"/"==t.charAt(0)},i.getPath=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(0,e+1):""},i.getName=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(e+1):t},i.version={},i.basePath="",i.rootPath="",i.customFormat=null,i}(),Render=function(){function n(t,e){var i=(n._mainCanvas=HTMLCanvas.create("2D")).source.style;i.position="absolute",i.top=i.left="0px",i.background="#000000",n._mainCanvas.source.id="layaCanvas";var s=laya.renders.Render.isWebGL;s&&n.WebGL.init(n.canvas,t,e),Browser.document.getElementById("small-game").appendChild(n._mainCanvas.source),n._context=new RenderContext(t,e,s?null:n._mainCanvas),Browser.window.requestAnimationFrame(function t(){Laya.stage._loop();Browser.window.requestAnimationFrame(t)})}return __class(n,"laya.renders.Render"),__getset(1,n,"context",function(){return n._context}),__getset(1,n,"canvas",function(){return n._mainCanvas}),n._context=null,n._mainCanvas=null,n.WebGL=null,n.isConchApp=!1,n.isWebGL=!1,n.is3DMode=!1,n}(),RenderContext=function(){function a(t,e,i){this.x=0,this.y=0,this._drawTexture=function(t,e,i){i[0].loaded?this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],t,e):this.ctx._repaint=!0},this._drawTextureWithTransform=function(t,e,i){i[0].loaded?this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e):this.ctx._repaint=!0},this._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawRect=function(t,e,i){var s=this.ctx;null!=i[4]&&(s.fillStyle=i[4],s.fillRect(t+i[0],e+i[1],i[2],i[3],null)),null!=i[5]&&(s.strokeStyle=i[5],s.lineWidth=i[6],s.strokeRect(t+i[0],e+i[1],i[2],i[3],i[6]))},this._drawPolyGL=function(t,e,i){var s=i[2];t+=i[0],e+=i[1],this.ctx.drawPoly(t,e,s,i[3],i[5],i[4])},this._drawPie=function(t,e,i){var s=this.ctx;s.translate(t+i[0],e+i[1]),s.beginPath(),s.moveTo(0,0),s.arc(0,0,i[2],i[3],i[4]),s.closePath(),this._fillAndStroke(i[5],i[6],i[7]),s.translate(-t-i[0],-e-i[1])},this._drawPieWebGL=function(t,e,i){var s=this.ctx;s.lineWidth=i[7],s.fan(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])},this._fillRect=function(t,e,i){this.ctx.fillRect(t+i[0],e+i[1],i[2],i[3],i[4])},this._drawCircle=function(t,e,i){var s=this.ctx;s.beginPath(),s.arc(i[0]+t,i[1]+e,i[2],0,a.PI2),this._fillAndStroke(i[3],i[4],i[5])},this._drawCircleWebGL=function(t,e,i){this.ctx.drawCircle(t+this.x+i[0],e+this.y+i[1],i[2],40,i[4],i[5],i[3])},this._fillCircle=function(t,e,i){var s=this.ctx;s.beginPath(),s.fillStyle=i[3],s.arc(i[0]+t,i[1]+e,i[2],0,a.PI2),s.fill()},this._setShader=function(t,e,i){this.ctx.setShader(i[0])},this._drawLine=function(t,e,i){var s=this.ctx;s.beginPath(),s.strokeStyle=i[4],s.lineWidth=i[5],s.moveTo(t+i[0],e+i[1]),s.lineTo(t+i[2],e+i[3]),s.stroke()},this._drawLines=function(t,e,i){var s=this.ctx;s.beginPath(),s.strokeStyle=i[3],s.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],s.moveTo(t+n[0],e+n[1]);for(var r=2,a=n.length;r<a;)s.lineTo(t+n[r++],e+n[r++]);s.stroke()},this._drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(t,e,i){var s=this.ctx;s.beginPath(),s.strokeStyle=i[3],s.lineWidth=i[4];var n=i[2];t+=i[0],e+=i[1],s.moveTo(t+n[0],e+n[1]);for(var r=2,a=n.length;r<a;)s.quadraticCurveTo(t+n[r++],e+n[r++],t+n[r++],e+n[r++]);s.stroke()},this._drawCurvesGL=function(t,e,i){var s=i[2];t+=i[0],e+=i[1];for(var n=Bezier.I,r=0,a=s.length,o=[];r<a;){var h=n.getBezierPoints([s[r++],s[r++],s[r++],s[r++],s[r++],s[r++]],30,2);o=o.concat(h),r<a&&(r-=2)}this.ctx.drawLines(t,e,o,i[3],i[4])},this._draw=function(t,e,i){i[0].call(null,this,t,e)},this._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(t,e,i){this.ctx.save()},this._restore=function(t,e,i){this.ctx.restore()},this._translate=function(t,e,i){this.ctx.translate(i[0],i[1])},this._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var s=i[0];this.ctx.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),this.ctx.translate(-t-i[1],-e-i[2])},this._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e),this.ctx.rotate(i[0]),this.ctx.translate(-t-i[1],-e-i[2])},this._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e),this.ctx.scale(i[0],i[1]),this.ctx.translate(-t-i[2],-e-i[3])},this._alpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._fillText=function(t,e,i){this.ctx.fillText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])},this._strokeText=function(t,e,i){this.ctx.strokeText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])},this._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])},this.drawPath=function(t,e,i){this.ctx.drawPath(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawPath=function(t,e,i){var s=this.ctx;s.beginPath(),t+=i[0],e+=i[1];for(var n=i[2],r=0,a=n.length;r<a;r++){var o=n[r];switch(o[0]){case"moveTo":s.moveTo(t+o[1],e+o[2]);break;case"lineTo":s.lineTo(t+o[1],e+o[2]);break;case"arcTo":s.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":s.closePath()}}var h=i[3];null!=h&&(s.fillStyle=h.fillStyle,s.fill());var l=i[4];null!=l&&(s.strokeStyle=l.strokeStyle,s.lineWidth=l.lineWidth||1,s.lineJoin=l.lineJoin,s.lineCap=l.lineCap,s.miterLimit=l.miterLimit,s.stroke())},this.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(t,e,i){var s=this.ctx;s.beginPath();var n=i[2];t+=i[0],e+=i[1],s.moveTo(t+n[0],e+n[1]);for(var r=2,a=n.length;r<a;)s.lineTo(t+n[r++],e+n[r++]);s.closePath(),this._fillAndStroke(i[3],i[4],i[5])},this._drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])},i?this.ctx=i.getContext("2d"):(i=HTMLCanvas.create("3D"),this.ctx=RunDriver.createWebGLContext2D(i),i._setContext(this.ctx)),i.size(t,e),this.canvas=i}__class(a,"laya.renders.RenderContext");var t=a.prototype;return t.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},t.drawTexture=function(t,e,i,s,n){t.loaded?this.ctx.drawTexture(t,e,i,s,n,this.x,this.y):this.ctx._repaint=!0},t.drawTextureWithTransform=function(t,e,i,s,n,r){t.loaded?this.ctx.drawTextureWithTransform(t,e,i,s,n,r,this.x,this.y):this.ctx._repaint=!0},t.fillQuadrangle=function(t,e,i,s,n){this.ctx.fillQuadrangle(t,e,i,s,n)},t.drawCanvas=function(t,e,i,s,n){this.ctx.drawCanvas(t,e+this.x,i+this.y,s,n)},t.drawRect=function(t,e,i,s,n,r){void 0===r&&(r=1);var a=this.ctx;a.strokeStyle=n,a.lineWidth=r,a.strokeRect(t+this.x,e+this.y,i,s,r)},t._fillAndStroke=function(t,e,i){var s=this.ctx;null!=t&&(s.fillStyle=t,s.fill()),null!=e&&(s.strokeStyle=e,s.lineWidth=i,s.stroke())},t.clipRect=function(t,e,i,s){this.ctx.clipRect(t+this.x,e+this.y,i,s)},t.fillRect=function(t,e,i,s,n){this.ctx.fillRect(t+this.x,e+this.y,i,s,n)},t.drawCircle=function(t,e,i,s,n){void 0===n&&(n=1);var r=this.ctx;r.beginPath(),r.strokeStyle=s,r.lineWidth=n,r.arc(t+this.x,e+this.y,i,0,a.PI2),r.stroke()},t.fillCircle=function(t,e,i,s){var n=this.ctx;n.beginPath(),n.fillStyle=s,n.arc(t+this.x,e+this.y,i,0,a.PI2),n.fill()},t.setShader=function(t){this.ctx.setShader(t)},t.drawLine=function(t,e,i,s,n,r){void 0===r&&(r=1);var a=this.ctx;a.beginPath(),a.strokeStyle=n,a.lineWidth=r,a.moveTo(this.x+t,this.y+e),a.lineTo(this.x+i,this.y+s),a.stroke()},t.clear=function(){this.ctx.clear()},t.transformByMatrix=function(t){this.ctx.transformByMatrix(t)},t.setTransform=function(t,e,i,s,n,r){this.ctx.setTransform(t,e,i,s,n,r)},t.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)},t.save=function(){this.ctx.save()},t.restore=function(){this.ctx.restore()},t.translate=function(t,e){this.ctx.translate(t,e)},t.transform=function(t,e,i,s,n,r){this.ctx.transform(t,e,i,s,n,r)},t.rotate=function(t){this.ctx.rotate(t)},t.scale=function(t,e){this.ctx.scale(t,e)},t.alpha=function(t){this.ctx.globalAlpha=t},t.setAlpha=function(t){this.ctx.globalAlpha=t},t.fillWords=function(t,e,i,s,n){this.ctx.fillWords(t,e,i,s,n)},t.fillText=function(t,e,i,s,n,r){this.ctx.fillText(t,e+this.x,i+this.y,s,n,r)},t.strokeText=function(t,e,i,s,n,r,a){this.ctx.strokeText(t,e+this.x,i+this.y,s,n,r,a)},t.blendMode=function(t){this.ctx.globalCompositeOperation=t},t.flush=function(){this.ctx.flush&&this.ctx.flush()},t.addRenderObject=function(t){this.ctx.addRenderObject(t)},t.beginClip=function(t,e,i,s){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,s)},t.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},t.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],4<i.length?i[4]:null)},__getset(0,t,"enableMerge",null,function(t){this.ctx.enableMerge=t}),a.PI2=2*Math.PI,a}(),RenderSprite=function(){function a(t,e){switch(this._next=e||a.NORENDER,t){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 4:return void(this._fun=this._alpha);case 8:return void(this._fun=this._transform);case 32:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._clip);case 128:return void(this._fun=this._style);case 256:return void(this._fun=this._graphics);case 1024:return void(this._fun=this._enableRenderMerge);case 2048:return void(this._fun=this._childs);case 512:return void(this._fun=this._custom);case 257:case 265:return void(this._fun=this._image2);case 2:return void(this._fun=Filter._filter);case 69905:return void(this._fun=a._initRenderFun)}this.onCreate(t)}__class(a,"laya.renders.RenderSprite");var t=a.prototype;return t.onCreate=function(t){},t._style=function(t,e,i,s){t._style.render(t,e,i,s);var n=this._next;n._fun.call(n,t,e,i,s)},t._no=function(t,e,i,s){},t._custom=function(t,e,i,s){t.customRender(e,i,s);var n=t._style._tf;this._next._fun.call(this._next,t,e,i-n.translateX,s-n.translateY)},t._clip=function(t,e,i,s){var n=this._next;if(n!=a.NORENDER){var r=t._style.scrollRect;e.ctx.save(),e.ctx.clipRect(i,s,r.width,r.height),n._fun.call(n,t,e,i-r.x,s-r.y),e.ctx.restore()}},t._enableRenderMerge=function(t,e,i,s){var n=this._next;n!=a.NORENDER&&(e.ctx.save(),e.ctx.enableMerge=!0,n._fun.call(n,t,e,i,s),e.ctx.restore())},t._blend=function(t,e,i,s){var n=t._style;n.blendMode&&(e.ctx.globalCompositeOperation=n.blendMode);var r=this._next;r._fun.call(r,t,e,i,s);var a=t.mask;a&&(e.ctx.globalCompositeOperation="destination-in",(0<a.numChildren||!a.graphics._isOnlyOne())&&(a.cacheAsBitmap=!0),a.render(e,i,s)),e.ctx.globalCompositeOperation="source-over"},t._graphics=function(t,e,i,s){var n=t._style._tf;t._graphics&&t._graphics._render(t,e,i-n.translateX,s-n.translateY);var r=this._next;r._fun.call(r,t,e,i,s)},t._image=function(t,e,i,s){var n=t._style;e.ctx.drawTexture2(i,s,n._tf.translateX,n._tf.translateY,t.transform,n.alpha,n.blendMode,t._graphics._one)},t._image2=function(t,e,i,s){var n=t._style._tf;e.ctx.drawTexture2(i,s,n.translateX,n.translateY,t.transform,1,null,t._graphics._one)},t._alpha=function(t,e,i,s){var n;if(.01<(n=t._style.alpha)){var r=e.ctx.globalAlpha;e.ctx.globalAlpha*=n;var a=this._next;a._fun.call(a,t,e,i,s),e.ctx.globalAlpha=r}},t._transform=function(t,e,i,s){var n=t.transform,r=this._next;n&&r!=a.NORENDER?(e.save(),e.transform(n.a,n.b,n.c,n.d,n.tx+i,n.ty+s),r._fun.call(r,t,e,0,0),e.restore()):r._fun.call(r,t,e,i,s)},t._childs=function(t,e,i,s){var n=t._style;i+=-n._tf.translateX+n.paddingLeft,s+=-n._tf.translateY+n.paddingTop;var r=t._getWords();r&&e.fillWords(r,i,s,n.font,n.color);var a,o=t._childs,h=o.length;if(t.optimizeFloat&&null!=t.scrollRect){var l=t.scrollRect;for(u=0;u<h;++u)(a=o[u])._style.visible&&l.intersects(Rectangle.TEMP.setTo(a.x,a.y,a.width,a.height))&&a.render(e,i,s)}else for(var u=0;u<h;++u)(a=o[u])._style.visible&&a.render(e,i,s)},t._canvas=function(t,e,i,s){var n=t._$P.cacheCanvas,r=this._next;if(n){var a,o,h,l,u=n.ctx,c=t.isRepaint()||!u||u.ctx._repaint;if("bitmap"===n.type?Stat.canvasBitmap++:Stat.canvasNormal++,c){var _,d;if(n._cacheRec||(n._cacheRec=new Rectangle),l=t.getSelfBounds(),Render.isWebGL&&"bitmap"===n.type&&(2048<l.width||2048<l.height))throw new Error("cache bitmap size larger than 2048");if(l.x-=t.pivotX,l.y-=t.pivotY,l.x-=10,l.y-=10,l.width+=20,l.height+=20,l.x=Math.floor(l.x+i)-i,l.y=Math.floor(l.y+s)-s,l.width=Math.floor(l.width),l.height=Math.floor(l.height),n._cacheRec.copyFrom(l),_=(l=n._cacheRec).width*Browser.pixelRatio,d=l.height*Browser.pixelRatio,o=l.x,h=l.y,u||((u=n.ctx=new RenderContext(_,d,HTMLCanvas.create("AUTO"))).ctx.sprite=t),a=u.canvas,"bitmap"===n.type&&(a.asBitmap=!0),a.clear(),(a.width!=_||a.height!=d)&&a.size(_,d),1<Browser.pixelRatio){var f=u.ctx;f.save(),f.scale(Browser.pixelRatio,Browser.pixelRatio),r._fun.call(r,t,u,-o,-h),t.applyFilters(),f.restore()}else r._fun.call(r,t,u,-o,-h),t.applyFilters();t._$P.isStatic&&(n.reCache=!1),Stat.canvasReCache++}else o=(l=n._cacheRec).x,h=l.y,a=u.canvas;e.drawCanvas(a,i+o,s+h,l.width,l.height)}else r._fun.call(r,t,u,i,s)},a.__init__=function(){var t,e,i=0;for(e=RunDriver.createRenderSprite(69905,null),t=a.renders.length=4096,i=0;i<t;i++)a.renders[i]=e;a.renders[0]=RunDriver.createRenderSprite(0,null),function(t,e){for(var i=0,s=0;s<t.length;s++)i|=t[s],a.renders[i]=e}([1,256,8,4],new a(1,null)),a.renders[257]=RunDriver.createRenderSprite(257,null),a.renders[265]=new a(265,null)},a._initRenderFun=function(t,e,i,s){var n=t._renderType;(a.renders[n]=a._getTypeRender(n))._fun(t,e,i,s)},a._getTypeRender=function(t){for(var e=null,i=2048;1<i;)i&t&&(e=RunDriver.createRenderSprite(i,e)),i>>=1;return e},a.IMAGE=1,a.FILTERS=2,a.ALPHA=4,a.TRANSFORM=8,a.CANVAS=16,a.BLEND=32,a.CLIP=64,a.STYLE=128,a.GRAPHICS=256,a.CUSTOM=512,a.ENABLERENDERMERGE=1024,a.CHILDS=2048,a.INIT=69905,a.renders=[],a.NORENDER=new a(0,null),a}(),Context=function(){function i(){this._repaint=!1}__class(i,"laya.resource.Context");var t=i.prototype;return t.drawCanvas=function(t,e,i,s,n){Stat.drawCall++,this.drawImage(t.source,e,i,s,n)},t.fillRect=function(t,e,i,s,n){Stat.drawCall++,n&&(this.fillStyle=n),this.__fillRect(t,e,i,s)},t.fillText=function(t,e,i,s,n,r){Stat.drawCall++,3<arguments.length&&null!=s&&(this.font=s,this.fillStyle=n,this.textAlign=r,this.textBaseline="top"),this.__fillText(t,e,i)},t.fillBorderText=function(t,e,i,s,n,r,a,o){Stat.drawCall++,this.font=s,this.fillStyle=n,this.textBaseline="top",this.strokeStyle=r,this.lineWidth=a,this.textAlign=o,this.__strokeText(t,e,i),this.__fillText(t,e,i)},t.strokeText=function(t,e,i,s,n,r,a){Stat.drawCall++,3<arguments.length&&null!=s&&(this.font=s,this.strokeStyle=n,this.lineWidth=r,this.textAlign=a,this.textBaseline="top"),this.__strokeText(t,e,i)},t.transformByMatrix=function(t){this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.clipRect=function(t,e,i,s){Stat.drawCall++,this.beginPath(),this.rect(t,e,i,s),this.clip()},t.drawTexture=function(t,e,i,s,n,r,a){Stat.drawCall++;var o=t.uv,h=t.bitmap.width,l=t.bitmap.height;this.drawImage(t.bitmap.source,o[0]*h,o[1]*l,(o[2]-o[0])*h,(o[5]-o[3])*l,e+r,i+a,s,n)},t.drawTextureWithTransform=function(t,e,i,s,n,r,a,o){Stat.drawCall++;var h=t.uv,l=t.bitmap.width,u=t.bitmap.height;this.save(),this.transform(r.a,r.b,r.c,r.d,r.tx+a,r.ty+o),this.drawImage(t.bitmap.source,h[0]*l,h[1]*u,(h[2]-h[0])*l,(h[5]-h[3])*u,e,i,s,n),this.restore()},t.drawTexture2=function(t,e,i,s,n,r,a,o){"use strict";Stat.drawCall++;var h=1!==r;if(h){var l=this.globalAlpha;this.globalAlpha*=r}var u=o[0],c=u.uv,_=u.bitmap.width,d=u.bitmap.height;n?(this.save(),this.transform(n.a,n.b,n.c,n.d,n.tx+t,n.ty+e),this.drawImage(u.bitmap.source,c[0]*_,c[1]*d,(c[2]-c[0])*_,(c[5]-c[3])*d,o[1]-i,o[2]-s,o[3],o[4]),this.restore()):this.drawImage(u.bitmap.source,c[0]*_,c[1]*d,(c[2]-c[0])*_,(c[5]-c[3])*d,o[1]-i+t,o[2]-s+e,o[3],o[4]),h&&(this.globalAlpha=l)},t.flush=function(){return 0},t.fillWords=function(t,e,i,s,n){s&&(this.font=s),n&&(this.fillStyle=n);this.textBaseline="top",this.textAlign="left";for(var r=0,a=t.length;r<a;r++){var o=t[r];this.__fillText(o.char,o.x+e,o.y+i)}},t.destroy=function(){this.canvas.width=this.canvas.height=0},t.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},__getset(0,t,"enableMerge",function(){return!1},function(t){}),i._init=function(t,e){e.__fillText=e.fillText,e.__fillRect=e.fillRect,e.__strokeText=e.strokeText;["fillWords","fillRect","strokeText","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText"].forEach(function(t){e[t]=i._default[t]})},i._default=new i,i}(),ResourceManager=function(){function r(){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++r._uniqueIDCounter,this._name="Content Manager",r._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,r._resourceManagers.push(this),this._resources=[]}__class(r,"laya.resource.ResourceManager");var t=r.prototype;return Laya.imps(t,{"laya.resource.IDispose":!0}),t.getResourceByIndex=function(t){return this._resources[t]},t.getResourcesLength=function(){return this._resources.length},t.addResource=function(t){return t.resourceManager&&t.resourceManager.removeResource(t),-1===this._resources.indexOf(t)&&((t._resourceManager=this)._resources.push(t),this.addSize(t.memorySize),t.on("memorychanged",this,this.addSize),!0)},t.removeResource=function(t){var e=this._resources.indexOf(t);return-1!==e&&(this._resources.splice(e,1),t._resourceManager=null,this._memorySize-=t.memorySize,t.off("memorychanged",this,this.addSize),!0)},t.unload=function(){if(this===r._systemResourceManager)throw new Error("systemResourceManager不能被释放！");for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){var i=t[e];i.resourceManager.removeResource(i),i.dispose()}t.length=0},t.setUniqueName=function(t){for(var e=!0,i=0;i<r._resourceManagers.length;i++)if(r._resourceManagers[i]._name===t&&r._resourceManagers[i]!==this)return void(e=!1);e?this.name!=t&&(this.name=t,r._isResourceManagersSorted=!1):this.setUniqueName(t.concat("-copy"))},t.dispose=function(){if(this===r._systemResourceManager)throw new Error("systemResourceManager不能被释放！");r._resourceManagers.splice(r._resourceManagers.indexOf(this),1),r._isResourceManagersSorted=!1;for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){var i=t[e];i.resourceManager.removeResource(i),i.dispose()}t.length=0},t.addSize=function(t){t&&(this.autoRelease&&0<t&&this._memorySize+t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=t)},t.garbageCollection=function(t){var e=this._resources;(e=e.slice()).sort(function(t,e){if(!t||!e)throw new Error("a或b不能为空！");return t.released&&e.released?0:t.released?1:e.released?-1:t.lastUseFrameCount-e.lastUseFrameCount});for(var i=Stat.loopCount,s=0,n=e.length;s<n;s++){var r=e[s];if(!(1<i-r.lastUseFrameCount))return void(this._memorySize>=t&&(this._isOverflow=!0));if(r.releaseResource(),this._memorySize<t)return void(this._isOverflow=!1)}},__getset(0,t,"id",function(){return this._id}),__getset(0,t,"name",function(){return this._name},function(t){!t&&""===t||this._name===t||(this._name=t,r._isResourceManagersSorted=!1)}),__getset(0,t,"memorySize",function(){return this._memorySize}),__getset(1,r,"sortedResourceManagersByName",function(){return r._isResourceManagersSorted||(r._isResourceManagersSorted=!0,r._resourceManagers.sort(r.compareResourceManagersByName)),r._resourceManagers}),__getset(1,r,"systemResourceManager",function(){return null===r._systemResourceManager&&((r._systemResourceManager=new r)._name="System Resource Manager"),r._systemResourceManager}),r.__init__=function(){r.currentResourceManager=r.systemResourceManager},r.getLoadedResourceManagerByIndex=function(t){return r._resourceManagers[t]},r.getLoadedResourceManagersCount=function(){return r._resourceManagers.length},r.recreateContentManagers=function(t){void 0===t&&(t=!1);for(var e=r.currentResourceManager,i=0;i<r._resourceManagers.length;i++){r.currentResourceManager=r._resourceManagers[i];for(var s=0;s<r.currentResourceManager._resources.length;s++)r.currentResourceManager._resources[s].releaseResource(t),r.currentResourceManager._resources[s].activeResource(t)}r.currentResourceManager=e},r.releaseContentManagers=function(t){void 0===t&&(t=!1);for(var e=r.currentResourceManager,i=0;i<r._resourceManagers.length;i++){r.currentResourceManager=r._resourceManagers[i];for(var s=0;s<r.currentResourceManager._resources.length;s++){var n=r.currentResourceManager._resources[s];!n.released&&n.releaseResource(t)}}r.currentResourceManager=e},r.compareResourceManagersByName=function(t,e){if(t==e)return 0;var i=t._name,s=e._name;if(null==i)return null==s?0:-1;if(null==s)return 1;var n=i.localeCompare(s);return 0!=n?n:(e.setUniqueName(s),s=e._name,i.localeCompare(s))},r._uniqueIDCounter=0,r._systemResourceManager=null,r._isResourceManagersSorted=!1,r._resourceManagers=[],r.currentResourceManager=null,r}(),System=function(){function System(){}return __class(System,"laya.system.System"),System.changeDefinition=function(name,classObj){Laya[name]=classObj;var str=name+"=classObj";eval(str)},System.__init__=function(){Render.isConchApp=!!window.conch,Render.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())},System}(),Browser=function(){function a(){}return __class(a,"laya.utils.Browser"),__getset(1,a,"clientWidth",function(){return a.document.body.clientWidth}),__getset(1,a,"clientHeight",function(){return a.document.body.clientHeight||a.document.documentElement.clientHeight}),__getset(1,a,"pixelRatio",function(){return RunDriver.getPixelRatio(a._pixelRatio)}),__getset(1,a,"width",function(){return a.__init__(),(Laya.stage&&Laya.stage.canvasRotation?a.clientHeight:a.clientWidth)*a.pixelRatio}),__getset(1,a,"height",function(){return a.__init__(),(Laya.stage&&Laya.stage.canvasRotation?a.clientWidth:a.clientHeight)*a.pixelRatio}),a.__init__=function(){a.canvas||(a.canvas=HTMLCanvas.create("2D"),a.ctx=a.canvas.getContext("2d"))},a.createElement=function(t){return a.document.__createElement(t)},a.getElementById=function(t){return a.document.getElementById(t)},a.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},a.now=function(){return RunDriver.now()},a.window=RunDriver.getWindow(),a.userAgent=a.window.navigator.userAgent,a.onIOS=!!(a.u=a.userAgent).match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),a.onMobile=!!a.u.match(/AppleWebKit.*Mobile.*/),a.onIPhone=-1<a.u.indexOf("iPhone"),a.onIPad=-1<a.u.indexOf("iPad"),a.onAndriod=-1<a.u.indexOf("Android")||-1<a.u.indexOf("Adr"),a.onWP=-1<a.u.indexOf("Windows Phone"),a.onQQBrowser=-1<a.u.indexOf("QQBrowser"),a.onMQQBrowser=-1<a.u.indexOf("MQQBrowser"),a.onWeiXin=-1<a.u.indexOf("MicroMessenger"),a.onPC=!a.onMobile,a.httpProtocol="http:"==a.window.location.protocol,a.webAudioOK=!!(a.window.AudioContext||a.window.webkitAudioContext||a.window.mozAudioContext),a.soundType=a.webAudioOK?"WEBAUDIOSOUND":"AUDIOSOUND",a.canvas=null,a.ctx=null,a._pixelRatio=-1,__static(a,["document",function(){return this.document=a.window.document}]),a.__init$=function(){a.document.__createElement=a.document.createElement,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};var t=window.document.body.style;t.margin=0,t.overflow="hidden";for(var e=window.document.getElementsByTagName("meta"),i=0,s=!1,n="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";i<e.length;){var r=e[i];if("viewport"==r.name){r.content=n,s=!0;break}i++}s||((r=document.createElement("meta")).name="viewport",r.content=n,document.getElementsByTagName("head")[0].appendChild(r)),Sound=a.webAudioOK?WebAudioSound:AudioSound,a.webAudioOK&&WebAudioSound.initWebAudio()},a}(),Byte=function(){function e(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}__class(e,"laya.utils.Byte");var t=e.prototype;return t.___resizeBuffer=function(e){try{var t=new Uint8Array(e);null!=this._u8d_&&(this._u8d_.length<=e?t.set(this._u8d_):t.set(this._u8d_.subarray(0,e))),this._u8d_=t,this._d_=new DataView(t.buffer)}catch(t){throw"___resizeBuffer err:"+e}},t.getString=function(){return this.rUTF(this.getUint16())},t.getFloat32Array=function(t,e){var i=new Float32Array(this._d_.buffer.slice(t,t+e));return this._pos_+=e,i},t.getUint8Array=function(t,e){var i=new Uint8Array(this._d_.buffer.slice(t,t+e));return this._pos_+=e,i},t.getInt16Array=function(t,e){var i=new Int16Array(this._d_.buffer.slice(t,t+e));return this._pos_+=e,i},t.getFloat32=function(){var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},t.writeFloat32=function(t){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},t.getInt32=function(){var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},t.getUint32=function(){var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},t.writeInt32=function(t){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},t.writeUint32=function(t){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},t.getInt16=function(){var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},t.getUint16=function(){var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},t.writeUint16=function(t){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},t.writeInt16=function(t){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},t.getUint8=function(){return this._d_.getUint8(this._pos_++)},t.writeUint8=function(t){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t,this._xd_),this._pos_++},t._getUInt8=function(t){return this._d_.getUint8(t)},t._getUint16=function(t){return this._d_.getUint16(t,this._xd_)},t._getMatrix=function(){return new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},t.rUTF=function(t){for(var e="",i=this._pos_+t,s=0,n=String.fromCharCode,r=this._u8d_;this._pos_<i;)(s=r[this._pos_++])<128?0!=s&&(e+=n(s)):e+=n(s<224?(63&s)<<6|127&r[this._pos_++]:s<240?(31&s)<<12|(127&r[this._pos_++])<<6|127&r[this._pos_++]:(15&s)<<18|(127&r[this._pos_++])<<12|r[this._pos_++]<<6&127|127&r[this._pos_++]),0;return e},t.getCustomString=function(t){for(var e="",i=0,s=0,n=String.fromCharCode,r=this._u8d_;0<t;)if((s=r[this._pos_])<128)e+=n(s),this._pos_++,t--;else for(i=s-128,this._pos_++,t-=i;0<i;)s=r[this._pos_++],e+=n(r[this._pos_++]<<8|s),i--;return e},t.clear=function(){this._pos_=0,this.length=0},t.__getBuffer=function(){return this._d_.buffer},t.writeUTFBytes=function(t){for(var e=0,i=(t+="").length;e<i;e++){var s=t.charCodeAt(e);s<=127?this.writeByte(s):(s<=2047?this.writeByte(192|s>>6):(s<=65535?this.writeByte(224|s>>12):(this.writeByte(240|s>>18),this.writeByte(128|s>>12&63)),this.writeByte(128|s>>6&63)),this.writeByte(128|63&s))}},t.writeUTFString=function(t){var e;e=this.pos,this.writeInt16(1),this.writeUTFBytes(t);var i;i=this.pos-e-2,this._d_.setInt16(e,i,this._xd_)},t.readUTFString=function(){this.pos;var t;return t=this.getInt16(),this.readUTFBytes(t)},t.readUTFBytes=function(t){return void 0===t&&(t=-1),t=0<t?t:this.bytesAvailable,this.rUTF(t)},t.writeByte=function(t){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},t.ensureWrite=function(t){this._length<t&&(this.length=t)},t.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this.ensureWrite(this._pos_+i);var s=new Uint8Array(t);this._u8d_.set(s.subarray(e,e+i),this._pos_),this._pos_+=i},__getset(0,t,"buffer",function(){return this._u8d_.buffer}),__getset(0,t,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"==t}),__getset(0,t,"bytesAvailable",function(){return this.length-this._pos_}),__getset(0,t,"length",function(){return this._length},function(t){this._allocated_<t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this.___resizeBuffer(this._allocated_=t),this._length=t}),__getset(0,t,"pos",function(){return this._pos_},function(t){this._pos_=t,this._d_.byteOffset=t}),e.getSystemEndian=function(){if(!e._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,!0),e._sysEndian=256===new Int16Array(t)[0]?"littleEndian":"bigEndian"}return e._sysEndian},e.BIG_ENDIAN="bigEndian",e.LITTLE_ENDIAN="littleEndian",e._sysEndian=null,e}(),ClassUtils=function(){function _(){}return __class(_,"laya.utils.ClassUtils"),_.regClass=function(t,e){_._classMap[t]=e},_.getRegClass=function(t){return _._classMap[t]},_.getClass=function(t){var e=_._classMap[t]||t;return"string"==typeof e?Laya.__classmap[e]:e},_.getInstance=function(t){var e=_.getClass(t);return e?new e:(console.log("[error] Undefined class:",t),null)},_.createByJson=function(t,e,i,s){"string"==typeof t&&(t=JSON.parse(t));var n=t.props;if(!e&&!(e=_.getInstance(n.runtime||t.type)))return null;var r=t.child;if(r)for(var a=0,o=r.length;a<o;a++){var h=r[a];"render"===h.props.name&&e._$set_itemRender?e.itemRender=h:e.addChild(_.createByJson(h,null,i,s))}if(n)for(var l in n){var u=n[l];"var"===l&&i?i[u]=e:u instanceof Array&&"function"==typeof e[l]?e[l].apply(e,u):e[l]=u}var c=t.customProps;if(s&&c)for(l in c)u=c[l],s.runWith([e,l,u]);return e.created&&e.created(),e},_._classMap={Sprite:"laya.display.Sprite",Sprite3D:"laya.d3.core.Sprite3D",Mesh:"laya.d3.core.mesh.Mesh",Sky:"laya.d3.core.sky.Sky",Text:"laya.display.Text",div:"laya.html.dom.HTMLDivElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},_}(),Color=function(){function i(t){if(this._color=[],"string"==typeof t){null===(this.strColor=t)&&(t="#000000"),"#"==t.charAt(0)&&(t=t.substr(1));var e=this.numColor=parseInt(t,16);if(8==t.length)return void(this._color=[parseInt(t.substr(0,2),16)/255,((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255])}else e=this.numColor=t,this.strColor=Utils.toHexColor(e);this._color=[((16711680&e)>>16)/255,((65280&e)>>8)/255,(255&e)/255,1],this._color.__id=++i._COLODID}return __class(i,"laya.utils.Color"),i._initDefault=function(){for(var t in i._DEFAULT={},i._COLOR_MAP)i._SAVE[t]=i._DEFAULT[t]=new i(i._COLOR_MAP[t]);return i._DEFAULT},i._initSaveMap=function(){for(var t in i._SAVE_SIZE=0,i._SAVE={},i._DEFAULT)i._SAVE[t]=i._DEFAULT[t]},i.create=function(t){var e=i._SAVE[t+""];return null!=e?e:(i._SAVE_SIZE<1e3||i._initSaveMap(),i._SAVE[t+""]=new i(t))},i._SAVE={},i._SAVE_SIZE=0,i._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},i._DEFAULT=i._initDefault(),i._COLODID=1,i}(),Dictionary=function(){function t(){this._elements=[],this._keys=[]}__class(t,"laya.utils.Dictionary");var e=t.prototype;return e.set=function(t,e){var i=this.indexOf(t);0<=i?this._elements[i]=e:(this._keys.push(t),this._elements.push(e))},e.indexOf=function(t){var e=this._keys.indexOf(t);return 0<=e?e:(t="string"==typeof t?Number(t):"number"==typeof t?t.toString():t,this._keys.indexOf(t))},e.get=function(t){var e=this.indexOf(t);return e<0?null:this._elements[e]},e.remove=function(t){var e=this.indexOf(t);return 0<=e&&(this._keys.splice(e,1),this._elements.splice(e,1),!0)},e.clear=function(){this._elements.length=0,this._keys.length=0},__getset(0,e,"elements",function(){return this._elements}),__getset(0,e,"keys",function(){return this._keys}),t}(),Dragging=function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}__class(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,i,s,n,r,a){this.clearTimer(),this.target=t,this.area=e,this.hasInertia=i,this.elasticDistance=s,this.elasticBackTime=n,this.data=r,this._disableMouseEvent=a,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=Laya.stage.mouseX,this._lastY=Laya.stage.mouseY,Laya.stage.on("mouseup",this,this.onStageMouseUp),Laya.stage.on("mouseout",this,this.onStageMouseUp),Laya.timer.frameLoop(1,this,this.loop)},e.clearTimer=function(){Laya.timer.clear(this,this.loop),Laya.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=Laya.stage.mouseX,e=Laya.stage.mouseY,i=t-this._lastX,s=e-this._lastY;if(this._clickOnly){if(!(1<Math.abs(i*Laya.stage._canvasTransform.getScaleX())||1<Math.abs(s*Laya.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),MouseManager.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(i,s),this._lastX=t,this._lastY=e;0===i&&0===s||(this.target.x+=i*this._elasticRateX,this.target.y+=s*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var t=this.area.x-this.target.x;else t=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target.y<this.area.y)var e=this.area.y-this.target.y;else e=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(t){if(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),Laya.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(Laya.stage.mouseX-this._lastX,Laya.stage.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,i=Math.min(e,6),s=this._offsets.length-i,n=e-1;s<n;n--)this._offsetY+=this._offsets[n--],this._offsetX+=this._offsets[n];this._offsetX=this._offsetX/i*2,this._offsetY=this._offsetY/i*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),Laya.timer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},e.checkElastic=function(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target.x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target.y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=Tween.to(this.target,i,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(Laya.timer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,t.event("dragend",this.data)}},t}(),Ease=function(){function o(){}return __class(o,"laya.utils.Ease"),o.linearNone=function(t,e,i,s){return i*t/s+e},o.linearIn=function(t,e,i,s){return i*t/s+e},o.linearInOut=function(t,e,i,s){return i*t/s+e},o.linearOut=function(t,e,i,s){return i*t/s+e},o.bounceIn=function(t,e,i,s){return i-o.bounceOut(s-t,0,i,s)+e},o.bounceInOut=function(t,e,i,s){return t<.5*s?.5*o.bounceIn(2*t,0,i,s)+e:.5*o.bounceOut(2*t-s,0,i,s)+.5*i+e},o.bounceOut=function(t,e,i,s){return(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},o.backIn=function(t,e,i,s,n){return void 0===n&&(n=1.70158),i*(t/=s)*t*((n+1)*t-n)+e},o.backInOut=function(t,e,i,s,n){return void 0===n&&(n=1.70158),(t/=.5*s)<1?.5*i*(t*t*((1+(n*=1.525))*t-n))+e:i/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},o.backOut=function(t,e,i,s,n){return void 0===n&&(n=1.70158),i*((t=t/s-1)*t*((n+1)*t+n)+1)+e},o.elasticIn=function(t,e,i,s,n,r){var a;return void 0===n&&(n=0),void 0===r&&(r=0),0==t?e:1==(t/=s)?e+i:(r||(r=.3*s),a=!n||0<i&&n<i||i<0&&n<-i?(n=i,r/4):r/o.PI2*Math.asin(i/n),-n*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*o.PI2/r)+e)},o.elasticInOut=function(t,e,i,s,n,r){var a;return void 0===n&&(n=0),void 0===r&&(r=0),0==t?e:2==(t/=.5*s)?e+i:(r||(r=s*(.3*1.5)),a=!n||0<i&&n<i||i<0&&n<-i?(n=i,r/4):r/o.PI2*Math.asin(i/n),t<1?n*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*o.PI2/r)*-.5+e:n*Math.pow(2,-10*(t-=1))*Math.sin((t*s-a)*o.PI2/r)*.5+i+e)},o.elasticOut=function(t,e,i,s,n,r){var a;return void 0===n&&(n=0),void 0===r&&(r=0),0==t?e:1==(t/=s)?e+i:(r||(r=.3*s),a=!n||0<i&&n<i||i<0&&n<-i?(n=i,r/4):r/o.PI2*Math.asin(i/n),n*Math.pow(2,-10*t)*Math.sin((t*s-a)*o.PI2/r)+i+e)},o.strongIn=function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},o.strongInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.strongOut=function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},o.sineInOut=function(t,e,i,s){return.5*-i*(Math.cos(Math.PI*t/s)-1)+e},o.sineIn=function(t,e,i,s){return-i*Math.cos(t/s*o.HALF_PI)+i+e},o.sineOut=function(t,e,i,s){return i*Math.sin(t/s*o.HALF_PI)+e},o.quintIn=function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},o.quintInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.quintOut=function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},o.quartIn=function(t,e,i,s){return i*(t/=s)*t*t*t+e},o.quartInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},o.quartOut=function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},o.cubicIn=function(t,e,i,s){return i*(t/=s)*t*t+e},o.cubicInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},o.cubicOut=function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},o.QuadIn=function(t,e,i,s){return i*(t/=s)*t+e},o.QuadInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},o.QuadOut=function(t,e,i,s){return-i*(t/=s)*(t-2)+e},o.expoIn=function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e-.001*i},o.expoInOut=function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=.5*s)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(2-Math.pow(2,-10*--t))+e},o.expoOut=function(t,e,i,s){return t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e},o.circIn=function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},o.circInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},o.circOut=function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},o.HALF_PI=.5*Math.PI,o.PI2=2*Math.PI,o}(),HTMLChar=function(){function n(t,e,i,s){this.char=t,this.charNum=t.charCodeAt(0),this._x=this._y=0,this.width=e,this.height=i,this.style=s,this.isWord=!n._isWordRegExp.test(t)}__class(n,"laya.utils.HTMLChar");var t=n.prototype;return Laya.imps(t,{"laya.display.ILayout":!0}),t.setSprite=function(t){this._sprite=t},t.getSprite=function(){return this._sprite},t._isChar=function(){return!0},t._getCSSStyle=function(){return this.style},__getset(0,t,"x",function(){return this._x},function(t){this._sprite&&(this._sprite.x=t),this._x=t}),__getset(0,t,"y",function(){return this._y},function(t){this._sprite&&(this._sprite.y=t),this._y=t}),__getset(0,t,"width",function(){return this._w},function(t){this._w=t}),__getset(0,t,"height",function(){return this._h},function(t){this._h=t}),n._isWordRegExp=new RegExp("[\\w.]",""),n}(),LaterEvent=function(){var r;function a(){}return __class(a,"laya.utils.LaterEvent"),a.add=function(t,e,i,s){var n=a._cache._length?a._cache[--a._cache._length]:new r;n.caller=t,n.fun=e,n.args=i,n.msg=s,a._events[a._events._length++]=n},a.update=function(){if(!(a._events.length<1)){for(var t=a._events._length,e=Browser.now(),i=0;i<t;i++){var s=a._events[i];if(s.fun.call(s.caller,s.args),a._cache[a._cache._length++]=s,Browser.now()-e>a.maxTimeOut)return console.log("LaterEvent use long time:"+(Browser.now()-e)+")"+t+" "+s.msg),a._events.splice(0,i+1),void(a._events._length-=i+1)}t!=a._events._length?(a._events.splice(0,t),a._events._length-=t):a._events._length=0}},a._cache=((a._cache=[])._length=0,a._cache),a._events=((a._events=[])._length=0,a._events),a.maxTimeOut=30,a.__init$=function(){r=function(){function t(){this.caller=null,this.fun=null,this.args=null,this.msg=null}return __class(t,""),t}()},a}(),Log=function(){function e(){}return __class(e,"laya.utils.Log"),e.enable=function(){e._logdiv=Browser.window.document.createElement("div"),Browser.window.document.body.appendChild(e._logdiv),e._logdiv.style.cssText="border:white;overflow:scroll;z-index:1000000;background:rgba(100,100,100,0.7);color:white;position: absolute;left:0px;top:0px;width:100%;height:50%",e._logdiv.onclick=function(){30==Laya.__parseInt(this.style.width)?(this.style.width="100%",this.style.height="50%",this.style.overflow="scroll",this.style.background="rgba(100,100,100,0.7)"):(this.style.width=this.style.height="30px",this.style.overflow="hidden",this.style.background="white")}},e.print=function(t){e._logdiv&&(e._logdiv.innerText+=t+"\n")},e._logdiv=null,e}(),Pool=function(){function n(){}return __class(n,"laya.utils.Pool"),n.getPoolBySign=function(t){return n._poolDic[t]||(n._poolDic[t]=[])},n.recover=function(t,e){e.__InPool||(e.__InPool=!0,n.getPoolBySign(t).push(e))},n.getItemByClass=function(t,e){var i=n.getPoolBySign(t),s=i.length?i.pop():new e;return s.__InPool=!1,s},n.getItemByCreateFun=function(t,e){var i=n.getPoolBySign(t),s=i.length?i.pop():e();return s.__InPool=!1,s},n.getItem=function(t){var e=n.getPoolBySign(t),i=e.length?e.pop():null;return i&&(i.__InPool=!1),i},n._poolDic={},n.InPoolSign="__InPool",n}(),Stat=function(){function a(){}return __class(a,"laya.utils.Stat"),__getset(1,a,"onclick",null,function(t){a._canvas.source.onclick=t,a._canvas.source.style.pointerEvents=""}),a.show=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),a.preFrameTime=a._timer=Browser.now()-1e3,a._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},a._view[1]={title:"Sprite",value:"spriteDraw",color:"white",units:"int"},a._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"},a._view[3]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},a._view[4]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},Render.isWebGL&&(Render.is3DMode?a._view[0].title="FPS(3D)":(a._view[0].title="FPS(WebGL)",a._view[4]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},a._view[5]={title:"Shader",value:"shaderCall",color:"white",units:"int"}));for(var i=0;i<a._view.length;i++)a._view[i].x=4,a._view[i].y=12*i+2;(a._height=12*a._view.length+4,a._canvas)||((a._canvas=new HTMLCanvas("2D")).size(a._width,a._height),(a._ctx=a._canvas.getContext("2d")).textBaseline="top",a._canvas.source.style.cssText="pointer-events:none;z-index:100000;position: absolute;left:"+t+"px;top:"+e+"px;width:"+a._width+"px;height:"+a._height+"px;");Laya.timer.frameLoop(1,a,a.loop),Browser.document.body.appendChild(a._canvas.source)},a.hide=function(){var t=a._canvas.source;Browser.removeElement(t),Laya.timer.clear(a,a.loop)},a.clear=function(){a.trianglesFaces=0,a.drawCall=-6,a.shaderCall=0,a.spriteDraw=-1,a.bufferLen=0,a.canvasNormal=0,a.canvasBitmap=0,a.canvasReCache=0},a.loop=function(){a._count++;var t=Browser.now();if(a.interval=Browser.now()-a.preFrameTime,(a.preFrameTime=t)-a._timer<1e3)a.clear();else{a._count=Math.round(1e3*a._count/(t-a._timer)),a.maxMemorySize=ResourceManager.systemResourceManager.autoReleaseMaxSize,a.currentMemorySize=ResourceManager.systemResourceManager.memorySize,a.texturesMemSize=0;for(var e=a.buffersMemSize=0;e<Resource.getLoadedResourcesCount();e++){var i=Resource.getLoadedResourceByIndex(e);i instanceof laya.resource.Bitmap&&(a.texturesMemSize+=i.memorySize)}a.FPS=a._count,a._fpsStr=a._count+(a.renderSlow?" slow":""),a._canvasStr=a.canvasReCache+"/"+a.canvasNormal+"/"+a.canvasBitmap;var s=a._ctx;for(s.clearRect(0,0,a._width,a._height),s.fillStyle="rgba(150,150,150,0.8)",s.fillRect(0,0,a._width,a._height,null),e=0;e<a._view.length;e++){var n=a._view[e];s.fillStyle="white",s.fillText(n.title,n.x,n.y,null,null,null),s.fillStyle=n.color;var r=a[n.value];"M"==n.units&&(r=Math.floor(r/1048576*100)/100+" M"),s.fillText(r+"",n.x+70,n.y,null,null,null)}a._count=0,a._timer=t,a.clear()}},a.loopCount=0,a.maxMemorySize=0,a.currentMemorySize=0,a.texturesMemSize=0,a.buffersMemSize=0,a.shaderCall=0,a.drawCall=-6,a.trianglesFaces=0,a.spriteDraw=0,a.FPS=0,a.canvasNormal=0,a.canvasBitmap=0,a.canvasReCache=0,a.interval=0,a.preFrameTime=0,a.bufferLen=0,a.renderSlow=!1,a._fpsStr=null,a._canvasStr=null,a._canvas=null,a._ctx=null,a._timer=NaN,a._count=0,a._width=120,a._height=100,a._view=[],a}(),StringKey=function(){function t(){this._strs={},this._length=0}__class(t,"laya.utils.StringKey");var e=t.prototype;return e.add=function(t){var e=this._strs[t];return null!=e?e:this._strs[t]=this._length++},e.get=function(t){var e=this._strs[t];return null==e?-1:e},t}(),Timer=function(){var h;function l(){this.scale=1,this.currFrame=0,this._mid=1,this._map=[],this._laters=[],this._handlers=[],this._temp=[],this._pool=[],this._count=0,this.currTimer=Browser.now(),this._lastTimer=Browser.now(),Laya.timer&&Laya.timer.frameLoop(1,this,this._update)}__class(l,"laya.utils.Timer");var t=l.prototype;return t._update=function(){if(this.scale<=0)this._lastTimer=Browser.now();else{var t=this.currFrame=this.currFrame+this.scale,e=Browser.now();l.DELTA=e-this._lastTimer;var i=this.currTimer=this.currTimer+l.DELTA*this.scale;this._lastTimer=e;var s=this._handlers;for(a=this._count=0,o=s.length;a<o;a++)if(null!==(h=s[a]).method){var n=h.userFrame?t:i;n>=h.exeTime&&(h.repeat?n>h.exeTime&&(h.exeTime+=h.delay,h.run(!1),n>=h.exeTime&&(h.exeTime+=Math.ceil((n-h.exeTime)/h.delay)*h.delay)):h.run(!0))}else this._count++;(30<this._count||t%200==0)&&this._clearHandlers();for(var r=this._laters,a=0,o=r.length-1;a<=o;a++){var h=r[a];null!==h.method&&h.run(!1),this._recoverHandler(h),a===o&&(o=r.length-1)}r.length=0}},t._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;e<i;e++){var s=t[e];null!==s.method?this._temp.push(s):this._recoverHandler(s)}this._handlers=this._temp,this._temp=t,this._temp.length=0},t._recoverHandler=function(t){t.clear(),this._map[t.key]=null,this._pool.push(t)},t._create=function(t,e,i,s,n,r,a){if(i){if(a){var o=this._getHandler(s,n);if(o)return o.repeat=e,o.userFrame=t,o.delay=i,o.caller=s,o.method=n,o.args=r,void(o.exeTime=i+(t?this.currFrame:this.currTimer))}(o=0<this._pool.length?this._pool.pop():new h).repeat=e,o.userFrame=t,o.delay=i,o.caller=s,o.method=n,o.args=r,o.exeTime=i+(t?this.currFrame:this.currTimer),this._indexHandler(o),this._handlers.push(o)}else n.apply(s,r)},t._indexHandler=function(t){var e=t.caller,i=t.method,s=e?e.$_GID||(e.$_GID=Utils.getGID()):0,n=i.$_TID||(i.$_TID=1e5*this._mid++);t.key=s+n,this._map[t.key]=t},t.once=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!1,!1,t,e,i,s,n)},t.loop=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!1,!0,t,e,i,s,n)},t.frameOnce=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!0,!1,t,e,i,s,n)},t.frameLoop=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!0,!0,t,e,i,s,n)},t.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+this._pool.length},t.clear=function(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())},t.clearAll=function(t){for(var e=0,i=this._handlers.length;e<i;e++){var s=this._handlers[e];s.caller===t&&(this._map[s.key]=null,s.key=0,s.clear())}},t._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=Utils.getGID()):0,s=e.$_TID||(e.$_TID=1e5*this._mid++);return this._map[i+s]},t.callLater=function(t,e,i){if(null==this._getHandler(t,e)){if(this._pool.length)var s=this._pool.pop();else s=new h;s.caller=t,s.method=e,s.args=i,this._indexHandler(s),this._laters.push(s)}},t.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(i.run(!0),this._map[i.key]=null)},l.DELTA=0,l.__init$=function(){h=function(){function t(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null}__class(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,s=this.args;t&&this.clear(),null!=i&&(s?i.apply(e,s):i.call(e))},t}()},l}(),Tween=function(){function c(){this.gid=0}__class(c,"laya.utils.Tween");var t=c.prototype;return t.to=function(t,e,i,s,n,r,a){return void 0===r&&(r=0),void 0===a&&(a=!1),this._create(t,e,i,s,n,r,a,!0,!1,!0)},t.from=function(t,e,i,s,n,r,a){return void 0===r&&(r=0),void 0===a&&(a=!1),this._create(t,e,i,s,n,r,a,!1,!1,!0)},t._create=function(t,e,i,s,n,r,a,o,h,l){if(!t)throw new Error("Tween:target is null");this._target=t,this._duration=i,this._ease=s||c.easeNone,this._complete=n,this._delay=r,this._props=[],this._usedTimer=0,this._startTimer=Browser.now(),this._usedPool=h;var u=t.$_GID||(t.$_GID=Utils.getGID());return c.tweenMap[u]?(a&&c.clearTween(t),c.tweenMap[u].push(this)):c.tweenMap[u]=[this],l?r<=0?this.firstStart(t,e,o):Laya.timer.once(r,this,this.firstStart,[t,e,o]):this._initProps(t,e,o),this},t.firstStart=function(t,e,i){this._initProps(t,e,i),this._beginLoop()},t._initProps=function(t,e,i){for(var s in e)if("number"==typeof t[s]){var n=i?t[s]:e[s],r=i?e[s]:t[s];this._props.push([s,n,r-n])}},t._beginLoop=function(){Laya.timer.frameLoop(1,this,this._doEase)},t._doEase=function(){this._updateEase(Browser.now())},t._updateEase=function(t){var e=this._target;if(e.destroyed)return c.clearTween(e);var i=this._usedTimer=t-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();for(var s=0<i?this._ease(i,0,1,this._duration):0,n=this._props,r=0,a=n.length;r<a;r++){var o=n[r];e[o[0]]=o[1]+s*o[2]}this.update&&this.update.run()}},t.complete=function(){if(this._target){var t=this._target,e=this._props,i=this._complete;this.clear();for(var s=0,n=e.length;s<n;s++){var r=e[s];t[r[0]]=r[1]+r[2]}i&&i.run()}},t.pause=function(){Laya.timer.clear(this,this._beginLoop),Laya.timer.clear(this,this._doEase)},t.setStartTime=function(t){this._startTimer=t},t.clear=function(){this._target&&(this._remove(),this._clear())},t._clear=function(){this.pause(),Laya.timer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._usedPool&&Pool.recover("tween",this)},t.recover=function(){this._usedPool=!0,this._clear()},t._remove=function(){var t=c.tweenMap[this._target.$_GID];if(t)for(var e=0,i=t.length;e<i;e++)if(t[e]===this){t.splice(e,1);break}},t.restart=function(){this.pause(),this._usedTimer=0,this._startTimer=Browser.now();for(var t=this._props,e=0,i=t.length;e<i;e++){var s=t[e];this._target[s[0]]=s[1]}Laya.timer.once(this._delay,this,this._beginLoop)},t.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Browser.now()-this._usedTimer-this._delay,this._beginLoop())},c.to=function(t,e,i,s,n,r,a,o){return void 0===r&&(r=0),void 0===a&&(a=!1),void 0===o&&(o=!0),Pool.getItemByClass("tween",c)._create(t,e,i,s,n,r,a,!0,o,!0)},c.from=function(t,e,i,s,n,r,a,o){return void 0===r&&(r=0),void 0===a&&(a=!1),void 0===o&&(o=!0),Pool.getItemByClass("tween",c)._create(t,e,i,s,n,r,a,!1,o,!0)},c.clearAll=function(t){if(t&&t.$_GID){var e=c.tweenMap[t.$_GID];if(e){for(var i=0,s=e.length;i<s;i++)e[i]._clear();e.length=0}}},c.clear=function(t){t.clear()},c.clearTween=function(t){c.clearAll(t)},c.easeNone=function(t,e,i,s){return i*t/s+e},c.tweenMap={},c}(),Utils=function(){function i(){}return __class(i,"laya.utils.Utils"),i.toRadian=function(t){return t*i._pi2},i.toAngle=function(t){return t*i._pi},i.toHexColor=function(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},i.getGID=function(){return i._gid++},i.parseXMLFromString=function(t){return(new DOMParser).parseFromString(t,"text/xml")},i.preFixNumber=function(t,e){return("0000000000"+t).slice(-e)},i.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,s=e.length;for(i=0;i<s;i++)t.push(e[i]);return t},i.clearArray=function(t){return t&&(t.length=0),t},i.copyArray=function(t,e){return t||(t=[]),t.length=0,i.concatArray(t,e)},i.getGlobalRecByPoints=function(t,e,i,s,n){var r,a;return r=new Point(e,i),r=t.localToGlobal(r),a=new Point(s,n),a=t.localToGlobal(a),Rectangle._getWrapRec([r.x,r.y,a.x,a.y])},i.getGlobalPosAndScale=function(t){return i.getGlobalRecByPoints(t,0,0,1,1)},i.bind=function(t,e){return t.bind(e)},i.measureText=function(t,e){return RunDriver.measureText(t,e)},i.updateOrder=function(t){if(t.length<2)return!1;var e=t[0],i=1,s=t.length,n=e._zOrder,r=NaN,a=NaN,o=NaN,h=NaN,l=!1;for(i=1;i<s;i++)if((e=t[i])&&((n=e._zOrder)<0&&(n=e._zOrder),n<t[i-1]._zOrder)){for(o=r=0,a=i-1;r<=a&&t[o=r+a>>>1];)if((h=t[o]._zOrder)<0&&(h=t[o]._zOrder),h<n)r=o+1;else{if(!(n<h))break;a=o-1}n>t[o]._zOrder&&o++,t.splice(i,1),t.splice(o,0,e),l=!0}return l},i.transPointList=function(t,e,i){var s=0,n=t.length;for(s=0;s<n;s+=2)t[s]+=e,t[s+1]+=i},i._gid=1,i._pi=180/Math.PI,i._pi2=Math.PI/180,i}(),Node=function(t){function a(){this.name="",this.destroyed=!1,this._displayInStage=!1,this._parent=null,a.__super.call(this),this._childs=a.ARRAY_EMPTY,this.timer=Laya.timer,this._$P=a.PROP_EMPTY}__class(a,"laya.display.Node",EventDispatcher);var e=a.prototype;return e.destroy=function(t){void 0===t&&(t=!0),this.destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(t?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll()},e.destroyChildren=function(){if(this._childs)for(var t=this._childs.length-1;-1<t;t--)this._childs[t].destroy(!0)},e.addChild=function(t){return t===this||(t._parent===this?(this._childs.splice(this.getChildIndex(t),1),this._childs.push(t),this.childChanged()):(t.parent&&t.parent.removeChild(t),this._childs===a.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),t.parent=this)),t},e.addChildren=function(t){for(var e=arguments,i=0,s=e.length;i<s;)this.addChild(e[i++])},e.addChildAt=function(t,e){if(t===this)return t;if(0<=e&&e<=this._childs.length)return t._parent===this?(this._childs.splice(this.getChildIndex(t),1),this._childs.splice(e,0,t),this.childChanged()):(t.parent&&t.parent.removeChild(t),this._childs===a.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(e,0,t),t.parent=this),t;throw new Error("appendChildAt:The index is out of bounds")},e.getChildIndex=function(t){return this._childs.indexOf(t)},e.getChildByName=function(t){for(var e=this._childs,i=0,s=e.length;i<s;i++){var n=e[i];if(n.name===t)return n}return null},e._get$P=function(t){return this._$P[t]},e._set$P=function(t,e){return this._$P===a.PROP_EMPTY&&(this._$P={}),this._$P[t]=e},e.getChildAt=function(t){return this._childs[t]},e.setChildIndex=function(t,e){var i=this._childs;if(e<0||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var s=this.getChildIndex(t);return i.splice(s,1),i.splice(e,0,t),this.childChanged(),t},e.childChanged=function(t){},e.removeChild=function(t){if(!this._childs)return t;var e=this._childs.indexOf(t);return this.removeChildAt(e)},e.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},e.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},e.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._childs.splice(t,1),e.parent=null),e},e.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),0<this._childs.length){var i=this._childs;if(0===t&&r<=e){var s=i;this._childs=a.ARRAY_EMPTY}else s=i.splice(t,e-t);for(var n=0,r=s.length;n<r;n++)s[n].parent=null}return this},e.replaceChild=function(t,e){var i=this._childs.indexOf(e);return-1<i?(this._childs.splice(i,1,t),e.parent=null,t.parent=this,t):null},e._setDisplay=function(t){this._displayInStage!==t&&((this._displayInStage=t)?this.event("display"):this.event("undisplay"))},e._displayChild=function(t,e){t._setDisplay(e);var i=t._childs;if(i)for(var s=i.length-1;-1<s;s--){var n=i[s];n._setDisplay(e),n.numChildren&&this._displayChild(n,e)}},e.ask=function(t,e){return 1==t&&1==e},e.contains=function(t){if(t===this)return!0;for(;t;){if(t.parent===this.parent)return!0;t=t.parent}return!1},e.timerLoop=function(t,e,i,s,n){void 0===n&&(n=!1),this.timer._create(!1,!0,t,e,i,s,n)},e.timerOnce=function(t,e,i,s,n){void 0===n&&(n=!1),this.timer._create(!1,!1,t,e,i,s,n)},e.frameLoop=function(t,e,i,s,n){void 0===n&&(n=!1),this.timer._create(!0,!0,t,e,i,s,n)},e.frameOnce=function(t,e,i,s,n){void 0===n&&(n=!1),this.timer._create(!0,!1,t,e,i,s,n)},e.clearTimer=function(t,e){this.timer.clear(t,e)},__getset(0,e,"numChildren",function(){return this._childs.length}),__getset(0,e,"parent",function(){return this._parent},function(t){this._parent!==t&&(t?(this._parent=t,this.event("added"),t.displayInStage&&this._displayChild(this,!0),t.childChanged(this)):(this.event("removed"),this._parent.childChanged(),this._displayChild(this,!1),this._parent=t))}),__getset(0,e,"displayInStage",function(){return this._displayInStage}),a.ASK_CLASS=1,a.ASK_VALUE_NODE=1,a.ASK_VALUE_SPRITE=2,a.ASK_VALUE_HTMLELEMENT=3,a.ASK_VALUE_SPRITE3D=100,a.ARRAY_EMPTY=[],a.PROP_EMPTY={},a}(),CSSStyle=function(t){function _(t){this._bgground=null,this._border=null,this._rect=null,this.lineHeight=0,_.__super.call(this),this._padding=_._PADDING,this._spacing=_._SPACING,this._aligns=_._ALIGNS,this._font=Font.EMPTY,this._ower=t}__class(_,"laya.display.css.CSSStyle",t);var e=_.prototype;return e.destroy=function(){this._ower=null,this._font=null,this._rect=null},e.inherit=function(t){this._font=t._font,this._spacing=t._spacing===_._SPACING?_._SPACING:t._spacing.slice(),this.lineHeight=t.lineHeight},e._widthAuto=function(){return 0!=(262144&this._type)},e.widthed=function(t){return 0!=(8&this._type)},e._calculation=function(t,e){if(e.indexOf("%")<0)return!1;var s=this._ower,n=s.parent,r=this._rect;function a(t,e,i){return t*i[0]+e*i[1]+i[2]}function i(t){var e=n.width,i=s.width;r.width&&(s.width=a(e,i,r.width)),r.height&&(s.height=a(e,i,r.height)),r.left&&(s.x=a(e,i,r.left)),r.top&&(s.y=a(e,i,r.top))}null===r&&(n._getCSSStyle()._type|=524288,n.on("resize",this,i),this._rect=r={input:{}});var o=e.split(" ");return o[0]=parseFloat(o[0])/100,1==o.length?o[1]=o[2]=0:(o[1]=parseFloat(o[1])/100,o[2]=parseFloat(o[2])),r[t]=o,r.input[t]=e,i(),!0},e.heighted=function(t){return 0!=(8192&this._type)},e.size=function(t,e){var i=this._ower,s=!1;-1!==t&&t!=this._ower.width&&(this._type|=8,this._ower.width=t,s=!0),-1!==e&&e!=this._ower.height&&(this._type|=8192,this._ower.height=e,s=!0),s&&(i.layoutLater(),524288&this._type&&i.event("resize",this))},e._getAlign=function(){return this._aligns[0]},e._getValign=function(){return this._aligns[1]},e._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},e._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new Font(this._font))},e.render=function(t,e,i,s){var n=t.width,r=t.height;this._bgground&&null!=this._bgground.color&&e.ctx.fillRect(i,s,n,r,this._bgground.color),this._border&&this._border.color&&e.drawRect(i,s,n,r,this._border.color.strColor,this._border.size)},e.getCSSStyle=function(){return this},e.cssText=function(t){this.attrs(_.parseOneCSS(t,";"))},e.attrs=function(t){if(t)for(var e=0,i=t.length;e<i;e++){var s=t[e];this[s[0]]=s[1]}},e.setTransform=function(t){"none"===t?this._tf=Style._TF_EMPTY:this.attrs(_.parseOneCSS(t,","))},e.translate=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=Style._createTransform()),this._tf.translateX=t,this._tf.translateY=e},e.scale=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=Style._createTransform()),this._tf.scaleX=t,this._tf.scaleY=e},e._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},__getset(0,e,"align",function(){return _._aligndef[this._aligns[0]]},function(t){this._aligns===_._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=_._aligndef[t]}),__getset(0,e,"paddingTop",function(){return this.padding[0]}),__getset(0,e,"block",t.prototype._$get_block,function(t){t?this._type|=1:this._type&=-2}),__getset(0,e,"padding",function(){return this._padding},function(t){this._padding=t}),__getset(0,e,"width",null,function(t){if(this._type|=8,"string"==typeof t){var e=t.indexOf("auto");if(0<=e&&(this._type|=262144,t=t.substr(0,e)),this._calculation("width",t))return;t=Laya.__parseInt(t)}this.size(t,-1)}),__getset(0,e,"height",null,function(t){if(this._type|=8192,"string"==typeof t){if(this._calculation("height",t))return;t=Laya.__parseInt(t)}this.size(-1,t)}),__getset(0,e,"_scale",null,function(t){this._ower.scale(t[0],t[1])}),__getset(0,e,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(t){this.lineElement=!1,"right"===t?this._type|=32768:this._type&=-32769}),__getset(0,e,"font",function(){return this._font.toString()},function(t){this._createFont().set(t)}),__getset(0,e,"lineElement",function(){return 0!=(65536&this._type)},function(t){t?this._type|=65536:this._type&=-65537}),__getset(0,e,"valign",function(){return _._valigndef[this._aligns[1]]},function(t){this._aligns===_._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=_._valigndef[t]}),__getset(0,e,"border",function(){return this._border?this._border.value:""},function(t){if("none"!=t){this._border||(this._border={});var e=(this._border.value=t).split(" ");if(this._border.color=Color.create(e[e.length-1]),1==e.length)return this._border.size=1,void(this._border.type="solid");var i=0;0<e[0].indexOf("px")?(this._border.size=Laya.__parseInt(e[0]),i++):this._border.size=1,this._border.type=e[i],this._ower._renderType|=128}else this._border=null}),__getset(0,e,"leading",function(){return this._spacing[1]},function(t){"string"==typeof t&&(t=Laya.__parseInt(t+"")),this._spacing===_._SPACING&&(this._spacing=[0,0]),this._spacing[1]=t}),__getset(0,e,"left",null,function(t){var e=this._ower;if("string"==typeof t){if("center"===t?t="50% -50% 0":"right"===t&&(t="100% -100% 0"),this._calculation("left",t))return;t=Laya.__parseInt(t)}e.x=t}),__getset(0,e,"position",function(){return 4&this._type?"absolute":""},function(t){"absolute"==t?this._type|=4:this._type&=-5}),__getset(0,e,"top",null,function(t){var e=this._ower;if("string"==typeof t){if("middle"===t?t="50% -50% 0":"bottom"===t&&(t="100% -100% 0"),this._calculation("top",t))return;t=Laya.__parseInt(t)}e.y=t}),__getset(0,e,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(t){"nowrap"===t&&(this._type|=131072),"none"===t&&(this._type&=-131073)}),__getset(0,e,"wordWrap",function(){return 0==(131072&this._type)},function(t){t?this._type&=-131073:this._type|=131072}),__getset(0,e,"bold",function(){return this._font.bold},function(t){this._createFont().bold=t}),__getset(0,e,"password",function(){return this._font.password},function(t){this._createFont().password=t}),__getset(0,e,"weight",null,function(t){this._createFont().weight=t}),__getset(0,e,"letterSpacing",function(){return this._spacing[0]},function(t){"string"==typeof t&&(t=Laya.__parseInt(t+"")),this._spacing===_._SPACING&&(this._spacing=[0,0]),this._spacing[0]=t}),__getset(0,e,"fontSize",function(){return this._font.size},function(t){this._createFont().size=t}),__getset(0,e,"italic",function(){return this._font.italic},function(t){this._createFont().italic=t}),__getset(0,e,"fontFamily",function(){return this._font.family},function(t){this._createFont().family=t}),__getset(0,e,"fontWeight",function(){return this._font.weight},function(t){this._createFont().weight=t}),__getset(0,e,"textDecoration",function(){return this._font.decoration},function(t){this._createFont().decoration=t}),__getset(0,e,"color",function(){return this._font.color},function(t){this._createFont().color=t}),__getset(0,e,"strokeColor",function(){return this._font.stroke[1]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=t}),__getset(0,e,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(t){this._border||(this._border={size:1,type:"solid"}),this._border.color=null==t?null:Color.create(t),this._ower._renderType|=128}),__getset(0,e,"stroke",function(){return this._font.stroke[0]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=t}),__getset(0,e,"backgroundColor",function(){return this._bgground?this._bgground.color:""},function(t){"none"===t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=t),this._ower._renderType|=128}),__getset(0,e,"absolute",function(){return 0!=(4&this._type)}),__getset(0,e,"background",null,function(t){this._bgground||(this._bgground={}),this._bgground.color=t,this._type|=16384,this._ower._renderType|=128}),__getset(0,e,"paddingLeft",function(){return this.padding[3]}),__getset(0,e,"display",null,function(t){switch(t){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower.layoutLater()}}),__getset(0,e,"_translate",null,function(t){this.translate(t[0],t[1])}),__getset(0,e,"_rotate",null,function(t){this._ower.rotation=t}),_.parseOneCSS=function(t,e){for(var i,s=[],n=t.split(e),r=0,a=n.length;r<a;r++){var o=n[r],h=o.indexOf(":"),l=o.substr(0,h).replace(/^\s+|\s+$/g,""),u=o.substr(h+1).replace(/^\s+|\s+$/g,""),c=[l,u];switch(l){case"italic":case"bold":c[1]="true"==u;break;case"line-height":c[0]="lineHeight",c[1]=Laya.__parseInt(u);break;case"font-size":c[0]="fontSize",c[1]=Laya.__parseInt(u);break;case"padding":1<(i=u.split(" ")).length||(i[1]=i[2]=i[3]=i[0]),c[1]=[Laya.__parseInt(i[0]),Laya.__parseInt(i[1]),Laya.__parseInt(i[2]),Laya.__parseInt(i[3])];break;case"rotate":c[0]="_rotate",c[1]=parseFloat(u);break;case"scale":i=u.split(" "),c[0]="_scale",c[1]=[parseFloat(i[0]),parseFloat(i[1])];break;case"translate":i=u.split(" "),c[0]="_translate",c[1]=[Laya.__parseInt(i[0]),Laya.__parseInt(i[1])];break;default:(c[0]=_._CSSTOVALUE[l])||(c[0]=l)}s.push(c)}return s},_.parseCSS=function(t,e){for(var i;null!=(i=_._parseCSSRegExp.exec(t));)_.styleSheets[i[1]]=_.parseOneCSS(i[2],";")},_.EMPTY=new _(null),_._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor",float:"cssFloat"},_._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),_._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},_._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},_.styleSheets={},_.ALIGN_CENTER=1,_.ALIGN_RIGHT=2,_.VALIGN_MIDDLE=1,_.VALIGN_BOTTOM=2,_._CSS_BLOCK=1,_._DISPLAY_NONE=2,_._ABSOLUTE=4,_._WIDTH_SET=8,_._PADDING=[0,0,0,0],_._RECT=[-1,-1,-1,-1],_._SPACING=[0,0],_._ALIGNS=[0,0,0],_.ADDLAYOUTED=512,_._NEWFONT=4096,_._HEIGHT_SET=8192,_._BACKGROUND_SET=16384,_._FLOAT_RIGHT=32768,_._LINE_ELEMENT=65536,_._NOWARP=131072,_._WIDTHAUTO=262144,_._LISTERRESZIE=524288,_}(Style),AudioSound=function(t){function a(){this.url=null,this.audio=null,this.loaded=!1,a.__super.call(this)}__class(a,"laya.media.h5audio.AudioSound",EventDispatcher);var e=a.prototype;return e.dispose=function(){var t=a._audioCache[this.url];t&&(t.src="",delete a._audioCache[this.url])},e.load=function(t){this.url=t;var e=a._audioCache[t];if(e&&2<=e.readyState)this.event("complete");else{e||((e=Browser.createElement("audio")).src=t,a._audioCache[t]=e),e.addEventListener("canplaythrough",s),e.addEventListener("error",n);var i=this;(this.audio=e).load()}function s(){r(),i.loaded=!0,i.event("complete")}function n(){r(),i.event("error")}function r(){e.removeEventListener("canplaythrough",s),e.removeEventListener("error",n)}},e.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),!this.url)return null;var i,s;if(!(i=a._audioCache[this.url]))return null;s=(s=Pool.getItem("audio:"+this.url))||i.cloneNode(!0);var n=new AudioSoundChannel(s);return n.url=this.url,n.loops=e,n.startTime=t,n.play(),SoundManager.addChannel(n),n},a._audioCache={},a}(),SoundChannel=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}__class(e,"laya.media.SoundChannel",EventDispatcher);var i=e.prototype;return i.play=function(){},i.stop=function(){},__getset(0,i,"volume",function(){return 1},function(t){}),__getset(0,i,"position",function(){return 0}),e}(),Sound=function(t){function e(){e.__super.call(this)}__class(e,"laya.media.Sound",EventDispatcher);var i=e.prototype;return i.load=function(t){},i.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},e}(),WebAudioSound=function(t){function s(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,s.__super.call(this)}__class(s,"laya.media.webaudio.WebAudioSound",EventDispatcher);var e=s.prototype;return e.load=function(t){var e=this;if(this.url=t,this.audioBuffer=s._dataCache[t],this.audioBuffer)this._loaded(this.audioBuffer);else if(s.e.on("loaded:"+t,this,this._loaded),s.e.on("err:"+t,this,this._err),!s.__loadingSound[t]){s.__loadingSound[t]=!0;var i=new Browser.window.XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e.data=i.response,s.buffs.push({buffer:e.data,url:e.url}),s.decode()},i.send()}},e._err=function(){this._removeLoadEvents(),this.event("error")},e._loaded=function(t){this._removeLoadEvents(),this.audioBuffer=t,s._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete")},e._removeLoadEvents=function(){s.e.off("loaded:"+this.url,this,this._loaded),s.e.off("err:"+this.url,this,this._err)},e.__playAfterLoaded=function(){if(this.__toPlays){var t,e,i,s=0;for(t=(e=this.__toPlays).length,s=0;s<t;s++)(i=e[s])[2]&&!i[2].isStopped&&this.play(i[0],i[1],i[2]);this.__toPlays.length=0}},e.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),i=i||new WebAudioSoundChannel,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),SoundManager.addChannel(i),i},e.dispose=function(){delete s._dataCache[this.url]},s.decode=function(){s.buffs.length<=0||s.isDecoding||(s.isDecoding=!0,s.tInfo=s.buffs.shift(),s.ctx.decodeAudioData(s.tInfo.buffer,s._done,s._fail))},s._done=function(t){s.e.event("loaded:"+s.tInfo.url,t),s.isDecoding=!1,s.decode()},s._fail=function(){s.e.event("err:"+s.tInfo.url,null),s.isDecoding=!1,s.decode()},s._playEmptySound=function(){if(null!=s.ctx){var t=s.ctx.createBufferSource();t.buffer=s._miniBuffer,t.connect(s.ctx.destination),t.start(0,0,0)}},s._unlock=function(){s._unlocked||(s._playEmptySound(),"running"==s.ctx.state&&(Browser.document.removeEventListener("mousedown",s._unlock,!0),Browser.document.removeEventListener("touchend",s._unlock,!0),s._unlocked=!0))},s.initWebAudio=function(){"running"!=s.ctx.state&&(s._unlock(),Browser.document.addEventListener("mousedown",s._unlock,!0),Browser.document.addEventListener("touchend",s._unlock,!0))},s._dataCache={},s.buffs=[],s.isDecoding=!1,s._unlocked=!1,s.tInfo=null,s.__loadingSound={},__static(s,["window",function(){return this.window=Browser.window},"webAudioOK",function(){return this.webAudioOK=s.window.AudioContext||s.window.webkitAudioContext||s.window.mozAudioContext},"ctx",function(){return this.ctx=s.webAudioOK?new(s.window.AudioContext||s.window.webkitAudioContext||s.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=s.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new EventDispatcher}]),s}(),ColorFilter=function(t){function i(t){if(i.__super.call(this),t){this._elements=new Float32Array(20);for(var e=0;e<20;e++)this._elements[e]=t[e];this._action=RunDriver.createFilterAction(32),this._action.data=this}else this._elements=i.DEFAULT._elements}__class(i,"laya.filters.ColorFilter",Filter);var e=i.prototype;return Laya.imps(e,{"laya.filters.IFilter":!0}),__getset(0,e,"type",function(){return 32}),__getset(0,e,"action",function(){return this._action}),__static(i,["DEFAULT",function(){return this.DEFAULT=new i([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])},"GRAY",function(){return this.GRAY=new i([.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0])}]),i}(),HttpRequest=function(t){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new Browser.window.XMLHttpRequest}__class(e,"laya.net.HttpRequest",EventDispatcher);var i=e.prototype;return i.send=function(t,e,i,s,n){void 0===i&&(i="get"),void 0===s&&(s="text"),this._responseType=s,this._data=null;var r=this,a=this._http;if(a.open(i,t,!0),n)for(var o=0;o<n.length;o++)a.setRequestHeader(n[o++],n[o]);else e&&"string"!=typeof e?a.setRequestHeader("Content-Type","application/json"):a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.responseType="arraybuffer"!==s?"text":"arraybuffer",a.onerror=function(t){r.onError(t)},a.onabort=function(t){r.onAbort(t)},a.onprogress=function(t){r.onProgress(t)},a.onload=function(t){r.onLoad(t)},a.send(e)},i.onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i.onAbort=function(t){this.error("Request was aborted by user")},i.onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i.onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)},i.error=function(t){this.clear(),this.event("error",t)},i.complete=function(){if(this.clear(),"json"===this._responseType)this._data=JSON.parse(this._http.responseText);else if("xml"===this._responseType){var t=new Browser.window.DOMParser;this._data=t.parseFromString(this._http.responseText,"text/xml")}else this._data=this._http.response||this._http.responseText;this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},__getset(0,i,"data",function(){return this._data}),__getset(0,i,"url",function(){return this._http.responseURL}),e}(),Loader=function(t){function g(){this._data=null,this._url=null,this._type=null,this._cache=!1,this._http=null,g.__super.call(this)}__class(g,"laya.net.Loader",EventDispatcher);var e=g.prototype;return e.load=function(t,e,i){return void 0===i&&(i=!0),t=URL.formatURL(t),this._url=t,this._type=e||(e=this.getTypeFromUrl(t)),this._cache=i,this._data=null,g.loadedMap[t]?(this._data=g.loadedMap[t],this.event("progress",1),void this.event("complete",this._data)):"image"===e?this._loadImage(t):"sound"===e?this._loadSound(t):(this._http||(this._http=new HttpRequest,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),void this._http.send(t,null,"get","atlas"!==e?e:"json"))},e.getTypeFromUrl=function(t){g._extReg.lastIndex=t.lastIndexOf(".");var e=g._extReg.exec(t);return e&&1<e.length?g.typeMap[e[1].toLowerCase()]:(console.log("Not recognize the resources suffix",t),"text")},e._loadImage=function(t){var e=HTMLImage.create(),i=this;function s(){e.onload=null,e.onerror=null}e.onload=function(){s(),i.onLoaded(e)},e.onerror=function(){s(),i.event("error","Load image filed")},e.src=t},e._loadSound=function(t){var e=this,i=new Sound,s=this;function n(){a(),s.onLoaded(i)}function r(){a(),s.event("error","Load sound filed")}function a(){i.off("complete",e,n),i.off("error",e,r)}i.on("complete",this,n),i.on("error",this,r),i.load(t)},e.onProgress=function(t){this.event("progress",t)},e.onError=function(t){this.event("error",t)},e.onLoaded=function(t){var e=this._type;if("image"===e)this.complete(new Texture(t));else if("sound"===e)this.complete(t);else if("texture"===e)this.complete(new Texture(t));else if("atlas"===e){var i;if(!t.src){if(!this._data){if((this._data=t).meta&&t.meta.image){var s,n;i=t.meta.image.split(","),n=0<=this._url.indexOf("/")?"/":"\\";var r;s=0<=(r=this._url.lastIndexOf(n))?this._url.substr(0,r+1):"";var a,o=0;for(a=i.length,o=0;o<a;o++)i[o]=s+i[o]}else i=[this._url.replace(".json",".png")];i.reverse(),t.toLoads=i,t.pics=[]}return this._loadImage(URL.formatURL(i.pop()))}if(this._data.pics.push(t),0<this._data.toLoads.length)return this._loadImage(URL.formatURL(this._data.toLoads.pop()));var h,l,u=this._data.frames,c=this._data.meta&&this._data.meta.prefix?URL.basePath+this._data.meta.prefix:this._url.substring(0,this._url.lastIndexOf("."))+"/";h=this._data.pics;var _=g.atlasMap[this._url]||(g.atlasMap[this._url]=[]);Config.atlasEnable&&Render.isWebGL;for(var d in u){var f=u[d];l=h[f.frame.idx?f.frame.idx:0];var p=c+d;g.loadedMap[p]=Texture.create(l,f.frame.x,f.frame.y,f.frame.w,f.frame.h,f.spriteSourceSize.x,f.spriteSourceSize.y,f.sourceSize.w,f.sourceSize.h),_.push(g.loadedMap[p])}this.complete(this._data)}else this.complete(t)},e.complete=function(t){this._data=t,g._loaders.push(this),g._isWorking||g.checkNext()},e._endLoad=function(){this._cache&&(g.loadedMap[this._url]=this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},__getset(0,e,"cache",function(){return this._cache}),__getset(0,e,"data",function(){return this._data}),__getset(0,e,"url",function(){return this._url}),__getset(0,e,"type",function(){return this._type}),g.checkNext=function(){g._isWorking=!0;for(var t=Browser.now();g._startIndex<g._loaders.length;)if(Browser.now(),g._loaders[g._startIndex]._endLoad(),g._startIndex++,Browser.now()-t>g.maxTimeOut)return console.log("loader callback cost a long time:"+(Browser.now()-t)+") url="+g._loaders[g._startIndex-1].url),void Laya.timer.frameOnce(1,null,g.checkNext);g._loaders.length=0,g._startIndex=0,g._isWorking=!1},g.clearRes=function(t){t=URL.formatURL(t);var e=g.atlasMap[t];if(e){for(var i=0,s=e.length;i<s;i++){var n=e[i];n&&n.destroy()}e.length=0,delete g.atlasMap[t]}delete g.loadedMap[t]},g.getRes=function(t){return g.loadedMap[URL.formatURL(t)]},g.getAtlas=function(t){return g.atlasMap[URL.formatURL(t)]},g.cacheRes=function(t,e){g.loadedMap[URL.formatURL(t)]=e},g.basePath="",g.TEXT="text",g.JSOn="json",g.XML="xml",g.BUFFER="arraybuffer",g.IMAGE="image",g.SOUND="sound",g.TEXTURE="texture",g.ATLAS="atlas",g.typeMap={png:"image",jpg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",mp3:"sound",ogg:"sound",wav:"sound"},g.loadedMap={},g.atlasMap={},g._loaders=[],g._isWorking=!1,g._startIndex=0,g.maxTimeOut=100,g._extReg=/\.(\w+)\??/g,g}(),LoaderManager=function(t){var h;function e(){this.retryNum=1,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._resMap={},this._infoPool=[],this._maxPriority=5,this._failRes={},e.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}__class(e,"laya.net.LoaderManager",EventDispatcher);var i=e.prototype;return i.load=function(t,e,i,s,n,r){if(void 0===n&&(n=1),void 0===r&&(r=!0),t instanceof Array)return this._loadAssets(t,e,i,r);var a=Loader.getRes(t);if(null!=a)e&&e.runWith(a),this._loaderCount||this.event("complete");else{var o=this._resMap[t];o?(e&&o.on("complete",e.caller,e.method,e.args),i&&o.on("progress",i.caller,i.method,i.args)):((o=this._infoPool.length?this._infoPool.pop():new h).url=t,o.type=s,o.cache=r,e&&o.on("complete",e.caller,e.method,e.args),i&&o.on("progress",i.caller,i.method,i.args),this._resMap[t]=o,n=n<this._maxPriority?n:this._maxPriority-1,this._resInfos[n].push(o),this._next())}return this},i._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++){var e=this._resInfos[t];if(0<e.length)return this._doLoad(e.shift())}this._loaderCount||this.event("complete")}},i._doLoad=function(e){this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new Loader;i.on("complete",null,n),i.on("progress",null,function(t){e.event("progress",t)}),i.on("error",null,function(t){n(null)});var s=this;function n(t){i.offAll(),s._loaders.push(i),s._endLoad(e,t),s._loaderCount--,s._next()}i.load(e.url,e.type,e.cache)},i._endLoad=function(t,e){if(null===e){var i=this._failRes[t.url]||0;if(i<this.retryNum)return console.log("[warn]Retry to load:",t.url),this._failRes[t.url]=i+1,void this._resInfos[this._maxPriority-1].push(t);console.log("[error]Failed to load:",t.url),this.event("error",t.url)}delete this._resMap[t.url],t.event("complete",e),t.offAll(),this._infoPool.push(t)},i.clearRes=function(t){Loader.clearRes(t)},i.getRes=function(t){return Loader.getRes(t)},i.clearUnLoaded=function(){this._resInfos.length=0,this._loaderCount=0,this._resMap={}},i._loadAssets=function(t,i,a,e){void 0===e&&(e=!0);for(var o=t.length,s=0,h=0,l=[],n=0;n<o;n++){var r=t[n];"string"==typeof r&&(r={url:r,type:"image",size:1,priority:1}),r.size||(r.size=1),r.progress=0,h+=r.size,l.push(r);var u=a?Handler.create(this,_,[r]):null;this.load(r.url,Handler.create(r,c,[r]),u,r.type,r.priority||1,e)}function c(t,e){s++,t.progress=1,s===o&&i&&i.run()}function _(t,e){if(null!=a){t.progress=e;for(var i=0,s=0;s<o;s++){var n=l[s];i+=n.size*n.progress}var r=i/h;a.runWith(r)}}return this},e.cacheRes=function(t,e){Loader.cacheRes(t,e)},e.__init$=function(){h=function(t){function e(){this.url=null,this.type=null,this.cache=!1,e.__super.call(this)}return __class(e,"",EventDispatcher),e}()},e}(),Socket=function(t){function s(t,e,i){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this._bytes=null,this.timeout=0,this.objectEncoding=0,this._byteClass=null,void 0===e&&(e=0),s.__super.call(this),this._byteClass=i,this._byteClass=this._byteClass?this._byteClass:Byte,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,t&&0<e&&e<65535&&this.connect(t,e)}__class(s,"laya.net.Socket",EventDispatcher);var e=s.prototype;return e.connect=function(t,e){var i="ws://"+t+":"+e;this.connectByUrl(i)},e.connectByUrl=function(t){var e=this;null!=this._socket&&this.close(),this._socket&&this._cleanSocket(),this._socket=new WebSocket(t),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(t){e.onOpenHandler(t)},this._socket.onmessage=function(t){e.onMessageHandler(t)},this._socket.onclose=function(t){e.onCloseHandler(t)},this._socket.onerror=function(t){e.onErrorHandler(t)}},e._cleanSocket=function(){try{this._socket.close()}catch(t){}this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},e.close=function(){null!=this._socket&&this._cleanSocket()},e.onOpenHandler=function(t){this._connected=!0,this.event("open",t)},e.onMessageHandler=function(t){0<this._input.length&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var e=this._input.pos;if(!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,t&&t.data){var i=t.data;i&&("string"==typeof i?this._input.writeUTFBytes(i):this._input.writeArrayBuffer(i),this._addInputPosition=this._input.pos,this._input.pos=e),this.event("message",i)}},e.onCloseHandler=function(t){this.event("close",t)},e.onErrorHandler=function(t){this.event("error",t)},e.send=function(t){this._socket.send(t)},e.flush=function(){if(this._output&&0<this._output.length)try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length)),this._output.endian=this.endian,this._output.clear()}catch(t){this.event("error",t)}},__getset(0,e,"input",function(){return this._input}),__getset(0,e,"output",function(){return this._output}),__getset(0,e,"connected",function(){return this._connected}),__getset(0,e,"endian",function(){return this._endian},function(t){this._endian=t,null!=this._input&&(this._input.endian=t),null!=this._output&&(this._output.endian=t)}),s.LITTLE_ENDIAN="littleEndian",s.BIG_ENDIAN="bigEndian",s}(),Resource=function(t){function s(){this._id=0,this._lastUseFrameCount=0,this._memorySize=0,this._name=null,this._released=!1,this._resourceManager=null,this.lock=!1,s.__super.call(this),this._$1__id=++s._uniqueIDCounter,s._loadedResources.push(this),s._isLoadedResourcesSorted=!1,this._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,ResourceManager.currentResourceManager&&ResourceManager.currentResourceManager.addResource(this)}__class(s,"laya.resource.Resource",EventDispatcher);var e=s.prototype;return Laya.imps(e,{"laya.resource.IDispose":!0}),e.recreateResource=function(){this.startCreate(),this.compoleteCreate()},e.detoryResource=function(){},e.activeResource=function(t){void 0===t&&(t=!1),this._lastUseFrameCount=Stat.loopCount,(this._released||t)&&this.recreateResource()},e.releaseResource=function(t){return void 0===t&&(t=!1),!(!t&&this.lock)&&(!(this._released&&!t)&&(this.detoryResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0))},e.setUniqueName=function(t){for(var e=!0,i=0;i<s._loadedResources.length;i++)if(s._loadedResources[i]._name===t&&s._loadedResources[i]!==this)return void(e=!1);e?this.name!=t&&(this.name=t,s._isLoadedResourcesSorted=!1):this.setUniqueName(t.concat("-copy"))},e.dispose=function(){if(null!==this._resourceManager)throw new Error("附属于resourceManager的资源不能独立释放！");this.lock=!1,this.releaseResource();var t=s._loadedResources.indexOf(this);-1!==t&&(s._loadedResources.splice(t,1),s._isLoadedResourcesSorted=!1)},e.startCreate=function(){this.event("recovering",this)},e.compoleteCreate=function(){this._released=!1,this.event("recovered",this)},__getset(0,e,"id",function(){return this._$1__id}),__getset(0,e,"lastUseFrameCount",function(){return this._lastUseFrameCount}),__getset(0,e,"name",function(){return this._name},function(t){!t&&""===t||this.name===t||(this._name=t,s._isLoadedResourcesSorted=!1)}),__getset(0,e,"resourceManager",function(){return this._resourceManager}),__getset(0,e,"memorySize",function(){return this._memorySize},function(t){var e=t-this._memorySize;this._memorySize=t,this.event("memorychanged",e)}),__getset(0,e,"released",function(){return this._released}),__getset(1,s,"sortedLoadedResourcesByName",function(){return s._isLoadedResourcesSorted||(s._isLoadedResourcesSorted=!0,s._loadedResources.sort(s.compareResourcesByName)),s._loadedResources},laya.events.EventDispatcher._$SET_sortedLoadedResourcesByName),s.getLoadedResourceByIndex=function(t){return s._loadedResources[t]},s.getLoadedResourcesCount=function(){return s._loadedResources.length},s.compareResourcesByName=function(t,e){if(t===e)return 0;var i=t.name,s=e.name;if(null===i)return null===s?0:-1;if(null==s)return 1;var n=i.localeCompare(s);return 0!=n?n:(e.setUniqueName(s),s=e.name,i.localeCompare(s))},s.animationCache={},s.meshCache={},s._uniqueIDCounter=0,s._loadedResources=[],s._isLoadedResourcesSorted=!1,s}(),Texture=function(t){function b(t,e){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,b.__super.call(this),this.setTo(t,e)}__class(b,"laya.resource.Texture",EventDispatcher);var e=b.prototype;return e.setTo=function(t,e){if(this.bitmap=t,this.uv=e||b.DEF_UV,t){this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=0<this._w;var i=this;if(this._loaded)RunDriver.addToAtlas&&RunDriver.addToAtlas(i);else{var s=t;s instanceof laya.resource.HTMLImage&&s.image&&s.image.addEventListener("load",function(t){RunDriver.addToAtlas&&RunDriver.addToAtlas(i)},!1)}}},e.active=function(){this.bitmap.activeResource()},e.destroy=function(){this.bitmap=null},e.load=function(t){var e=this;this._loaded=!1;var i=this.bitmap||(this.bitmap=HTMLImage.create()),s=this;i.onload=function(){i.onload=null,s._loaded=!0,e.sourceWidth=e._w=i.width,e.sourceHeight=e._h=i.height,s.event("loaded",this),RunDriver.addToAtlas&&RunDriver.addToAtlas(s)},i.src=URL.formatURL(t)},__getset(0,e,"height",function(){return this._h?this._h:this.uv&&this.uv!==b.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}),__getset(0,e,"loaded",function(){return this._loaded}),__getset(0,e,"released",function(){return this.bitmap.released}),__getset(0,e,"source",function(){return this.bitmap.activeResource(),this.bitmap.source}),__getset(0,e,"width",function(){return this._w?this._w:this.uv&&this.uv!==b.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}),b.moveUV=function(t,e,i){for(var s=0;s<8;s+=2)i[s]+=t,i[s+1]+=e;return i},b.create=function(t,e,i,s,n,r,a,o,h){void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0);var l=t.uv||b.DEF_UV,u=t.bitmap||t,c=new b(u,null);c.width=s,c.height=n,c.offsetX=r,c.offsetY=a,c.sourceWidth=o||s,c.sourceHeight=h||n;var _=1/u.width,d=1/u.height;e*=_,i*=d,s*=_,n*=d;var f=c.uv[0],p=c.uv[1],g=c.uv[4],m=c.uv[5],y=g-f,v=m-p,x=b.moveUV(l[0],l[1],[e,i,e+s,i,e+s,i+n,e,i+n]);return c.uv=[f+x[0]*y,p+x[1]*v,g-(1-x[2])*y,p+x[3]*v,g-(1-x[4])*y,m-(1-x[5])*v,f+x[6]*y,m-(1-x[7])*v],c},b.createFromTexture=function(t,e,i,s,n){var r=Rectangle.TEMP.setTo(e-t.offsetX,i-t.offsetY,s,n),a=r.intersection(b._rect1.setTo(0,0,t.width,t.height),b._rect2);return a?b.create(t,a.x,a.y,a.width,a.height,a.x-r.x,a.y-r.y,s,n):new b(HTMLImage.create())},b.TEXTURE2D=1,b.TEXTURE3D=2,b.DEF_UV=[0,0,1,0,1,1,0,1],b.INV_UV=[0,1,1,1,1,0,0,0],b._rect1=new Rectangle,b._rect2=new Rectangle,b}(),TimeLine=function(t){var o;function e(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,e.__super.call(this)}__class(e,"laya.utils.TimeLine",EventDispatcher);var i=e.prototype;return i.to=function(t,e,i,s,n){void 0===n&&(n=0),this._create(t,e,i,s,n,!0)},i.from=function(t,e,i,s,n){void 0===n&&(n=0),this._create(t,e,i,s,n,!1)},i._create=function(t,e,i,s,n,r){var a=new o;a.isTo=r,a.type=0,a.target=t,a.duration=i,a.data=e,a.startTime=this._startTime+n,a.endTime=a.startTime+a.duration,a.ease=s,this._startTime=Math.max(a.endTime,this._startTime),this._tweenDataList.push(a),this._startTimeSort=!0,this._endTimeSort=!0},i.add=function(t,e){var i=new o;i.type=1,i.data=t,i.endTime=i.startTime=this._startTime+e,this._labelDic||(this._labelDic={}),this._labelDic[t]=i,this._tweenDataList.push(i)},i.gotoTime=function(t){if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var e,i,s,n;for(var r in this._firstTweenDic)if(i=this._firstTweenDic[r])for(var a in i)i.diyTarget[a]=i[a];for(r in this._tweenDic)(e=this._tweenDic[r]).clear(),delete this._tweenDic[r];if(this._index=0,this._gidIndex=0,this._currTime=t,this._lastTime=Browser.now(),null==this._endTweenDataList||this._endTimeSort){this._endTimeSort=!1,this._endTweenDataList=s=this._tweenDataList.concat(),s.sort(function(t,e){return t.endTime>e.endTime?1:t.endTime<e.endTime?-1:0})}else s=this._endTweenDataList;for(var o=0,h=s.length;o<h;o++)if(0==(n=s[o]).type){if(!(t>=n.endTime))break;this._index=Math.max(this._index,o+1);var l=n.data;for(var u in l)n.isTo&&(n.target[u]=l[u])}for(o=0,h=this._tweenDataList.length;o<h;o++)0==(n=this._tweenDataList[o]).type&&t>=n.startTime&&t<n.endTime&&(this._index=Math.max(this._index,o+1),this._gidIndex++,(e=Pool.getItemByClass("tween",Tween))._create(n.target,n.data,n.duration,n.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,n.isTo,!0,!1),e.setStartTime(this._currTime-(t-n.startTime)),e._updateEase(this._currTime),e.gid=this._gidIndex,this._tweenDic[this._gidIndex]=e)}},i.gotoLabel=function(t){if(null!=this._labelDic){var e=this._labelDic[t];if(e){var i=e.startTime;this.gotoTime(i)}}},i.pause=function(){Laya.timer.clear(this,this._update)},i.resume=function(){this.play(this._currTime,this._loopKey)},i.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(function(t,e){return t.startTime>e.startTime?1:t.startTime<e.startTime?-1:0});for(var i=0,s=this._tweenDataList.length;i<s;i++){var n=this._tweenDataList[i];if(null!=n&&0==n.type){var r=n.target,a=r.$_GID||(r.$_GID=Utils.getGID()),o=null;for(var h in null==this._firstTweenDic[a]?((o={}).diyTarget=r,this._firstTweenDic[a]=o):o=this._firstTweenDic[a],n.data)null==o[h]&&(o[h]=r[h])}}}"string"==typeof t?this.gotoLabel(t):this.gotoTime(t),this._loopKey=e,this._lastTime=Browser.now(),Laya.timer.frameLoop(1,this,this._update)},i._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey)return void this._complete();this._complete(),this.gotoTime(0)}var t,e=Browser.now(),i=e-this._lastTime,s=this._currTime+=i*this.scale;if(this._lastTime=e,0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var n=this._tweenDataList[this._index];s>=n.startTime&&(this._index++,0==n.type?(this._gidIndex++,(t=new Tween)._create(n.target,n.data,n.duration,n.ease,new Handler(this,this._animComplete,[this._gidIndex]),0,!1,n.isTo,!0,!1),t.setStartTime(s),t.gid=this._gidIndex,this._tweenDic[this._gidIndex]=t):this.event("label",n.data))}for(var r in this._tweenDic)(t=this._tweenDic[r])._updateEase(s)},i._animComplete=function(t){this._tweenDic[t]&&delete this._tweenDic[t]},i._complete=function(){this.event("complete")},i.reset=function(){var t;if(this._labelDic)for(t in this._labelDic)delete this._labelDic[t];for(t in this._tweenDic)this._tweenDic[t].clear(),delete this._tweenDic[t];for(t in this._firstTweenDic)delete this._firstTweenDic[t];this._endTweenDataList=null,this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,Laya.timer.clear(this,this._update)},i.destory=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},e.__init$=function(){o=function(){function t(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return __class(t,""),t}()},e}(),Sprite=function(i){function e(){this.mouseThrough=!1,this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._enableRenderMerge=!1,this._zOrder=0,this._graphics=null,this._renderType=0,this.autoSize=!1,this.optimizeFloat=!1,e.__super.call(this),this._style=Style.EMPTY}__class(e,"laya.display.Sprite",i);var t=e.prototype;return Laya.imps(t,{"laya.display.ILayout":!0}),t.destroy=function(t){void 0===t&&(t=!0),i.prototype.destroy.call(this,t),this._style&&this._style.destroy(),this._transform=null,this._style=null,this._graphics=null,this._$P=null},t.updateOrder=function(){Utils.updateOrder(this._childs)&&this.repaint()},t.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0)},t.setBounds=function(t){this._set$P("uBounds",t)},t.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this.boundPointsToParent(),this._$P.mBounds)},t.getSelfBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds)},t.boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this._style._tf.translateX,i=this._style._tf.translateY,t=t||0!==this._style._tf.rotate,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var s=this._getBoundPointsM(t);if(!s||s.length<1)return s;if(8!=s.length&&(s=t?GrahamScan.scanPList(s):Rectangle._getWrapRec(s,Rectangle.TEMP)._getBoundPoints()),!this.transform)return Utils.transPointList(s,this.x-e,this.y-i),s;var n=Point.TEMP,r=0,a=s.length;for(r=0;r<a;r+=2)n.x=s[r],n.y=s[r+1],this.toParentPoint(n),s[r]=n.x,s[r+1]=n.y;return s},t.getGraphicBounds=function(){return this._graphics?this._graphics.getBounds():Rectangle.EMPTY},t._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var e=Utils.clearArray(this._$P.temBM),i=Rectangle.TEMP;return i.copyFrom(this.scrollRect),Utils.concatArray(e,i._getBoundPoints()),e}for(var s,n,r,a=this._graphics?this._graphics.getBoundPoints():Utils.clearArray(this._$P.temBM),o=0,h=(r=this._childs).length;o<h;o++)(s=r[o])instanceof laya.display.Sprite&&1==s.visible&&(n=s.boundPointsToParent(t))&&(a=a?Utils.concatArray(a,n):n);return a},t.getStyle=function(){return this._style===Style.EMPTY&&(this._style=new Style),this._style},t.setStyle=function(t){this._style=t},t._adjustTransform=function(){"use strict";this._tfChanged=!1;var t,e=this._style._tf,i=e.scaleX,s=e.scaleY;if(e.rotate||1!==i||1!==s||e.skewX||e.skewY){if((t=this._transform||(this._transform=Matrix.create())).bTransform=!0,e.rotate){var n=.0174532922222222*e.rotate,r=t.cos=Math.cos(n),a=t.sin=Math.sin(n);return t.a=i*r,t.b=i*a,t.c=-s*a,t.d=s*r,t.tx=t.ty=0,t}return t.a=i,t.d=s,t.c=t.b=t.tx=t.ty=0,e.skewX||e.skewY?t.skew(.0174532922222222*e.skewX,.0174532922222222*e.skewY):t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-9,t},t.pos=function(t,e){return this._x===t&&this._y===e||(this.x=t,this.y=e),this},t.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},t.size=function(t,e){return this.width=t,this.height=e,this},t.scale=function(t,e){return this.scaleX=t,this.scaleY=e,this},t.skew=function(t,e){return this.skewX=t,this.skewY=e,this},t.render=function(t,e,i){Stat.spriteDraw++,RenderSprite.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t.drawToCanvas=function(t,e,i,s){return RunDriver.drawToCanvas(this,this._renderType,t,e,i,s)},t.customRender=function(t,e,i){},t.applyFilters=function(){var t;if(!Render.isWebGL&&((t=this._$P.filters)&&!(t.length<1)))for(var e=0,i=t.length;e<i;e++)t[e].action.apply(this._$P.cacheCanvas)},t.isHaveGlowFilter=function(){var t,e=0;for(e=0;e<this.filters.length;e++)if(8==this.filters[e].type)return!0;for(e=0,t=this._childs.length;e<t;e++)if(this._childs[e].isHaveGlowFilter())return!0;return!1},t.ask=function(t,e){return 1==t&&2==e},t.localToGlobal=function(t,e){if(void 0===e&&(e=!1),!this._displayInStage||!t)return t;!0===e&&(t=new Point(t.x,t.y));for(var i=this;i&&i!=Laya.stage;)t=i.toParentPoint(t),i=i.parent;return t},t.globalToLocal=function(t,e){if(void 0===e&&(e=!1),!this._displayInStage||!t)return t;!0===e&&(t=new Point(t.x,t.y));for(var i=this,s=[];i&&i!=Laya.stage;)s.push(i),i=i.parent;for(var n=s.length-1;0<=n;)t=(i=s[n]).fromParentPoint(t),n--;return t},t.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t.x,t.y,t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},t.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},t.on=function(t,e,i,s){return 1!==this._mouseEnableState&&this.isMouseEvent(t)&&(this._displayInStage?this._$2__onDisplay():laya.events.EventDispatcher.prototype.once.call(this,"display",this,this._$2__onDisplay)),laya.events.EventDispatcher.prototype.on.call(this,t,e,i,s)},t.once=function(t,e,i,s){return 1!==this._mouseEnableState&&this.isMouseEvent(t)&&(this._displayInStage?this._$2__onDisplay():laya.events.EventDispatcher.prototype.once.call(this,"display",this,this._$2__onDisplay)),laya.events.EventDispatcher.prototype.once.call(this,t,e,i,s)},t._$2__onDisplay=function(){if(1!==this._mouseEnableState)for(var t=this;t&&1!==t._mouseEnableState;)t.mouseEnabled=!0,t=t.parent},t.loadImage=function(t,e,i,s,n,r){var a=this;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),this.graphics.loadImage(t,e,i,s,n,function(t){a.size(t.width,t.height),a.repaint(),r&&r.runWith(t)}),this},t.repaint=function(){0===this._repaint&&(this._repaint=1,this.parentRepaint(this))},t.isRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},t.childChanged=function(t){this._childs.length?this._renderType|=2048:this._renderType&=-2049,t&&t.zOrder&&Laya.timer.callLater(this,this.updateOrder),this.repaint()},t.parentRepaint=function(t){var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this))},t.startDrag=function(t,e,i,s,n,r){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===s&&(s=300),void 0===r&&(r=!1),this._$P.dragging||this._set$P("dragging",new Dragging),this._$P.dragging.start(this,t,e,i,s,n,r)},t.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},t._setDisplay=function(t){!t&&this._$P.cacheCanvas&&this._$P.cacheCanvas.ctx&&(this._$P.cacheCanvas.ctx.destroy(),this._$P.cacheCanvas.ctx=null);var e=this._$P._filterCache;e&&(e.destroy(),e.recycle(),this._set$P("_filterCache",null)),this._set$P("_isHaveGlowFilter",!1),i.prototype._setDisplay.call(this,t)},t.hitTestPoint=function(t,e){var i=this.globalToLocal(Point.TEMP.setTo(t,e));return(this._$P.hitArea?this._$P.hitArea:Rectangle.EMPTY.setTo(0,0,this._width,this._height)).contains(i.x,i.y)},t.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY))},t._getWords=function(){return null},t._addChildsToLayout=function(e){var t=this._getWords();return(null!=t||0!=this._childs.length)&&(t&&t.forEach(function(t){e.push(t)}),this._childs.forEach(function(t){t._style._enableLayout()&&t._addToLayout(e)}),!0)},t._addToLayout=function(t){this._style.absolute||(this._style.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))},t._isChar=function(){return!1},t._getCSSStyle=function(){return this._style.getCSSStyle()},t.setValue=function(t,e){switch(t){case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}},t.layoutLater=function(){this.parent&&this.parent.layoutLater()},__getset(0,t,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(t){this.cacheAs=t?"normal":"none"}),__getset(0,t,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t,this.repaint(),t?this._renderType|=64:this._renderType&=-65}),__getset(0,t,"viewHeight",function(){return this.height*this._style._tf.scaleY}),__getset(0,t,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(t){var e=this._$P.cacheCanvas;t!==(e?e.type:"none")&&("none"!==t?(e||(e=this._set$P("cacheCanvas",Pool.getItemByClass("cacheCanvas",Object))),e.type=t,e.reCache=!0,this._renderType|=16):(e&&Pool.recover("cacheCanvas",e),this._$P.cacheCanvas=null,this._renderType&=-17),this.repaint())}),__getset(0,t,"staticCache",function(){return this._$P.staticCache},function(t){!(this._$P.staticCache=t)&&this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0)}),__getset(0,t,"x",function(){return this._x},function(t){var e=this._parent;this._x!==t&&(this._x=t,e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this)))}),__getset(0,t,"y",function(){return this._y},function(t){var e=this._parent;this._y!==t&&(this._y=t,e&&0===e._repaint&&(e._repaint=1,e.parentRepaint(this)))}),__getset(0,t,"skewX",function(){return this._style._tf.skewX},function(t){var e=this.getStyle();if(e._tf.skewX!==t){e.setSkewX(t),this._tfChanged=!0,this._renderType|=8;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint(this))}}),__getset(0,t,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(t){this._width!==t&&(this._width=t,this.repaint())}),__getset(0,t,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(t){this._height!==t&&(this._height=t,this.repaint())}),__getset(0,t,"viewWidth",function(){return this.width*this._style._tf.scaleX}),__getset(0,t,"scaleX",function(){return this._style._tf.scaleX},function(t){var e=this.getStyle();if(e._tf.scaleX!==t){e.setScaleX(t),this._tfChanged=!0,this._renderType|=8;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint(this))}}),__getset(0,t,"hitArea",function(){return this._$P.hitArea},function(t){this._set$P("hitArea",t)}),__getset(0,t,"rotation",function(){return this._style._tf.rotate},function(t){var e=this.getStyle();if(e._tf.rotate!==t){e.setRotate(t),this._tfChanged=!0,this._renderType|=8;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint(this))}}),__getset(0,t,"scaleY",function(){return this._style._tf.scaleY},function(t){var e=this.getStyle();if(e._tf.scaleY!==t){e.setScaleY(t),this._tfChanged=!0,this._renderType|=8;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint(this))}}),__getset(0,t,"blendMode",function(){return this._style.blendMode},function(t){(this.getStyle().blendMode=t)&&"source-over"!=t?this._renderType|=32:this._renderType&=-33,this.parentRepaint(this)}),__getset(0,t,"skewY",function(){return this._style._tf.skewY},function(t){var e=this.getStyle();if(e._tf.skewY!==t){e.setSkewY(t),this._tfChanged=!0,this._renderType|=8;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint(this))}}),__getset(0,t,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1,(this._transform=t)&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0),t?this._renderType|=8:this._renderType&=-9,this.parentRepaint(this)}),__getset(0,t,"pivotX",function(){return this._style._tf.translateX},function(t){this.getStyle().setTranslateX(t),this.repaint()}),__getset(0,t,"pivotY",function(){return this._style._tf.translateY},function(t){this.getStyle().setTranslateY(t),this.repaint()}),__getset(0,t,"alpha",function(){return this._style.alpha},function(t){this._style.alpha!==t&&(t=t<0?0:1<t?1:t,1!==(this.getStyle().alpha=t)?this._renderType|=4:this._renderType&=-5,this.parentRepaint(this))}),__getset(0,t,"visible",function(){return this._style.visible},function(t){this._style.visible!==t&&(this.getStyle().visible=t,this.parentRepaint(this))}),__getset(0,t,"graphics",function(){return this._graphics||(this.graphics=RunDriver.createGraphics())},function(t){this._graphics&&(this._graphics._sp=null),(this._graphics=t)?(this._renderType&=-2,this._renderType|=256,t._sp=this):(this._renderType&=-257,this._renderType&=-2),this.repaint()}),__getset(0,t,"filters",function(){return this._$P.filters},function(t){if(t&&0===t.length&&(t=null),this._$P.filters!=t){if(this._set$P("filters",t?t.slice():null),Render.isWebGL)return t&&t.length?this._renderType|=2:this._renderType&=-3,void this.repaint();this.cacheAsBitmap=t&&0<t.length,this.repaint()}}),__getset(0,t,"mask",function(){return this._$P._mask},function(t){this.cacheAsBitmap=!0,this._set$P("_mask",t),this._renderType|=32,this.parentRepaint(this)}),__getset(0,t,"stage",function(){return Laya.stage}),__getset(0,t,"mouseEnabled",function(){return 1<this._mouseEnableState},function(t){this._mouseEnableState=t?2:1}),__getset(0,t,"enableRenderMerge",function(){return this._enableRenderMerge},function(t){Render.isWebGL&&(t?this._renderType|=1024:this._renderType&=-1025,this._enableRenderMerge=t)}),__getset(0,t,"mouseY",function(){return this.getMousePoint().y}),__getset(0,t,"mouseX",function(){return this.getMousePoint().x}),__getset(0,t,"zOrder",function(){return this._zOrder},function(t){this._zOrder!=t&&(this._zOrder=t,this._parent&&Laya.timer.callLater(this._parent,this.updateOrder))}),e.fromImage=function(t){return(new e).loadImage(t)},e}(Node),AudioSoundChannel=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=Utils.bind(this.__onEnd,this),this._resumePlay=Utils.bind(this.__resumePlay,this),t.addEventListener("ended",this._onEnd),this._audio=t}__class(e,"laya.media.h5audio.AudioSoundChannel",SoundChannel);var i=e.prototype;return i.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(this.completeHandler.run(),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.play()},i.__resumePlay=function(){try{this._audio.removeEventListener("canplay",this._resumePlay),this._audio.currentTime=this.startTime,Browser.document.body.appendChild(this._audio),this._audio.play()}catch(t){this.event("error")}},i.play=function(){try{this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._resumePlay)}Browser.document.body.appendChild(this._audio),this._audio.play()},i.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),Pool.recover("audio:"+this.url,this._audio),Browser.removeElement(this._audio),this._audio=null)},__getset(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e}(),WebAudioSoundChannel=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._onPlayEnd=null,this.context=WebAudioSound.ctx,e.__super.call(this),this._onPlayEnd=Utils.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}__class(e,"laya.media.webaudio.WebAudioSoundChannel",SoundChannel);var i=e.prototype;return i.play=function(){if(this._clearBufferSource(),this.audioBuffer){var t=this.context,e=this.gain,i=t.createBufferSource();(this.bufferSource=i).buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this._startTime=Browser.now(),this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.start(0,this.startTime),this._currentTime=0}},i.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(this.completeHandler.run(),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.play()},i._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null;try{t.buffer=WebAudioSound._miniBuffer}catch(t){}this.bufferSource=null}},i.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null},__getset(0,i,"position",function(){return this.bufferSource?(Browser.now()-this._startTime)/1e3+this.startTime:0}),__getset(0,i,"volume",function(){return this._volume},function(t){this.isStopped||(this._volume=t,this.gain.gain.value=t)}),e}(),Bitmap=function(t){function e(){e.__super.call(this),this._w=0,this._h=0}__class(e,"laya.resource.Bitmap",t);var i=e.prototype;return i.copyTo=function(t){t._source=this._source,t._w=this._w,t._h=this._h},i.dispose=function(){this._resourceManager.removeResource(this),t.prototype.dispose.call(this)},__getset(0,i,"source",function(){return this._source}),__getset(0,i,"width",function(){return this._w}),__getset(0,i,"height",function(){return this._h}),e}(Resource),Animation=function(e){function o(){this.loop=!1,this._frames=null,this._index=0,this._count=0,this._isPlaying=!1,o.__super.call(this),this.interval=Config.animationInterval,this.on("display",this,this._$3__onDisplay),this.on("undisplay",this,this._$3__onDisplay)}__class(o,"laya.display.Animation",e);var t=o.prototype;return t.destroy=function(t){void 0===t&&(t=!0),this.stop(),e.prototype.destroy.call(this,t),this._frames=null},t._$3__onDisplay=function(){this._isPlaying&&(this._displayInStage?this.play(this._index,this.loop):this.clearTimer(this,this._frameLoop))},t.play=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),i&&o.framesMap[i]&&(this._frames=o.framesMap[i],this._count=this._frames.length),this._isPlaying=!0,this.index=t,this.loop=e,this._frames&&0<this._frames.length&&0<this.interval&&(this._index++,this.timerLoop(this.interval,this,this._frameLoop,null,!0))},t._frameLoop=function(){this._style.visible&&.01<this._style.alpha&&(this.index=this._index,this._index++,this._index>=this._count&&(this.loop?this._index=0:(this._index--,this.stop()),this.event("complete")))},t.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},t.clear=function(){this.stop(),this.graphics=null,this._frames=null},t.loadImages=function(t){return this.frames=o.createFrames(t,""),this},t.loadAtlas=function(e){var i=this;function t(t){e===t&&(i.frames=o.createFrames(e,""))}return Loader.getAtlas(e)?t(e):Laya.loader.load(e,Handler.create(null,t,[e]),null,"atlas"),this},__getset(0,t,"index",function(){return this._index},function(t){this._index=t,this._frames&&(this.graphics=this._frames[t])}),__getset(0,t,"count",function(){return this._count}),__getset(0,t,"frames",function(){return this._frames},function(t){(this._frames=t)&&(this._count=t.length,this._isPlaying?this.play(this._index,this.loop):this.index=this._index)}),o.createFrames=function(t,e){var i;if("string"==typeof t){var s=Loader.getAtlas(t);if(s&&s.length){i=[];for(var n=0,r=s.length;n<r;n++){var a=new Graphics;a.drawTexture(s[n],0,0),i.push(a)}}}else if(t instanceof Array)for(i=[],n=0,r=t.length;n<r;n++)(a=new Graphics).loadImage(t[n],0,0),i.push(a);return e&&(o.framesMap[e]=i),i},o.framesMap={},o}(Sprite),Text=function(e){function d(){this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._clipPoint=null,this._currBitmapFont=null,d.__super.call(this),this.overflow=d.VISIBLE,this._style=new CSSStyle(this),this._style.wordWrap=!1}__class(d,"laya.display.Text",e);var t=d.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._lines=null},t._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},t.getGraphicBounds=function(){var t=Rectangle.TEMP;return t.setTo(0,0,this.width,this.height),t},t._getCSSStyle=function(){return this._style},t.lang=function(t,e,i,s,n,r,a,o,h,l,u){if(t=d.langPacks?d.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var c=0,_=arguments.length;c<_;c++)t=t.replace("{"+c+"}",arguments[c+1]);this._text=t}},t.renderText=function(t,e){var i=this.graphics;i.clear();var s=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.ctx.font=s;var n=this.padding,r=n[3],a="left",o=this._lines,h=this.leading+this.fontSize,l=this._currBitmapFont;l&&(h=this.leading+l.getMaxHeight());var u=n[0];if(!l&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(a="right",r=this._width-n[1]):"center"==this.align&&(a="center",r=.5*this._width+n[3]-n[1])),0<this._height){var c=this._textHeight>this._height?"top":this.valign;"middle"===c?u=.5*(this._height-e*h)+n[0]-n[2]:"bottom"===c&&(u=this._height-e*h-n[2])}var _=this._style;if(l&&l.autoScaleSize)var d=l.fontSize/this.fontSize;if(this._clipPoint)if(i.save(),l&&l.autoScaleSize){var f=0,p=0;f=this._width?this._width-n[3]-n[1]:this._textWidth,p=this._height?this._height-n[0]-n[2]:this._textHeight,f*=d,p*=d,i.clipRect(n[3],n[0],f,p)}else i.clipRect(n[3],n[0],this._width?this._width-n[3]-n[1]:this._textWidth,this._height?this._height-n[0]-n[2]:this._textHeight);for(var g=0,m=0,y=Math.min(this._lines.length,e+t)||1,v=t;v<y;v++){var x=o[v];if(_.password){var b=x.length;x="";for(var w=b;0<w;w--)x+="·"}if(g=r-(this._clipPoint?this._clipPoint.x:0),m=u+h*v-(this._clipPoint?this._clipPoint.y:0),l){var T=this.width;l.autoScaleSize&&(T=this.width*d),l.drawText(x,this,g,m,this.align,T)}else _.stroke?i.fillBorderText(x,g,m,s,this.color,_.strokeColor,_.stroke,a):i.fillText(x,g,m,s,this.color,a)}if(l&&l.autoScaleSize){var S=1/d;this.scale(S,S)}this._clipPoint&&i.restore(),this._startX=r,this._startY=u},t.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear();Browser.ctx.font=this._getCSSStyle().font,this._lines.length=0,this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new Point(0,0)):this._clipPoint=null;var t=this._lines.length;if(this.overflow!=d.VISIBLE){var e=this.overflow==d.HIDDEN?Math.floor:Math.ceil;t=Math.min(t,e((this.height-this.padding[0]-this.padding[2])/(this.leading+this.fontSize)))}this.renderText(0,t),this.repaint()},t.evalTextSize=function(){for(var t=this._textWidth=0,e=this._lines.length;t<e;++t){var i=this._lines[t];this._textWidth=Math.max(this.getTextWidth(i)+this.padding[3]+this.padding[1],this._textWidth)}this._currBitmapFont?this._textHeight=this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._textHeight=this._lines.length*(this.fontSize+this.leading)+this.padding[0]+this.padding[2]},t.checkEnabledViewportOrNot=function(){return this.overflow==d.SCROLL&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},t.changeText=function(t){this._text!==t&&(this.lang(t),this._graphics&&this._graphics.replaceText(t)||this.typeset())},t.parseLines=function(t){var e=this.wordWrap||this.overflow==d.HIDDEN;if(e)var i=this.getWordWrapWidth();for(var s=t.split(/\r|\n|\\n/),n=0,r=s.length;n<r;n++)n<r-1&&(s[n]+="\n"),e?this.parseLine(s[n],i):this._lines[n]=s[n]},t.parseLine=function(t,e){Browser.ctx;var i,s=this._lines,n=0,r=NaN,a=NaN,o=0;if((r=this.getTextWidth(t))<=e)s.push(t);else{r=this._currBitmapFont?this._currBitmapFont.getMaxWidth():Browser.ctx.measureText("阳").width,0==(n=Math.floor(e/r))&&(n=1),a=r=this.getTextWidth(t.substring(0,n));for(var h=n,l=t.length;h<l;h++)if(e<(a+=r=this.getTextWidth(t.charAt(h))))if(this.wordWrap){var u=t.substring(o,h);if((i=/[^\x20-]+$/.exec(u))&&(h=i.index+o,0==i.index?h+=u.length:u=t.substring(o,h)),s.push(u),!((o=h)+n<l)){s.push(t.substring(o,l)),o=-1;break}h+=n,a=r=this.getTextWidth(t.substring(o,h)),h--}else if(this.overflow==d.HIDDEN)return void s.push(t.substring(0,h));this.wordWrap&&-1!=o&&s.push(t.substring(o,l))}},t.getTextWidth=function(t){return this._currBitmapFont?this._currBitmapFont.getTextWidth(t):Browser.ctx.measureText(t).width},t.getWordWrapWidth=function(){var t=this.padding,e=NaN;return(e=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width)<=0&&(e=this.wordWrap?100:Browser.width),e<=0&&(e=100),e-t[3]-t[1]},t.getCharPoint=function(t,e){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);for(var i=0,s=this._lines,n=0,r=0,a=s.length;r<a;r++){if(t<(i+=s[r].length)){var o=r;break}n=i}var h=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.ctx.font=h;var l=Browser.ctx.measureText(this._text.substring(n,t)).width;return(e||new Point).setTo(this._startX+l-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this.fontSize+this.leading)-(this._clipPoint?this._clipPoint.y:0))},__getset(0,t,"textHeight",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textHeight}),__getset(0,t,"width",function(){return this._width?this._width:this.textWidth},function(t){e.prototype._$set_width.call(this,t),this.isChanged=!0}),__getset(0,t,"font",function(){return this._getCSSStyle().fontFamily},function(t){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),d.bitmapFonts&&d.bitmapFonts[t]&&(this._currBitmapFont=d.bitmapFonts[t]),this._getCSSStyle().fontFamily=t,this.isChanged=!0}),__getset(0,t,"height",function(){return this._height?this._height:this.textHeight},function(t){e.prototype._$set_height.call(this,t),this.isChanged=!0}),__getset(0,t,"leading",function(){return this._getCSSStyle().leading},function(t){this._getCSSStyle().leading=t,this.isChanged=!0}),__getset(0,t,"text",function(){return this._text||""},function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"))}),__getset(0,t,"textWidth",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textWidth}),__getset(0,t,"fontSize",function(){return this._getCSSStyle().fontSize},function(t){this._getCSSStyle().fontSize=t,this.isChanged=!0}),__getset(0,t,"bold",function(){return this._getCSSStyle().bold},function(t){this._getCSSStyle().bold=t,this.isChanged=!0}),__getset(0,t,"color",function(){return this._getCSSStyle().color},function(t){this._getCSSStyle().color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0}),__getset(0,t,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(t){this._getCSSStyle().strokeColor=t,this.isChanged=!0}),__getset(0,t,"italic",function(){return this._getCSSStyle().italic},function(t){this._getCSSStyle().italic=t,this.isChanged=!0}),__getset(0,t,"align",function(){return this._getCSSStyle().align},function(t){this._getCSSStyle().align=t,this.isChanged=!0}),__getset(0,t,"valign",function(){return this._getCSSStyle().valign},function(t){this._getCSSStyle().valign=t,this.isChanged=!0}),__getset(0,t,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(t){this._getCSSStyle().wordWrap=t,this.isChanged=!0}),__getset(0,t,"padding",function(){return this._getCSSStyle().padding},function(t){this._getCSSStyle().padding=t,this.isChanged=!0}),__getset(0,t,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(t){this._getCSSStyle().backgroundColor=t,this.isChanged=!0}),__getset(0,t,"borderColor",function(){return this._getCSSStyle().borderColor},function(t){this._getCSSStyle().borderColor=t,this.isChanged=!0}),__getset(0,t,"stroke",function(){return this._getCSSStyle().stroke},function(t){this._getCSSStyle().stroke=t,this.isChanged=!0}),__getset(0,t,"asPassword",function(){return this._getCSSStyle().password},function(t){this._getCSSStyle().password=t,this.isChanged=!0}),__getset(0,t,"isChanged",null,function(t){this._isChanged!==t&&(this._isChanged=t)&&Laya.timer.callLater(this,this.typeset)}),__getset(0,t,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){if(!(this.overflow!=d.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=e<t?e:t;var i=this._height/(this.fontSize+this.leading)|1;this._clipPoint.x=t,this.renderText(this._lastVisibleLineIndex,i)}}),__getset(0,t,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){if(!(this.overflow!=d.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height,i=(t=e<t?e:t)/(this.fontSize+this.leading)|0;this._lastVisibleLineIndex=i;var s=1+(this._height/(this.fontSize+this.leading)|0);this._clipPoint.y=t,this.renderText(i,s)}}),__getset(0,t,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),__getset(0,t,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),d.registerBitmapFont=function(t,e){d.bitmapFonts||(d.bitmapFonts={}),d.bitmapFonts[t]=e},d.unregisterBitmapFont=function(t,e){if(void 0===e&&(e=!0),d.bitmapFonts&&d.bitmapFonts[t]){var i=d.bitmapFonts[t];e&&i.destory(),delete d.bitmapFonts[t]}},d.langPacks=null,d.bitmapFonts=null,d.VISIBLE="visible",d.SCROLL="scroll",d.HIDDEN="hidden",d}(Sprite),Stage=function(a){function i(){this.focus=null,this.frameRate="fast",this.desginWidth=0,this.desginHeight=0,this.canvasRotation=!1,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,i.__super.call(this),this.offset=new Point,this.now=Browser.now(),this._canvasTransform=new Matrix,this.mouseEnabled=!0,this._displayInStage=!0;var e=this,t=Browser.window;t.addEventListener("focus",function(){e.event("focus")}),t.addEventListener("blur",function(){e.event("blur"),this.focus&&this.focus.focus&&(this.focus.focus=!1)}),t.addEventListener("resize",function(){e._resetCanvas(),Laya.timer.once(100,e,e._changeCanvasSize)}),t.addEventListener("orientationchange",function(t){e._resetCanvas(),Laya.timer.once(100,e,e._changeCanvasSize)}),this.on("mousemove",this,this._onmouseMove)}__class(i,"laya.display.Stage",a);var t=i.prototype;return t.size=function(t,e){return this.desginWidth=this.width=t,this.desginHeight=this.height=e,Laya.timer.callLater(this,this._changeCanvasSize),this},t._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio)},t._resetCanvas=function(){var t=Render.canvas,e=t.source.style;t.size(1,1),e.transform=e.webkitTransform=e.msTransform=e.mozTransform=e.oTransform="",this.visible=!1},t.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode&&(i=(t/e<1?"vertical":"horizontal")!==this._screenMode)){var s=e;e=t,t=s}this.canvasRotation=i;var n=Render.canvas,r=n.source.style,a=this._canvasTransform.identity(),o=this._scaleMode,h=t/this.desginWidth,l=e/this.desginHeight,u=this.desginWidth,c=this.desginHeight,_=t,d=e,f=Browser.pixelRatio;switch(this._width=this.desginWidth,this._height=this.desginHeight,o){case"noscale":h=l=1,_=this.desginWidth,d=this.desginHeight;break;case"showall":h=l=Math.min(h,l),_=Math.round(this.desginWidth*h),d=Math.round(this.desginHeight*l);break;case"noborder":h=l=Math.max(h,l),_=Math.round(this.desginWidth*h),d=Math.round(this.desginHeight*l);break;case"full":h=l=1,this._width=u=t,this._height=c=e;break;case"fixedwidth":l=h,this._height=e/h,c=Math.round(e/h);break;case"fixedheight":h=l,this._width=t/l,u=Math.round(t/l)}1===h&&1===l?this.transform&&this.transform.identity():(this.transform||(this.transform=new Matrix),this.transform.a=h/(_/u),this.transform.d=l/(d/c)),n.size(u,c),RunDriver.changeWebGLSize(u,c),a.scale(_/u/f,d/c/f),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=t-_:this.offset.x=.5*(t-_)/f,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=e-d:this.offset.y=.5*(e-d)/f,a.translate(this.offset.x,this.offset.y),i&&("horizontal"===this._screenMode?(a.rotate(Math.PI/2),a.translate(e/f,0)):(a.rotate(-Math.PI/2),a.translate(0,t/f))),a.a<1e-14&&(a.a=a.d=0),r.transformOrigin=r.webkitTransformOrigin=r.msTransformOrigin=r.mozTransformOrigin=r.oTransformOrigin="0px 0px 0px",r.transform=r.webkitTransform=r.msTransform=r.mozTransform=r.oTransform="matrix("+a.toString()+")",this.visible=!0,this._repaint=1,this.event("resize")},t.repaint=function(){this._repaint=1},t.parentRepaint=function(t){},t._loop=function(){return this.render(Render.context,0,0),!0},t._onmouseMove=function(t){this._mouseMoveTime=Browser.now()},t.render=function(t,e,i){Render.isFlash&&this.repaint(),this.now=Browser.now(),this._renderCount++;var s="slow"!==this.frameRate,n=this._renderCount%2==0,r=Render.context;Stat.renderSlow=!s,(s||n)&&(Stat.loopCount++,MouseManager.instance.runEvent(),Laya.timer._update(),this._style.visible&&(Render.isWebGL?r.clear():RunDriver.clear(this._bgColor),a.prototype.render.call(this,t,e,i))),!this._style.visible||!s&&n||(Render.isWebGL&&RunDriver.clear(this._bgColor),RunDriver.benginFlush(),t.flush(),RunDriver.endFinish())},__getset(0,t,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"alignH",function(){return this._alignH},function(t){this._alignH=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"alignV",function(){return this._alignV},function(t){this._alignV=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,t,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,Render.canvas.source.style.background=t||"none"}),__getset(0,t,"mouseX",function(){return Math.round(MouseManager.instance.mouseX/(this._transform?this._transform.a:1))}),__getset(0,t,"mouseY",function(){return Math.round(MouseManager.instance.mouseY/(this._transform?this._transform.d:1))}),__getset(0,t,"clientScaleX",function(){return this._transform?this._transform.a:1}),__getset(0,t,"clientScaleY",function(){return this._transform?this._transform.d:1}),__getset(0,t,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t}),i.SCALE_NOSCALE="noscale",i.SCALE_EXACTFIT="exactfit",i.SCALE_SHOWALL="showall",i.SCALE_NOBORDER="noborder",i.SCALE_FULL="full",i.SCALE_FIXED_WIDTH="fixedwidth",i.SCALE_FIXED_HEIGHT="fixedheight",i.ALIGN_LEFT="left",i.ALIGN_RIGHT="right",i.ALIGN_CENTER="center",i.ALIGN_TOP="top",i.ALIGN_MIDDLE="middle",i.ALIGN_BOTTOM="bottom",i.SCREEN_NONE="none",i.SCREEN_HORIZONTAL="horizontal",i.SCREEN_VERTICAL="vertical",i.FRAME_FAST="fast",i.FRAME_SLOW="slow",i.FRAME_MOUSE="mouse",i}(Sprite),FileBitmap=function(t){function e(){this._src=null,this._onload=null,this._onerror=null,e.__super.call(this)}__class(e,"laya.resource.FileBitmap",Bitmap);var i=e.prototype;return __getset(0,i,"onload",null,function(t){}),__getset(0,i,"src",function(){return this._src},function(t){this._src=t}),__getset(0,i,"onerror",null,function(t){}),e}(),HTMLCanvas=function(e){function i(t){this._is2D=!1,i.__super.call(this);var s=this;if(this._source=this,"2D"===t||"AUTO"===t&&!Render.isWebGL){this._is2D=!0,this._source=Browser.createElement("canvas");var n=this;n.getContext=function(t,e){if(s._ctx)return s._ctx;var i=s._ctx=s._source.getContext(t,e);return i&&(i._canvas=n,Render.isFlash||(i.size=function(t,e){})),"2d"===t&&Context._init(n,i),i}}else this._source={}}__class(i,"laya.resource.HTMLCanvas",e);var t=i.prototype;return t.clear=function(){this._ctx&&this._ctx.clear()},t.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},t.release=function(){},t._setContext=function(t){this._ctx=t},t.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=i._createContext(this)},t.copyTo=function(t){e.prototype.copyTo.call(this,t),t._ctx=this._ctx},t.getMemSize=function(){return 0},t.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t))},__getset(0,t,"context",function(){return this._ctx}),__getset(0,t,"asBitmap",null,function(t){}),i.create=function(t){return new i(t)},i.TYPE2D="2D",i.TYPE3D="3D",i.TYPEAUTO="AUTO",i._createContext=null,i}(Bitmap),HTMLSubImage=function(t){function h(t,e,i,s,n,r,a,o){throw h.__super.call(this),new Error("不允许new！")}return __class(h,"laya.resource.HTMLSubImage",Bitmap),h.create=function(t,e,i,s,n,r,a,o){return void 0===o&&(o=!1),new h(t,e,i,s,n,r,a,o)},h}(),Input=function(e){function n(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this.inputElementXAdjuster=0,this.inputElementYAdjuster=0,this.title="",this.clearOnFocus=!1,n.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=Text.SCROLL,this.on("mousedown",this,this.onMouseDown),this.on("undisplay",this,this.onUnDisplay)}__class(n,"laya.display.Input",e);var t=n.prototype;return t.onStageDown=function(t){t.target!=this&&(t.target instanceof laya.display.Input?(this.focusOut(),this.removeNeedlessInputMethod()):this.focus=!1,Laya.stage.off("mousedown",this,this.onStageDown))},t.onUnDisplay=function(t){this.focus=!1},t.onMouseDown=function(t){this.focus=!0,Browser.onMobile||Laya.stage.on("mousedown",this,this.onStageDown)},t.render=function(t,e,i){laya.display.Sprite.prototype.render.call(this,t,e,i)},t.syncInputPosition=function(){var t,e=this.nativeInput.style,i=Laya.stage;t=Utils.getGlobalPosAndScale(this);var s=i._canvasTransform.a,n=i._canvasTransform.d;if(e.left=(t.x+this.padding[3]+this.inputElementXAdjuster)*i.clientScaleX*s+i.offset.x+"px",e.top=(t.y+this.padding[0]+this.inputElementYAdjuster)*i.clientScaleY*n+i.offset.y+"px",this._getVisible()||(this.focus=!1),i.transform||1!=t.width||1!=t.height){var r="scale("+i.clientScaleX*s*t.width+","+i.clientScaleY*n*t.height+")";r!=e.transform&&(e.transformOrigin="0 0",e.transform=r)}},t._getVisible=function(){for(var t=this;t;){if(!1===t.visible)return!1;t=t.parent}return!0},t.select=function(){this.nativeInput.select()},t.focusIn=function(){var t=this.nativeInput;this._focus=!0;var e=n.cssStyle;e+=";white-space:"+(this.wordWrap?"pre-wrap":"pre"),t.readOnly=!this._editable,t.maxLength=this._maxChars;var i=this.padding;e+=";width:"+(this._width-i[1]-i[3])+"px",e+=";height:"+(this._height-i[0]-i[2])+"px",e+=";color:"+this.color,e+=";font-size:"+this.fontSize+"px",e+=";font-family:"+this.font,e+=";line-height:"+(this.leading+this.fontSize)+"px",e+=";font-style:"+(this.italic?"italic":"normal"),e+=";font-weight:"+(this.bold?"bold":"normal"),e+=";text-align:"+this.align;var s=this._text;t.value=s,this._text="",this.typeset(),this._text=s,t.style.cssText=e,t.type=this.asPassword?"password":"text",t.focus(),Laya.stage.off("keydown",this,this.onKeyDown),Laya.stage.on("keydown",this,this.onKeyDown),(Laya.stage.focus=this).event("focus"),this.syncInputPosition(),Laya.timer.frameLoop(1,this,this.syncInputPosition)},t.focusOut=function(){this._focus=!1;var t=this._text||"";this._text="",e.prototype._$set_text.call(this,t),Laya.stage.off("keydown",this,this.onKeyDown),Laya.stage.focus=null,this.event("blur"),Browser.document.body.scrollTop=0,Laya.timer.clear(this,this.syncInputPosition)},t.removeNeedlessInputMethod=function(){var t=Browser.document.body;!this._multiline&&t.contains(n.input)&&t.contains(n.area)?Browser.document.body.removeChild(n.input):this._multiline&&t.contains(n.area)&&t.contains(n.input)&&Browser.document.body.removeChild(n.area)},t.onKeyDown=function(t){13===t.keyCode&&this.event("enter")},__getset(0,t,"multiline",function(){return this._multiline},function(t){this._multiline=t,this.valign=t?"top":"middle",Browser.onMobile||(t?n.area||n.initInput(n.area=Browser.createElement("textarea")):n.input||n.initInput(n.input=Browser.createElement("input")))}),__getset(0,t,"color",e.prototype._$get_color,function(t){this._focus&&(this.nativeInput.style.color=t),e.prototype._$set_color.call(this,t)}),__getset(0,t,"nativeInput",function(){return this._multiline?n.area:n.input}),__getset(0,t,"focus",function(){return this._focus},function(t){if(Browser.onMobile){if(t&&this._editable){var e=Browser.window.prompt(this.clearOnFocus?"":(this.title,this._text||""));null!=e&&(this._restrictPattern&&(e=e.replace(this._restrictPattern,"")),this.text=e,this.event("input"),this.event("blur"))}}else{var i=this.nativeInput;this._focus!==t&&((laya.display.Input.isInputting=t)?(i.target&&(i.target.focus=!1),i.target=this,Browser.document.body.appendChild(i),this.focusIn()):(i.target=null,this.focusOut(),Browser.document.body.removeChild(i)))}}),__getset(0,t,"text",function(){return this._focus?this.nativeInput.value:this._text},function(t){this._focus&&(this.nativeInput.value=t||""),e.prototype._$set_text.call(this,t)}),__getset(0,t,"maxChars",function(){return this._maxChars},function(t){t<=0&&(t=1e5),this._maxChars=t}),__getset(0,t,"restrict",function(){return this._restrictPattern.source},function(t){this._restrictPattern=t?(-1<(t="[^"+t+"]").indexOf("^^")&&(t=t.replace("^^","")),new RegExp(t,"g")):null}),__getset(0,t,"editable",function(){return this._editable},function(t){this._editable=t}),n.getActiveInput=function(){return Browser.document.body.contains(n.input)?n.input:Browser.document.body.contains(n.area)?n.area:null},n.initInput=function(s){s.style.cssText=n.cssStyle,s.setAttribute("class","laya"),s.addEventListener("input",function(t){var e=s.target;if(e){var i=s.value;e._restrictPattern&&(i=i.replace(e._restrictPattern,""),s.value=i),e._text=i,e.event("input")}}),s.addEventListener("mousemove",n._stopEvent),s.addEventListener("mousedown",n._stopEvent),s.addEventListener("touchmove",n._stopEvent)},n._stopEvent=function(t){t.stopPropagation()},n.cssStyle="position:absolute;background-color:transparent;border:none;outline:none;resize:none;overflow:hidden;z-index:999",n.input=null,n.area=null,n.inputHeight=50,n.textAreaHeight=75,n.inputFontSize=25,n.borderStyle="3px solid orange",n.backgroundStyle="Linen",n.isInputting=!1,n}(Text),HTMLImage=function(t){function e(t){this._recreateLock=!1,this._needReleaseAgain=!1,e.__super.call(this),this._w=0,this._h=0,this._init_(t)}__class(e,"laya.resource.HTMLImage",t);var i=e.prototype;return i._init_=function(t){this._source=t||new Browser.window.Image},i.recreateResource=function(){var t=this;if(""===this._src)throw new Error("src不能为空！");if(this.startCreate(),this._source){if(this._recreateLock)return;this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.compoleteCreate()}else{this._recreateLock=!0;var e=this;this._source=new Browser.window.Image,this._source.onload=function(){if(e._source.onload=null,e._needReleaseAgain)return e._needReleaseAgain=!1,void(e._source=null);e.memorySize=t._w*t._h*4,e._recreateLock=!1,e.compoleteCreate()},this._source.src=this._src}},i.detoryResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},i.onresize=function(){this._w=this._source.width,this._h=this._source.height},i.dispose=function(){this.resourceManager.removeResource(this),laya.resource.Bitmap.prototype.dispose.call(this)},__getset(0,i,"source",function(){return this._source}),__getset(0,i,"onload",null,function(t){var e=this;this._onload=t,this._source&&(this._source.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),__getset(0,i,"src",t.prototype._$get_src,function(t){this._src=t,this._source&&(this._source.src=this._src)}),__getset(0,i,"onerror",null,function(t){var e=this;this._onerror=t,this._source&&(this._source.onerror=null!=this._onerror?function(){e._onerror()}:null)}),e.create=function(t){return new e(t)},e}(FileBitmap);Laya.__init([EventDispatcher,LoaderManager,Browser,Timer,LocalStorage,LaterEvent,TimeLine])}(window,document,Laya),function(t,e,i){i.un,i.uns,i.static;var s=i.class;i.getset,i.__newvec;new(function(){function t(){}return s(t,"LayaMain"),t}())}(window,document,Laya),function(t,e,m){m.un,m.uns;var n=m.static,c=m.class,s=m.getset,a=m.__newvec,o=laya.utils.Browser,l=laya.maths.Arith,u=laya.utils.RunDriver,d=(laya.filters.ColorFilter,m.Config),_=laya.renders.RenderSprite,C=laya.maths.Matrix,L=laya.maths.Rectangle,f=laya.utils.Stat,h=laya.renders.Render,i=laya.resource.Bitmap,p=laya.resource.HTMLImage,g=laya.system.System,r=(laya.utils.Byte,laya.resource.Context),y=(laya.utils.HTMLChar,laya.resource.Texture),M=laya.maths.Point,v=laya.utils.Utils,x=(laya.display.Text,laya.display.Sprite,laya.resource.FileBitmap,laya.renders.RenderContext,laya.utils.Color),b=laya.resource.HTMLCanvas,w=laya.display.Graphics,T=(laya.events.Event,laya.resource.Resource),S=laya.utils.StringKey,I=(laya.utils.Handler,laya.display.css.Style,laya.filters.Filter),A=(laya.resource.HTMLSubImage,laya.resource.ResourceManager);m.interface("laya.webgl.shapes.IShape"),m.interface("laya.webgl.resource.IMergeAtlasBitmap"),m.interface("laya.webgl.submit.ISubmit"),m.interface("laya.webgl.canvas.save.ISaveData"),m.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var R=function(){function t(){}c(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return m.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(t){},e.setValueMix=function(t){},e.apply3d=function(t,e,i,s,n){return null},e.apply=function(t){return null},s(0,e,"typeMix",function(){return 0}),t}(),P=function(){function t(){}return c(t,"laya.webgl.shader.ShaderValue"),t}(),E=function(){var s,n,r;function t(t,e,i){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new r,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=i}c(t,"laya.webgl.atlas.AtlasGrid");var e=t.prototype;return e.getAltasID=function(){return this._atlasID},e.setAltasID=function(t){0<=t&&(this._atlasID=t)},e.addTex=function(t,e,i){var s=this._get(e,i);return 0==s.ret||(this._fill(s.x,s.y,e,i,t),this._texCount++),s},e._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},e._init=function(t,e){if(this._width=t,this._height=e,this._release(),0==this._width)return!1;this._cells=new Array(this._width*this._height),this._rowInfo=a(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new n;for(i=0;i<this._width*this._height;i++)this._cells[i]=new s;return this._clear(),!0},e._get=function(t,e){var i=new D;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var s=-1,n=-1,r=this._width,a=this._height,o=this._cells,h=0;h<a;h++)if(!(this._rowInfo[h].spaceCount<t))for(var l=0;l<r;)if(0!=o[h*r+l].type||o[h*r+l].successionWidth<t||o[h*r+l].successionHeight<e)l+=o[h*r+l].successionWidth;else{s=l,n=h;for(var u=0;u<t;u++)if(o[h*r+l+u].successionHeight<e){s=-1;break}if(!(s<0))return i.ret=!0,i.x=s,i.y=n,i;l+=o[h*r+l].successionWidth}return i},e._fill=function(t,e,i,s,n){var r=this._width,a=this._height;this._check(t+i<=r&&e+s<=a);for(var o=e;o<s+e;++o){this._check(this._rowInfo[o].spaceCount>=i),this._rowInfo[o].spaceCount-=i;for(var h=0;h<i;h++)this._check(0==this._cells[t+o*r+h].type),this._cells[t+o*r+h].type=n,this._cells[t+o*r+h].successionWidth=i,this._cells[t+o*r+h].successionHeight=s}if(0<t)for(o=0;o<s;++o){var l=0;for(h=t-1;0<=h&&0==this._cells[(e+o)*r+h].type;--h,++l);for(h=l;0<h;--h)this._cells[(e+o)*r+t-h].successionWidth=h,this._check(0<h)}if(0<e)for(h=t;h<t+i;++h){for(l=0,o=e-1;0<=o&&0==this._cells[h+o*r].type;--o,l++);for(o=l;0<o;--o)this._cells[h+(e-o)*r].successionHeight=o,this._check(0<o)}},e._check=function(t){0==t&&console.log("xtexMerger 错误啦")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var s=this._cells[e*this._width+i];s.type=0,s.successionWidth=this._width-i,s.successionHeight=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},t.__init$=function(){s=function(){function t(){this.type=0,this.successionWidth=0,this.successionHeight=0}return c(t,""),t}(),n=function(){function t(){this.spaceCount=0}return c(t,""),t}(),r=function(){function t(){this.width=0,this.height=0}return c(t,""),t}()},t}(),B=function(){function p(t,e,i,s){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=s,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}c(p,"laya.webgl.atlas.AtlasResourceManager");var t=p.prototype;return t.setAtlasParam=function(t,e,i,s){if(1==this._setAtlasParam)return p._sid_=0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=s,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},t.pushData=function(t){this._setAtlasParam=!1;for(var e=Math.ceil((t.bitmap.width+2)/this._gridSize),i=Math.ceil((t.bitmap.height+2)/this._gridSize),s=!1,n=0;n<2;n++){for(var r=this._maxAtlaserCount,a=0;a<r;a++){var o=(this._curAtlasIndex+a)%r;this._atlaserArray.length-1>=o||this._atlaserArray.push(new ft(this._gridNumX,this._gridNumY,this._width,this._height,p._sid_++));var h=this._atlaserArray[o],l=t.bitmap,u=h.inAtlasWebGLImagesKey.indexOf(l),c=0,_=0;if(-1!=u){var d=h.InAtlasWebGLImagesOffsetValue[u];c=d[0],_=d[1],h.addToAtlas(t,c,_),s=!0,this._curAtlasIndex=o;break}var f=h.addTex(1,e,i);if(f.ret){c=f.x*this._gridSize+1,_=f.y*this._gridSize+1,l.lock=!0,h.addToAtlasTexture(l,c,_),h.addToAtlas(t,c,_),s=!0,this._curAtlasIndex=o;break}}if(s)break;this._atlaserArray.push(new ft(this._gridNumX,this._gridNumY,this._width,this._height,p._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return s||console.log(">>>AtlasManager pushData error"),s},t.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},t.garbageCollection=function(){if(!0===this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose();this._atlaserArray.splice(0,t),this._needGC=!1}return!0},t.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0},t.getAtlaserCount=function(){return this._atlaserArray.length},t.getAtlaserByIndex=function(t){return this._atlaserArray[t]},s(1,p,"instance",function(){return p._Instance||(p._Instance=new p(p.atlasTextureWidth,p.atlasTextureHeight,p.gridSize,p.maxTextureCount)),p._Instance}),s(1,p,"atlasLimitWidth",function(){return p._atlasLimitWidth},function(t){p._atlasLimitWidth=t}),s(1,p,"enabled",function(){return p._enabled}),s(1,p,"atlasLimitHeight",function(){return p._atlasLimitHeight},function(t){p._atlasLimitHeight=t}),p.enable=function(){p._enabled=!0,d.atlasEnable=!0},p.disable=function(){p._enabled=!1,d.atlasEnable=!1},p.__init__=function(){p.atlasTextureWidth=2048,p.atlasTextureHeight=2048,p.gridSize=16,p.maxTextureCount=8,p.atlasLimitWidth=512,p.atlasLimitHeight=512},p._enabled=!1,p._atlasLimitWidth=0,p._atlasLimitHeight=0,p.atlasTextureWidth=0,p.atlasTextureHeight=0,p.gridSize=0,p.maxTextureCount=0,p.BOARDER_TYPE_NO=0,p.BOARDER_TYPE_RIGHT=1,p.BOARDER_TYPE_LEFT=2,p.BOARDER_TYPE_BOTTOM=4,p.BOARDER_TYPE_TOP=8,p.BOARDER_TYPE_ALL=15,p._sid_=0,p._Instance=null,p}(),D=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return c(t,"laya.webgl.atlas.MergeFillInfo"),t}(),k=function(){function e(){}return c(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget]},e.BlendNormal=function(t){t.blendFunc(770,771)},e.BlendAdd=function(t){t.blendFunc(770,772)},e.BlendMultiply=function(t){t.blendFunc(774,771)},e.BlendScreen=function(t){t.blendFunc(770,1)},e.BlendOverlay=function(t){t.blendFunc(1,769)},e.BlendLight=function(t){t.blendFunc(770,1)},e.BlendNormalTarget=function(t){t.blendFuncSeparate(770,771,1,771)},e.BlendAddTarget=function(t){t.blendFunc(770,772)},e.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},e.BlendScreenTarget=function(t){t.blendFunc(770,1)},e.BlendOverlayTarget=function(t){t.blendFunc(1,769)},e.BlendLightTarget=function(t){t.blendFunc(770,1)},e.NAMES=["normal","add","multiply","screen","overlay","light"],e.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.LIGHT="light",e.OVERLAY="overlay",e.fns=[],e.targetFns=[],e}(),O=function(){function t(t){this._color=x.create("black"),this.setValue(t)}c(t,"laya.webgl.canvas.DrawStyle");var e=t.prototype;return e.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=x.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},e.reset=function(){this._color=x.create("black")},e.equal=function(t){return"string"==typeof t&&this._color.strColor===t},e.toColorStr=function(){return this._color.strColor},t.DEFAULT=new t("#000000"),t}(),F=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.geomatrys=[];ot.mainContext;this.ib=Dt.create(),this.vb=kt.create()}c(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.clear=function(){this._rect=null},e.rect2=function(t,e,i,s,n,r,a){void 0===r&&(r=2),void 0===a&&(a=0),this.geomatrys.push(this._curGeomatry=new wt(t,e,i,s,n,r,a))},e.rect=function(t,e,i,s){this._rect=new L(t,e,i,s),this.dirty=!0},e.strokeRect=function(t,e,i,s){this._rect=new L(t,e,i,s)},e.circle=function(t,e,i,s,n,r,a){var o;this.geomatrys.push(this._curGeomatry=o=new gt(t,e,i,s,n,r,a)),null==a&&(o.borderWidth=0)},e.fan=function(t,e,i,s,n,r,a,o){this.geomatrys.push(this._curGeomatry=new yt(t,e,i,s,n,r,a,o))},e.ellipse=function(t,e,i,s,n,r,a){this.geomatrys.push(this._curGeomatry=new mt(t,e,i,s,n,r,a))},e.polygon=function(t,e,i,s,n,r){var a;this.geomatrys.push(this._curGeomatry=a=new bt(t,e,i,s,n,r)),s||(a.fill=!1),null==r&&(a.borderWidth=0)},e.loopLine=function(t,e,i,s,n){var r;this.geomatrys.push(this._curGeomatry=r=new xt(t,e,i,s,n)),r.fill=!1},e.drawPath=function(t,e,i,s,n){this.geomatrys.push(this._curGeomatry=new vt(t,e,i,s,n))},e.update=function(){var t=this.ib.length,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb.length/20);this.geoStart=e,this.count=(this.ib.length-t)/2},e.sector=function(t,e,i,s){},e.roundRect=function(t,e,i,s,n,r){},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},t}(),N=function(){function o(){}c(o,"laya.webgl.canvas.save.SaveBase");var t=o.prototype;return m.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(o._cache[o._cache._length++]=this)._newSubmit&&(t._curSubmit=$.RENDERBASE)},o._createArray=function(){var t=[];return t._length=0,t},o._init=function(){var t=o._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[524288]="shader",t[1048576]="filters",t},o.save=function(t,e,i,s){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var n=o._cache,r=0<n._length?n[--n._length]:new o;r._value=i[r._valueName=o._namemap[e]],r._dataObj=i,r._newSubmit=s;var a=t._save;a[a._length++]=r}},o._cache=laya.webgl.canvas.save.SaveBase._createArray(),o._namemap=o._init(),o}(),z=function(){function r(){this._clipRect=new L}c(r,"laya.webgl.canvas.save.SaveClipRect");var t=r.prototype;return m.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._clipRect=this._clipSaveRect,(r._cache[r._cache._length++]=this)._submitScissor.submitLength=t._submits._length-this._submitScissor.submitIndex,t._curSubmit=$.RENDERBASE},r.save=function(t,e){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var i=r._cache,s=0<i._length?i[--i._length]:new r;s._clipSaveRect=t._clipRect,t._clipRect=s._clipRect.copyFrom(t._clipRect),s._submitScissor=e;var n=t._save;n[n._length++]=s}},r._cache=N._createArray(),r}(),H=function(){function s(){this._saveuse=0}c(s,"laya.webgl.canvas.save.SaveMark");var t=s.prototype;return m.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,s._no[s._no._length++]=this},s.Create=function(t){var e=s._no,i=0<e._length?e[--e._length]:new s;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},s._no=N._createArray(),s}(),V=function(){function r(){this._matrix=new C}c(r,"laya.webgl.canvas.save.SaveTransform");var t=r.prototype;return m.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,r._no[r._no._length++]=this},r.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=r._no,s=0<i._length?i[--i._length]:new r;s._savematrix=t._curMat,t._curMat=t._curMat.copy(s._matrix);var n=t._save;n[n._length++]=s}},r._no=N._createArray(),r}(),W=function(){function n(){}c(n,"laya.webgl.canvas.save.SaveTranslate");var t=n.prototype;return m.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat;t._x=this._x,t._y=this._y,n._no[n._no._length++]=this},n.save=function(t){var e=n._no,i=0<e._length?e[--e._length]:new n;i._x=t._x,i._y=t._y;var s=t._save;s[s._length++]=i},n._no=N._createArray(),n}(),U=function(){var i;function u(){this.targets=null,this.oneTargets=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._clipRect=new L}c(u,"laya.webgl.resource.RenderTargetMAX");var t=u.prototype;return t.size=function(t,e){this._width===t&&this._height===e||(this.repaint=!0,this._width=t,this._height=e,this.oneTargets?this.oneTargets.target.size(t,e):this.oneTargets=new i(t,e))},t._flushToTarget=function(t,e){var i=rt.worldScissorTest,s=rt.worldClipRect;rt.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,rt.worldScissorTest=!1,ot.mainContext.disable(3089);var n=rt.worldAlpha,r=rt.worldMatrix4,a=rt.worldMatrix,o=rt.worldFilters,h=rt.worldShaderDefines;if(rt.worldMatrix=u._matrixDefault,rt.worldMatrix4=rt.TEMPMAT4_ARRAY,rt.worldAlpha=1,rt.worldFilters=null,rt.worldShaderDefines=null,St.activeShader=null,e.start(),d.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),St.activeShader=null,rt.worldAlpha=n,rt.worldMatrix4=r,rt.worldMatrix=a,rt.worldFilters=o,rt.worldShaderDefines=h,rt.worldScissorTest=i){var l=rt.height-s.y-s.height;ot.mainContext.scissor(s.x,l,s.width,s.height),ot.mainContext.enable(3089)}rt.worldClipRect=s},t.flush=function(t){this.repaint&&(this._flushToTarget(t,this.oneTargets.target),this.repaint=!1)},t.drawTo=function(t,e,i,s,n){t.drawTexture(this.oneTargets.target.getTexture(),e,i,s,n,0,0)},t.destroy=function(){this.oneTargets&&(this.oneTargets.target.destroy(),this.oneTargets.target=null,this.oneTargets=null)},n(u,["_matrixDefault",function(){return this._matrixDefault=new C}]),u.__init$=function(){i=function(){function t(t,e){this.width=t,this.height=e,this.target=Ct.create(t,e)}return c(t,""),t}()},u}(),G=function(){function t(){this.ALPHA=1,this.shaderType=0,this.glTexture=p.create(),this.defines=new pt}return c(t,"laya.webgl.shader.d2.Shader2D"),t.__init__=function(){var t,e;St.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform float u_colorMatrix[20];\n"),St.addInclude("parts/ColorFilter_ps_logic.glsl","vec4 rgba=gl_FragColor;\ngl_FragColor.r =rgba.r*u_colorMatrix[0]+rgba.g*u_colorMatrix[1]+rgba.b*u_colorMatrix[2]+rgba.a*u_colorMatrix[3]+u_colorMatrix[4]/255.0;\ngl_FragColor.g =rgba.r*u_colorMatrix[5]+rgba.g*u_colorMatrix[6]+rgba.b*u_colorMatrix[7]+rgba.a*u_colorMatrix[8]+u_colorMatrix[9]/255.0;\ngl_FragColor.b =rgba.r*u_colorMatrix[10]+rgba.g*u_colorMatrix[11]+rgba.b*u_colorMatrix[12]+rgba.a*u_colorMatrix[13]+u_colorMatrix[14]/255.0;\ngl_FragColor.a =rgba.r*u_colorMatrix[15]+rgba.g*u_colorMatrix[16]+rgba.b*u_colorMatrix[17]+rgba.a*u_colorMatrix[18]+u_colorMatrix[19]/255.0;"),St.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),St.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);"),St.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor=vec4(0.0);\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 0])*0.004431848411938341;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 1])*0.05399096651318985;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 2])*0.2419707245191454;\ngl_FragColor += texture2D(texture, v_texcoord        )*0.3989422804014327;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 3])*0.2419707245191454;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 4])*0.05399096651318985;\ngl_FragColor += texture2D(texture, vBlurTexCoords[ 5])*0.004431848411938341;"),St.addInclude("parts/BlurFilter_ps_uniform.glsl","varying vec2 vBlurTexCoords[6];"),St.addInclude("parts/BlurFilter_vs_uniform.glsl","uniform float strength;\nvarying vec2 vBlurTexCoords[6];"),St.addInclude("parts/BlurFilter_vs_logic.glsl","\nvBlurTexCoords[ 0] = v_texcoord + vec2(-0.012 * strength, 0.0);\nvBlurTexCoords[ 1] = v_texcoord + vec2(-0.008 * strength, 0.0);\nvBlurTexCoords[ 2] = v_texcoord + vec2(-0.004 * strength, 0.0);\nvBlurTexCoords[ 3] = v_texcoord + vec2( 0.004 * strength, 0.0);\nvBlurTexCoords[ 4] = v_texcoord + vec2( 0.008 * strength, 0.0);\nvBlurTexCoords[ 5] = v_texcoord + vec2( 0.012 * strength, 0.0);"),St.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),St.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);"),t='attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\nuniform mat4 mmat;\nvarying vec2 v_texcoord;\n\n#include?BLUR_FILTER  "parts/BlurFilter_vs_uniform.glsl";\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_texcoord = texcoord;\n  #include?BLUR_FILTER  "parts/BlurFilter_vs_logic.glsl";\n}',e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',St.preCompile(0,1,t,e,null),t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',St.preCompile(0,2,t,e,null),t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 pos=mmat*u_mmat2*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n}",St.preCompile(0,4,t,e,null)},t}(),Y=function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}c(e,"laya.webgl.shader.ShaderDefines");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,s){s[i[t]=e]=t},e._toText=function(t,e,i){var s=i[t];if(s)return s;for(var n={},r=1,a=0;a<32&&!(t<(r=1<<a));a++)if(t&r){var o=e[r];o&&(n[o]="")}return i[t]=n},e._toInt=function(t,e){for(var i=t.split("."),s=0,n=0,r=i.length;n<r;n++){var a=e[i[n]];if(!a)throw new Error("Defines to int err:"+t+"/"+i[n]);s|=a}return s},e}(),X=function(){function t(t,e,i,s,n,r,a,o,h){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===h&&(h=0),this.x=t,this.y=e,this.width=i,this.height=s,this.edges=n,this.color=r,this.borderWidth=a,this.borderColor=o}c(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return m.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.circle=function(t,e,i){var s=this.x,n=this.y,r=this.edges,a=2*Math.PI/r,o=this.width,h=this.height,l=this.color,u=(l>>16&255)/255,c=(l>>8&255)/255,_=(255&l)/255;t.push(s,n,u,c,_);for(var d=0;d<r;d++)t.push(s+Math.sin(a*d)*o,n+Math.cos(a*d)*h),t.push(u,c,_);for(d=0;d<r;d++)e.push(i,i+d+1,i+d+2);e[e.length-1]=i+1},e.sector=function(t,e,i){var s=this.x,n=this.y,r=this.edges,a=(this.r1-this.r0)/r,o=this.width,h=this.height,l=this.color,u=(l>>16&255)/255,c=(l>>8&255)/255,_=(255&l)/255;t.push(s,n,u,c,_);for(var d=0;d<r+1;d++)t.push(s+Math.sin(a*d+this.r0)*o,n+Math.cos(a*d+this.r0)*h),t.push(u,c,_);for(d=0;d<r;d++)e.push(i,i+d+1,i+d+2)},e.createFanLine=function(t,e,i,s,n,r){var a=t.concat(),o=n||t,h=this.borderColor,l=(h>>16&255)/255,u=(h>>8&255)/255,c=(255&h)/255,_=[a[0],a[1]],d=[a[a.length-5],a[a.length-4]],f=d[0]+.5*(_[0]-d[0]),p=d[1]+.5*(_[1]-d[1]);a.unshift(f,p,0,0,0),a.push(f,p,0,0,0);var g,m,y,v,x,b,w,T,S,C,L,M,I,A,R,P,E,B,D,k,O=a.length/5,F=s,N=i/2;y=a[0],v=a[1],C=y-(x=a[5]),S=(S=-(v-(b=a[6])))/(k=Math.sqrt(S*S+C*C))*N,C=C/k*N,o.push(y-S,v-C,l,u,c,y+S,v+C,l,u,c);for(var z=1;z<O-1;z++)y=a[5*(z-1)],v=a[5*(z-1)+1],x=a[5*z],b=a[5*z+1],w=a[5*(z+1)],T=a[5*(z+1)+1],C=y-x,M=x-w,R=(-(S=(S=-(v-b))/(k=Math.sqrt(S*S+C*C))*N)+y)*(-(C=C/k*N)+b)-(-S+x)*(-C+v),B=(-(L=(L=-(b-T))/(k=Math.sqrt(L*L+M*M))*N)+w)*(-(M=M/k*N)+b)-(-L+x)*(-M+T),D=(I=-C+v-(-C+b))*(E=-L+x-(-L+w))-(P=-M+T-(-M+b))*(A=-S+x-(-S+y)),Math.abs(D)<.1?(D+=10.1,o.push(x-S,b-C,l,u,c,x+S,b+C,l,u,c)):(((g=(A*B-E*R)/D)-x)*(g-x)+((m=(P*R-I*B)/D)-b)+(m-b),o.push(g,m,l,u,c,x-(g-x),b-(m-b),l,u,c));e=r||e;var H=this.edges+3;for(z=1;z<H;z++)e.push(F+2*(z-1),F+2*(z-1)+1,F+2*z+1,F+2*z+1,F+2*z,F+2*(z-1));return e.push(F+2*(z-1),F+2*(z-1)+1,F+1,F+1,F,F+2*(z-1)),o},e.createLine2=function(t,e,i,s,n,r){var a,o,h,l,u,c,_,d,f,p,g,m,y,v,x,b,w,T,S,C,L=t.concat(),M=n,I=this.borderColor,A=(I>>16&255)/255,R=(I>>8&255)/255,P=(255&I)/255,E=L.length/2,B=s,D=i/2;h=L[0],l=L[1],p=h-(u=L[2]),f=(f=-(l-(c=L[3])))/(C=Math.sqrt(f*f+p*p))*D,p=p/C*D,M.push(h-f+this.x,l-p+this.y,A,R,P,h+f+this.x,l+p+this.y,A,R,P);for(var k=1;k<E-1;k++)h=L[2*(k-1)],l=L[2*(k-1)+1],u=L[2*k],c=L[2*k+1],_=L[2*(k+1)],d=L[2*(k+1)+1],p=h-u,m=u-_,x=(-(f=(f=-(l-c))/(C=Math.sqrt(f*f+p*p))*D)+h)*(-(p=p/C*D)+c)-(-f+u)*(-p+l),T=(-(g=(g=-(c-d))/(C=Math.sqrt(g*g+m*m))*D)+_)*(-(m=m/C*D)+c)-(-g+u)*(-m+d),S=(y=-p+l-(-p+c))*(w=-g+u-(-g+_))-(b=-m+d-(-m+c))*(v=-f+u-(-f+h)),Math.abs(S)<.1?(S+=10.1,M.push(u-f+this.x,c-p+this.y,A,R,P,u+f+this.x,c+p+this.y,A,R,P)):(((a=(v*T-w*x)/S)-u)*(a-u)+((o=(b*x-y*T)/S)-c)+(o-c),M.push(a+this.x,o+this.y,A,R,P,u-(a-u)+this.x,c-(o-c)+this.y,A,R,P));h=L[L.length-4],l=L[L.length-3],p=h-(u=L[L.length-2]),f=(f=-(l-(c=L[L.length-1])))/(C=Math.sqrt(f*f+p*p))*D,p=p/C*D,M.push(u-f+this.x,c-p+this.y,A,R,P,u+f+this.x,c+p+this.y,A,R,P);var O=r;for(k=1;k<O;k++)e.push(B+2*(k-1),B+2*(k-1)+1,B+2*k+1,B+2*k+1,B+2*k,B+2*(k-1));return M},e.createLine=function(t,e,i,s){var n=t.concat(),r=t,a=this.borderColor,o=(a>>16&255)/255,h=(a>>8&255)/255,l=(255&a)/255;n.splice(0,5);var u,c,_,d,f,p,g,m,y,v,x,b,w,T,S,C,L,M,I,A,R=n.length/5,P=s,E=i/2;_=n[0],d=n[1],v=_-(f=n[5]),y=(y=-(d-(p=n[6])))/(A=Math.sqrt(y*y+v*v))*E,v=v/A*E,r.push(_-y,d-v,o,h,l,_+y,d+v,o,h,l);for(var B=1;B<R-1;B++)_=n[5*(B-1)],d=n[5*(B-1)+1],f=n[5*B],p=n[5*B+1],g=n[5*(B+1)],m=n[5*(B+1)+1],v=_-f,b=f-g,S=(-(y=(y=-(d-p))/(A=Math.sqrt(y*y+v*v))*E)+_)*(-(v=v/A*E)+p)-(-y+f)*(-v+d),M=(-(x=(x=-(p-m))/(A=Math.sqrt(x*x+b*b))*E)+g)*(-(b=b/A*E)+p)-(-x+f)*(-b+m),I=(w=-v+d-(-v+p))*(L=-x+f-(-x+g))-(C=-b+m-(-b+p))*(T=-y+f-(-y+_)),Math.abs(I)<.1?(I+=10.1,r.push(f-y,p-v,o,h,l,f+y,p+v,o,h,l)):(((u=(T*M-L*S)/I)-f)*(u-f)+((c=(C*S-w*M)/I)-p)+(c-p),r.push(u,c,o,h,l,f-(u-f),p-(c-p),o,h,l));_=n[n.length-10],d=n[n.length-9],v=_-(f=n[n.length-5]),y=(y=-(d-(p=n[n.length-4])))/(A=Math.sqrt(y*y+v*v))*E,v=v/A*E,r.push(f-y,p-v,o,h,l,f+y,p+v,o,h,l);var D=this.edges+1;for(B=1;B<D;B++)e.push(P+2*(B-1),P+2*(B-1)+1,P+2*B+1,P+2*B+1,P+2*B,P+2*(B-1));return r},e.createLoopLine=function(t,e,i,s,n,r){var a=t.concat(),o=n||t,h=this.borderColor,l=(h>>16&255)/255,u=(h>>8&255)/255,c=(255&h)/255;a.splice(0,5);var _=[a[0],a[1]],d=[a[a.length-5],a[a.length-4]],f=d[0]+.5*(_[0]-d[0]),p=d[1]+.5*(_[1]-d[1]);a.unshift(f,p,0,0,0),a.push(f,p,0,0,0);var g,m,y,v,x,b,w,T,S,C,L,M,I,A,R,P,E,B,D,k,O=a.length/5,F=s,N=i/2;y=a[0],v=a[1],C=y-(x=a[5]),S=(S=-(v-(b=a[6])))/(k=Math.sqrt(S*S+C*C))*N,C=C/k*N,o.push(y-S,v-C,l,u,c,y+S,v+C,l,u,c);for(var z=1;z<O-1;z++)y=a[5*(z-1)],v=a[5*(z-1)+1],x=a[5*z],b=a[5*z+1],w=a[5*(z+1)],T=a[5*(z+1)+1],C=y-x,M=x-w,R=(-(S=(S=-(v-b))/(k=Math.sqrt(S*S+C*C))*N)+y)*(-(C=C/k*N)+b)-(-S+x)*(-C+v),B=(-(L=(L=-(b-T))/(k=Math.sqrt(L*L+M*M))*N)+w)*(-(M=M/k*N)+b)-(-L+x)*(-M+T),D=(I=-C+v-(-C+b))*(E=-L+x-(-L+w))-(P=-M+T-(-M+b))*(A=-S+x-(-S+y)),Math.abs(D)<.1?(D+=10.1,o.push(x-S,b-C,l,u,c,x+S,b+C,l,u,c)):(((g=(A*B-E*R)/D)-x)*(g-x)+((m=(P*R-I*B)/D)-b)+(m-b),o.push(g,m,l,u,c,x-(g-x),b-(m-b),l,u,c));r&&(e=r);var H=this.edges+1;for(z=1;z<H;z++)e.push(F+2*(z-1),F+2*(z-1)+1,F+2*z+1,F+2*z+1,F+2*z,F+2*(z-1));return e.push(F+2*(z-1),F+2*(z-1)+1,F+1,F+1,F,F+2*(z-1)),o},t}(),$=(function(){function t(t,e,i,s,n,r,a){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=s,this.fillAlpha=n,this.shape=a,this.fill=r}c(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null}}(),function(){function t(t){if(t instanceof Float32Array)this.points=t;else if(t instanceof Array){t.length;this.points=new Float32Array(t)}}c(t,"laya.webgl.shapes.Vertex");var e=t.prototype;m.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){}}(),function(){function u(t){void 0===t&&(t=1),this._renderType=t}c(u,"laya.webgl.submit.Submit");var t=u.prototype;return m.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=u._cache;(t[t._length++]=this).shaderValue.release(),this._submitID=-1,this._vb=null},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle)return 1;if(this.shaderValue.textureHost){if(!this.shaderValue.textureHost.bitmap||!this.shaderValue.textureHost.source)return 1;this.shaderValue.texture=this.shaderValue.textureHost.source}this._vb.bind_upload(this._ib);var t=ot.mainContext;return this.shaderValue.upload(),u.activeBlendFunction!==this._blendFn&&(t.enable(3042),this._blendFn(t),u.activeBlendFunction=this._blendFn),f.drawCall++,f.trianglesFaces+=this._numEle/3,t.drawElements(4,this._numEle,5123,this._startIdx),1},u.__init__=function(){var t=u.RENDERBASE=new u(-1);t.shaderValue=new ct(0,0),t.shaderValue.ALPHA=-1234},u.create=function(t,e,i,s,n,r,a){var o=u._cache._length?u._cache[--u._cache._length]:new u;null==n&&((n=o._selfVb||(o._selfVb=kt.create())).clear(),r=0),o._ib=s,o._vb=n,o._submitID=e,o._mergID=i,o._startIdx=r*st.BYTES_PIDX,o._numEle=0;var h=t._nBlendType;o._blendFn=t._targets?k.targetFns[h]:k.fns[h],o.shaderValue=a,o.shaderValue.setValue(t._shader2D);var l=t._shader2D.filters;return l&&o.shaderValue.setFilters(l),o},u.createShape=function(t,e,i,s,n,r){var a=u._cache._length?u._cache[--u._cache._length]:new u;a._ib=e,a._vb=i,a._numEle=s,a._startIdx=n,a.shaderValue=r,a.shaderValue.setValue(t._shader2D);var o=t._nBlendType;return a._blendFn=t._targets?k.targetFns[o]:k.fns[o],a},u.TYPE_2D=1,u.TYPE_CANVAS=3,u.TYPE_CMDSETRT=4,u.TYPE_CUSTOM=5,u.TYPE_BLURRT=6,u.TYPE_CMDDESTORYPRERT=7,u.TYPE_DISABLESTENCIL=8,u.TYPE_OTHERIBVB=9,u.TYPE_PRIMITIVE=10,u.TYPE_RT=11,u.TYPE_BLUR_RT=12,u.TYPE_TARGET=13,u.TYPE_CHANGE_VALUE=14,u.TYPE_SHAPE=15,u.RENDERBASE=null,u.activeBlendFunction=null,u._cache=((u._cache=[])._length=0,u._cache),u}()),K=function(){function s(){this.fun=null,this.args=null}c(s,"laya.webgl.submit.SubmitCMD");var t=s.prototype;return m.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(null,this.args),1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=s._cache;t[t._length++]=this},s.create=function(t,e){var i=s._cache._length?s._cache[--s._cache._length]:new s;return i.fun=e,i.args=t,i},s._cache=((s._cache=[])._length=0,s._cache),s}(),j=function(){function e(){this.variables={}}c(e,"laya.webgl.submit.SubmitCMDScope");var t=e.prototype;return t.getValue=function(t){return this.variables[t]},t.addValue=function(t,e){return this.variables[t]=e},t.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},t.clear=function(){for(var t in this.variables)delete this.variables[t]},t.recycle=function(){this.clear(),e.POOL.push(this)},e.create=function(){var t=e.POOL.pop();return t||(t=new e),t},e.POOL=[],e}(),q=function(){function u(){this.offset=0,this.startIndex=0,this._mat=C.create()}c(u,"laya.webgl.submit.SubmitOtherIBVB");var t=u.prototype;return m.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=u._cache;t[t._length++]=this},t.getRenderType=function(){return 9},t.renderSubmit=function(){if(this._shaderValue.textureHost){var t=this._shaderValue.textureHost.source;if(!t)return 1;this._shaderValue.texture=t}this._vb.bind_upload(this._ib);var e=rt.worldMatrix4,i=C.TEMP;C.mulPre(this._mat,e[0],e[1],e[4],e[5],e[12],e[13],i);var s=rt.worldMatrix4=u.tempMatrix4;s[0]=i.a,s[1]=i.b,s[4]=i.c,s[5]=i.d,s[12]=i.tx,s[13]=i.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var n=ot.mainContext;return $.activeBlendFunction!==this._blendFn&&(n.enable(3042),this._blendFn(n),$.activeBlendFunction=this._blendFn),f.drawCall++,f.trianglesFaces+=this._numEle/3,n.drawElements(4,this._numEle,5123,this.startIndex),rt.worldMatrix4=e,St.activeShader=null,1},u.create=function(t,e,i,s,n,r,a,o){var h=u._cache._length?u._cache[--u._cache._length]:new u;h._ib=i,h._vb=e,h._numEle=s,h._shader=n,h._shaderValue=r;var l=t._nBlendType;return h._blendFn=t._targets?k.targetFns[l]:k.fns[l],h.startIndex=a,h.offset=o,h},u._cache=((u._cache=[])._length=0,u._cache),u.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u}(),Q=function(){function i(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new L,this.screenRect=new L}c(i,"laya.webgl.submit.SubmitScissor");var t=i.prototype;return m.imps(t,{"laya.webgl.submit.ISubmit":!0}),t._scissor=function(t,e,i,s){var n=rt.worldMatrix4,r=n[0],a=n[5],o=n[12],h=n[13];if(s*=a,(i*=r)<1||s<1)return!1;var l=(t=t*r+o)+i,u=(e=e*a+h)+s;t<0&&(i=l-(t=0)),e<0&&(s=u-(e=0));var c=rt.worldClipRect;if(t=Math.max(t,c.x),e=Math.max(e,c.y),i=Math.min(l,c.right)-t,s=Math.min(u,c.bottom)-e,i<1||s<1)return!1;var _=rt.worldScissorTest;return this.screenRect.copyFrom(c),c.x=t,c.y=e,c.width=i,c.height=s,rt.worldScissorTest=!0,e=rt.height-e-s,ot.mainContext.scissor(t,e,i,s),ot.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),_?(e=rt.height-this.screenRect.y-this.screenRect.height,ot.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),ot.mainContext.enable(3089)):(ot.mainContext.disable(3089),rt.worldScissorTest=!1),c.copyFrom(this.screenRect),!0},t._scissorWithTagart=function(t,e,i,s){if(i<1||s<1)return!1;var n=t+i,r=e+s;t<0&&(i=n-(t=0)),e<0&&(s=r-(e=0));var a=rt.worldClipRect;if(t=Math.max(t,a.x),e=Math.max(e,a.y),i=Math.min(n,a.right)-t,s=Math.min(r,a.bottom)-e,i<1||s<1)return!1;var o=rt.worldScissorTest;return this.screenRect.copyFrom(a),rt.worldScissorTest=!0,a.x=t,a.y=e,a.width=i,a.height=s,e=rt.height-e-s,ot.mainContext.scissor(t,e,i,s),ot.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),o?(e=rt.height-this.screenRect.y-this.screenRect.height,ot.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),ot.mainContext.enable(3089)):(ot.mainContext.disable(3089),rt.worldScissorTest=!1),a.copyFrom(this.screenRect),!0},t.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=i._cache;(t[t._length++]=this).context=null},i.create=function(t){var e=i._cache._length?i._cache[--i._cache._length]:new i;return e.context=t,e},i._cache=((i._cache=[])._length=0,i._cache),i}(),Z=function(){function i(){this.step=0,this.level=0}c(i,"laya.webgl.submit.SubmitStencil");var t=i.prototype;return m.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5()}return 1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=i._cache;t[t._length++]=this},t.do1=function(){var t=ot.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},t.do2=function(){var t=ot.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do3=function(){var t=ot.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},t.do4=function(){var t=ot.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,this.level,255),t.stencilOp(7680,7680,5386)},t.do5=function(){var t=ot.mainContext;t.stencilFunc(514,255,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},i.create=function(t){var e=i._cache._length?i._cache[--i._cache._length]:new i;return e.step=t,e},i._cache=((i._cache=[])._length=0,i._cache),i}(),J=function(){function o(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}c(o,"laya.webgl.submit.SubmitTarget");var t=o.prototype;return m.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return this.shaderValue.texture=t.source,this.shaderValue.upload(),this.blend(),f.drawCall++,f.trianglesFaces+=this._numEle/3,ot.mainContext.drawElements(4,this._numEle,5123,this._startIdx),1},t.blend=function(){if(o.activeBlendType!==this.blendType){var t=ot.mainContext;t.enable(3042),k.fns[this.blendType](t),o.activeBlendType=this.blendType}},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=o._cache;t[t._length++]=this},o.create=function(t,e,i,s,n,r){var a=o._cache._length?o._cache[--o._cache._length]:new o;return a._ib=e,a._vb=i,a.proName=r,a._startIdx=s*st.BYTES_PIDX,a._numEle=0,a.blendType=t._nBlendType,a.shaderValue=n,a.shaderValue.setValue(t._shader2D),a},o.activeBlendType=-1,o._cache=((o._cache=[])._length=0,o._cache),o}(),tt=function(){var t;function L(){}return c(L,"laya.webgl.text.DrawText"),L.__init__=function(){L._charsTemp=new Array,L._drawValue=new t},L.getChar=function(t,e,i){return L._wordsMsg[e]=et.createOneChar(t,i)},L._drawSlow=function(t,e,i,s,n,r,a,o,h,l,u,c,_,d){var f,p,g=L._drawValue.value(r,o,h,l,_,d),m=0,y=0,v=L._charsTemp,x=0,b=NaN;if(s)for(v.length=s.length,m=0,y=s.length;m<y;m++)b=(p=s[m]).charNum+g.txtID,v[m]=f=L._wordsMsg[b]||L.getChar(p.char,b,g),f.active();else for(v.length=i.length,m=0,y=i.length;m<y;m++)b=i.charCodeAt(m)+g.txtID,v[m]=f=L._wordsMsg[b]||L.getChar(i.charAt(m),b,g),f.active(),x+=f.width;var w=0;null!==a&&"left"!==a&&(w=-("center"==a?x/2:x));var T,S,C=NaN;if(s)for(m=0,y=v.length;m<y;m++)(f=v[m]).isSpace||(p=s[m],C=f.borderSize,T=f.texture,e._drawText(T,u+w+(p.x-C)*_,c+(p.y-C)*d,T.width,T.height,n,0,0,0,0));else for(m=0,y=v.length;m<y;m++)(f=v[m]).isSpace||(C=f.borderSize,T=f.texture,e._drawText(T,u+w-C*_,c-C*d,T.width,T.height,n,0,0,0,0),t&&(t.push(S=[]),S[0]=T,S[1]=w-C*_,S[2]=-C*d)),w+=f.width},L._drawFast=function(t,e,i,s,n){for(var r,a,o=0,h=t.length;o<h;o++)(r=(a=t[o])[0]).active(),e._drawText(r,s+a[1],n+a[2],r.width,r.height,i,0,0,0,0)},L.drawText=function(t,e,i,s,n,r,a,o,h,l,u){if(!(e&&0===e.length||i&&0===i.length)){var c=s.a,_=s.d;(0!==s.b||0!==s.c)&&(c=_=1);var d=1!==c||1!==_;if(d&&m.stage.transform){var f=m.stage.transform;d=f.a===c&&f.d===_}else d=!1;if(d?((s=s.copy(ut._tmpMatrix)).scale(1/c,1/_),s._checkTransform(),l*=c,u*=_):c=_=1,i)L._drawSlow(null,t,e,i,s,n,r,a,o,h,l,u,c,_);else{var p=e+n.toString()+a+o+h+c+_,g=L._textCache[p];g?L._drawFast(g,t,s,l,u):(L._textCache.__length||(L._textCache.__length=0),100<L._textCache.__length&&((L._textCache={}).__length=0),g=L._textCache[p]=[],L._drawSlow(g,t,e,i,s,n,r,a,o,h,l,u,c,_))}}},L._wordsMsg={},L._textCache={},L._charsTemp=null,L._drawValue=null,L.__init$=function(){t=function(){function o(){}return c(o,""),o.prototype.value=function(t,e,i,s,n,r){this.font=t,this.fillColor=e,this.borderColor=i,this.lineWidth=s,this.scaleX=n,this.scaleY=r;var a=t.toString()+n+r+s+e+i;return this.txtID=o._keymap[a],this.txtID||(this.txtID=1e-7*++o._keymapCount,o._keymap[a]=this.txtID),this},o._keymap={},o._keymapCount=1,o}()},L}(),et=function(){function i(t,e){if(this.char=t,this.isSpace=" "===t,this.xs=e.scaleX,this.ys=e.scaleY,this.font=e.font.toString(),this.fontSize=e.font.size,this.fillColor=e.fillColor,this.borderColor=e.borderColor,this.lineWidth=e.lineWidth,h.isConchApp){var i=ConchTextCanvas;i._source=ConchTextCanvas,i._source.canvas=ConchTextCanvas,this.texture=new y(new Pt(i,this))}else this.texture=new y(new Pt(o.canvas.source,this))}return c(i,"laya.webgl.text.DrawTextChar"),i.prototype.active=function(){this.texture.active()},i.createOneChar=function(t,e){return new i(t,e)},i}(),it=function(){function i(t){this._index=0,this._size=14,this._italic=-2,this.setFont(t||"14px Arial")}c(i,"laya.webgl.text.FontInContext");var t=i.prototype;return t.setFont=function(t){this._words=t.split(" ");for(var e=0,i=this._words.length;e<i;e++)if(0<this._words[e].indexOf("px")){this._index=e;break}this._size=m.__parseInt(this._words[this._index]),this._text=null,this._italic=-2},t.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},t.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t)return e;return-1},t.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},t.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},t.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},s(0,t,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),i.create=function(t){var e=i._cache[t];return e||(e=i._cache[t]=new i(t))},i.EMPTY=new i,i._cache={},i}(),st=function(){function t(){}return c(t,"laya.webgl.utils.CONST3D2D"),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,n(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),nt=function(){function f(){}return c(f,"laya.webgl.utils.GlUtils"),f.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},f.fillIBQuadrangle=function(t,e){if(65535/4<e)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.length=t.bufferLength;for(var i=t.getUint16Array(),s=0,n=0;n<e;n++)i[s++]=4*n,i[s++]=4*n+2,i[s++]=4*n+1,i[s++]=4*n,i[s++]=4*n+3,i[s++]=4*n+2;return t.setNeedUpload(),!0},f.expandIBQuadrangle=function(t,e){t.bufferLength>=6*e*2||f.fillIBQuadrangle(t,e)},f.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},f.fillQuadrangleImgVb=function(t,e,i,s,n,r,a,o){"use strict";var h=16+(t._length>>2);t.length=h<<2;var l=t.getFloat32Array();l[(h-=16)+2]=n[0],l[h+3]=n[1],l[h+6]=n[2],l[h+7]=n[3],l[h+10]=n[4],l[h+11]=n[5],l[h+14]=n[6],l[h+15]=n[7];var u=r.a,c=r.b,_=r.c,d=r.d;if(1!==u||0!==c||0!==_||1!==d){r.bTransform=!0;var f=r.tx+a,p=r.ty+o;l[h]=(s[0]+e)*u+(s[1]+i)*_+f,l[h+1]=(s[0]+e)*c+(s[1]+i)*d+p,l[h+4]=(s[2]+e)*u+(s[3]+i)*_+f,l[h+5]=(s[2]+e)*c+(s[3]+i)*d+p,l[h+8]=(s[4]+e)*u+(s[5]+i)*_+f,l[h+9]=(s[4]+e)*c+(s[5]+i)*d+p,l[h+12]=(s[6]+e)*u+(s[7]+i)*_+f,l[h+13]=(s[6]+e)*c+(s[7]+i)*d+p}else r.bTransform=!1,e+=r.tx+a,i+=r.ty+o,l[h]=e+s[0],l[h+1]=i+s[1],l[h+4]=e+s[2],l[h+5]=i+s[3],l[h+8]=e+s[4],l[h+9]=i+s[5],l[h+12]=e+s[6],l[h+13]=i+s[7];return t._upload=!0},f.fillTranglesVB=function(t,e,i,s,n,r,a){"use strict";var o=(t._length>>2)+s.length;t.length=o<<2;var h=t.getFloat32Array();o-=s.length;for(var l=s.length,u=n.a,c=n.b,_=n.c,d=n.d,f=0;f<l;f+=4)if(h[o+f+2]=s[f+2],h[o+f+3]=s[f+3],1!==u||0!==c||0!==_||1!==d){n.bTransform=!0;var p=n.tx+r,g=n.ty+a;h[o+f]=(s[f]+e)*u+(s[f+1]+i)*_+p,h[o+f+1]=(s[f]+e)*c+(s[f+1]+i)*d+g}else n.bTransform=!1,e+=n.tx+r,i+=n.ty+a,h[o+f]=e+s[f],h[o+f+1]=i+s[f+1];return t._upload=!0},f.fillRectImgVb=function(t,e,i,s,n,r,a,o,h,l,u,c,_){void 0===_&&(_=!1);var d,f,p,g,m,y,v,x,b,w,T,S,C,L,M,I,A=1,R=o.a,P=o.b,E=o.c,B=o.d;if(1!==R||0!==P||0!==E||1!==B?(o.bTransform=!0,0===P&&0===E&&(A=23,b=n+i,w=r+s,d=R*i+(T=o.tx+h),p=R*b+T,f=B*s+(S=o.ty+l),g=B*w+S)):(A=23,o.bTransform=!1,p=(d=i+o.tx+h)+n,g=(f=s+o.ty+l)+r),1!==A&&(v<=d||x<=f||p<=m||g<=y))return!1;var D=16+(t._length>>2);t.length=D<<2;var k=t.getFloat32Array();switch(k[(D-=16)+2]=a[0],k[D+3]=a[1],k[D+6]=a[2],k[D+7]=a[3],k[D+10]=a[4],k[D+11]=a[5],k[D+14]=a[6],k[D+15]=a[7],A){case 1:T=o.tx+h,S=o.ty+l;var O=R*i,F=E*s,N=B*s,z=P*i,H=R*(b=n+i),V=E*(w=r+s),W=B*w,U=P*b;k[D+13]=_?(C=O+F+T,M=Math.round(C)-C,L=N+z+S,I=Math.round(L)-L,k[D]=C+M,k[D+1]=L+I,k[D+4]=H+F+T+M,k[D+5]=N+U+S+I,k[D+8]=H+V+T+M,k[D+9]=W+U+S+I,k[D+12]=O+V+T+M,W+z+S+I):(k[D]=O+F+T,k[D+1]=N+z+S,k[D+4]=H+F+T,k[D+5]=N+U+S,k[D+8]=H+V+T,k[D+9]=W+U+S,k[D+12]=O+V+T,W+z+S);break;case 23:k[D+13]=_?(C=d+u,M=Math.round(C)-C,L=f,I=Math.round(L)-L,k[D]=C+M,k[D+1]=L+I,k[D+4]=p+u+M,k[D+5]=f+I,k[D+8]=p+M,k[D+9]=g+I,k[D+12]=d+M,g+I):(k[D]=d+u,k[D+1]=f,k[D+4]=p+u,k[D+5]=f,k[D+8]=p,k[D+9]=g,k[D+12]=d,g);break;case 30:if(d<m||f<y||v<p||x<g){var G=m-d,Y=y-f,X=p-v,$=g-x;0<G&&(d=m,k[D+14]=k[D+2]=k[D+2]+G/(n*R)*(k[D+6]-k[D+2])),0<Y&&(f=y,k[D+7]=k[D+3]=k[D+3]+Y/(r*B)*(k[D+11]-k[D+7])),0<X&&(p=v,k[D+6]=k[D+10]=k[D+6]-X/(n*R)*(k[D+6]-k[D+2])),0<$&&(g=x,k[D+11]=k[D+15]=k[D+15]-$/(r*B)*(k[D+11]-k[D+7]))}k[D+13]=_?(C=d+u,M=Math.round(C)-C,L=f,I=Math.round(L)-L,k[D]=C+M,k[D+1]=L+I,k[D+4]=p+u+M,k[D+5]=f+I,k[D+8]=p+M,k[D+9]=g+I,k[D+12]=d+M,g+I):(k[D]=d+u,k[D+1]=f,k[D+4]=p+u,k[D+5]=f,k[D+8]=p,k[D+9]=g,k[D+12]=d,g)}return t._upload=!0},f.fillLineVb=function(t,e,i,s,n,r,a,o){"use strict";var h=.5*a,l=f._fillLineArray,u=-(s-r),c=i-n,_=Math.sqrt(u*u+c*c);u/=_,c/=_,u*=h,c*=h,l[0]=i-u,l[1]=s-c,l[4]=i+u,l[5]=s+c,l[8]=n+u,l[9]=r+c,l[12]=n-u,l[13]=r-c,o&&o.transformPointArray(l,l);var d=16+(t._length>>2);return t.length=d<<2,t.insertData(l,d-16),!0},f._fillLineArray=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],f}(),rt=function(){function t(){}return c(t,"laya.webgl.utils.RenderState2D"),t.mat2MatArray=function(t,e){var i=t,s=e;return s[0]=i.a,s[1]=i.b,s[4]=i.c,s[5]=i.d,s[12]=i.tx,s[13]=i.ty,e},t.restoreTempArray=function(){t.TEMPMAT4_ARRAY[0]=1,t.TEMPMAT4_ARRAY[1]=0,t.TEMPMAT4_ARRAY[4]=0,t.TEMPMAT4_ARRAY[5]=1,t.TEMPMAT4_ARRAY[12]=0,t.TEMPMAT4_ARRAY[13]=0},t.clear=function(){t.worldScissorTest=!1,t.worldShaderDefines=null,t.worldFilters=null,t.worldAlpha=1,t.worldClipRect.x=t.worldClipRect.y=0,t.worldClipRect.width=t.width,t.worldClipRect.height=t.height,t.curRenderTarget=null},t._MAXSIZE=99999999,t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldAlpha=1,t.worldScissorTest=!1,t.worldFilters=null,t.worldShaderDefines=null,t.worldClipRect=new L(0,0,99999999,99999999),t.curRenderTarget=null,t.width=0,t.height=0,n(t,["worldMatrix",function(){return this.worldMatrix=new C}]),t}(),at=function(){var p;function t(t,e,i,s,d){function f(t){for(var e=t.split(" "),i=[],s=0;s<e.length;s++)0<e[s].length&&i.push(e[s]);return i}function n(t){var e,i,s,n=0,r=0,a=new p(0,null,null,null),o=a,h=t.split("\n");for(n=0,e=h.length;n<e;n++){var l=h[n];if(0<=l.indexOf("#ifdef"))i=f(l),o=new p(1,i[1],"",o);else if(0<=l.indexOf("#else"))s=o.condition,(o=new p(2,null,"",o.parent)).condition=s;else if(0<=l.indexOf("#endif"))o=o.parent;else if(0<=l.indexOf("#include")){var u=(i=f(l))[1],c=u.charAt(0);'"'!==c&&"'"!==c||0<(r=(u=u.substr(1,u.length-2)).lastIndexOf(c))&&(u=u.substr(0,r));var _=0<(r=i[0].indexOf("?"))?i[0].substr(r+1):i[0];new p(1,_,d[u],o)}else 0<o.childs.length&&0===o.childs[o.childs.length-1].type?o.childs[o.childs.length-1].text+="\n"+l:new p(0,null,l,o)}return a}this._VSTXT=e,this._PSTXT=i,this._VS=n(e),this._PS=n(i),this._nameMap=s}return c(t,"laya.webgl.utils.ShaderCompile"),t.prototype.createShader=function(t,e,i){var s={},n="";if(t)for(var r in t)n+="#define "+r+"\n",s[r]=!0;var a=this._VS.toscript(s,[]),o=this._PS.toscript(s,[]);return(i||St.create)(n+a.join("\n"),n+o.join("\n"),e,this._nameMap)},t.IFDEF_NO=0,t.IFDEF_YES=1,t.IFDEF_ELSE=2,t.__init$=function(){p=function(){function t(t,e,i,s){if(this.childs=new Array,this.type=t,this.text=i,(this.parent=s)&&s.childs.push(this),e){for(var n="",r=!1,a=!1,o=0,h=e.length;o<h;o++){var l=e.charAt(o);r!=(a="!&|() \t".indexOf(l)<0)&&(a&&(n+="this."),r=a),n+=l}this.condition=u.createShaderCondition(n)}}return c(t,""),t.prototype.toscript=function(s,n){if(0===this.type&&this.text&&n.push(this.text),this.childs.length<1&&!this.text)return n;if(0!==this.type){var t=!!this.condition.call(s);if(2===this.type&&(t=!t),!t)return n;this.text&&n.push(this.text)}return 0<this.childs.length&&this.childs.forEach(function(t,e,i){t.toscript(s,n)}),n},t}()},t}(),ot=function(){function r(){}return c(r,"laya.webgl.WebGL"),r.enable=function(){if(!r.isWebGLSupported())return!1;if(h.isWebGL)return!0;p.create=function(t){return new Ft(t)},h.WebGL=r,h.isWebGL=!0,tt.__init__(),u.createRenderSprite=function(t,e){return new dt(t,e)},u.createWebGLContext2D=function(t){return new ut(t)},u.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},u.createGraphics=function(){return new lt};var t=u.createFilterAction;return u.createFilterAction=t||function(t){return new _t},u.clear=function(t){rt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=x.create(t)._color;h.context.ctx.clearBG(e[0],e[1],e[2],e[3]),rt.clear()},u.addToAtlas=function(e,t){void 0===t&&(t=!1);var i=e.bitmap;m.__typeof(i,"laya.webgl.resource.IMergeAtlasBitmap")&&i.allowMerageInAtlas&&i.on("recovered",null,function(t){i.enableMerageInAtlas&&B.instance.addToAtlas(e)})},B.enable(),u.benginFlush=function(){for(var t=B.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var s=t.getAtlaserByIndex(i).texture;s._flashCacheImageNeedFlush&&u.flashFlushImage(s)}},u.drawToCanvas=function(t,e,i,s,n,r){var a=new Ct(i,s,!1,6408,5121,0);a.start(),a.clear(1,0,0,1),t.render(h.context,-n,rt.height-s-r),h.context.flush(),a.end();var o=a.getData(0,0,a.width,a.height);return a.dispose(),o},u.createFilterAction=function(t){var e;switch(t){case 32:e=new _t}return e},I._filterStart=function(t,e,i,s,n){var r=t.getValue("bounds"),a=Ct.create(r.width,r.height);if(a.start(),a.clear(0,0,0,0),t.addValue("src",a),t.addValue("ScissorTest",rt.worldScissorTest),rt.worldScissorTest){var o=new L;o.copyFrom(i.ctx._clipRect),t.addValue("clipRect",o),rt.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},I._filterEnd=function(t,e,i,s,n){var r=t.getValue("bounds");t.getValue("src").end();var a=Ct.create(r.width,r.height);a.start(),a.clear(0,0,0,0),t.addValue("out",a),e._set$P("_filterCache",a),e._set$P("_isHaveGlowFilter",t.getValue("isHaveGlowFilter"))},I._EndTarget=function(t,e){if(t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")){rt.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var i=t.getValue("clipRect");e.ctx.clipRect(i.x,i.y,i.width,i.height)}},I._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},I._endSrc=function(t){t.getValue("src").end()},I._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},I._endOut=function(t){t.getValue("out").end()},I._recycleScope=function(t){t.recycle()},I._filter=function(t,e,i,s){var n=this._next;if(n){var r,a,o=t.filters,h=o.length;if(1==h&&32==o[0].type)return e.ctx.save(),e.ctx.setFilters([o[0]]),n._fun.call(n,t,e,i,s),void e.ctx.restore();var l=j.create(),u=M.TEMP,c=e.ctx._getTransformMatrix(),_=C.create();c.copy(_);var d=0,f=0,p=!1,g=t._$P._filterCache?t._$P._filterCache:null;if(!g||t._repaint){if(p=t.isHaveGlowFilter(),l.addValue("isHaveGlowFilter",p),p&&(d=50,f=25),(a=new L).copyFrom(t.getBounds()),a.width+=d,a.height+=d,u.x=a.x*_.a+a.y*_.c,u.y=a.y*_.d+a.x*_.b,a.x=u.x,a.y=u.y,u.x=a.width*_.a+a.height*_.c,u.y=a.height*_.d+a.width*_.b,a.width=u.x,a.height=u.y,a.width<=0||a.height<=0)return;g&&g.recycle(),l.addValue("bounds",a);var m=K.create([l,t,e,0,0],I._filterStart);e.addRenderObject(m),e.ctx._shader2D.glTexture=null;var y=t.x-t.pivotX,v=t.y-t.pivotY,x=y*_.a+v*_.c,b=v*_.d+y*_.b,w=-a.x+x+f-_.tx/_.a+t.pivotX,T=-a.y+b+f-_.ty/_.d+t.pivotY;n._fun.call(n,t,e,w,T),m=K.create([l,t,e,0,0],I._filterEnd),e.addRenderObject(m);for(var S=0;S<h;S++){0!=S&&(m=K.create([l],I._useSrc),e.addRenderObject(m),r=ct.create(1,0),C.TEMP.identity(),e.ctx.drawTarget(l,0,0,a.width,a.height,C.TEMP,"out",r),m=K.create([l],I._useOut),e.addRenderObject(m)),o[S].action.apply3d(l,t,e,0,0)}m=K.create([l,e],I._EndTarget),e.addRenderObject(m)}else{if((p=!!t._isHaveGlowFilter&&t._isHaveGlowFilter)&&(d=50,f=25),(a=t.getBounds()).width<=0||a.height<=0)return;a.width+=d,a.height+=d,u.x=a.x*_.a+a.y*_.c,u.y=a.y*_.d+a.x*_.b,a.x=u.x,a.y=u.y,u.x=a.width*_.a+a.height*_.c,u.y=a.height*_.d+a.width*_.b,l.addValue("out",g)}i=i-f-t.x,s=s-f-t.y,_.transformPoint(i,s,u),i=u.x+a.x,s=u.y+a.y,r=ct.create(1,0),C.TEMP.identity(),e.ctx.drawTarget(l,i,s,a.width,a.height,C.TEMP,"out",r),m=K.create([l],I._recycleScope),e.addRenderObject(m),_.destroy()}},!0},r.isWebGLSupported=function(){for(var t,e=o.createElement("canvas"),i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],s=0;s<i.length;s++){try{t=e.getContext(i[s])}catch(t){}if(t)return i[s]}return null},r.onStageResize=function(t,e){r.mainContext.viewport(0,0,t,e),rt.width=t,rt.height=e},r.isExperimentalWebgl=function(){return r._isExperimentalWebgl},r.addRenderFinish=function(){(r._isExperimentalWebgl||h.isFlash)&&(u.endFinish=function(){h.context.ctx.finish()})},r.removeRenderFinish=function(){r._isExperimentalWebgl&&(u.endFinish=function(){})},r.onInvalidGLRes=function(){B.instance.freeAll(),A.releaseContentManagers(!0),r.doNodeRepaint(m.stage),r.mainContext.viewport(0,0,rt.width,rt.height)},r.doNodeRepaint=function(t){0==t.numChildren&&t.repaint();for(var e=0;e<t.numChildren;e++)r.doNodeRepaint(t.getChildAt(e))},r.init=function(t,e,i){r.mainCanvas=t,b._createContext=function(t){return new ut(t)};var s=r.isWebGLSupported(),n=r.mainContext=u.newWebGLContext(t,s);if(r._isExperimentalWebgl="webgl"!=s&&(o.onWeiXin||o.onMQQBrowser),o.window.SetupWebglContext&&o.window.SetupWebglContext(n),r.onStageResize(e,i),null==r.mainContext)throw new Error("webGL getContext err!");g.__init__(),B.__init__(),pt.__init__(),$.__init__(),ut.__init__(),ct.__init__(),G.__init__(),Lt.__int__(n),k._init_(n),h.isConchApp&&conch.setOnInvalidGLRes(r.onInvalidGLRes)},r.mainCanvas=null,r.mainContext=null,r.antialias=!0,r._bg_null=[0,0,0,0],r._isExperimentalWebgl=!1,r}(),ht=function(){function s(){}return c(s,"laya.webgl.WebGLContext"),s.UseProgram=function(t){return s._useProgram!==t&&(ot.mainContext.useProgram(t),s._useProgram=t,!0)},s.setDepthTest=function(t,e){e!==s._depthTest&&((s._depthTest=e)?t.enable(2929):t.disable(2929))},s.setDepthMask=function(t,e){e!==s._depthMask&&(s._depthMask=e,t.depthMask(e))},s.setBlend=function(t,e){e!==s._blend&&((s._blend=e)?t.enable(3042):t.disable(3042))},s.setBlendFunc=function(t,e,i){(e!==s._sFactor||i!==s._dFactor)&&(s._sFactor=e,s._dFactor=i,t.blendFunc(e,i))},s.setCullFace=function(t,e){e!==s._cullFace&&((s._cullFace=e)?t.enable(2884):t.disable(2884))},s.setFrontFaceCCW=function(t,e){e!==s._frontFace&&(s._frontFace=e,t.frontFace(e))},s.bindTexture=function(t,e,i){t.bindTexture(e,i),s.curBindTexTarget=e,s.curBindTexValue=i},s._useProgram=null,s._depthTest=!0,s._depthMask=1,s._blend=!1,s._cullFace=!1,s.curBindTexTarget=null,s.curBindTexValue=null,n(s,["_depthFunc",function(){return this._depthFunc=515},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),s.__init$=function(){},s}(),lt=(function(){function t(){this.img=null,ot.enable(),m.init(800,800),m.stage.bgColor="gray",f.show()}c(t,"LayaWebGLMain")}(),function(t){function e(){e.__super.call(this)}c(e,"laya.webgl.display.GraphicsGL",w);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(h.context._setShader,arguments)},i.setIBVB=function(t,e,i,s,n,r){this._saveToCmd(h.context._setIBVB,arguments)},i.drawParticle=function(t,e,i){var s=u.createParticleTemplate2D(i);s.x=t,s.y=e,this._saveToCmd(h.context._drawParticle,[s])},e}()),ut=function(t){var i;function _(t){this._x=0,this._y=0,this._id=++_._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._submits=[],this._mergeID=0,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,_.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=_.MAXCLIPRECT,this._shader2D=new G,this.drawTexture=this._drawTextureM,this._canvas=t,this._curMat=C.create(),h.isFlash?(this._ib=Dt.create(),nt.fillIBQuadrangle(this._ib,16)):this._ib=Dt.QuadrangleIB,this._vb=kt.create(),this._other=i.DEFAULT,this._save=[H.Create(this)],this._save.length=10,this.clear()}c(_,"laya.webgl.canvas.WebGLContext2D",r);var e=_.prototype;return e.clearBG=function(t,e,i,s){var n=ot.mainContext;n.clearColor(t,e,i,s),n.clear(16640)},e._getSubmits=function(){return this._submits},e.destroy=function(){this._curMat&&this._curMat.destroy(),this._targets&&this._targets.destroy(),this._vb&&this._vb.releaseResource(),this._ib&&this._ib!=Dt.QuadrangleIB&&this._ib.releaseResource()},e.clear=function(){this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=i.DEFAULT,this._clear=!0,this._mergeID=0,this._repaint=!1,this._drawCount=1,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=_.MAXCLIPRECT,this._curSubmit=$.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=O.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){this._width=t,this._height=e,this._targets&&this._targets.size(t,e)},e._getTransformMatrix=function(){return this._curMat},e.translate=function(t,e){0===t&&0===e||(W.save(this),this._curMat.bTransform&&(V.save(this),this._curMat.transformPoint(t,e,M.TEMP),t=M.TEMP.x,e=M.TEMP.y),this._x+=t,this._y+=e)},e.save=function(){this._save[this._save._length++]=H.Create(this)},e.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;0<=e;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},e.measureText=function(t){return u.measureText(t,this._other.font.toString())},e._fillText=function(t,e,i,s,n,r,a){var o=this._shader2D,h=this._curSubmit.shaderValue,l=n?it.create(n):this._other.font;if(B.enabled)o.ALPHA!==h.ALPHA&&(o.glTexture=null),tt.drawText(this,t,e,this._curMat,l,a||this._other.textAlign,r,null,-1,i,s);else{var u=this._shader2D.defines.getValue(),c=r?x.create(r)._color:o.colorAdd;o.ALPHA===h.ALPHA&&c===o.colorAdd&&h.colorAdd===o.colorAdd||(o.glTexture=null,o.colorAdd=c),o.defines.add(64),tt.drawText(this,t,e,this._curMat,l,a||this._other.textAlign,null,null,-1,i,s),o.defines.setValue(u)}},e.fillWords=function(t,e,i,s,n){0<t.length&&this._fillText(null,t,e,i,s,n,null)},e.fillText=function(t,e,i,s,n,r){0<t.length&&this._fillText(t,null,e,i,s,n,r)},e.strokeText=function(t,e,i,s,n,r,a){if(0!==t.length){var o=this._shader2D,h=this._curSubmit.shaderValue,l=s?(_._fontTemp.setFont(s),_._fontTemp):this._other.font;if(B.enabled)o.ALPHA!==h.ALPHA&&(o.glTexture=null),tt.drawText(this,t,null,this._curMat,l,a||this._other.textAlign,null,n,r||1,e,i);else{var u=this._shader2D.defines.getValue(),c=n?x.create(n)._color:o.colorAdd;o.ALPHA===h.ALPHA&&c===o.colorAdd&&h.colorAdd===o.colorAdd||(o.glTexture=null,o.colorAdd=c),o.defines.add(64),tt.drawText(this,t,null,this._curMat,l,a||this._other.textAlign,null,n,r||1,e,i),o.defines.setValue(u)}}},e.fillBorderText=function(t,e,i,s,n,r,a,o){if(0!==t.length){if(!B.enabled)return this.strokeText(t,e,i,s,r,a,o),void this.fillText(t,e,i,s,n,o);var h=this._shader2D,l=this._curSubmit.shaderValue;h.ALPHA!==l.ALPHA&&(h.glTexture=null);var u=s?(_._fontTemp.setFont(s),_._fontTemp):this._other.font;tt.drawText(this,t,null,this._curMat,u,o||this._other.textAlign,n,r,a||1,e,i)}},e.fillRect=function(t,e,i,s,n){var r=this._vb;if(nt.fillRectImgVb(r,this._clipRect,t,e,i,s,y.DEF_UV,this._curMat,this._x,this._y,0,0)){var a=this._shader2D.fillStyle;n&&(this._shader2D.fillStyle=new O(n));var o=this._shader2D,h=this._curSubmit.shaderValue;if(o.fillStyle!==h.fillStyle||o.ALPHA!==h.ALPHA){o.glTexture=null;var l=this._curSubmit=$.create(this,0,this._mergeID,this._ib,r,(r._length-64)/32*3,ct.create(2,0));l.shaderValue.color=o.fillStyle._color._color,l.shaderValue.ALPHA=o.ALPHA,this._submits[this._submits._length++]=l}this._curSubmit._numEle+=6,this._shader2D.fillStyle=a}},e.setShader=function(t){N.save(this,524288,this._shader2D,!0),this._shader2D.shader=t},e.setFilters=function(t){N.save(this,1048576,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=$.RENDERBASE,this._drawCount++,this._mergeID=0},e._findSameSubmit=function(t){for(var e=this._submits._length-1;0<=e;e--){var i=this._submits[e];if(i._mergID&&i._mergID!==this._mergeID)break;if(i._submitID===t)return i}return null},e.drawTexture=function(t,e,i,s,n,r,a){this._drawTextureM(t,e,i,s,n,r,a,null)},e._drawTextureM=function(t,e,i,s,n,r,a,o){if(t.loaded&&t.bitmap&&t.source){var h=t.bitmap,l=this._shader2D,u=this._curSubmit.shaderValue;if(this._drawCount++,l.glTexture!==h||l.ALPHA!==u.ALPHA){l.glTexture=h;var c=this._vb,_=null,d=NaN,f=c._length/32*3;this._mergeID&&(d=h.id+l.ALPHA/10,_=this._findSameSubmit(d),c=null),_||(_=$.create(this,d,this._mergeID,this._ib,c,f,ct.create(1,0)),(this._submits[this._submits._length++]=_).shaderValue.textureHost=t),this._curSubmit=_}nt.fillRectImgVb(this._curSubmit._vb||this._vb,this._clipRect,e+r,i+a,s||t.width,n||t.height,t.uv,o||this._curMat,this._x,this._y,0,0)&&(this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))}else this.sprite&&m.timer.callLater(this,this._repaintSprite)},e._repaintSprite=function(){this.sprite.repaint()},e.drawImage=function(t){var e=arguments,i=e[0],s=i.__texture||(i.__texture=new y(new Ft(i)));switch(s.uv=y.DEF_UV,e.length){case 3:i.__width||(i.__width=i.width,i.__height=i.height),this.drawTexture(s,e[1],e[2],i.__width,i.__height,0,0);break;case 5:this.drawTexture(s,e[1],e[2],e[3],e[4],0,0);break;case 9:var n=e[1]/i.__width,r=(e[1]+e[3])/i.__width,a=e[2]/i.__height,o=(e[2]+e[4])/i.__height;s.uv=[n,a,r,a,r,o,n,o],this.drawTexture(s,e[5],e[6],e[7],e[8],0,0)}},e._drawText=function(t,e,i,s,n,r,a,o,h,l){var u=t.bitmap,c=this._shader2D;this._curSubmit.shaderValue;if(this._drawCount++,c.glTexture!==u){c.glTexture=u;var _=this._vb,d=null,f=NaN,p=_._length/32*3;this._mergeID&&(f=u.id+c.ALPHA/10+(B.enabled?0:c.colorAdd.__id/1e4),d=this._findSameSubmit(f),_=null),d||(B.enabled?d=$.create(this,f,this._mergeID,this._ib,_,p,ct.create(1,0)):((d=$.create(this,f,this._mergeID,this._ib,_,p,Ot.create())).shaderValue.colorAdd=c.colorAdd,d.shaderValue.defines.add(64)),d.shaderValue.textureHost=t,this._submits[this._submits._length++]=d),this._curSubmit=d}t.active(),nt.fillRectImgVb(this._curSubmit._vb||this._vb,this._clipRect,e+a,i+o,s||t.width,n||t.height,t.uv,r||this._curMat,this._x,this._y,h,l,!0)&&(this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},e.drawTextureWithTransform=function(t,e,i,s,n,r,a,o){var h=this._curMat;(0!==a||0!==o)&&(this._x=a*h.a+o*h.c,this._y=o*h.d+a*h.b),r&&h.bTransform?(C.mul(r,h,_._tmpMatrix),(r=_._tmpMatrix)._checkTransform()):(this._x+=h.tx,this._y+=h.ty),this._drawTextureM(t,e,i,s,n,0,0,r),this._x=this._y=0},e.fillQuadrangle=function(t,e,i,s,n){var r=this._curSubmit,a=this._vb,o=this._shader2D,h=r.shaderValue;if(t.bitmap){var l=t.bitmap;o.glTexture==l&&o.ALPHA===h.ALPHA||(o.glTexture=l,(r=this._curSubmit=$.create(this,0,this._mergeID,this._ib,a,a._length/32*3,ct.create(1,0))).shaderValue.glTexture=l,this._submits[this._submits._length++]=r),nt.fillQuadrangleImgVb(a,e,i,s,t.uv,n||this._curMat,this._x,this._y)}else r.shaderValue.fillStyle&&r.shaderValue.fillStyle.equal(t)&&o.ALPHA===h.ALPHA||(o.glTexture=null,(r=this._curSubmit=$.create(this,0,this._mergeID,this._ib,a,a._length/32*3,ct.create(2,0))).shaderValue.defines.add(2),r.shaderValue.fillStyle=new O(t),this._submits[this._submits._length++]=r),nt.fillQuadrangleImgVb(a,e,i,s,y.DEF_UV,n||this._curMat,this._x,this._y);r._numEle+=6},e.drawTexture2=function(t,e,i,s,n,r,a,o){var h=this._curMat;if(this._x=t*h.a+e*h.c,this._y=e*h.d+t*h.b,n&&(n=h.bTransform||n.bTransform?(C.mul(n,h,_._tmpMatrix),_._tmpMatrix):(this._x+=n.tx+h.tx,this._y+=n.ty+h.ty,C.EMPTY)),1!==r||a){var l=this._shader2D.ALPHA,u=this._nBlendType;this._shader2D.ALPHA=r,a&&(this._nBlendType=k.TOINT(a)),this._drawTextureM(o[0],o[1]-i,o[2]-s,o[3],o[4],0,0,n),this._shader2D.ALPHA=l,this._nBlendType=u}else this._drawTextureM(o[0],o[1]-i,o[2]-s,o[3],o[4],0,0,n);this._x=this._y=0},e.drawCanvas=function(t,e,i,s,n){var r=t.context;if(r._targets)this._submits[this._submits._length++]=Tt.create(r,0,null),this._curSubmit=$.RENDERBASE,r._targets.drawTo(this,e,i,s,n);else{var a=this._submits[this._submits._length++]=Tt.create(r,this._shader2D.ALPHA,this._shader2D.filters),o=s/t.width,h=n/t.height,l=a._matrix;this._curMat.copy(l),1!=o&&1!=h&&l.scale(o,h);var u=l.tx,c=l.ty;l.tx=l.ty=0,l.transformPoint(e,i,M.TEMP),l.translate(M.TEMP.x+u,M.TEMP.y+c),this._curSubmit=$.RENDERBASE}d.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=r._targets?"yellow":"green",this.strokeRect(e-1,i-1,s+2,n+2,1),this.strokeRect(e,i,s,n,1),this.restore())},e.drawTarget=function(t,e,i,s,n,r,a,o,h,l){void 0===l&&(l=-1);var u=this._vb;if(nt.fillRectImgVb(u,this._clipRect,e,i,s,n,h||y.DEF_UV,r||this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;this._curSubmit.shaderValue;var c=this._curSubmit=J.create(this,this._ib,u,(u._length-64)/32*3,o,a);c.blendType=-1==l?this._nBlendType:l,c.scope=t,this._submits[this._submits._length++]=c,this._curSubmit._numEle+=6}},e.transform=function(t,e,i,s,n,r){V.save(this),C.mul(C.TEMP.setTo(t,e,i,s,n,r),this._curMat,this._curMat),this._curMat._checkTransform()},e.setTransformByMatrix=function(t){t.copy(this._curMat)},e.transformByMatrix=function(t){V.save(this),C.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},e.rotate=function(t){V.save(this),this._curMat.rotate(t)},e.scale=function(t,e){V.save(this),this._curMat.scale(t,e)},e.clipRect=function(t,e,i,s){i*=this._curMat.a,s*=this._curMat.d;var n=M.TEMP;this._curMat.transformPoint(t,e,n);var r=this._curSubmit=Q.create(this);(this._submits[this._submits._length++]=r).submitIndex=this._submits._length,r.submitLength=9999999,z.save(this,r);var a=this._clipRect,o=a.x,h=a.y,l=n.x+i,u=n.y+s;o<n.x&&(a.x=n.x),h<n.y&&(a.y=n.y),a.width=Math.min(l,o+a.width)-a.x,a.height=Math.min(u,h+a.height)-a.y,this._shader2D.glTexture=null,r.clipRect.copyFrom(a),this._curSubmit=$.RENDERBASE,this._mergeID=0},e.setIBVB=function(t,e,i,s,n,r,a,o,h,l){if(void 0===h&&(h=0),void 0===l&&(l=0),null===i&&(nt.expandIBQuadrangle(this._ib,s.length/64+8),i=this._ib),!o||!a)throw Error("setIBVB must input:shader shaderValues");var u=q.create(this,s,i,n,a,o,h,l);r||(r=C.EMPTY),r.translate(t,e),C.mul(r,this._curMat,u._mat),r.translate(-t,-e),this._submits[this._submits._length++]=u,this._curSubmit=$.RENDERBASE},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.fillTrangles=function(t,e,i,s,n){var r=this._curSubmit,a=this._vb,o=this._shader2D,h=r.shaderValue,l=s.length>>4,u=t.bitmap;o.glTexture==u&&o.ALPHA===h.ALPHA||((r=this._curSubmit=$.create(this,0,this._mergeID,this._ib,a,a._length/32*3,ct.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=r),nt.fillTranglesVB(a,e,i,s,n||this._curMat,this._x,this._y),r._numEle+=6*l},e.arc=function(t,e,i,s,n,r){void 0===r&&(r=!0)},e.fill=function(){},e.closePath=function(){},e.beginPath=function(){this._other=this._other.make(),this._other.path||(this._other.path=new F),this._other.path.clear()},e.rect=function(t,e,i,s){this._other=this._other.make(),this._other.path||(this._other.path=new F),this._other.path.rect(t,e,i,s)},e.strokeRect=function(t,e,i,s,n){var r=.5*n;this.line(t-r,e,t+i+r,e,n,this._curMat),this.line(t+i,e,t+i,e+s,n,this._curMat),this.line(t,e,t,e+s,n,this._curMat),this.line(t-r,e+s,t+i+r,e+s,n,this._curMat)},e.clip=function(){},e.stroke=function(){if(this._other!==i.DEFAULT){if(this._other.path._rect){var t=this._other.path._rect;this.strokeRect(t.x,t.y,t.width,t.height,this._other.lineWidth)}this._other.path.clear()}},e.moveTo=function(t,e){this._other.path._x=t,this._other.path._y=e},e.lineTo=function(t,e){this.line(this._other.path._x,this._other.path._y,t,e,this._other.lineWidth,this._curMat)},e.line=function(t,e,i,s,n,r){var a=this._curSubmit,o=this._vb;if(nt.fillLineVb(o,this._clipRect,t,e,i,s,n,r)){var h=this._shader2D,l=a.shaderValue;h.strokeStyle===l.strokeStyle&&h.ALPHA===l.ALPHA||(h.glTexture=null,(a=this._curSubmit=$.create(this,0,this._mergeID,this._ib,o,(o._length-64)/32*3,ct.create(2,0))).shaderValue.strokeStyle=h.strokeStyle,a.shaderValue.mainID=2,a.shaderValue.ALPHA=h.ALPHA,this._submits[this._submits._length++]=a),a._numEle+=6}},e.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},e.finish=function(){ot.mainContext.finish()},e.flush=function(){var t=Math.max(this._vb.length/64,this._maxNumEle/6)+8;return t>this._ib.bufferLength/12&&nt.expandIBQuadrangle(this._ib,t),this._vb.bind_upload(this._ib),this.submitElement(0,this._submits._length),this._path&&this._path.reset(),this._curSubmit=$.RENDERBASE,this._submits._length},e.fan=function(t,e,i,s,n,r,a){this._getPath().fan(t,e,i,s,n,r,this._other.lineWidth?this._other.lineWidth:1,a),this._path.update();var o=$.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,ct.create(4,0));o.shaderValue.ALPHA=this._shader2D.ALPHA,o.shaderValue.u_mmat2=rt.mat2MatArray(this._curMat,rt.TEMPMAT4_ARRAY),this._submits[this._submits._length++]=o},e.drawCircle=function(t,e,i,s,n,r,a){this._getPath().circle(t,e,i,s,a,r||1,n),this._path.update();var o=$.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,ct.create(4,0));o.shaderValue.ALPHA=this._shader2D.ALPHA,o.shaderValue.u_mmat2=rt.mat2MatArray(this._curMat,rt.TEMPMAT4_ARRAY),this._submits[this._submits._length++]=o},e.drawPoly=function(t,e,i,s,n,r){var a;this._getPath().polygon(t,e,i,s,n||1,r),this._path.update();var o=Z.create(4);this.addRenderObject(o),(a=$.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,ct.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,a.shaderValue.u_mmat2=rt.mat2MatArray(this._curMat,rt.TEMPMAT4_ARRAY),this._submits[this._submits._length++]=a,o=Z.create(5),this.addRenderObject(o),(a=$.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,ct.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,a.shaderValue.u_mmat2=rt.mat2MatArray(this._curMat,rt.TEMPMAT4_ARRAY),this._submits[this._submits._length++]=a,o=Z.create(3),this.addRenderObject(o),0<n&&(this._path.loopLine(t,e,i,n,r),this._path.update(),(a=$.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,ct.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,a.shaderValue.u_mmat2=rt.mat2MatArray(this._curMat,rt.TEMPMAT4_ARRAY),this._submits[this._submits._length++]=a)},e.drawPath=function(t,e,i,s,n){this._getPath().drawPath(t,e,i,s,n),this._path.update();var r=$.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,ct.create(4,0));this._submits[this._submits._length++]=r},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e.drawLines=function(t,e,i,s,n){var r=M.TEMP;this._curMat.transformPoint(t,e,r),this._curMat.bTransform&&(i=i.concat(),this._curMat.transformPointArrayScale(i,i)),this._getPath().drawPath(r.x,r.y,i,s,n),this._path.update();var a=$.createShape(this,this._path.ib,this._path.vb,this._path.count,this._path.offset,ct.create(4,0));a.shaderValue.ALPHA=this._shader2D.ALPHA,a.shaderValue.u_mmat2=rt.mat2MatArray(this._curMat,rt.TEMPMAT4_ARRAY),this._submits[this._submits._length++]=a},e._getPath=function(){return this._path||(this._path=new F)},s(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new U),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.size(this._width,this._height)}else this._targets=null}),s(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(N.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=new O(t))}),s(0,e,"globalCompositeOperation",function(){return k.NAMES[this._nBlendType]},function(t){var e=k.TOINT[t];null==e||this._nBlendType===e||(N.save(this,65536,this,!0),this._curSubmit=$.RENDERBASE,this._nBlendType=e)}),s(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),N.save(this,32768,this._other,!1),this._other.textAlign=t)}),s(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(N.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),s(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),N.save(this,16384,this._other,!1),this._other.textBaseline=t)}),s(0,e,"enableMerge",function(){return 0<this._mergeID},function(t){N.save(this,8192,this,!0),this._mergeID=this._drawCount}),s(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(N.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=new O(t))}),s(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),N.save(this,256,this._other,!1),this._other.lineWidth=t)}),s(0,e,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),N.save(this,8,this._other,!1),this._other.font===it.EMPTY?this._other.font=new it(t):this._other.font.setFont(t))}),_.__init__=function(){i.DEFAULT=new i},_._SUBMITVBSIZE=32e3,_._MAXSIZE=99999999,_._RECTVBSIZE=16,_.MAXCLIPRECT=new L(0,0,99999999,99999999),_._COUNT=0,_._tmpMatrix=new C,n(_,["_fontTemp",function(){return this._fontTemp=new it},"_drawStyleTemp",function(){return this._drawStyleTemp=new O(null)}]),_.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=it.EMPTY}c(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=it.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},_}(),ct=function(t){function s(t,e){this.size=[0,0],this.alpha=1,this.mmat=null,this.ALPHA=1,this.shader=null,this.mainID=0,this.subID=0,this.filters=null,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._inClassCache=null,this._cacheID=0,s.__super.call(this),this.defines=new pt,this.position=s._POSITION,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=s._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=s._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}c(s,"laya.webgl.shader.d2.value.Value2D",P);var e=s.prototype;return e.setValue=function(t){},e.refresh=function(){var t=this.size;return t[0]=rt.width,t[1]=rt.height,this.alpha=this.ALPHA*rt.worldAlpha,this.mmat=rt.worldMatrix4,this},e._ShaderWithCompile=function(){return St.withCompile(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Bt.create)},e._withWorldShaderDefines=function(){var t=rt.worldShaderDefines,e=St.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,s={};for(i in this.defines.toNameDic())s[i]="";for(i in t.toNameDic())s[i]="";e=St.withCompile(0,this.mainID,s,this.mainID|this.defines._value|t.getValue(),Bt.create)}var n=rt.worldFilters;if(!n)return e;for(var r,a=n.length,o=0;o<a;o++)(r=n[o])&&r.action.setValue(this);return e},e.upload=function(){var t=rt;this.alpha=this.ALPHA*t.worldAlpha;var e,i=t.worldShaderDefines?this._withWorldShaderDefines():St.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=t.width,this.size[1]=t.height,this.mmat=t.worldMatrix4,St.activeShader!==i?i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick2||i._make2dQuick2():i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick1||i._make2dQuick1(),i.upload(this,e)},e.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,s=0;s<i;s++)(e=t[s])&&(this.defines.add(e.type),e.action.setValue(this))},e.clear=function(){this.defines.setValue(this.subID)},e.release=function(){(this._inClassCache[this._inClassCache._length++]=this).clear()},s._initone=function(t,e){s._typeClass[t]=e,s._cache[t]=[],s._cache[t]._length=0},s.__init__=function(){s._POSITION=[2,5126,!1,4*st.BYTES_PE,0],s._TEXCOORD=[2,5126,!1,4*st.BYTES_PE,2*st.BYTES_PE],s._initone(2,Mt),s._initone(4,At),s._initone(1,It),s._initone(65,Ot),s._initone(9,It)},s.create=function(t,e){var i=s._cache[t|e];return i._length?i[--i._length]:new s._typeClass[t|e](e)},s._POSITION=null,s._TEXCOORD=null,s._cache=[],s._typeClass=[],s}(),_t=function(t){function e(){this.data=null,e.__super.call(this)}c(e,"laya.filters.webgl.ColorFilterActionGL",R);var i=e.prototype;return m.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValue=function(t){t.u_colorMatrix=this.data._elements},i.apply3d=function(t,e,i,s,n){var r=t.getValue("bounds"),a=ct.create(1,0);a.setFilters([this.data]);var o=C.EMPTY;o.identity(),i.ctx.drawTarget(t,0,0,r.width,r.height,o,"src",a)},e}(),dt=function(t){function i(t,e){i.__super.call(this,t,e)}c(i,"laya.webgl.utils.RenderSprite3D",_);var e=i.prototype;return e.onCreate=function(t){switch(t){case 32:return void(this._fun=this._blend);case 8:return void(this._fun=this._transform)}},e._blend=function(t,e,i,s){var n,r,a=t._style;e.ctx.save(),t.mask?(n=Z.create(1),e.addRenderObject(n),t.mask.render(e,i,s),n=Z.create(2),e.addRenderObject(n),(r=this._next)._fun.call(r,t,e,i,s),n=Z.create(3),e.ctx._curSubmit=$.RENDERBASE,e.addRenderObject(n)):(e.ctx.globalCompositeOperation=a.blendMode,(r=this._next)._fun.call(r,t,e,i,s)),e.ctx.restore()},e._transform=function(t,e,i,s){"use strict";var n=t.transform,r=this._next;if(n&&r!=_.NORENDER){var a=e.ctx;t._style;n.tx=i,n.ty=s;var o=a._getTransformMatrix(),h=o.clone();C.mul(n,o,o),o._checkTransform(),r._fun.call(r,t,e,0,0),h.copy(o),h.destroy(),n.tx=n.ty=0}else r._fun.call(r,t,e,i,s)},i}(),ft=function(t){function r(t,e,i,s,n){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,r.__super.call(this,t,e,n),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey=[],this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new Rt,this._atlasCanvas.width=i,this._atlasCanvas.height=s,this._atlasCanvas.activeResource()}c(r,"laya.webgl.atlas.Atlaser",E);var e=r.prototype;return e.computeUVinAtlasTexture=function(t,e,i,s){var n=B.atlasTextureWidth,r=B.atlasTextureHeight,a=i/n,o=s/r,h=(i+t.bitmap.width)/n,l=(s+t.bitmap.height)/r,u=t.bitmap.width/n,c=t.bitmap.height/r;t.uv=[a+e[0]*u,o+e[1]*c,h-(1-e[2])*u,o+e[3]*c,h-(1-e[4])*u,l-(1-e[5])*c,a+e[6]*u,l-(1-e[7])*c]},e.addToAtlasTexture=function(t,e,i){t instanceof laya.webgl.resource.WebGLImage&&(this._InAtlasWebGLImagesKey.push(t),this._InAtlasWebGLImagesOffsetValue.push([e,i])),this._atlasCanvas.texSubImage2D(t,e,i,t.atlasSource),t.clearAtlasSource()},e.addToAtlas=function(t,e,i){var s=t.uv.slice(),n=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(s),this._inAtlasTextureBitmapValue.push(n),this.computeUVinAtlasTexture(t,s,e,i),t.bitmap=this._atlasCanvas},e.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t].bitmap.lock=!0,this._inAtlasTextureKey[t].bitmap.releaseResource(),this._inAtlasTextureKey[t].bitmap.lock=!1;this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey.length=0,this._InAtlasWebGLImagesOffsetValue.length=0},e.dispose=function(){this.clear(),this._atlasCanvas.dispose()},s(0,e,"texture",function(){return this._atlasCanvas}),s(0,e,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),s(0,e,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),r}(),pt=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return c(i,"laya.webgl.shader.d2.ShaderDefines2D",Y),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("COLOR2D",2),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64)},i.reg=function(t,e){Y._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return Y._toText(t,e,i)},i.toInt=function(t){return Y._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.COLOR2D=2,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),gt=function(t){function o(t,e,i,s,n,r,a){o.__super.call(this,t,e,i,i,s,n,r,a)}return c(o,"laya.webgl.shapes.Circle",X),o.prototype.getData=function(t,e,i){var s=[],n=[];if(this.circle(n,s,i),this.fill)0<this.borderWidth&&this.createLoopLine(n,s,this.borderWidth,i+n.length/5),t.append(new Uint16Array(s)),e.append(new Float32Array(n));else{var r=[],a=[];this.createLoopLine(n,s,this.borderWidth,i,r,a),t.append(new Uint16Array(a)),e.append(new Float32Array(r))}},o}(),mt=function(t){function o(t,e,i,s,n,r,a){o.__super.call(this,t,e,i,s,40,n,r,a)}return c(o,"laya.webgl.shapes.Ellipse",X),o}(),yt=function(t){function l(t,e,i,s,n,r,a,o,h){void 0===h&&(h=0),l.__super.call(this,t,e,i,i,30,r,a,o,h),this.r0=s,this.r1=n}return c(l,"laya.webgl.shapes.Fan",X),l.prototype.getData=function(t,e,i){var s=[],n=[];if(this.sector(n,s,i),this.fill)0<this.borderWidth&&-1!=this.borderColor&&this.createFanLine(n,s,this.borderWidth,i+n.length/5,null,null),t.append(new Uint16Array(s)),e.append(new Float32Array(n));else{var r=[],a=[];-1!=this.borderColor&&0<this.borderWidth&&this.createFanLine(n,s,this.borderWidth,i,r,a),t.append(new Uint16Array(a)),e.append(new Float32Array(r))}},l}(),vt=function(t){function r(t,e,i,s,n){this.points,r.__super.call(this,t,e,0,0,0,s,n,s,0),this.points=i}return c(r,"laya.webgl.shapes.Line",X),r.prototype.getData=function(t,e,i){var s=[],n=[];0<this.borderWidth&&this.createLine2(this.points,s,this.borderWidth,i,n,this.points.length/2),t.append(new Uint16Array(s)),e.append(new Float32Array(n))},r}(),xt=function(t){function r(t,e,i,s,n){this._points=i,r.__super.call(this,t,e,0,0,this._points.length/2,0,s,n)}c(r,"laya.webgl.shapes.LoopLine",X);var e=r.prototype;return e.getData=function(t,e,i){if(0<this.borderWidth){for(var s=this.color,n=(s>>16&255)/255,r=(s>>8&255)/255,a=(255&s)/255,o=[],h=[],l=Math.floor(this._points.length/2),u=0;u<l;u++)o.push(this.x+this._points[2*u],this.y+this._points[2*u+1],n,r,a);this.createLoopLine(o,h,this.borderWidth,i+o.length/5),t.append(new Uint16Array(h)),e.append(new Float32Array(o))}},e.createLoopLine=function(t,e,i,s,n,r){var a=t.concat(),o=n||t,h=this.borderColor,l=(h>>16&255)/255,u=(h>>8&255)/255,c=(255&h)/255,_=[a[0],a[1]],d=[a[a.length-5],a[a.length-4]],f=d[0]+.5*(_[0]-d[0]),p=d[1]+.5*(_[1]-d[1]);a.unshift(f,p,0,0,0),a.push(f,p,0,0,0);var g,m,y,v,x,b,w,T,S,C,L,M,I,A,R,P,E,B,D,k,O=a.length/5,F=s,N=i/2;y=a[0],v=a[1],C=y-(x=a[5]),S=(S=-(v-(b=a[6])))/(k=Math.sqrt(S*S+C*C))*N,C=C/k*N,o.push(y-S,v-C,l,u,c,y+S,v+C,l,u,c);for(var z=1;z<O-1;z++)y=a[5*(z-1)],v=a[5*(z-1)+1],x=a[5*z],b=a[5*z+1],w=a[5*(z+1)],T=a[5*(z+1)+1],C=y-x,M=x-w,R=(-(S=(S=-(v-b))/(k=Math.sqrt(S*S+C*C))*N)+y)*(-(C=C/k*N)+b)-(-S+x)*(-C+v),B=(-(L=(L=-(b-T))/(k=Math.sqrt(L*L+M*M))*N)+w)*(-(M=M/k*N)+b)-(-L+x)*(-M+T),D=(I=-C+v-(-C+b))*(E=-L+x-(-L+w))-(P=-M+T-(-M+b))*(A=-S+x-(-S+y)),Math.abs(D)<.1?(D+=10.1,o.push(x-S,b-C,l,u,c,x+S,b+C,l,u,c)):(((g=(A*B-E*R)/D)-x)*(g-x)+((m=(P*R-I*B)/D)-b)+(m-b),o.push(g,m,l,u,c,x-(g-x),b-(m-b),l,u,c));r&&(e=r);var H=this.edges+1;for(z=1;z<H;z++)e.push(F+2*(z-1),F+2*(z-1)+1,F+2*z+1,F+2*z+1,F+2*z,F+2*(z-1));return e.push(F+2*(z-1),F+2*(z-1)+1,F+1,F+1,F,F+2*(z-1)),o},r}(),bt=function(t){function a(t,e,i,s,n,r){this._points=null,this._points=i,a.__super.call(this,t,e,0,0,this._points.length/2,s,n,r)}return c(a,"laya.webgl.shapes.Polygon",X),a.prototype.getData=function(t,e,i){var s,n=[],r=[],a=this.color,o=(a>>16&255)/255,h=(a>>8&255)/255,l=(255&a)/255;s=this._points;var u=0,c=Math.floor(s.length/2);for(u=0;u<c;u++)r.push(this.x+s[2*u],this.y+s[2*u+1],o,h,l);for(u=2;u<c;u++)n.push(i,i+u-1,i+u);t.append(new Uint16Array(n)),e.append(new Float32Array(r))},a}(),wt=function(t){function o(t,e,i,s,n,r,a){o.__super.call(this,t+i/2,e+s/2,i/2,s/2,4,n,r,a)}return c(o,"laya.webgl.shapes.Rect",X),o}(),Tt=(function(t){function l(t,e,i,s,n,r,a,o,h){l.__super.call(this,t,e,i,s,n,r,a,o,h)}c(l,"laya.webgl.shapes.RoundPolygon",X)}(),function(t){function r(){this._matrix=new C,this._matrix4=st.defaultMatrix4.concat(),r.__super.call(this,1),this.shaderValue=new ct(0,0)}c(r,"laya.webgl.submit.SubmitCanvas",$);var e=r.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=rt.worldAlpha,e=rt.worldMatrix4,i=rt.worldMatrix,s=rt.worldFilters,n=rt.worldShaderDefines,r=this.shaderValue,a=this._matrix,o=this._matrix4,h=C.TEMP;return C.mul(a,i,h),o[0]=h.a,o[1]=h.b,o[4]=h.c,o[5]=h.d,o[12]=h.tx,o[13]=h.ty,rt.worldMatrix=h.clone(),rt.worldMatrix4=o,rt.worldAlpha=rt.worldAlpha*r.alpha,r.filters&&r.filters.length&&(rt.worldFilters=r.filters,rt.worldShaderDefines=r.defines),this._ctx_src.flush(),rt.worldAlpha=t,rt.worldMatrix4=e,rt.worldMatrix.destroy(),rt.worldMatrix=i,rt.worldFilters=s,rt.worldShaderDefines=n,1},e.releaseRender=function(){var t=r._cache;t[t._length++]=this},e.getRenderType=function(){return 3},r.create=function(t,e,i){var s=r._cache._length?r._cache[--r._cache._length]:new r;s._ctx_src=t;var n=s.shaderValue;return n.alpha=e,n.defines.setValue(0),i&&i.length&&n.setFilters(i),s},r._cache=((r._cache=[])._length=0,r._cache),r}()),St=function(t){function p(t,e,i,s){this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,p.__super.call(this),(h.isConchApp||h.isFlash)&&(this.customCompile=!0),this._id=++p._count,this._vs=t,this._ps=e,this._nameMap=s||{},null!=i&&(p.sharders[i]=this)}c(p,"laya.webgl.shader.Shader",t);var e=p.prototype;return e.recreateResource=function(){this.startCreate(),this._compile(),this.compoleteCreate(),this.memorySize=0},e.detoryResource=function(){ot.mainContext.deleteShader(this._vshader),ot.mainContext.deleteShader(this._pshader),ot.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t,e=[this._vs,this._ps];this.customCompile&&(t=this._preGetParams(this._vs,this._ps));var i=ot.mainContext;if(this._program=i.createProgram(),this._vshader=p._createShader(i,e[0],35633),this._pshader=p._createShader(i,e[1],35632),i.attachShader(this._program,this._vshader),i.attachShader(this._program,this._pshader),i.linkProgram(this._program),!this.customCompile&&!i.getProgramParameter(this._program,35714))throw i.getProgramInfoLog(this._program);var s,n,r=0,a=this.customCompile?t.attributes.length:i.getProgramParameter(this._program,35721);for(r=0;r<a;r++){var o=this.customCompile?t.attributes[r]:i.getActiveAttrib(this._program,r);s={vartype:"attribute",ivartype:0,attrib:o,location:i.getAttribLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(s)}var h=this.customCompile?t.uniforms.length:i.getProgramParameter(this._program,35718);for(r=0;r<h;r++){var l=this.customCompile?t.uniforms[r]:i.getActiveUniform(this._program,r);0<(s={vartype:"uniform",ivartype:1,attrib:o,location:i.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(s.name=s.name.substr(0,s.name.length-3),s.isArray=!0,s.location=i.getUniformLocation(this._program,s.name)),this._params.push(s)}for(r=0,n=this._params.length;r<n;r++)if((s=this._params[r]).indexOfParams=r,s.index=1,s.value=[s.location,null],s.codename=s.name,s.name=this._nameMap[s.codename]?this._nameMap[s.codename]:s.codename,(this._paramsMap[s.name]=s)._this=this,s.saveValue=[],"attribute"!==s.vartype)switch(s.type){case 5126:s.fun=s.isArray?this._uniform1fv:this._uniform1f;break;case 35664:s.fun=this._uniform_vec2;break;case 35665:s.fun=this._uniform_vec3;break;case 35666:s.fun=this._uniform_vec4;break;case 35678:s.fun=this._uniform_sampler2D;break;case 35676:s.fun=this._uniformMatrix4fv;break;case 35670:s.fun=this._uniform1i;break;case 35680:case 35674:case 35675:default:throw new Error("compile shader err!")}else s.fun=this._attribute}},e.getUniform=function(t){return this._paramsMap[t]},e._attribute=function(t,e){var i=ot.mainContext;return i.enableVertexAttribArray(t.location),i.vertexAttribPointer(t.location,e[0],e[1],e[2],e[3],e[4]+this._offset),2},e._uniformMatrix4fv=function(t,e){return ot.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.saveValue;return i[0]!==e?(ot.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1f=function(t,e){var i=t.saveValue;return i[0]!==e?(ot.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){var i=t.saveValue;return i[0]!==e?(ot.mainContext.uniform1fv(t.location,i[0]=e),1):0},e._uniform_vec2=function(t,e){var i=t.saveValue;return i[0]!==e[0]||i[1]!==e[1]?(ot.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec3=function(t,e){return ot.mainContext.uniform3f(t.location,e[0],e[1],e[2]),1},e._uniform_vec4=function(t,e){return ot.mainContext.uniform4f(t.location,e[0],e[1],e[2],e[3]),1},e._uniform_sampler2D=function(t,e){var i=ot.mainContext,s=t.saveValue;return null==s[0]?(s[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(p._TEXTURES[this._curActTexIndex]),ht.bindTexture(i,3553,e),this._curActTexIndex++,1):(i.activeTexture(p._TEXTURES[s[0]]),ht.bindTexture(i,3553,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){this.activeResource(),ht.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.upload=function(t,e){(p.activeShader=this).activeResource(),ht.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var i,s,n=e.length,r=0,a=0;a<n;a++)null!==(s=t[(i=e[a]).name])&&(r+=i.fun.call(this,i,s));f.shaderCall+=r},e.uploadArray=function(t,e,i){(p.activeShader=this).activeResource();for(var s,n,r=!ht.UseProgram(this._program),a=(this._params,0),o=p._uploadArrayCount++,h=e-2;0<=h;h-=2)if((n=this._paramsMap[t[h]])&&n._uploadArrayCount!==o){n._uploadArrayCount=o;var l=t[h+1],u=l[1];r&&1===n.ivartype&&0<u&&u===n.__uploadid||null!=(s=l[0])&&(i&&i[n.name]&&i[n.name].bind(),a+=n.fun.call(this,n,s),n.__uploadid=u)}f.shaderCall+=a},e.getParams=function(){return this._params},e._preGetParams=function(t,e){var i=[t,e],s={},n=[],r=[];s.attributes=n,s.uniforms=r;for(var a,o=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),h=new RegExp("(\".*\")|('.*')|([\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),l=0,u=0,c=0;c<2;c++){i[c]=i[c].replace(o,"");var _=i[c].match(h),d="";for(l=0,u=_.length;l<u;l++){var f=_[l];"attribute"==f||"uniform"==f?(a={type:p.shaderParamsMap[_[l+1]],name:_[l+2],size:isNaN(m.__parseInt(_[l+3]))?1:m.__parseInt(_[l+3])},"attribute"==f?n.push(a):r.push(a),d+=a.vartype+" "+a.type+" "+a.name+" ",":"==_[l+3]&&(a.type=_[l+4],l+=2),l+=2):(d+=f,";"!=f&&(d+=" "))}i[c]=d}return s},e.dispose=function(){this.resourceManager.removeResource(this),t.prototype.dispose.call(this)},p.getShader=function(t){return p.sharders[t]},p.create=function(t,e,i,s){return new p(t,e,i,s)},p.withCompile=function(t,e,i,s,n){if(s&&p.sharders[s])return p.sharders[s];var r=p._preCompileShader[2e-4*t+e];if(!r)throw new Error("withCompile shader err!"+t+" "+e);return r.createShader(i,s,n)},p.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(p._includeFiles[t])throw new Error("add shader include file err, has add:"+t);p._includeFiles[t]=e},p.preCompile=function(t,e,i,s,n){var r=2e-4*t+e;p._preCompileShader[r]=new at(r,i,s,n,p._includeFiles)},p._createShader=function(t,e,i){var s=t.createShader(i);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,35713))throw t.getShaderInfoLog(s);return s},p._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],p._includeFiles={},p._count=0,p._preCompileShader={},p._uploadArrayCount=1,p.SHADERNAME2ID=2e-4,p.activeShader=null,p.sharders=((p.sharders=[]).length=32,p.sharders),n(p,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new S}]),p}(T),Ct=function(t){function a(t,e,i,s,n,r){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthFormat=0,this._mipMap=!1,this._destroy=!1,this._type=1,this._w=t,this._h=e,this._surfaceFormat=s,this._surfaceType=n,this._depthFormat=r,this._mipMap=i,this._createWebGLRenderTarget(),this.bitmap.lock=!0,a.__super.call(this,this.bitmap,y.INV_UV)}c(a,"laya.webgl.resource.RenderTarget2D",t);var e=a.prototype;return m.imps(e,{"laya.resource.IDispose":!0}),e.getType=function(){return this._type},e.getTexture=function(){return this},e.size=function(t,e){this.bitmap&&this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),this._createWebGLRenderTarget())},e.release=function(){this.destroy()},e.recycle=function(){a.POOL.push(this)},e.start=function(){var t=ot.mainContext;return this._preRenderTarget=rt.curRenderTarget,rt.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=rt.width,this._svHeight=rt.height,rt.width=this._w,rt.height=this._h,St.activeShader=null),this},e.clear=function(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1);var n=ot.mainContext;n.clearColor(t,e,i,s);var r=16384;this._depthFormat&&(r|=256),n.clear(r)},e.end=function(){var t=ot.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,rt.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),rt.width=this._svWidth,rt.height=this._svHeight,St.activeShader=null):t.viewport(0,0,m.stage.width,m.stage.height)},e.getData=function(t,e,i,s){var n=ot.mainContext;if(n.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053===n.checkFramebufferStatus(36160)))return n.bindFramebuffer(36160,null),null;var r=new Uint8Array(this._w*this._h*4);return n.readPixels(t,e,i,s,this._surfaceFormat,this._surfaceType,r),n.bindFramebuffer(36160,null),r},e.destroy=function(){this._destroy||(this._loaded=!1,this.bitmap.dispose(),this.bitmap=null,this._destroy=!0,t.prototype.destroy.call(this))},e.dispose=function(){},e._createWebGLRenderTarget=function(){this.bitmap=new Et(this.width,this.height,this.mipMap,this.surfaceFormat,this.surfaceType,this.depthFormat),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0},s(0,e,"surfaceFormat",function(){return this._surfaceFormat}),s(0,e,"surfaceType",function(){return this._surfaceType}),s(0,e,"depthFormat",function(){return this._depthFormat}),s(0,e,"mipMap",function(){return this._mipMap}),s(0,e,"source",function(){if(this._alreadyResolved)return t.prototype._$get_source.call(this);throw new Error("RenderTarget  还未准备好！")}),a.create=function(t,e,i){void 0===i&&(i=1);var s=a.POOL.pop();return s||(s=new a(t,e,!1,6408,5121,0)),s.size(t,e),s},a.TYPE2D=1,a.TYPE3D=2,a.POOL=[],a}(y),Lt=function(t){function n(){this._length=0,this._upload=!0,this._uploadSize=0,this._maxsize=0,n.__super.call(this),this.lock=!0,n._gl=ot.mainContext,this._id=++n._COUNT,h.isFlash||(this._buffer=new ArrayBuffer(8))}c(n,"laya.webgl.utils.Buffer",t);var e=n.prototype;return e._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._length),f.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkFloatArray32Use()),this._maxsize=this._length),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,n._gl.bufferData(this._type,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),n._gl.bufferSubData(this._type,0,this._buffer),f.bufferLen+=this._length},e._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._length),f.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkFloatArray32Use()),this._maxsize=this._length),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,n._gl.bufferData(this._type,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var s=this._buffer.slice(e,i);n._gl.bufferSubData(this._type,t,s)}else n._gl.bufferSubData(this._type,t,this._buffer)},e._checkFloatArray32Use=function(){},e.recreateResource=function(){this.startCreate(),this._glBuffer||(this._glBuffer=n._gl.createBuffer()),this.compoleteCreate()},e.detoryResource=function(){if(this._glBuffer){ot.mainContext.disableVertexAttribArray(0),ot.mainContext.disableVertexAttribArray(1),ot.mainContext.disableVertexAttribArray(2),ot.mainContext.deleteBuffer(this._glBuffer);this._glBuffer;this._glBuffer=null,this._upload=!0,this._uploadSize=0,this.memorySize=0}},e._bind=function(){this.activeResource(),n._bindActive[this._type]===this._glBuffer||(n._gl.bindBuffer(this._type,n._bindActive[this._type]=this._glBuffer),St.activeShader=null)},e._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},e._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},e._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkFloatArray32Use(),this._upload=!0,this},e.append=function(t){this._upload=!0;var e,i=0;t instanceof Uint8Array?(i=t.length,this._resizeBuffer(this._length+i,!0),e=new Uint8Array(this._buffer,this._length)):t instanceof Float32Array?(i=4*t.length,this._resizeBuffer(this._length+i,!0),e=new Float32Array(this._buffer,this._length)):t instanceof Uint16Array&&(i=2*t.length,this._resizeBuffer(this._length+i,!0),e=new Uint16Array(this._buffer,this._length)),e.set(t,0),this._length+=i,this._checkFloatArray32Use()},e.getBuffer=function(){return this._buffer},e.setNeedUpload=function(){this._upload=!0},e.getNeedUpload=function(){return this._upload},e.upload=function(){var t=this._bind_upload();return n._gl.bindBuffer(this._type,null),n._bindActive[this._type]=null,St.activeShader=null,t},e.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var s=this._bind_subUpload();return n._gl.bindBuffer(this._type,null),n._bindActive[this._type]=null,St.activeShader=null,s},e.clear=function(){this._length=0,this._upload=!0},e.disposeCPUData=function(){this._buffer=null},e.dispose=function(){this.resourceManager.removeResource(this),t.prototype.dispose.call(this)},s(0,e,"bufferType",function(){return this._type}),s(0,e,"bufferLength",function(){return this._buffer.byteLength}),s(0,e,"length",function(){return this._length},function(t){this._length!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._length=t)}),n.__int__=function(t){n._gl=t,Dt.QuadrangleIB=Dt.create(),nt.fillIBQuadrangle(Dt.QuadrangleIB,16)},n.INDEX="INDEX",n.POSITION0="POSITION",n.NORMAL0="NORMAL",n.COLOR0="COLOR",n.UV0="UV",n.NEXTUV0="NEXTUV",n.UV1="UV1",n.NEXTUV1="NEXTUV1",n.BLENDWEIGHT0="BLENDWEIGHT",n.BLENDINDICES0="BLENDINDICES",n.MVPMATRIX="MVPMATRIX",n.MATRIX1="MATRIX1",n.MATRIX2="MATRIX2",n.DIFFUSETEXTURE="DIFFUSETEXTURE",n.NORMALTEXTURE="NORMALTEXTURE",n.SPECULARTEXTURE="SPECULARTEXTURE",n.EMISSIVETEXTURE="EMISSIVETEXTURE",n.AMBIENTTEXTURE="AMBIENTTEXTURE",n.REFLECTTEXTURE="REFLECTTEXTURE",n.MATRIXARRAY0="MATRIXARRAY0",n.FLOAT0="FLOAT0",n.UVAGEX="UVAGEX",n.CAMERAPOS="CAMERAPOS",n.LUMINANCE="LUMINANCE",n.ALPHATESTVALUE="ALPHATESTVALUE",n.FOGCOLOR="FOGCOLOR",n.FOGSTART="FOGSTART",n.FOGRANGE="FOGRANGE",n.MATERIALAMBIENT="MATERIALAMBIENT",n.MATERIALDIFFUSE="MATERIALDIFFUSE",n.MATERIALSPECULAR="MATERIALSPECULAR",n.LIGHTDIRECTION="LIGHTDIRECTION",n.LIGHTDIRDIFFUSE="LIGHTDIRDIFFUSE",n.LIGHTDIRAMBIENT="LIGHTDIRAMBIENT",n.LIGHTDIRSPECULAR="LIGHTDIRSPECULAR",n.POINTLIGHTPOS="POINTLIGHTPOS",n.POINTLIGHTRANGE="POINTLIGHTRANGE",n.POINTLIGHTATTENUATION="POINTLIGHTATTENUATION",n.POINTLIGHTDIFFUSE="POINTLIGHTDIFFUSE",n.POINTLIGHTAMBIENT="POINTLIGHTAMBIENT",n.POINTLIGHTSPECULAR="POINTLIGHTSPECULAR",n.SPOTLIGHTPOS="SPOTLIGHTPOS",n.SPOTLIGHTDIRECTION="SPOTLIGHTDIRECTION",n.SPOTLIGHTSPOT="SPOTLIGHTSPOT",n.SPOTLIGHTRANGE="SPOTLIGHTRANGE",n.SPOTLIGHTATTENUATION="SPOTLIGHTATTENUATION",n.SPOTLIGHTDIFFUSE="SPOTLIGHTDIFFUSE",n.SPOTLIGHTAMBIENT="SPOTLIGHTAMBIENT",n.SPOTLIGHTSPECULAR="SPOTLIGHTSPECULAR",n.CORNERTEXTURECOORDINATE="CORNERTEXTURECOORDINATE",n.VELOCITY="VELOCITY",n.SIZEROTATION="SIZEROTATION",n.RADIUSRADIAN="RADIUSRADIAN",n.AGEADDSCALE="AGEADDSCALE",n.TIME="TIME",n.VIEWPORTSCALE="VIEWPORTSCALE",n.CURRENTTIME="CURRENTTIME",n.DURATION="DURATION",n.GRAVITY="GRAVITY",n.ENDVELOCITY="ENDVELOCITY",n.FLOAT32=4,n.SHORT=2,n._gl=null,n._bindActive={},n._COUNT=1,n}(T),Mt=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}return c(e,"laya.webgl.shader.d2.value.Color2dSV",ct),e.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)},e}(),It=function(t){function e(t){this.u_colorMatrix=null,this.texcoord=ct._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}c(e,"laya.webgl.shader.d2.value.TextureSV",ct);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),At=function(t){function e(t){this.a_color=null,e.__super.call(this,4,0),this.position=[2,5126,!1,5*st.BYTES_PE,0],this.a_color=[3,5126,!1,5*st.BYTES_PE,8]}return c(e,"laya.webgl.shader.d2.value.PrimitiveSV",ct),e}(),Rt=function(t){function e(){this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}c(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;return i.recreateResource=function(){this.startCreate();var t=ot.mainContext,e=this._source=t.createTexture(),i=ht.curBindTexTarget,s=ht.curBindTexValue;ht.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&s&&ht.bindTexture(t,i,s),this.memorySize=this._w*this._h*4,this.compoleteCreate()},i.detoryResource=function(){this._source&&(ot.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i,s){if(h.isFlash){this._flashCacheImage||(this._flashCacheImage=p.create(),this._flashCacheImage.image.createCanvas(this._w,this._h));var n=s.bitmapdata;0<=e-1&&this._flashCacheImage.image.copyPixels(n,0,0,n.width-1,n.height,e,i),e+1<=t.width&&this._flashCacheImage.image.copyPixels(n,0,0,n.width+1,n.height,e,i),0<=i-1&&this._flashCacheImage.image.copyPixels(n,0,0,n.width,n.height-1,e,i),i+1<=t.height&&this._flashCacheImage.image.copyPixels(n,0,0,n.width+1,n.height,e,i),this._flashCacheImage.image.copyPixels(n,0,0,n.width,n.height,e,i),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var r=ot.mainContext,a=ht.curBindTexTarget,o=ht.curBindTexValue;ht.bindTexture(r,3553,this._source),0<=e-1&&r.texSubImage2D(3553,0,e-1,i,6408,5121,s),e+1<=t.width&&r.texSubImage2D(3553,0,e+1,i,6408,5121,s),0<=i-1&&r.texSubImage2D(3553,0,e,i-1,6408,5121,s),i+1<=t.height&&r.texSubImage2D(3553,0,e,i+1,6408,5121,s),r.texSubImage2D(3553,0,e,i,6408,5121,s),a&&o&&ht.bindTexture(r,a,o)}},i.texSubImage2DPixel=function(t,e,i,s,n,r){var a=ot.mainContext,o=ht.curBindTexTarget,h=ht.curBindTexValue;ht.bindTexture(a,3553,this._source);var l=new Uint8Array(r.data);a.texSubImage2D(3553,0,e,i,s,n,6408,5121,l),o&&h&&ht.bindTexture(a,o,h)},s(0,i,"width",t.prototype._$get_width,function(t){this._w=t}),s(0,i,"height",t.prototype._$get_height,function(t){this._h=t}),e}(i),Pt=(function(e){function i(t){this._is2D=!1;var s=this;if(i.__super.call(this),this._canvas=this,"2D"===t||"AUTO"===t&&!h.isWebGL){this._is2D=!0,this._canvas=this._source=o.createElement("canvas"),this.iscpuSource=!0;var n=this;n.getContext=function(t,e){if(s._ctx)return s._ctx;var i=s._ctx=s._canvas.getContext(t,e);return i&&(i._canvas=n,i.size=function(){}),"2d"===t&&r._init(n,i),i}}else this._canvas={}}c(i,"laya.webgl.resource.WebGLCanvas",e);var t=i.prototype;t.clear=function(){this._ctx&&this._ctx.clear()},t.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},t._setContext=function(t){this._ctx=t},t.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=i._createContext(this)},t.copyTo=function(t){e.prototype.copyTo.call(this,t),t._ctx=this._ctx},t.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},t.recreateResource=function(){this.startCreate(),this.createWebGlTexture(),this.compoleteCreate()},t.detoryResource=function(){this._source&&!this.iscpuSource&&(ot.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},t.createWebGlTexture=function(){var t=ot.mainContext;if(!this._canvas)throw"create GLTextur err:no data:"+this._canvas;var e=this._source=t.createTexture();this.iscpuSource=!1;var i=ht.curBindTexTarget,s=ht.curBindTexValue;ht.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),this.memorySize=this._w*this._h*4,i&&s&&ht.bindTexture(t,i,s),this._canvas=null},t.texSubImage2D=function(t,e,i){var s=ot.mainContext,n=ht.curBindTexTarget,r=ht.curBindTexValue;ht.bindTexture(s,3553,this._source),s.texSubImage2D(3553,0,e,i,6408,5121,t._source),n&&r&&ht.bindTexture(s,n,r)},s(0,t,"canvas",function(){return this._canvas}),s(0,t,"context",function(){return this._ctx}),s(0,t,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),i.create=function(t){return new i(t)},i._createContext=null}(i),function(i){function a(t,e){this.borderSize=12,a.__super.call(this),this.canvas=t,this.char=e,this._enableMerageInAtlas=!0;var i=h.isConchApp;this._ctx=i?t:t.getContext("2d",void 0);var s=e.xs,n=e.ys,r=null;e.height=(e.width=i?(this._ctx.font=e.font,(r=this._ctx.measureText(e.char)).width1*s):(r=v.measureText(e.char,e.font)).width*s,r.height*n),this.onresize(e.width+2*this.borderSize,e.height+2*this.borderSize)}c(a,"laya.webgl.resource.WebGLCharImage",i);var t=a.prototype;return m.imps(t,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),t.recreateResource=function(){this.startCreate();var t=this.char,e=h.isConchApp,i=t.xs,s=t.ys;if(this.onresize(t.width+2*this.borderSize,t.height+2*this.borderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),e){var n="normal 100 "+t.fontSize+"px Arial";t.borderColor&&(n+=" 1 "+t.borderColor),this._ctx.font=n,this._ctx.textBaseline="top",this._ctx.fillStyle=t.fillColor,this._ctx.fillText(t.char,this.borderSize,this.borderSize,null,null,null)}else this._ctx.save(),this._ctx.clearRect(0,0,t.width+2*this.borderSize,t.height+2*this.borderSize),this._ctx.font=t.font,this._ctx.textBaseline="top",1==i&&1==s||this._ctx.scale(i,s),this._ctx.translate(this.borderSize,this.borderSize),t.fillColor&&t.borderColor?(this._ctx.strokeStyle=t.borderColor,this._ctx.lineWidth=t.lineWidth,this._ctx.strokeText(t.char,0,0,null,null,0,null),this._ctx.fillStyle=t.fillColor,this._ctx.fillText(t.char,0,0,null,null,null)):-1===t.lineWidth?(this._ctx.fillStyle=t.fillColor?t.fillColor:"white",this._ctx.fillText(t.char,0,0,null,null,null)):(this._ctx.strokeStyle=t.borderColor?t.borderColor:"white",this._ctx.lineWidth=t.lineWidth,this._ctx.strokeText(t.char,0,0,null,null,0,null)),this._ctx.restore();t.borderSize=this.borderSize,this.compoleteCreate()},t.copyTo=function(t){var e=t;e._ctx=this._ctx,e.canvas=this.canvas,e.char=this.char,i.prototype.copyTo.call(this,t)},t.onresize=function(t,e){if(this._w=t,this._h=e,!(this._w<B.atlasLimitWidth&&this._h<B.atlasLimitHeight))throw this._allowMerageInAtlas=!1,new Error("文字尺寸超出大图合集限制！");this._allowMerageInAtlas=!0},t.clearAtlasSource=function(){},t.dispose=function(){this.resourceManager.removeResource(this),i.prototype.dispose.call(this)},s(0,t,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),s(0,t,"atlasSource",function(){return this.canvas}),s(0,t,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),a}(i)),Et=function(t){function a(t,e,i,s,n,r){void 0===i&&(i=!1),void 0===s&&(s=6408),void 0===n&&(n=5121),void 0===r&&(r=33189),a.__super.call(this),this._w=t,this._h=e,this._mipMap=i,this._surfaceFormat=s,this._surfaceType=n,this._depthFormat=r}c(a,"laya.webgl.resource.WebGLRenderTarget",i);var e=a.prototype;return e.recreateResource=function(){this.startCreate();var t=ot.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=ht.curBindTexTarget,i=ht.curBindTexValue;ht.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071);var s=l.isPOT(this._w,this._h);this._mipMap&&s?(t.texParameteri(3553,10240,9987),t.generateMipmap(3553)):(t.texParameteri(3553,10240,9729),this._mipMap&&(this._mipMap=!1)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthFormat&&(this._depthBuffer||(this._depthBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthBuffer),t.renderbufferStorage(36161,this._depthFormat,this._w,this._h),t.framebufferRenderbuffer(36160,36096,36161,this._depthBuffer)),t.bindFramebuffer(36160,null),e&&i&&ht.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),this.memorySize=this._w*this._h*4,this.compoleteCreate()},e.detoryResource=function(){this._frameBuffer&&(ot.mainContext.deleteTexture(this._source),ot.mainContext.deleteFramebuffer(this._frameBuffer),ot.mainContext.deleteRenderbuffer(this._depthBuffer),this._source=null,this._frameBuffer=null,this._depthBuffer=null,this.memorySize=0)},s(0,e,"frameBuffer",function(){return this._frameBuffer}),s(0,e,"depthBuffer",function(){return this._depthBuffer}),a}(),Bt=(function(i){function h(t,e,i,s,n,r,a,o){this.offsetX=0,void(this.offsetY=0)===o&&(o=!0),h.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=r,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=s,this._h=n,this.offsetX=e,this.offsetY=i,this.src=a,this._enableMerageInAtlas=o}c(h,"laya.webgl.resource.WebGLSubImage",i);var t=h.prototype;m.imps(t,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),t.copyTo=function(t){var e=t;i.prototype.copyTo.call(this,t),e._ctx=this._ctx},t.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},t.recreateResource=function(){this.startCreate(),this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),(!B.enabled||!this._allowMerageInAtlas)&&this.createWebGlTexture(),this.compoleteCreate()},t.createWebGlTexture=function(){var t=ot.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=ht.curBindTexTarget,s=ht.curBindTexValue;ht.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,6408,5121,this.canvas);var n=this.minFifter,r=this.magFifter,a=this.repeat?10497:33071;l.isPOT(this.width,this.height)?(this.mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10240,r),t.texParameteri(3553,10241,n),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this.mipmap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&s&&ht.bindTexture(t,i,s),this.canvas=null,this.memorySize=this._w*this._h*4},t.detoryResource=function(){B.enabled&&this._allowMerageInAtlas||!this._source||(ot.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},t.clearAtlasSource=function(){this.canvas=null},t.dispose=function(){this.resourceManager.removeResource(this),i.prototype.dispose.call(this)},s(0,t,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),s(0,t,"atlasSource",function(){return this.canvas}),s(0,t,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t})}(i),function(t){function n(t,e,i,s){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,n.__super.call(this,t,e,i,s)}c(n,"laya.webgl.shader.d2.Shader2X",t);var e=n.prototype;return e.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},e._make2dQuick1=function(){try{if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,s=e.length;i<s;i++)t=e[i],(h.isFlash||"size"!==t.name&&"al2pha"!==t.name&&"mmat"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1}catch(t){}return null},e.detoryResource=function(){t.prototype.detoryResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){try{if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,s=e.length;i<s;i++)t=e[i],(h.isFlash||"size"!==t.name&&"al2pha"!==t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2}catch(t){}return null},n.create=function(t,e,i,s){return new n(t,e,i,s)},n}(St)),Dt=function(t){function e(){e.__super.call(this),this._bufferUsage=35044,this._type=34963}return c(e,"laya.webgl.utils.IndexBuffer",Lt),e.prototype.getUint16Array=function(){return new Uint16Array(this._buffer)},e.QuadrangleIB=null,e.create=function(){return new e},e}(),kt=function(t){function e(t){this._floatArray32=null,e.__super.call(this),this._bufferUsage=t,this._type=34962,this.getFloat32Array()}c(e,"laya.webgl.utils.VertexBuffer",t);var i=e.prototype;return i.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},i.bind=function(t){t&&t._bind(),this._bind()},i.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},i.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},i._checkFloatArray32Use=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},i.disposeCPUData=function(){t.prototype.disposeCPUData.call(this),this._floatArray32=null},e.create=function(t){return void 0===t&&(t=35048),new e(t)},e}(Lt),Ot=(function(e){function i(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,i.__super.call(this,9)}c(i,"laya.webgl.shader.d2.value.GlowSV",e);var t=i.prototype;t.setValue=function(t){e.prototype.setValue.call(this,t)},t.clear=function(){e.prototype.clear.call(this)}}(It),function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}c(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){(e.pool[e._length++]=this).clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(It)),Ft=function(t){function e(t){this._image=null,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this.mipmap=!1,this.minFifter=0,this.magFifter=0,e.__super.call(this,null),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this._image=t||new o.window.Image,this._enableMerageInAtlas=!0}c(e,"laya.webgl.resource.WebGLImage",t);var i=e.prototype;return m.imps(i,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),i._init_=function(t){},i.recreateResource=function(){var t=this;if(null!=this._src&&""!==this._src)if(this.startCreate(),this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this.createWebGlTexture(),this.compoleteCreate()}else{this._recreateLock=!0;var e=this;this._image=new o.window.Image,this._image.onload=function(){if(e._image.onload=null,e._needReleaseAgain)return e._needReleaseAgain=!1,void(e._image=null);e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e.createWebGlTexture(),e.compoleteCreate()},e._image.src=this._src}},i.copyTo=function(t){var e=t;e._image=this._image,laya.resource.Bitmap.prototype.copyTo.call(this,e)},i.detoryResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(ot.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.createWebGlTexture=function(){var t=ot.mainContext;if(!this._image)throw"create GLTextur err:no data:"+this._image;var e=this._source=t.createTexture(),i=ht.curBindTexTarget,s=ht.curBindTexValue;ht.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,6408,5121,this._image);var n=this.minFifter,r=this.magFifter,a=this.repeat?10497:33071,o=l.isPOT(this.width,this.height);o?(this.mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10240,r),t.texParameteri(3553,10241,n),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this.mipmap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==r||(r=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,r),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&s&&ht.bindTexture(t,i,s),this._image=null,this.memorySize=o?this._w*this._h*4*(1+1/3):this._w*this._h*4,this._recreateLock=!1},i.onresize=function(){this._w=this._image.width,this._h=this._image.height,B.enabled&&this._w<B.atlasLimitWidth&&this._h<B.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},i.clearAtlasSource=function(){this._image=null},i.dispose=function(){this.resourceManager.removeResource(this),t.prototype.dispose.call(this)},s(0,i,"image",function(){return this._image}),s(0,i,"onload",null,function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),s(0,i,"src",t.prototype._$get_src,function(t){this._src=t,this._image&&(this._image.src=t)}),s(0,i,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),s(0,i,"atlasSource",function(){return this._image}),s(0,i,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),s(0,i,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)}),e}(p);m.__init([at,ht,ut,E,U,tt])}(window,document,Laya),function(t,e,r){r.un,r.uns;var s=r.static,n=r.class,a=r.getset,o=(r.__newvec,laya.events.Event),h=laya.net.Loader,l=laya.display.css.Font,u=laya.display.Input,c=laya.display.Text,_=laya.display.Sprite,d=laya.resource.Texture,f=laya.filters.ColorFilter,i=laya.display.Graphics,p=laya.utils.Handler,g=(laya.display.Node,laya.maths.Rectangle),m=laya.utils.Utils,y=laya.maths.Point,v=(laya.display.Stage,laya.utils.Tween),x=laya.utils.Ease;r.interface("laya.ui.IComponent"),r.interface("laya.ui.IItem"),r.interface("laya.ui.IRender"),r.interface("laya.ui.ISelect"),r.interface("laya.ui.IBox","IComponent");var b=function(){function t(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN}return n(t,"laya.ui.LayoutStyle"),s(t,["EMPTY",function(){return this.EMPTY=new t}]),t}(),w=function(){function t(){}return n(t,"laya.ui.Styles"),t.labelColor="#000000",t.buttonStateNum=3,t.scrollBarMinNum=15,t.scrollBarDelayTime=500,s(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),t}(),T=function(){function i(){}return n(i,"laya.ui.UIUtils"),i.fillArray=function(t,e,i){var s=t.concat();if(e)for(var n=e.split(","),r=0,a=Math.min(s.length,n.length);r<a;r++){var o=n[r];s[r]="true"==o||"false"!=o&&o,null!=i&&(s[r]=i(o))}return s},i.toColor=function(t){for(var e=t.toString("16");e.length<6;)e="0"+e;return"#"+e},i.gray=function(t,e){void 0===e&&(e=!0),e?i.addFilter(t,i.grayFilter):i.clearFilter(t,f)},i.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},i.clearFilter=function(t,e){var i=t.filters;if(null!=i&&0<i.length){for(var s=i.length-1;-1<s;s--){var n=i[s];r.__typeof(n,e)&&i.splice(s,1)}t.filters=i}},s(i,["grayFilter",function(){return this.grayFilter=new f([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])}]),i}(),S=function(){function t(){}return n(t,"UIConfig"),t.touchScrollEnable=!0,t.mouseWheelEnable=!0,t.showButtons=!0,t.popupBgColor="#000000",t.popupBgAlpha=.5,t}(),C=function(t){function c(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,c.__super.call(this)}n(c,"laya.ui.AutoBitmap",t);var e=c.prototype;return e.destroy=function(){t.prototype.destroy.call(this),this._source=null,this._sizeGrid=null},e.changeSource=function(){var t=this._source;if(t){var e=this.width,i=this.height,s=this._sizeGrid,n=t.sourceWidth,r=t.sourceHeight;if(!s||n===e&&r===i)this.clear(),this.drawTexture(t,0,0,e,i);else{t.$_GID||(t.$_GID=m.getGID());var a=t.$_GID+"."+e+"."+i+"."+s.join(".");if(c.cmdCaches[a])return void(this.cmds=c.cmdCaches[a]);this.clear();var o=s[0],h=s[1],l=s[2],u=s[3];e<u+h&&(h=0),u&&o&&this.drawTexture(c.getTexture(t,0,0,u,o),0,0,u,o),h&&o&&this.drawTexture(c.getTexture(t,n-h,0,h,o),e-h,0,h,o),u&&l&&this.drawTexture(c.getTexture(t,0,r-l,u,l),0,i-l,u,l),h&&l&&this.drawTexture(c.getTexture(t,n-h,r-l,h,l),e-h,i-l,h,l),o&&this.drawTexture(c.getTexture(t,u,0,n-u-h,o),u,0,e-u-h,o),l&&this.drawTexture(c.getTexture(t,u,r-l,n-u-h,l),u,i-l,e-u-h,l),u&&this.drawTexture(c.getTexture(t,0,o,u,r-o-l),0,o,u,i-o-l),h&&this.drawTexture(c.getTexture(t,n-h,o,h,r-o-l),e-h,o,h,i-o-l),this.drawTexture(c.getTexture(t,u,o,n-u-h,r-o-l),u,o,e-u-h,i-o-l),this.autoCacheCmd&&(c.cmdCaches[a]=this.cmds)}this._repaint()}},a(0,e,"sizeGrid",function(){return this._sizeGrid},function(t){this._sizeGrid=t,r.timer.callLater(this,this.changeSource)}),a(0,e,"source",function(){return this._source},function(t){t?(this._source=t,r.timer.callLater(this,this.changeSource)):(this._source=null,this.clear())}),a(0,e,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(t){this._width=t,r.timer.callLater(this,this.changeSource)}),a(0,e,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(t){this._height=t,r.timer.callLater(this,this.changeSource)}),c.getTexture=function(t,e,i,s,n){t.$GID||(t.$GID=m.getGID());var r=t.$GID+"."+e+"."+i+"."+s+"."+n,a=c.textureCache[r];return a||(a=c.textureCache[r]=d.createFromTexture(t,e,i,s,n)),a},c.clearCache=function(){c.cmdCaches={},c.textureCache={}},c.cmdCaches={},c.textureCache={},c}(i),L=(function(t){function e(){e.__super.call(this)}n(e,"laya.ui.UIEvent",o),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip"}(),function(e){function t(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,t.__super.call(this),this._layout=b.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}n(t,"laya.ui.Component",e);var i=t.prototype;return r.imps(i,{"laya.ui.IComponent":!0}),i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},i.preinitialize=function(){},i.createChildren=function(){},i.initialize=function(){},i.callLater=function(t,e){r.timer.callLater(this,t,e)},i.runCallLater=function(t){r.timer.runCallLater(this,t)},i.commitMeasure=function(){},i.changeSize=function(){this.event("resize")},i.getLayout=function(){return this._layout===b.EMPTY&&(this._layout=new b),this._layout},i.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},i.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},i.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},i.resetLayoutX=function(){var t=this.parent;if(t){var e=this._layout;isNaN(e.centerX)?isNaN(e.left)?isNaN(e.right)||(this.x=t.width-this.displayWidth-e.right):(this.x=e.left,isNaN(e.right)||(this.width=(t._width-e.left-e.right)/this.scaleX)):this.x=.5*(t.width-this.displayWidth)+e.centerX}},i.resetLayoutY=function(){var t=this.parent;if(t){var e=this._layout;isNaN(e.centerY)?isNaN(e.top)?isNaN(e.bottom)||(this.y=t.height-this.displayHeight-e.bottom):(this.y=e.top,isNaN(e.bottom)||(this.height=(t._height-e.top-e.bottom)/this.scaleY)):this.y=.5*(t.height-this.displayHeight)+e.centerY}},i.onMouseOver=function(t){r.stage.event("showtip",this._toolTip)},i.onMouseOut=function(t){r.stage.event("hidetip",this._toolTip)},a(0,i,"width",function(){return this._width?this._width:this.measureWidth},function(t){this._width!=t&&(this._width=t,this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)||this.resetLayoutX())}),a(0,i,"displayWidth",function(){return this.width*this.scaleX}),a(0,i,"centerX",function(){return this._layout.centerX},function(t){this.getLayout().centerX=t,this.layOutEabled=!0,this.resetLayoutX()}),a(0,i,"displayHeight",function(){return this.height*this.scaleY}),a(0,i,"measureHeight",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.y+i.height*i.scaleY,t))}return t}),a(0,i,"measureWidth",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.x+i.width*i.scaleX,t))}return t}),a(0,i,"height",function(){return this._height?this._height:this.measureHeight},function(t){this._height!=t&&(this._height=t,this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)||this.resetLayoutY())}),a(0,i,"scaleX",e.prototype._$get_scaleX,function(t){e.prototype._$get_scaleX.call(this)!=t&&(e.prototype._$set_scaleX.call(this,t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),a(0,i,"scaleY",e.prototype._$get_scaleY,function(t){e.prototype._$get_scaleY.call(this)!=t&&(e.prototype._$set_scaleY.call(this,t),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),a(0,i,"dataSource",function(){return this._dataSource},function(t){for(var e in this._dataSource=t,this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])}),a(0,i,"toolTip",function(){return this._toolTip},function(t){this._toolTip!=t&&(null!=(this._toolTip=t)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),a(0,i,"top",function(){return this._layout.top},function(t){this.getLayout().top=t,this.layOutEabled=!0,this.resetLayoutY()}),a(0,i,"bottom",function(){return this._layout.bottom},function(t){this.getLayout().bottom=t,this.layOutEabled=!0,this.resetLayoutY()}),a(0,i,"left",function(){return this._layout.left},function(t){this.getLayout().left=t,this.layOutEabled=!0,this.resetLayoutX()}),a(0,i,"right",function(){return this._layout.right},function(t){this.getLayout().right=t,this.layOutEabled=!0,this.resetLayoutX()}),a(0,i,"centerY",function(){return this._layout.centerY},function(t){this.getLayout().centerY=t,this.layOutEabled=!0,this.resetLayoutY()}),a(0,i,"tag",function(){return this._tag},function(t){this._tag=t}),a(0,i,"layOutEabled",null,function(t){this._layout.enable!=t&&(this._layout.enable=t,this.hasListener("added")||(this.on("added",this,this.onAdded),this.on("removed",this,this.onRemoved)))}),a(0,i,"comXml",function(){return this._comXml},function(t){this._comXml=t}),a(0,i,"x",e.prototype._$get_x,function(t){e.prototype._$set_x.call(this,Math.round(t))}),a(0,i,"y",e.prototype._$get_y,function(t){e.prototype._$set_y.call(this,Math.round(t))}),a(0,i,"disabled",function(){return this._disabled},function(t){t!==this._disabled&&(this._disabled=t,T.gray(this,t))}),t}(_)),M=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.Box",t);var i=e.prototype;return r.imps(i,{"laya.ui.IBox":!0}),a(0,i,"dataSource",t.prototype._$get_dataSource,function(t){for(var e in this._dataSource=t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&(this[e]=t[e])}}),e}(L),I=function(e){function i(t,e){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,i.__super.call(this),this._labelColors=w.buttonLabelColors,this._stateNum=w.buttonStateNum,void 0===e&&(e=""),this.skin=t,this.label=e}n(i,"laya.ui.Button",e);var t=i.prototype;return r.imps(t,{"laya.ui.ISelect":!0}),t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(t),this._sources&&(this._sources.length=0),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},t.createChildren=function(){this.graphics=this._bitmap=new C,this._text=new c,this._text.align="center",this._text.valign="middle"},t.initialize=function(){this.on("mouseover",this,this.onMouse),this.on("mouseout",this,this.onMouse),this.on("mousedown",this,this.onMouse),this.on("mouseup",this,this.onMouse),this.on("click",this,this.onMouse)},t.onMouse=function(t){if(!(!1===this.toggle&&this._selected||this.disabled))return"click"===t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=i.stateMap[t.type]))},t.changeClips=function(){var t=h.getRes(this._skin);if(t){this._sources||(this._sources=[]),this._sources.length=0;for(var e=t.width,i=t.height/this._stateNum,s=0;s<this._stateNum;s++)this._sources.push(d.createFromTexture(t,0,i*s,e,i));this._autoSize?(this._bitmap.width=this._text.width=this._width||e,this._bitmap.height=this._text.height=this._height||i):this._text.x=e}else console.log("lose skin",this._skin)},t.changeState=function(){this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]),this.label&&(this._text.color=this._labelColors[t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[t]))},a(0,t,"labelStrokeColor",function(){return this._text.strokeColor},function(t){this._text.strokeColor=t}),a(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.callLater(this.changeClips),this.callLater(this.changeState))}),a(0,t,"state",function(){return this._state},function(t){this._state!=t&&(this._state=t,this.callLater(this.changeState))}),a(0,t,"label",function(){return this._text.text},function(t){this._text.text!=t&&(t&&!this._text.displayInStage&&this.addChild(this._text),this._text.text=t,this.callLater(this.changeState))}),a(0,t,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=t<1?1:3<t?3:t,this.callLater(this.changeClips))}),a(0,t,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(t){this._strokeColors=T.fillArray(w.buttonLabelColors,t,String),this.callLater(this.changeState)}),a(0,t,"labelStroke",function(){return this._text.stroke},function(t){this._text.stroke=t}),a(0,t,"measureHeight",function(){return this.runCallLater(this.changeClips),this._bitmap.height}),a(0,t,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+this._text.width)}),a(0,t,"selected",function(){return this._selected},function(t){this._selected!=t&&(this._selected=t,this.state=this._selected?2:0,this.event("change"))}),a(0,t,"labelColors",function(){return this._labelColors.join(",")},function(t){this._labelColors=T.fillArray(w.buttonLabelColors,t,String),this.callLater(this.changeState)}),a(0,t,"labelPadding",function(){return this._text.padding.join(",")},function(t){this._text.padding=T.fillArray(w.labelPadding,t,Number)}),a(0,t,"labelSize",function(){return this._text.fontSize},function(t){this._text.fontSize=t}),a(0,t,"labelBold",function(){return this._text.bold},function(t){this._text.bold=t}),a(0,t,"labelAlign",function(){return this._text.align},function(t){this._text.align=t}),a(0,t,"labelFont",function(){return this._text.font},function(t){this._text.font=t}),a(0,t,"clickHandler",function(){return this._clickHandler},function(t){this._clickHandler=t}),a(0,t,"text",function(){return this._text}),a(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=T.fillArray(w.defaultSizeGrid,t,Number)}),a(0,t,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this._autoSize&&(this._bitmap.width=t,this._text.width=t)}),a(0,t,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this._autoSize&&(this._bitmap.height=t,this._text.height=t)}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.label=t+"":e.prototype._$set_dataSource.call(this,t)}),s(i,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),i}(L),A=function(e){function s(t,e,i){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,s.__super.call(this),void 0===e&&(e=1),void 0===i&&(i=1),this._clipX=e,this._clipY=i,this.skin=t}n(s,"laya.ui.Clip",e);var t=s.prototype;return t.destroy=function(t){void 0===t&&(t=!1),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},t.dispose=function(){this.destroy(!0),r.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new C},t.initialize=function(){this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},t._onDisplay=function(t){this._isPlaying?this._displayInStage?this.play():this.stop():this._autoPlay&&this._displayInStage&&this.play()},t.changeClip=function(){var t=h.getRes(this._skin);t?this.loadComplete(this._skin,t):r.loader.load(this._skin,p.create(this,this.loadComplete,[this._skin]))},t.loadComplete=function(t,e){if(t===this._skin&&e){this._clipWidth||(this._clipWidth=Math.ceil(e.width/this._clipX)),this._clipHeight||(this._clipHeight=Math.ceil(e.height/this._clipY)),this._sources||(this._sources=[]);for(var i=this._sources.length=0;i<this._clipY;i++)for(var s=0;s<this._clipX;s++)this._sources.push(d.createFromTexture(e,this._clipWidth*s,this._clipHeight*i,this._clipWidth,this._clipHeight));this.index=this._index,this.event("loaded"),this.onCompResize()}},t.play=function(){this._isPlaying=!0,this._index=0,r.timer.loop(this.interval,this,this._loop)},t._loop=function(){this._style.visible&&this._sources&&(this.index=this._index,this._index++,this._index>=this._sources.length&&(this._index=0))},t.stop=function(){this._isPlaying=!1,r.timer.clear(this,this._loop)},a(0,t,"autoPlay",function(){return this._autoPlay},function(t){this._autoPlay!=t&&((this._autoPlay=t)?this.play():this.stop())}),a(0,t,"clipX",function(){return this._clipX},function(t){this._clipX=t,this.callLater(this.changeClip)}),a(0,t,"skin",function(){return this._skin},function(t){this._skin=t,this.callLater(this.changeClip)}),a(0,t,"sources",function(){return this._sources},function(t){this._sources=t,this.index=this._index,this.event("loaded")}),a(0,t,"clipY",function(){return this._clipY},function(t){this._clipY=t,this.callLater(this.changeClip)}),a(0,t,"clipWidth",function(){return this._clipWidth},function(t){this._clipWidth=t,this.callLater(this.changeClip)}),a(0,t,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),a(0,t,"clipHeight",function(){return this._clipHeight},function(t){this._clipHeight=t,this.callLater(this.changeClip)}),a(0,t,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),a(0,t,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this._bitmap.width=t}),a(0,t,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this._bitmap.height=t}),a(0,t,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),a(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=T.fillArray(w.defaultSizeGrid,t,Number)}),a(0,t,"index",function(){return this._index},function(t){this._index=t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]),this.event("change")}),a(0,t,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._interval=t,this._isPlaying&&this.play())}),a(0,t,"isPlaying",function(){return this._isPlaying},function(t){this._isPlaying=t}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.index=r.__parseInt(t):e.prototype._$set_dataSource.call(this,t)}),a(0,t,"bitmap",function(){return this._bitmap}),s}(L),R=function(e){function t(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",t.__super.call(this)}n(t,"laya.ui.ColorPicker",e);var i=t.prototype;return i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._colorPanel&&this._colorPanel.destroy(t),this._colorButton&&this._colorButton.destroy(t),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},i.createChildren=function(){this.addChild(this._colorButton=new I),this._colorPanel=new M,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new _),this._colorPanel.addChild(this._colorBlock=new _),this._colorPanel.addChild(this._colorInput=new u)},i.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},i.onPanelMouseDown=function(t){t.stopPropagation()},i.changePanel=function(){var t=this._colorPanel.graphics;t.clear(),t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(t=this._colorTiles.graphics).clear();for(var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;i<12;i++)for(var s=0;s<20;s++){var n=0;n=0===s?e[i]:1===s?0:51*(((3*i+s/6)%3<<0)+3*(i/6<<0))<<16|s%6*51<<8|(i<<0)%6*51;var r=T.toColor(n);this._colors.push(r);var a=s*this._gridSize,o=i*this._gridSize;t.drawRect(a,o,this._gridSize,this._gridSize,r,"#000000")}},i.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()},i.open=function(){var t=this.localToGlobal(new y),e=t.x+this._colorPanel.width<=r.stage.width?t.x:r.stage.width-this._colorPanel.width,i=t.y+this._colorButton.height;i=i+this._colorPanel.height<=r.stage.height?i:t.y-this._colorPanel.height,this._colorPanel.pos(e,i),r.stage.addChild(this._colorPanel),r.stage.on("mousedown",this,this.removeColorBox)},i.close=function(){r.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},i.removeColorBox=function(t){this.close()},i.onColorFieldKeyDown=function(t){13==t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),t.stopPropagation())},i.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},i.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse(),this.close()},i.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var e=this.getColorByMouse();this._colorInput.text=e,this.drawBlock(e)},i.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),e=Math.floor(t.x/this._gridSize),i=Math.floor(t.y/this._gridSize);return this._colors[20*i+e]},i.drawBlock=function(t){var e=this._colorBlock.graphics;e.clear();var i=t||"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor),t||e.drawLine(0,0,50,20,"#ff0000")},i.changeColor=function(){var t=this.graphics;t.clear();var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)},a(0,i,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t,this.callLater(this.changePanel)}),a(0,i,"selectedColor",function(){return this._selectedColor},function(t){this._selectedColor!=t&&(this._selectedColor=this._colorInput.text=t,this.drawBlock(t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",o.EMPTY.setTo("change",this,this)))}),a(0,i,"inputBgColor",function(){return this._inputBgColor},function(t){this._inputBgColor=t,this.callLater(this.changePanel)}),a(0,i,"skin",function(){return this._colorButton.skin},function(t){this._colorButton.skin=t,this.changeColor()}),a(0,i,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this.callLater(this.changePanel)}),a(0,i,"inputColor",function(){return this._inputColor},function(t){this._inputColor=t,this.callLater(this.changePanel)}),t}(L),P=function(e){function i(t,e){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._scrollBar=null,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,i.__super.call(this),this._itemColors=w.comboBoxItemColors,this.skin=t,this.labels=e}n(i,"laya.ui.ComboBox",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._button&&this._button.destroy(t),this._list&&this._list.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),this._button=null,this._list=null,this._scrollBar=null,this._itemColors=null,this._labels=null,this._selectHandler=null},t.createChildren=function(){this.addChild(this._button=new I),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},t._createList=function(){this._list=new V,this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=p.create(this,this.onlistItemMouse,null,!1),this._scrollBarSkin&&(this._list.addChild(this._scrollBar=new K),this._scrollBar.skin=this._scrollBarSkin,this._scrollBar.name="scrollBar",this._scrollBar.y=1,this._scrollBar.on("mousedown",this,this.onScrollBarDown))},t.onListDown=function(t){t.stopPropagation()},t.onScrollBarDown=function(t){t.stopPropagation()},t.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])},t.changeList=function(){this._listChanged=!1;var t=this.width-2,e=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender={type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]},this._list.repeatY=this._visibleNum,this._scrollBar&&(this._scrollBar.x=this.width-this._scrollBar.width-1),this._list.refresh()},t.onlistItemMouse=function(t,e){var i=t.type;if("mouseover"===i||"mouseout"===i){var s=this._list.getCell(e);if(!s)return;var n=s.getChildByName("label");n.color="mouseover"===i?(n.bgColor=this._itemColors[0],this._itemColors[1]):(n.bgColor=null,this._itemColors[2])}else"click"===i&&(this.selectedIndex=e,this.isOpen=!1)},t.switchTo=function(t){this.isOpen=t},t.changeOpen=function(){this.isOpen=!this._isOpen},t.changeItem=function(){this._itemChanged=!1,this.runCallLater(this.changeList),this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,this._scrollBar&&(this._scrollBar.height=this._listHeight-2);var t=this._list.graphics;t.clear(),t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3]);for(var e=this._list.array||[],i=e.length=0,s=this._labels.length;i<s;i++)e.push({label:this._labels[i]});this._list.array=e},t.changeSelected=function(){this._button.label=this.selectedLabel},t.removeList=function(t){this.isOpen=!1},a(0,t,"labels",function(){return this._labels.join(",")},function(t){0<this._labels.length&&(this.selectedIndex=-1),t?this._labels=t.split(","):this._labels.length=0,this._itemChanged=!0}),a(0,t,"skin",function(){return this._button.skin},function(t){this._button.skin!=t&&(this._button.skin=t,this._listChanged=!0)}),a(0,t,"measureHeight",function(){return this._button.height}),a(0,t,"measureWidth",function(){return this._button.width}),a(0,t,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(t){this.selectedIndex=this._labels.indexOf(t)}),a(0,t,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[o.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),a(0,t,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),a(0,t,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this._button.height=this._height}),a(0,t,"selectHandler",function(){return this._selectHandler},function(t){this._selectHandler=t}),a(0,t,"stateNum",function(){return this._button.stateNum},function(t){this._button.stateNum=t}),a(0,t,"visibleNum",function(){return this._visibleNum},function(t){this._visibleNum=t,this._listChanged=!0}),a(0,t,"itemColors",function(){return String(this._itemColors)},function(t){this._itemColors=T.fillArray(this._itemColors,t,String),this._listChanged=!0}),a(0,t,"itemSize",function(){return this._itemSize},function(t){this._itemSize=t,this._listChanged=!0}),a(0,t,"isOpen",function(){return this._isOpen},function(t){if(this._isOpen!=t)if(this._isOpen=t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&this.changeList(),this._itemChanged&&this.changeItem(),y.EMPTY.setTo(0,0);var e=this.localToGlobal(y.EMPTY),i=e.y+this._button.height;i=i+this._listHeight<=r.stage.height?i:e.y-this._listHeight,this._list.pos(e.x,i),r.stage.addChild(this._list),r.stage.once("mousedown",this,this.removeList),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),a(0,t,"sizeGrid",function(){return this._button.sizeGrid},function(t){this._button.sizeGrid=t}),a(0,t,"button",function(){return this._button}),a(0,t,"scrollBarSkin",function(){return this._scrollBarSkin},function(t){this._scrollBarSkin=t}),a(0,t,"scrollBar",function(){return this._scrollBar}),a(0,t,"list",function(){return this._list}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=r.__parseInt(t):t instanceof Array?this.labels=t.join(","):e.prototype._$set_dataSource.call(this,t)}),a(0,t,"labelColors",function(){return this._button.labelColors},function(t){this._button.labelColors=t}),a(0,t,"labelPadding",function(){return this._button.text.padding.join(",")},function(t){this._button.text.padding=T.fillArray(w.labelPadding,t,Number)}),a(0,t,"labelSize",function(){return this._button.text.fontSize},function(t){this._button.text.fontSize=t}),a(0,t,"labelBold",function(){return this._button.text.bold},function(t){this._button.text.bold=t}),a(0,t,"labelFont",function(){return this._button.text.font},function(t){this._button.text.font=t}),i}(L),E=function(e){function i(t){this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this._scrollSize=1,this._skin=null,this._upButton=null,this._downButton=null,this._slider=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,i.__super.call(this),this._showButtons=S.showButtons,this._touchScrollEnable=S.touchScrollEnable,this._mouseWheelEnable=S.mouseWheelEnable,this.skin=t,this.max=1}n(i,"laya.ui.ScrollBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._upButton&&this._upButton.destroy(t),this._downButton&&this._downButton.destroy(t),this._slider&&this._slider.destroy(t),this._upButton=this._downButton=null,this._slider=null,this.changeHandler=null,this._offsets=null},t.createChildren=function(){this.addChild(this._slider=new B),this.addChild(this._upButton=new I),this.addChild(this._downButton=new I)},t.initialize=function(){this._slider.showLabel=!1,this._slider.on("change",this,this.onSliderChange),this._slider.setSlider(0,0,0),this._upButton.on("mousedown",this,this.onButtonMouseDown),this._downButton.on("mousedown",this,this.onButtonMouseDown)},t.onSliderChange=function(t){this.value=this._slider.value},t.onButtonMouseDown=function(t){var e=t.currentTarget===this._upButton;this.slide(e),r.timer.once(w.scrollBarDelayTime,this,this.startLoop,[e]),r.stage.once("mouseup",this,this.onStageMouseUp)},t.startLoop=function(t){r.timer.frameLoop(1,this,this.slide,[t])},t.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize},t.onStageMouseUp=function(t){r.timer.clear(this,this.startLoop),r.timer.clear(this,this.slide)},t.changeScrollBar=function(){this._upButton.visible=this._showButtons,this._downButton.visible=this._showButtons,this._showButtons&&(this._upButton.skin=this._skin.replace(".png","$up.png"),this._downButton.skin=this._skin.replace(".png","$down.png")),this._slider.isVertical?this._slider.y=this._showButtons?this._upButton.height:0:this._slider.x=this._showButtons?this._upButton.width:0,this.resetPositions()},t.changeSize=function(){e.prototype.changeSize.call(this),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},t.resetPositions=function(){this._slider.isVertical?this._slider.height=this.height-(this._showButtons?this._upButton.height+this._downButton.height:0):this._slider.width=this.width-(this._showButtons?this._upButton.width+this._downButton.width:0),this.resetButtonPosition()},t.resetButtonPosition=function(){this._slider.isVertical?this._downButton.y=this._slider.y+this._slider.height:this._downButton.x=this._slider.x+this._slider.width},t.setScroll=function(t,e,i){this.runCallLater(this.changeSize),this._slider.setSlider(t,e,i),this._slider.bar.visible=0<e,!this._hide&&this.autoHide&&(this.visible=!1)},t.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize,this.target=this._target},t.onTargetMouseDown=function(t){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new y),this._lastPoint.setTo(r.stage.mouseX,r.stage.mouseY),r.timer.clear(this,this.tweenMove),v.clearTween(this),r.stage.once("mouseup",this,this.onStageMouseUp2),r.stage.once("mouseout",this,this.onStageMouseUp2),r.timer.frameLoop(1,this,this.loop),this.event("start")},t.loop=function(){var t=r.stage.mouseY,e=r.stage.mouseX;if(this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?r.stage._canvasTransform.getScaleY():r.stage._canvasTransform.getScaleX()))))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0)}this._offsets.push(this._lastOffset),this._lastPoint.x=e,this._lastPoint.y=t,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(this._checkElastic=!0,0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?this._isElastic=!0:this._isElastic=!1):this._checkElastic=!0),this._checkElastic&&(this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset))},t.onStageMouseUp2=function(t){if(r.stage.off("mouseup",this,this.onStageMouseUp2),r.stage.off("mouseout",this,this.onStageMouseUp2),r.timer.clear(this,this.loop),!this._clickOnly)if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?v.to(this,{value:this.min},this.elasticBackTime,x.sineOut,p.create(this,this.elasticOver)):this._value>this.max&&v.to(this,{value:this.max},this.elasticBackTime,x.sineOut,p.create(this,this.elasticOver));else{this._offsets.length<1&&(this._offsets[0]=this.isVertical?r.stage.mouseY-this._lastPoint.y:r.stage.mouseX-this._lastPoint.x);for(var e=0,i=Math.min(this._offsets.length,3),s=0;s<i;s++)e+=this._offsets[this._offsets.length-1-s];if(this._lastOffset=e/i,(e=Math.abs(this._lastOffset))<2)return;60<e&&(this._lastOffset=0<this._lastOffset?60:-60),r.timer.frameLoop(1,this,this.tweenMove)}},t.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&v.to(this,{alpha:0},500)},t.tweenMove=function(){this._lastOffset*=.95,this.value-=this._lastOffset,Math.abs(this._lastOffset)<1&&(r.timer.clear(this,this.tweenMove),this.event("end"),!this.hide&&this.autoHide&&v.to(this,{alpha:0},500))},t.stopScroll=function(){this.onStageMouseUp2(null),r.timer.clear(this,this.tweenMove),v.clearTween(this)},a(0,t,"isVertical",function(){return this._slider.isVertical},function(t){this._slider.isVertical=t}),a(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._slider.skin=this._skin,this.callLater(this.changeScrollBar))}),a(0,t,"max",function(){return this._slider.max},function(t){this._slider.max=t}),a(0,t,"scrollSize",function(){return this._scrollSize},function(t){this._scrollSize=t}),a(0,t,"measureHeight",function(){return this._slider.isVertical?100:this._slider.height}),a(0,t,"measureWidth",function(){return this._slider.isVertical?this._slider.width:100}),a(0,t,"sizeGrid",function(){return this._slider.sizeGrid},function(t){this._slider.sizeGrid=t}),a(0,t,"min",function(){return this._slider.min},function(t){this._slider.min=t}),a(0,t,"value",function(){return this._value},function(t){t!==this._value&&(this._isElastic?this._value=t:(this._slider.value=t,this._value=this._slider.value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value))}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):e.prototype._$set_dataSource.call(this,t)}),a(0,t,"thumbPercent",function(){return this._thumbPercent},function(t){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),t=1<=t?.99:t,this._thumbPercent=t,this.scaleBar&&(this._slider.isVertical?this._slider.bar.height=Math.max(this._slider.height*t,w.scrollBarMinNum):this._slider.bar.width=Math.max(this._slider.width*t,w.scrollBarMinNum))}),a(0,t,"target",function(){return this._target},function(t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=t)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),a(0,t,"hide",function(){return this._hide},function(t){this._hide=t,this.visible=!t}),a(0,t,"showButtons",function(){return this._showButtons},function(t){this._showButtons=t,this.callLater(this.changeScrollBar)}),a(0,t,"touchScrollEnable",function(){return this._touchScrollEnable},function(t){this._touchScrollEnable=t,this.target=this._target}),a(0,t,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(t){this._mouseWheelEnable=t}),i}(L),B=function(e){function i(t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,i.__super.call(this),this.skin=t}n(i,"laya.ui.Slider",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._bg=null,this._bar=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new D),this.addChild(this._bar=new I)},t.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this.allowClickBack=!0},t.onBarMouseDown=function(t){this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=r.stage.mouseX,this._ty=r.stage.mouseY,r.stage.on("mousemove",this,this.mouseMove),r.stage.once("mouseup",this,this.mouseUp),this.showValueText()},t.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t),t.textField.changeText(this._value+""),this.isVertical?(t.x=this._bar.x+20,t.y=.5*(this._bar.height-t.height)+this._bar.y):(t.y=this._bar.y-20,t.x=.5*(this._bar.width-t.width)+this._bar.x)}},t.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},t.mouseUp=function(t){r.stage.off("mousemove",this,this.mouseMove),this.sendChangeEvent("changed"),this.hideValueText()},t.mouseMove=function(t){var e=this._value;this.isVertical?(this._bar.y+=r.stage.mouseY-this._ty,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min):(this._bar.x+=r.stage.mouseX-this._tx,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min),this._tx=r.stage.mouseX,this._ty=r.stage.mouseY;var i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*i)/i,this._value!=e&&this.sendChangeEvent(),this.showValueText()},t.sendChangeEvent=function(t){void 0===t&&(t="change"),this.event(t),this.changeHandler&&this.changeHandler.runWith(this._value)},t.setBarPoint=function(){this.isVertical?this._bar.x=.5*(this._bg.width-this._bar.width):this._bar.y=.5*(this._bg.height-this._bar.height)},t.changeSize=function(){e.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},t.setSlider=function(t,e,i){this._value=-1,this._min=t,this._max=t<e?e:t,this.value=i<t?t:e<i?e:i},t.changeValue=function(){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value,this.isVertical?this._bar.y=(this._value-this._min)/(this._max-this._min)*(this.height-this._bar.height):this._bar.x=(this._value-this._min)/(this._max-this._min)*(this.width-this._bar.width)},t.onBgMouseDown=function(t){var e=this._bg.getMousePoint();this.isVertical?this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},a(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.setBarPoint())}),a(0,t,"max",function(){return this._max},function(t){this._max!=t&&(this._max=t,this.callLater(this.changeValue))}),a(0,t,"bar",function(){return this._bar}),a(0,t,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),a(0,t,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),a(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=t,this._bar.sizeGrid=t}),a(0,t,"tick",function(){return this._tick},function(t){this._tick=t,this.callLater(this.changeValue)}),a(0,t,"min",function(){return this._min},function(t){this._min!=t&&(this._min=t,this.callLater(this.changeValue))}),a(0,t,"value",function(){return this._value},function(t){if(this._value!=t){var e=this._value;this._value=t,this.changeValue(),this._value!=e&&this.sendChangeEvent()}}),a(0,t,"allowClickBack",function(){return this._allowClickBack},function(t){this._allowClickBack!=t&&((this._allowClickBack=t)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):e.prototype._$set_dataSource.call(this,t)}),s(i,["label",function(){return this.label=new k}]),i}(L),D=function(e){function i(t){this._bitmap=null,this._skin=null,i.__super.call(this),this.skin=t}n(i,"laya.ui.Image",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},t.dispose=function(){this.destroy(!0),r.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new C,this._bitmap.autoCacheCmd=!1},t.setSource=function(t,e){t===this._skin&&(this.source=e),this.onCompResize()},a(0,t,"skin",function(){return this._skin},function(t){if(this._skin!=t)if(this._skin=t){var e=h.getRes(t);e?this.source=e:r.loader.load(this._skin,p.create(this,this.setSource,[this._skin]),null,"image")}else this.source=null}),a(0,t,"source",function(){return this._bitmap.source},function(t){this._bitmap&&(this._bitmap.source=t,this.event("loaded"),this.repaint())}),a(0,t,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this._bitmap.width=0==t?1e-7:t}),a(0,t,"measureHeight",function(){return this._bitmap.height}),a(0,t,"measureWidth",function(){return this._bitmap.width}),a(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=T.fillArray(w.defaultSizeGrid,t,Number)}),a(0,t,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this._bitmap.height=0==t?1e-7:t}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"string"==typeof(this._dataSource=t)?this.skin=t:e.prototype._$set_dataSource.call(this,t)}),i}(L),k=function(e){function i(t){this._tf=null,i.__super.call(this),void 0===t&&(t=""),l.defaultColor=w.labelColor,this.text=t}n(i,"laya.ui.Label",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._tf=null},t.createChildren=function(){this.addChild(this._tf=new c)},a(0,t,"leading",function(){return this._tf.leading},function(t){this._tf.leading=t}),a(0,t,"text",function(){return this._tf.text},function(t){this._tf.text!=t&&(this._tf.text=t,this.event("change"))}),a(0,t,"color",function(){return this._tf.color},function(t){this._tf.color=t}),a(0,t,"strokeColor",function(){return this._tf.strokeColor},function(t){this._tf.strokeColor=t}),a(0,t,"wordWrap",function(){return this._tf.wordWrap},function(t){this._tf.wordWrap=t}),a(0,t,"font",function(){return this._tf.font},function(t){this._tf.font=t}),a(0,t,"italic",function(){return this._tf.italic},function(t){this._tf.italic=t}),a(0,t,"valign",function(){return this._tf.valign},function(t){this._tf.valign=t}),a(0,t,"align",function(){return this._tf.align},function(t){this._tf.align=t}),a(0,t,"bold",function(){return this._tf.bold},function(t){this._tf.bold=t}),a(0,t,"textField",function(){return this._tf}),a(0,t,"fontSize",function(){return this._tf.fontSize},function(t){this._tf.fontSize=t}),a(0,t,"padding",function(){return this._tf.padding.join(",")},function(t){this._tf.padding=T.fillArray(w.labelPadding,t,Number)}),a(0,t,"bgColor",function(){return this._tf.bgColor},function(t){this._tf.bgColor=t}),a(0,t,"measureWidth",function(){return this._tf.width}),a(0,t,"borderColor",function(){return this._tf.borderColor},function(t){this._tf.borderColor=t}),a(0,t,"stroke",function(){return this._tf.stroke},function(t){this._tf.stroke=t}),a(0,t,"asPassword",function(){return this._tf.asPassword},function(t){this._tf.asPassword=t}),a(0,t,"measureHeight",function(){return this._tf.height}),a(0,t,"width",function(){return this._width||this._tf.text?e.prototype._$get_width.call(this):0},function(t){e.prototype._$set_width.call(this,t),this._tf.width=t}),a(0,t,"height",function(){return this._height||this._tf.text?e.prototype._$get_height.call(this):0},function(t){e.prototype._$set_height.call(this,t),this._tf.height=t}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.text=t+"":e.prototype._$set_dataSource.call(this,t)}),i}(L),O=function(e){function i(t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,i.__super.call(this),this.skin=t}n(i,"laya.ui.ProgressBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._bg=this._bar=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new D),this.addChild(this._bar=new D),this._bar._bitmap.autoCacheCmd=!1},t.changeValue=function(){if(this.sizeGrid){var t=this.sizeGrid.split(","),e=Number(t[0]),i=Number(t[2]),s=(this.width-e-i)*this._value;this._bar.width=e+i+s,this._bar.visible=this._bar.width>e+i}else this._bar.width=this.width*this._value},a(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),a(0,t,"bar",function(){return this._bar}),a(0,t,"measureHeight",function(){return this._bg.height}),a(0,t,"measureWidth",function(){return this._bg.width}),a(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=this._bar.sizeGrid=t}),a(0,t,"bg",function(){return this._bg}),a(0,t,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this._bg.height=this._height,this._bar.height=this._height}),a(0,t,"value",function(){return this._value},function(t){this._value!=t&&(t=1<t?1:t<0?0:t,this._value=t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(t))}),a(0,t,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this._bg.width=this._width,this.callLater(this.changeValue)}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):e.prototype._$set_dataSource.call(this,t)}),i}(L),F=function(e){function i(t,e){void 0===e&&(e=""),i.__super.call(this,t,e)}n(i,"laya.ui.CheckBox",e);var t=i.prototype;return t.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},t.initialize=function(){e.prototype.initialize.call(this),this._text.align="left",this._text.valign="top",this._text.width=0},a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"boolean"==typeof(this._dataSource=t)?this.selected=t:"string"==typeof t?this.selected="true"===t:e.prototype._$set_dataSource.call(this,t)}),i}(I),N=function(t){function u(){u.__super.call(this)}n(u,"laya.ui.View",M);var e=u.prototype;return e.createView=function(t){u.createComp(t,this,this)},e.loadUI=function(t){var e=u.uiMap[t];e&&this.createView(e)},u.createComp=function(t,e,i){e=e||u.getCompInstance(t);var s=t.child;if(s)for(var n=0,r=s.length;n<r;n++){var a=s[n];e.hasOwnProperty("itemRender")&&"render"==a.props.name?e.itemRender=a:e.addChild(u.createComp(a,null,i))}var o=t.props;for(var h in o){var l=o[h];u.setCompValue(e,h,l,i)}return e.initItems&&e.initItems(),e},u.setCompValue=function(t,e,i,s){"var"===e&&s?s[i]=t:"width"===e||"height"===e||"x"===e||"y"===e||"pivotX"===e||"pivotY"===e||"number"==typeof t[e]?t[e]=Number(i):t[e]="true"===i||"false"!==i&&i},u.getCompInstance=function(t){var e=t.props?t.props.runtime:"",i=e?u.viewClassMap[e]||r.__classmap[e]:u.uiClassMap[t.type];return i?new i:null},u.regComponent=function(t,e){u.uiClassMap[t]=e},u.regViewRuntime=function(t,e){u.viewClassMap[t]=e},u.uiMap={},u.viewClassMap={},s(u,["uiClassMap",function(){return this.uiClassMap={ViewStack:$,LinkButton:I,TextArea:it,ColorPicker:R,Box:M,Button:I,CheckBox:F,Clip:A,ComboBox:P,Component:L,HScrollBar:U,HSlider:Y,Image:D,Label:k,List:V,Panel:W,ProgressBar:O,Radio:G,RadioGroup:J,ScrollBar:E,Slider:B,Tab:tt,TextInput:q,View:u,VScrollBar:K,VSlider:j,Tree:X,HBox:Z,VBox:et}}]),u}(),z=function(e){function i(t,e){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,i.__super.call(this),this.skin=e,this.labels=t}n(i,"laya.ui.Group",e);var t=i.prototype;return r.imps(t,{"laya.ui.IItem":!0}),t.preinitialize=function(){this.mouseEnabled=!0},t.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},t.addItem=function(t,e){void 0===e&&(e=!0);var i=t,s=this._items.length;if(i.name="item"+s,this.addChild(i),this.initItems(),e&&0<s){var n=this._items[s-1];"horizontal"==this._direction?i.x=n.x+n.width+this._space:i.y=n.y+n.height+this._space}else e&&(i.x=0,i.y=0);return s},t.delItem=function(t,e){void 0===e&&(e=!0);var i=this._items.indexOf(t);if(-1!=i){var s=t;this.removeChild(s);for(var n=i+1,r=this._items.length;n<r;n++){var a=this._items[n];a.name="item"+(n-1),e&&("horizontal"==this._direction?a.x-=s.width+this._space:a.y-=s.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var o;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=o}}},t.initItems=function(){this._items||(this._items=[]);for(var t=this._items.length=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.selected=t===this._selectedIndex,e.clickHandler=p.create(this,this.itemClick,[t],!1)}},t.itemClick=function(t){this.selectedIndex=t},t.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].selected=e)},t.createItem=function(t,e){return null},t.changeLabels=function(){if(this._items)for(var t=0,e=0,i=this._items.length;e<i;e++){var s=this._items[e];this._skin&&(s.skin=this._skin),this._labelColors&&(s.labelColors=this._labelColors),this._labelSize&&(s.labelSize=this._labelSize),this._labelStroke&&(s.labelStroke=this._labelStroke),this._labelStrokeColor&&(s.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(s.strokeColors=this._strokeColors),this._labelBold&&(s.labelBold=this._labelBold),this._labelPadding&&(s.labelPadding=this._labelPadding),this._labelAlign&&(s.labelAlign=this._labelAlign),this._stateNum&&(s.stateNum=this._stateNum),"horizontal"===this._direction?(s.y=0,s.x=t,t+=s.width+this._space):(s.x=0,s.y=t,t+=s.height+this._space)}this.changeSize()},t.commitMeasure=function(){this.runCallLater(this.changeLabels)},a(0,t,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),a(0,t,"labelStrokeColor",function(){return this._labelStrokeColor},function(t){this._labelStrokeColor!=t&&(this._labelStrokeColor=t,this.callLater(this.changeLabels))}),a(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.callLater(this.changeLabels))}),a(0,t,"labels",function(){return this._labels},function(t){if(this._labels!=t){if(this._labels=t,this.removeChildren(),this.callLater(this.changeLabels),this._labels)for(var e=this._labels.split(","),i=0,s=e.length;i<s;i++){var n=this.createItem(this._skin,e[i]);n.name="item"+i,this.addChild(n)}this.initItems()}}),a(0,t,"labelColors",function(){return this._labelColors},function(t){this._labelColors!=t&&(this._labelColors=t,this.callLater(this.changeLabels))}),a(0,t,"labelStroke",function(){return this._labelStroke},function(t){this._labelStroke!=t&&(this._labelStroke=t,this.callLater(this.changeLabels))}),a(0,t,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=t,this.callLater(this.changeLabels))}),a(0,t,"strokeColors",function(){return this._strokeColors},function(t){this._strokeColors!=t&&(this._strokeColors=t,this.callLater(this.changeLabels))}),a(0,t,"labelSize",function(){return this._labelSize},function(t){this._labelSize!=t&&(this._labelSize=t,this.callLater(this.changeLabels))}),a(0,t,"space",function(){return this._space},function(t){this._space=t,this.callLater(this.changeLabels)}),a(0,t,"labelBold",function(){return this._labelBold},function(t){this._labelBold!=t&&(this._labelBold=t,this.callLater(this.changeLabels))}),a(0,t,"labelPadding",function(){return this._labelPadding},function(t){this._labelPadding!=t&&(this._labelPadding=t,this.callLater(this.changeLabels))}),a(0,t,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),a(0,t,"direction",function(){return this._direction},function(t){this._direction=t,this.callLater(this.changeLabels)}),a(0,t,"items",function(){return this._items}),a(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=int(t):t instanceof Array?this.labels=t.join(","):e.prototype._$set_dataSource.call(this,t)}),i}(M),H=function(t){function e(){this._space=0,this._align="none",e.__super.call(this)}n(e,"laya.ui.LayoutBox",M);var i=e.prototype;return i.addChild=function(t){return t.on("resize",this,this.onResize),this.callLater(this.changeItems),laya.display.Node.prototype.addChild.call(this,t)},i.onResize=function(t){this.callLater(this.changeItems)},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this.callLater(this.changeItems),laya.display.Node.prototype.addChildAt.call(this,t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this.callLater(this.changeItems),laya.display.Node.prototype.removeChild.call(this,t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this.callLater(this.changeItems),laya.display.Node.prototype.removeChildAt.call(this,t)},i.refresh=function(){this.callLater(this.changeItems)},i.changeItems=function(){},i.sortItem=function(t){t&&t.sort(function(t,e){return t.y>e.y?1:-1})},a(0,i,"space",function(){return this._space},function(t){this._space=t,this.callLater(this.changeItems)}),a(0,i,"align",function(){return this._align},function(t){this._align=t,this.callLater(this.changeItems)}),e}(),V=function(e){function t(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this._cacheBox=null,this.cacheContent=!1,t.__super.call(this),this._cells=[]}n(t,"laya.ui.List",e);var i=t.prototype;return r.imps(i,{"laya.ui.IItem":!0,"laya.ui.IRender":!0}),i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},i.createChildren=function(){this.addChild(this._content=new M)},i.onMouseDown=function(){this._$P.cacheAs=e.prototype._$get_cacheAs.call(this),e.prototype._$set_cacheAs.call(this,"none"),this._scrollBar&&this._scrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){e.prototype._$set_cacheAs.call(this,this._$P.cacheAs)},i.changeCells=function(){if(this._itemRender){for(var t=this._cells.length-1;-1<t;t--)this._cells[t].destroy();this._cells.length=0,this.scrollBar=this.getChildByName("scrollBar");var e=this.createItem(),i=e.width+this._spaceX,s=e.height+this._spaceY;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/i):Math.ceil(this._width/i)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/s):Math.round(this._height/s));var n=this._width?this._width:i*this.repeatX-this._spaceX,r=this._height?this._height:s*this.repeatY-this._spaceY;this._cellSize=this._isVertical?s:i,this._cellOffset=this._isVertical?s*Math.max(this._repeatY2,this._repeatY)-r-this._spaceY:i*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=r:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=n),this.setContentSize(n,r);var a=this._isVertical?this.repeatX:this.repeatY,o=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,a,o),this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},i._createItems=function(t,e,i){var s=this._content;this.cacheContent&&(this._cacheBox||(this._content.addChild(this._cacheBox=new M),this._cacheBox.cacheAsBitmap=!0),s=this._cacheBox);for(var n=t;n<i;n++)for(var r=0;r<e;r++){var a=this.createItem();a.x=(this._isVertical?r:n)*(a.width+this._spaceX),a.y=(this._isVertical?n:r)*(a.height+this._spaceY),a.name="item"+(n*e+r),s.addChild(a),this.addCell(a)}},i.createItem=function(){return"function"==typeof this._itemRender?new this._itemRender:N.createComp(this._itemRender)},i.addCell=function(t){t.on("click",this,this.onCellMouse),t.on("rightclick",this,this.onCellMouse),t.on("mouseover",this,this.onCellMouse),t.on("mouseout",this,this.onCellMouse),t.on("mousedown",this,this.onCellMouse),t.on("mouseup",this,this.onCellMouse),this._cells.push(t)},i.initItems=function(){if(!this._itemRender)for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(!e)break;this.addCell(e)}},i.setContentSize=function(t,e){this._content.width=t,this._content.height=e,this._scrollBar&&(this._content.scrollRect||(this._content.scrollRect=new g),this._content.scrollRect.setTo(0,0,t,e),this.event("resize"))},i.onCellMouse=function(t){"mousedown"===t.type&&(this._isMoved=!1);var e=t.currentTarget,i=this._startIndex+this._cells.indexOf(e);i<0||("click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(e,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===i||this.changeCellState(e,"mouseover"===t.type,0),this.mouseHandler&&this.mouseHandler.runWith([t,i]))},i.changeCellState=function(t,e,i){var s=t.getChildByName("selectBox");s&&(this.selectEnable=!0,s.visible=e,s.index=i)},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this._scrollBar&&r.timer.once(10,this,this.onScrollBarChange)},i.onScrollBarChange=function(t){this.runCallLater(this.changeCells);var e=this._scrollBar.value;if(!this.cacheContent){var i=this._isVertical?this.repeatX:this.repeatY,s=this._isVertical?this.repeatY:this.repeatX,n=Math.floor(e/this._cellSize)*i;if(n>this._startIndex){var r=n-this._startIndex,a=!0,o=this._startIndex+i*(s+1);this._isMoved=!0}else n<this._startIndex&&(r=this._startIndex-n,a=!1,o=this._startIndex-1,this._isMoved=!0);for(var h=0;h<r;h++){if(a){var l=this._cells.shift();this._cells[this._cells.length]=l;var u=o+h}else l=this._cells.pop(),this._cells.unshift(l),u=o-h;var c=Math.floor(u/i)*this._cellSize;this._isVertical?l.y=c:l.x=c,this.renderItem(l,u)}this._startIndex=n}this._isVertical?this._content.scrollRect.y=e:this._content.scrollRect.x=e,this.repaint()},i.posCell=function(t,e){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,s=(this._isVertical?this.repeatY:this.repeatX,Math.floor(e/i)*this._cellSize);this._isVertical?t.y=s:t.x=s}},i.changeSelectStatus=function(){for(var t=0,e=this._cells.length;t<e;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)},i.renderItems=function(){for(var t=0,e=this._cells.length;t<e;t++)this.renderItem(this._cells[t],this._startIndex+t);this.changeSelectStatus()},i.renderItem=function(t,e){0<=e&&e<this._array.length?(t.visible=!0,t.dataSource=this._array[e],this.posCell(t,e)):(t.visible=!1,t.dataSource=null),this.event("render",[t,e]),this.renderHandler&&this.renderHandler.runWith([t,e])},i.refresh=function(){this.array=this._array},i.getItem=function(t){return-1<t&&t<this._array.length?this._array[t]:null},i.changeItem=function(t,e){-1<t&&t<this._array.length&&(this._array[t]=e,t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t))},i.setItem=function(t,e){this.changeItem(t,e)},i.addItem=function(t){this._array.push(t),this.array=this._array},i.addItemAt=function(t,e){this._array.splice(e,0,t),this.array=this._array},i.deleteItem=function(t){this._array.splice(t,1),this.array=this._array},i.getCell=function(t){return this.runCallLater(this.changeCells),-1<t&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null},i.scrollTo=function(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else this.startIndex=t},i.tweenTo=function(t,e){if(void 0===e&&(e=200),this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY;v.to(this._scrollBar,{value:Math.floor(t/i)*this._cellSize},e,null,null,0,!0)}else this.startIndex=t},a(0,i,"cacheAs",e.prototype._$get_cacheAs,function(t){e.prototype._$set_cacheAs.call(this,t),this._scrollBar&&("none"!==t?this.on("mousedown",this,this.onMouseDown):this.off("mousedown",this,this.onMouseDown))}),a(0,i,"content",function(){return this._content}),a(0,i,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this.removeChildByName("scrollBar");var e=new U;e.name="scrollBar",e.bottom=0,e.skin=t,this.scrollBar=e,this.addChild(e),this.callLater(this.changeCells)}),a(0,i,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this.callLater(this.changeCells)}),a(0,i,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this.removeChildByName("scrollBar");var e=new K;e.name="scrollBar",e.right=0,e.skin=t,this.scrollBar=e,this.addChild(e),this.callLater(this.changeCells)}),a(0,i,"itemRender",function(){return this._itemRender},function(t){this._itemRender=t,this.callLater(this.changeCells)}),a(0,i,"scrollBar",function(){return this._scrollBar},function(t){this._scrollBar!=t&&(this._scrollBar=t)&&(this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange),this._isVertical=this._scrollBar.isVertical)}),a(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){if(this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t)),this.selectEnable&&this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;(t<this._startIndex||t+e>this._startIndex+this.repeatX*this.repeatY)&&this.scrollTo(t)}}),a(0,i,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this.callLater(this.changeCells)}),a(0,i,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(t){this._repeatX=t,this.callLater(this.changeCells)}),a(0,i,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(t){this._repeatY=t,this.callLater(this.changeCells)}),a(0,i,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,this.callLater(this.changeCells)}),a(0,i,"array",function(){return this._array},function(t){if(this.runCallLater(this.changeCells),this._array=t||[],this.cacheContent&&t.length>this._cells.length){var e=this._isVertical?this.repeatX:this.repeatY,i=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0),s=Math.ceil(t.length/e);this._createItems(i,e,s)}var n=this._array.length;if(this.totalPage=Math.ceil(n/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<n?this._selectedIndex:n-1,this.startIndex=this._startIndex,this._scrollBar){var r=this._isVertical?this.repeatX:this.repeatY,a=this._isVertical?this.repeatY:this.repeatX,o=Math.ceil(n/r),h=0<this._cellOffset?this.totalPage+1:this.totalPage;this._scrollBar.target=(1<h?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=a/o,this._scrollBar.setScroll(0,(o-a)*this._cellSize+this._cellOffset,this._isVertical?this._content.scrollRect.y:this._content.scrollRect.x)):this._scrollBar.setScroll(0,0,0),this._content)}}),a(0,i,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,this.callLater(this.changeCells)}),a(0,i,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(t){this.selectedIndex=this._array.indexOf(t)}),a(0,i,"selection",function(){return this.getCell(this._selectedIndex)},function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)}),a(0,i,"startIndex",function(){return this._startIndex},function(t){this._startIndex=0<t?t:0,this.callLater(this.renderItems)}),a(0,i,"page",function(){return this._page},function(t){this._page=t,this._array&&(this._page=0<t?t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),a(0,i,"length",function(){return this._array.length}),a(0,i,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=r.__parseInt(t):t instanceof Array?this.array=t:e.prototype._$set_dataSource.call(this,t)}),a(0,i,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),t}(M),W=function(e){function t(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,t.__super.call(this),this.width=this.height=100,this._content.optimizeFloat=!0}n(t,"laya.ui.Panel",e);var i=t.prototype;return i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._vScrollBar&&this._vScrollBar.destroy(t),this._hScrollBar&&this._hScrollBar.destroy(t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},i.destroyChildren=function(){this._content.destroyChildren()},i.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new M)},i.addChild=function(t){return t.on("resize",this,this.onResize),this.callLater(this.changeScroll),this._content.addChild(t)},i.onResize=function(t){this.callLater(this.changeScroll)},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this.callLater(this.changeScroll),this._content.addChildAt(t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this.callLater(this.changeScroll),this._content.removeChild(t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this.callLater(this.changeScroll),this._content.removeChildAt(t)},i.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);for(var i=this._content.numChildren-1;-1<i;i--)this._content.removeChildAt(i);return this.callLater(this.changeScroll),this},i.getChildAt=function(t){return this._content.getChildAt(t)},i.getChildByName=function(t){return this._content.getChildByName(t)},i.getChildIndex=function(t){return this._content.getChildIndex(t)},i.changeScroll=function(){var t=this.contentWidth,e=this.contentHeight,i=this._vScrollBar,s=this._hScrollBar,n=i&&e>this._height,r=s&&t>this._width,a=n?this._width-i.width:this._width,o=r?this._height-s.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(r?s.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=o/e,i.setScroll(0,e-o,i.value)),s&&(s.x=0,s.y=this._height-s.height,s.width=this._width-(n?i.width:0),s.scrollSize=Math.max(.033*this._width,1),s.thumbPercent=a/t,s.setScroll(0,t-a,s.value))},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},i.setContentSize=function(t,e){var i=this._content;i.width=t,i.height=e,i.scrollRect||(i.scrollRect=new g),i.scrollRect.setTo(0,0,t,e)},i.onScrollBarChange=function(t,e){var i=this._content.scrollRect;if(i){var s=Math.round(t.value);t.isVertical?i.y=s:i.x=s}},i.scrollTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.vScrollBar&&(this.vScrollBar.value=e),this.hScrollBar&&(this.hScrollBar.value=t)},i.refresh=function(){this.changeScroll()},i.onMouseDown=function(){this._$P.cacheAs=e.prototype._$get_cacheAs.call(this),e.prototype._$set_cacheAs.call(this,"none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){e.prototype._$set_cacheAs.call(this,this._$P.cacheAs)},a(0,i,"numChildren",function(){return this._content.numChildren}),a(0,i,"contentWidth",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.x+i.width*i.scaleX,t)}return t}),a(0,i,"contentHeight",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i.y+i.height*i.scaleY,t)}return t}),a(0,i,"vScrollBar",function(){return this._vScrollBar}),a(0,i,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this.callLater(this.changeScroll)}),a(0,i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new U),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this.callLater(this.changeScroll)),this._hScrollBar.skin=t}),a(0,i,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this.callLater(this.changeScroll)}),a(0,i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new K),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this.callLater(this.changeScroll)),this._vScrollBar.skin=t}),a(0,i,"hScrollBar",function(){return this._hScrollBar}),a(0,i,"content",function(){return this._content}),a(0,i,"cacheAs",e.prototype._$get_cacheAs,function(t){e.prototype._$set_cacheAs.call(this,t),"none"!==t?this.on("mousedown",this,this.onMouseDown):this.off("mousedown",this,this.onMouseDown)}),t}(M),U=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.HScrollBar",t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this._slider.isVertical=!1},e}(E),G=function(e){function i(t,e){this._value=null,void 0===e&&(e=""),i.__super.call(this,t,e)}n(i,"laya.ui.Radio",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._value=null},t.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},t.initialize=function(){e.prototype.initialize.call(this),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},t.onClick=function(t){this.selected=!0},a(0,t,"value",function(){return null!=this._value?this._value:this.label},function(t){this._value=t}),i}(I),Y=function(t){function e(t){e.__super.call(this,t),this.isVertical=!1}return n(e,"laya.ui.HSlider",B),e}(),X=function(e){function t(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,t.__super.call(this),this.width=this.height=200}n(t,"laya.ui.Tree",e);var i=t.prototype;return r.imps(i,{"laya.ui.IRender":!0}),i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._list&&this._list.destroy(t),this._list=null,this._source=null,this._renderHandler=null},i.createChildren=function(){this.addChild(this._list=new V),this._list.renderHandler=p.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},i.onListChange=function(t){this.event("change")},i.getArray=function(){var t,e=[];for(var i in this._source)t=this._source[i],this.getParentOpenStatus(t)&&(t.x=this._spaceLeft*this.getDepth(t),e.push(t));return e},i.getDepth=function(t,e){return void 0===e&&(e=0),null==t.nodeParent?e:this.getDepth(t.nodeParent,e+1)},i.getParentOpenStatus=function(t){var e=t.nodeParent;return null==e||!!e.isOpen&&(null==e.nodeParent||this.getParentOpenStatus(e))},i.renderItem=function(t,e){var i=t.dataSource;if(i){t.left=i.x;var s=t.getChildByName("arrow");s&&(i.hasChild?(s.visible=!0,s.index=i.isOpen?1:0,s.tag=e,s.off("click",this,this.onArrowClick),s.on("click",this,this.onArrowClick)):s.visible=!1);var n=t.getChildByName("folder");n&&(2==n.clipY?n.index=i.isDirectory?0:1:n.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([t,e])}},i.onArrowClick=function(t){var e=t.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this._list.array=this.getArray()},i.setItemState=function(t,e){this._list.array[t]&&(this._list.array[t].isOpen=e,this._list.array=this.getArray())},i.fresh=function(){this._list.array=this.getArray(),this.repaint()},i.parseXml=function(t,e,i,s){var n,r=t.childNodes,a=r.length;if(!s){n={};var o,h=t.attributes;for(var l in h){var u=(o=h[l]).nodeName,c=o.nodeValue;n[u]="true"==c||"false"!=c&&c}n.nodeParent=i,0<a&&(n.isDirectory=!0),n.hasChild=0<a,e.push(n)}for(var _=0;_<a;_++){var d=r[_];this.parseXml(d,e,n,!1)}},i.parseOpenStatus=function(t,e){for(var i=0,s=e.length;i<s;i++){var n=e[i];if(n.isDirectory)for(var r=0,a=t.length;r<a;r++){var o=t[r];if(o.isDirectory&&this.isSameParent(o,n)&&n.label==o.label){n.isOpen=o.isOpen;break}}}},i.isSameParent=function(t,e){return null==t.nodeParent&&null==e.nodeParent||null!=t.nodeParent&&null!=e.nodeParent&&(t.nodeParent.label==e.nodeParent.label&&this.isSameParent(t.nodeParent,e.nodeParent))},i.filter=function(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t),this._list.array=e}else this._list.array=this.getArray()},i.getFilterSource=function(t,e,i){var s;for(var n in i=i.toLocaleLowerCase(),t)!(s=t[n]).isDirectory&&-1<String(s.label).toLowerCase().indexOf(i)&&(s.x=0,e.push(s)),s.child&&0<s.child.length&&this.getFilterSource(s.child,e,i)},a(0,i,"keepStatus",function(){return this._keepStatus},function(t){this._keepStatus=t}),a(0,i,"list",function(){return this._list}),a(0,i,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(t){this._list.vScrollBarSkin=t}),a(0,i,"array",function(){return this._list.array},function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t),this._source=t,this._list.array=this.getArray()}),a(0,i,"selectedItem",function(){return this._list.selectedItem},function(t){this._list.selectedItem=t}),a(0,i,"source",function(){return this._source}),a(0,i,"itemRender",function(){return this._list.itemRender},function(t){this._list.itemRender=t}),a(0,i,"scrollBar",function(){return this._list.scrollBar}),a(0,i,"mouseHandler",function(){return this._list.mouseHandler},function(t){this._list.mouseHandler=t}),a(0,i,"renderHandler",function(){return this._renderHandler},function(t){this._renderHandler=t}),a(0,i,"spaceLeft",function(){return this._spaceLeft},function(t){this._spaceLeft=t}),a(0,i,"spaceBottom",function(){return this._list.spaceY},function(t){this._list.spaceY=t}),a(0,i,"selectedIndex",function(){return this._list.selectedIndex},function(t){this._list.selectedIndex=t}),a(0,i,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this._list.width=t}),a(0,i,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this._list.height=t}),a(0,i,"dataSource",e.prototype._$get_dataSource,function(t){this._dataSource=t,r.__typeof(t,laya.ui.XmlDom)?this.xml=t:e.prototype._$set_dataSource.call(this,t)}),a(0,i,"xml",null,function(t){var e=[];this.parseXml(t.childNodes[0],e,null,!0),this.array=e}),a(0,i,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),t}(M),$=function(t){function e(){this._items=null,this._selectedIndex=0,e.__super.call(this),this._setIndexHandler=p.create(this,this.setIndex,null,!1)}n(e,"laya.ui.ViewStack",t);var i=e.prototype;return r.imps(i,{"laya.ui.IItem":!0}),i.setItems=function(t){this.removeChildren();for(var e=0,i=0,s=t.length;i<s;i++){var n=t[i];n&&(n.name="item"+e,this.addChild(n),e++)}this.initItems()},i.addItem=function(t){t.name="item"+this._items.length,this.addChild(t),this.initItems()},i.initItems=function(){this._items=[];for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.visible=t==this._selectedIndex}},i.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].visible=e)},i.setIndex=function(t){this.selectedIndex=t},a(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(this._selectedIndex,!0))}),a(0,i,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),a(0,i,"setIndexHandler",function(){return this._setIndexHandler},function(t){this._setIndexHandler=t}),a(0,i,"items",function(){return this._items}),a(0,i,"dataSource",t.prototype._$get_dataSource,function(t){if("number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=int(t);else for(var e in this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])}),e}(M),K=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.VScrollBar",E),e}(),j=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.VSlider",B),e}(),q=function(e){function i(t){this._bg=null,this._skin=null,i.__super.call(this),void 0===t&&(t=""),this.text=t,this.skin=this.skin}n(i,"laya.ui.TextInput",e);var t=i.prototype;return t.preinitialize=function(){this.mouseEnabled=!0},t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(),this._bg=null},t.createChildren=function(){this.addChild(this._tf=new u),this._tf.padding=w.inputLabelPadding,this._tf.on("input",this,this.onInput),this._tf.on("enter",this,this.onEnter),this._tf.on("blur",this,this.onBlur),this._tf.on("focus",this,this.onFocus)},t.onFocus=function(t){this.event("focus",this)},t.onBlur=function(t){this.event("blur",this)},t.onInput=function(t){this.event("input",this)},t.onEnter=function(t){this.event("enter",this)},t.initialize=function(){this.width=128,this.height=22},t.select=function(){this._tf.select()},a(0,t,"bg",function(){return this._bg},function(t){this.graphics=this._bg=t}),a(0,t,"editable",function(){return this._tf.editable},function(t){this._tf.editable=t}),a(0,t,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(t){this._tf.inputElementYAdjuster=t}),a(0,t,"height",e.prototype._$get_height,function(t){e.prototype._$set_height.call(this,t),this._bg&&(this._bg.height=t)}),a(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg||(this.graphics=this._bg=new C),this._bg.source=h.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),a(0,t,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(t){this._bg||(this.graphics=this._bg=new C),this._bg.sizeGrid=T.fillArray(w.defaultSizeGrid,t,Number)}),a(0,t,"title",function(){return this._tf.title},function(t){this._tf.title=t}),a(0,t,"width",e.prototype._$get_width,function(t){e.prototype._$set_width.call(this,t),this._bg&&(this._bg.width=t)}),a(0,t,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(t){this._tf.inputElementXAdjuster=t}),a(0,t,"multiline",function(){return this._tf.multiline},function(t){this._tf.multiline=t}),a(0,t,"restrict",function(){return this._tf.restrict},function(t){this._tf.restrict=t}),a(0,t,"clearOnFocus",function(){return this._tf.clearOnFocus},function(t){this._tf.clearOnFocus=t}),a(0,t,"maxChars",function(){return this._tf.maxChars},function(t){this._tf.maxChars=t}),i}(k),Q=function(t){var e;function i(){this.popupCenter=!0,this.closeHandler=null,this._dragArea=null,i.__super.call(this)}n(i,"laya.ui.Dialog",N);var s=i.prototype;return s.initialize=function(){var t=this.getChildByName("drag");t&&(this.dragArea=t.x+","+t.y+","+t.width+","+t.height,t.removeSelf()),this.on("click",this,this.onClick)},s.onClick=function(t){var e=t.target;if(e)switch(e.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(e.name)}},s.show=function(t){void 0===t&&(t=!1),i.manager.show(this,t)},s.popup=function(t){void 0===t&&(t=!1),i.manager.popup(this,t)},s.close=function(t){i.manager.close(this),this.closeHandler&&this.closeHandler.runWith(t)},s.onMouseDown=function(t){var e=this.getMousePoint();this._dragArea.contains(e.x,e.y)?this.startDrag():this.stopDrag()},a(0,s,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(t){if(t){var e=T.fillArray([0,0,0,0],t,Number);this._dragArea=new g(e[0],e[1],e[2],e[3]),this.on("mousedown",this,this.onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this.onMouseDown)}),a(0,s,"isPopup",function(){return null!=this.parent}),a(1,i,"manager",function(){return i._manager||(i._manager=new e)},laya.ui.View._$SET_manager),i.closeAll=function(){i.manager.closeAll()},i.CLOSE="close",i.CANCEL="cancel",i.SURE="sure",i.NO="no",i.OK="ok",i.YES="yes",i._manager=null,i.__init$=function(){e=function(t){function e(){this._stage=null,e.__super.call(this),this.dialogLayer=new _,this.modalLayer=new _,this.mouseEnabled=this.dialogLayer.mouseEnabled=this.modalLayer.mouseEnabled=!0,this.addChild(this.dialogLayer),this._stage=r.stage,this._stage.addChild(this),this._stage.on("resize",this,this.onResize),this.onResize(null)}n(e,"",_);var i=e.prototype;return i.onResize=function(t){var e=this.modalLayer.width=this._stage.width,i=this.modalLayer.height=this._stage.height;this.modalLayer.graphics.clear(),this.modalLayer.graphics.alpha(S.popupBgAlpha),this.modalLayer.graphics.drawRect(0,0,e,i,S.popupBgColor),this.modalLayer.graphics.alpha(1);for(var s=this.dialogLayer.numChildren-1;-1<s;s--){var n=this.dialogLayer.getChildAt(s);n.popupCenter&&(n.x=.5*(e-n.width),n.y=.5*(i-n.height))}for(s=this.modalLayer.numChildren-1;-1<s;s--)(n=this.modalLayer.getChildAt(s)).isPopup&&n.popupCenter&&(n.x=.5*(e-n.width),n.y=.5*(i-n.height))},i.show=function(t,e){void 0===e&&(e=!1),e&&this.dialogLayer.removeChildren(),t.popupCenter&&(t.x=.5*(this._stage.width-t.width),t.y=.5*(this._stage.height-t.height)),this.dialogLayer.addChild(t),this.event("open")},i.popup=function(t,e){void 0===e&&(e=!1),e&&this.modalLayer.removeChildren(),t.popupCenter&&(t.x=.5*(this._stage.width-t.width),t.y=.5*(this._stage.height-t.height)),this.modalLayer.addChild(t),this.addChild(this.modalLayer),this.event("open")},i.close=function(t){t.removeSelf(),0===this.modalLayer.numChildren?this.modalLayer.removeSelf():this.showFirst(),this.event("close")},i.showFirst=function(){for(var t=0,e=this.modalLayer.numChildren-1;t<=e;t++)this.modalLayer.getChildAt(t).visible=t===e},i.closeAll=function(){this.dialogLayer.removeChildren(),this.modalLayer.removeChildren(),this.modalLayer.removeSelf(),this.event("close")},e}()},i}(),Z=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.HBox",H);var i=e.prototype;return i.sortItem=function(t){t&&t.sort(function(t,e){return t.x>e.x?1:-1})},i.changeItems=function(){for(var t=[],e=0,i=0,s=this.numChildren;i<s;i++){var n=this.getChildAt(i);n&&(t.push(n),e=Math.max(e,n.displayHeight))}this.sortItem(t);var r,a=0;for(r in t)(n=t[r]).x=a,a+=n.displayWidth+this._space,"top"==this._align?n.y=0:"middle"==this._align?n.y=.5*(e-n.displayHeight):"bottom"==this._align&&(n.y=e-n.displayHeight);this.changeSize()},e.NONE="none",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom",e}(),J=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.RadioGroup",z),e.prototype.createItem=function(t,e){return new G(t,e)},e}(),tt=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.Tab",z),e.prototype.createItem=function(t,e){return new I(t,e)},e}(),et=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.VBox",H),e.prototype.changeItems=function(){for(var t=[],e=0,i=0,s=this.numChildren;i<s;i++){var n=this.getChildAt(i);n&&(t.push(n),e=Math.max(e,n.displayWidth))}this.sortItem(t);var r,a=0;for(r in t)(n=t[r]).y=a,a+=n.displayHeight+this._space,"left"==this._align?n.x=0:"center"==this._align?n.x=.5*(e-n.displayWidth):"right"==this._align&&(n.x=e-n.displayWidth);this.changeSize()},e.NONE="none",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e}(),it=function(t){function e(t){void 0===t&&(t=""),e.__super.call(this,t),this.multiline=!0}return n(e,"laya.ui.TextArea",q),e}();r.__init([Q])}(window,document,Laya);var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)};window.View=laya.ui.View,window.Dialog=laya.ui.Dialog,function(i){var t=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(i.GameInfoUI.uiView)},e.uiView={type:"View",child:[{props:{x:403,y:10,skin:"war/btn_pause.png",stateNum:"1",var:"pauseBtn"},type:"Button"},{props:{x:107,y:24,text:"Level:50",color:"#f3e9e9",width:91,height:25,fontSize:20,var:"levelLabel"},type:"Label"},{props:{x:210,y:24,text:"Score:100",color:"#f8dd18",width:154,height:25,fontSize:20,var:"scoreLabel"},type:"Label"},{props:{x:24,y:24,text:"Hp:10",color:"#62f81c",width:74,height:25,fontSize:20,var:"hpLabel"},type:"Label"},{props:{x:44,y:408,text:"战斗结束",width:392,height:102,var:"infoLabel",align:"center",color:"#ffffff",fontSize:30,wordWrap:!0},type:"Label"}],props:{width:480,height:852}},e}(View);i.GameInfoUI=t}(window.ui||(window.ui={}));var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)};window.BackGround=function(t){function e(){t.call(this),this.init()}return __extends(e,t),e.prototype.init=function(){this.bg1=new Laya.Sprite,this.bg1.loadImage("res/background.png"),this.addChild(this.bg1),this.bg2=new Laya.Sprite,this.bg2.loadImage("res/background.png"),this.bg2.pos(0,-852),this.addChild(this.bg2),Laya.timer.frameLoop(1,this,this.onLoop)},e.prototype.onLoop=function(){this.y+=1,852<=this.bg1.y+this.y&&(this.bg1.y-=1704),852<=this.bg2.y+this.y&&(this.bg2.y-=1704)},e}(Laya.Sprite);var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)};window.Role=function(t){function a(){t.call(this),this.hitRadius=0,this.shootType=0,this.shootInterval=400,this.shootTime=Laya.Browser.now()+100,this.heroType=0}return __extends(a,t),a.prototype.init=function(t,e,i,s,n,r){void 0===r&&(r=0),this.type=t,this.camp=e,this.hp=i,this.speed=s,this.hitRadius=n,this.heroType=r,a.cached||(a.cached=!0,Laya.Animation.createFrames(["war/hero_fly1.png","war/hero_fly2.png"],"hero_fly"),Laya.Animation.createFrames(["war/hero_down1.png","war/hero_down2.png","war/hero_down3.png","war/hero_down4.png"],"hero_down"),Laya.Animation.createFrames(["war/enemy1_fly1.png"],"enemy1_fly"),Laya.Animation.createFrames(["war/enemy1_down1.png","war/enemy1_down2.png","war/enemy1_down3.png","war/enemy1_down4.png"],"enemy1_down"),Laya.Animation.createFrames(["war/enemy2_fly1.png"],"enemy2_fly"),Laya.Animation.createFrames(["war/enemy2_down1.png","war/enemy2_down2.png","war/enemy2_down3.png","war/enemy2_down4.png"],"enemy2_down"),Laya.Animation.createFrames(["war/enemy2_hit.png"],"enemy2_hit"),Laya.Animation.createFrames(["war/enemy3_fly1.png","war/enemy3_fly2.png"],"enemy3_fly"),Laya.Animation.createFrames(["war/enemy3_down1.png","war/enemy3_down2.png","war/enemy3_down3.png","war/enemy3_down4.png","war/enemy3_down5.png","war/enemy3_down6.png"],"enemy3_down"),Laya.Animation.createFrames(["war/enemy3_hit.png"],"enemy3_hit"),Laya.Animation.createFrames(["war/bullet1.png"],"bullet1_fly"),Laya.Animation.createFrames(["war/ufo1.png"],"ufo1_fly"),Laya.Animation.createFrames(["war/ufo2.png"],"ufo2_fly")),this.body||(this.body=new Laya.Animation,this.body.interval=50,this.addChild(this.body),this.body.on("complete",this,this.onPlayComplete)),this.playAction("fly")},a.prototype.onPlayComplete=function(){"down"===this.action?(this.body.stop(),this.visible=!1):"hit"===this.action&&this.playAction("fly")},a.prototype.playAction=function(t){this.action=t,this.body.play(0,!0,this.type+"_"+t);var e=this.body.getBounds();this.body.pos(-e.width/2,-e.height/2)},a.cached=!1,a}(Laya.Sprite);var __extends=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function s(){this.constructor=t}t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)};window.GameInfo=function(t){function e(){t.call(this),this.pauseBtn.on("click",this,this.onPauseBtnClick),this.reset()}return __extends(e,t),e.prototype.reset=function(){this.infoLabel.text="",this.hp(5),this.level(0),this.score(0)},e.prototype.onPauseBtnClick=function(t){t.stopPropagation(),this.infoLabel.text="The game has been suspended and resumed everywhere.",gameInstance.pause(),Laya.stage.once("click",this,this.onStageClick)},e.prototype.onStageClick=function(t){this.infoLabel.text="",gameInstance.resume()},e.prototype.hp=function(t){this.hpLabel.text="HP:"+t},e.prototype.level=function(t){this.levelLabel.text="Level:"+t},e.prototype.score=function(t){this.scoreLabel.text="Score:"+t},e}(ui.GameInfoUI),window.Game=function(){function t(){this.bulletPos=[[0],[-15,15],[-30,0,30],[-45,-15,15,45]],this.level=0,this.score=0,this.levelUpScore=10,this.bulletLevel=0,this.radius=[18,33,80],Laya.init(480,852,Laya.WebGL),Laya.loader.load("res/atlas/war.json",Laya.Handler.create(this,this.onLoaded),null,Laya.Loader.ATLAS),Laya.stage.scaleMode="showall",Laya.stage.alignH="center",Laya.stage.screenMode="vertical"}return t.prototype.onLoaded=function(){var t=new BackGround;Laya.stage.addChild(t),this.roleBox=new Laya.Sprite,Laya.stage.addChild(this.roleBox),this.gameInfo=new GameInfo,Laya.stage.addChild(this.gameInfo),this.hero=new Role,this.roleBox.addChild(this.hero),this.restart()},t.prototype.onLoop=function(){for(var t=this.roleBox.numChildren-1;-1<t;t--){var e=this.roleBox.getChildAt(t);if(e&&e.speed&&(e.y+=e.speed,(1e3<e.y||!e.visible||1===e.heroType&&e.y<-20)&&(e.removeSelf(),e.visible=!0,Laya.Pool.recover("role",e))),0<e.shootType){var i=Laya.Browser.now();if(i>e.shootTime){e.shootTime=i+e.shootInterval;for(var s=this.bulletPos[e.shootType-1],n=0;n<s.length;n++){var r=Laya.Pool.getItemByClass("role",Role);r.init("bullet1",e.camp,1,-5-e.shootType-Math.floor(this.level/15),1,1),r.pos(e.x+s[n],e.y-e.hitRadius-10),this.roleBox.addChild(r)}Laya.SoundManager.playSound("res/sound/bullet.mp3")}}}for(this.roleBox.numChildren,t=this.roleBox.numChildren-1;-1<t;t--){var a=this.roleBox.getChildAt(t);if(!(a.hp<1))for(var o=t-1;-1<o;o--)if(a.visible){var h=this.roleBox.getChildAt(o);if(0<h.hp&&a.camp!=h.camp){var l=a.hitRadius+h.hitRadius;Math.abs(a.x-h.x)<l&&Math.abs(a.y-h.y)<l&&(this.lostHp(a,1),this.lostHp(h,1),this.score++,this.gameInfo.score(this.score),this.score>this.levelUpScore&&(this.level++,this.gameInfo.level(this.level),this.levelUpScore+=5*this.level))}}}this.hero.hp<1&&(Laya.SoundManager.playSound("res/sound/game_over.mp3"),Laya.timer.clear(this,this.onLoop),this.gameInfo.infoLabel.text="GameOver，Score："+this.score+"\nClick here to start again.",this.gameInfo.infoLabel.once("click",this,this.restart));var u=this.level<30?2*this.level:60,c=Math.floor(this.level/6),_=Math.floor(this.level/8),d=Math.floor(this.level/10);Laya.timer.currFrame%(80-u)==0&&this.createEnemy(0,2+d,4+c,1),Laya.timer.currFrame%(150-2*u)==0&&this.createEnemy(1,1+d,3+c,2+2*_),Laya.timer.currFrame%(900-4*u)==0&&(this.createEnemy(2,1,1+c,10+5*_),Laya.SoundManager.playSound("res/sound/enemy3_out.mp3"))},t.prototype.restart=function(){this.score=0,this.level=0,this.levelUpScore=10,this.bulletLevel=0,this.gameInfo.reset(),this.hero.init("hero",0,5,0,30),this.hero.pos(240,700),this.hero.shootType=1,this.hero.shootInterval=400,this.hero.visible=!0;for(var t=this.roleBox.numChildren-1;-1<t;t--){var e=this.roleBox.getChildAt(t);e!=this.hero&&(e.removeSelf(),e.visible=!0,Laya.Pool.recover("role",e))}this.resume()},t.prototype.pause=function(){Laya.timer.clear(this,this.onLoop),Laya.stage.off("mousemove",this,this.onMouseMove)},t.prototype.resume=function(){Laya.timer.frameLoop(1,this,this.onLoop),Laya.stage.on("mousemove",this,this.onMouseMove)},t.prototype.lostHp=function(t,e){if(t.hp-=e,t==this.hero&&this.gameInfo.hp(t.hp),2===t.heroType)this.bulletLevel++,this.hero.shootType=Math.min(Math.floor(this.bulletLevel/2)+1,4),this.hero.shootInterval=400-16*(20<this.bulletLevel?20:this.bulletLevel),t.visible=!1,Laya.SoundManager.playSound("res/sound/achievement.mp3");else if(3===t.heroType)this.hero.hp++,10<this.hero.hp&&(this.hero.hp=10),t.visible=!1,this.gameInfo.hp(t.hp),Laya.SoundManager.playSound("res/sound/achievement.mp3");else if(0<t.hp)t.playAction("hit");else if(0<t.heroType)t.visible=!1;else if("hero"!=t.type&&Laya.SoundManager.playSound("res/sound/"+t.type+"_down.mp3"),t.playAction("down"),"enemy3"==t.type){var i=Math.random()<.7?2:3,s=Laya.Pool.getItemByClass("role",Role);s.init("ufo"+(i-1),t.camp,1,1,15,i),s.pos(t.x,t.y),this.roleBox.addChild(s)}},t.prototype.onMouseMove=function(t){this.hero.pos(Laya.stage.mouseX,Laya.stage.mouseY)},t.prototype.createEnemy=function(t,e,i,s){for(var n=0;n<e;n++){var r=Laya.Pool.getItemByClass("role",Role);r.init("enemy"+(t+1),1,s,i,this.radius[t]),r.pos(400*Math.random()+40,200*-Math.random()-100),this.roleBox.addChild(r)}},t}(),window.gameInstance = new Game(),window.gameInstance.pause();